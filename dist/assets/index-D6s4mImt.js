var rx=Object.defineProperty;var Qb=i=>{throw TypeError(i)};var ox=(i,e,t)=>e in i?rx(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var F=(i,e,t)=>ox(i,typeof e!="symbol"?e+"":e,t),cv=(i,e,t)=>e.has(i)||Qb("Cannot "+t);var a=(i,e,t)=>(cv(i,e,"read from private field"),t?t.call(i):e.get(i)),y=(i,e,t)=>e.has(i)?Qb("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),g=(i,e,t,n)=>(cv(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t),A=(i,e,t)=>(cv(i,e,"access private method"),t);var gt=(i,e,t,n)=>({set _(s){g(i,e,s,t)},get _(){return a(i,e,n)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();var Di=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ax(i){if(i.__esModule)return i;var e=i.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(i).forEach(function(n){var s=Object.getOwnPropertyDescriptor(i,n);Object.defineProperty(t,n,s.get?s:{enumerable:!0,get:function(){return i[n]}})}),t}var s1={exports:{}},My={},r1={exports:{}},de={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Vp=Symbol.for("react.element"),lx=Symbol.for("react.portal"),cx=Symbol.for("react.fragment"),ux=Symbol.for("react.strict_mode"),hx=Symbol.for("react.profiler"),dx=Symbol.for("react.provider"),fx=Symbol.for("react.context"),px=Symbol.for("react.forward_ref"),gx=Symbol.for("react.suspense"),mx=Symbol.for("react.memo"),yx=Symbol.for("react.lazy"),Jb=Symbol.iterator;function vx(i){return i===null||typeof i!="object"?null:(i=Jb&&i[Jb]||i["@@iterator"],typeof i=="function"?i:null)}var o1={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},a1=Object.assign,l1={};function xh(i,e,t){this.props=i,this.context=e,this.refs=l1,this.updater=t||o1}xh.prototype.isReactComponent={};xh.prototype.setState=function(i,e){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,e,"setState")};xh.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function c1(){}c1.prototype=xh.prototype;function O_(i,e,t){this.props=i,this.context=e,this.refs=l1,this.updater=t||o1}var M_=O_.prototype=new c1;M_.constructor=O_;a1(M_,xh.prototype);M_.isPureReactComponent=!0;var Zb=Array.isArray,u1=Object.prototype.hasOwnProperty,N_={current:null},h1={key:!0,ref:!0,__self:!0,__source:!0};function d1(i,e,t){var n,s={},r=null,o=null;if(e!=null)for(n in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(r=""+e.key),e)u1.call(e,n)&&!h1.hasOwnProperty(n)&&(s[n]=e[n]);var l=arguments.length-2;if(l===1)s.children=t;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];s.children=c}if(i&&i.defaultProps)for(n in l=i.defaultProps,l)s[n]===void 0&&(s[n]=l[n]);return{$$typeof:Vp,type:i,key:r,ref:o,props:s,_owner:N_.current}}function wx(i,e){return{$$typeof:Vp,type:i.type,key:e,ref:i.ref,props:i.props,_owner:i._owner}}function F_(i){return typeof i=="object"&&i!==null&&i.$$typeof===Vp}function _x(i){var e={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(t){return e[t]})}var eA=/\/+/g;function uv(i,e){return typeof i=="object"&&i!==null&&i.key!=null?_x(""+i.key):e.toString(36)}function Bg(i,e,t,n,s){var r=typeof i;(r==="undefined"||r==="boolean")&&(i=null);var o=!1;if(i===null)o=!0;else switch(r){case"string":case"number":o=!0;break;case"object":switch(i.$$typeof){case Vp:case lx:o=!0}}if(o)return o=i,s=s(o),i=n===""?"."+uv(o,0):n,Zb(s)?(t="",i!=null&&(t=i.replace(eA,"$&/")+"/"),Bg(s,e,t,"",function(u){return u})):s!=null&&(F_(s)&&(s=wx(s,t+(!s.key||o&&o.key===s.key?"":(""+s.key).replace(eA,"$&/")+"/")+i)),e.push(s)),1;if(o=0,n=n===""?".":n+":",Zb(i))for(var l=0;l<i.length;l++){r=i[l];var c=n+uv(r,l);o+=Bg(r,e,t,c,s)}else if(c=vx(i),typeof c=="function")for(i=c.call(i),l=0;!(r=i.next()).done;)r=r.value,c=n+uv(r,l++),o+=Bg(r,e,t,c,s);else if(r==="object")throw e=String(i),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function ag(i,e,t){if(i==null)return i;var n=[],s=0;return Bg(i,n,"","",function(r){return e.call(t,r,s++)}),n}function bx(i){if(i._status===-1){var e=i._result;e=e(),e.then(function(t){(i._status===0||i._status===-1)&&(i._status=1,i._result=t)},function(t){(i._status===0||i._status===-1)&&(i._status=2,i._result=t)}),i._status===-1&&(i._status=0,i._result=e)}if(i._status===1)return i._result.default;throw i._result}var _n={current:null},jg={transition:null},Ax={ReactCurrentDispatcher:_n,ReactCurrentBatchConfig:jg,ReactCurrentOwner:N_};function f1(){throw Error("act(...) is not supported in production builds of React.")}de.Children={map:ag,forEach:function(i,e,t){ag(i,function(){e.apply(this,arguments)},t)},count:function(i){var e=0;return ag(i,function(){e++}),e},toArray:function(i){return ag(i,function(e){return e})||[]},only:function(i){if(!F_(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};de.Component=xh;de.Fragment=cx;de.Profiler=hx;de.PureComponent=O_;de.StrictMode=ux;de.Suspense=gx;de.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ax;de.act=f1;de.cloneElement=function(i,e,t){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var n=a1({},i.props),s=i.key,r=i.ref,o=i._owner;if(e!=null){if(e.ref!==void 0&&(r=e.ref,o=N_.current),e.key!==void 0&&(s=""+e.key),i.type&&i.type.defaultProps)var l=i.type.defaultProps;for(c in e)u1.call(e,c)&&!h1.hasOwnProperty(c)&&(n[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)n.children=t;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];n.children=l}return{$$typeof:Vp,type:i.type,key:s,ref:r,props:n,_owner:o}};de.createContext=function(i){return i={$$typeof:fx,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:dx,_context:i},i.Consumer=i};de.createElement=d1;de.createFactory=function(i){var e=d1.bind(null,i);return e.type=i,e};de.createRef=function(){return{current:null}};de.forwardRef=function(i){return{$$typeof:px,render:i}};de.isValidElement=F_;de.lazy=function(i){return{$$typeof:yx,_payload:{_status:-1,_result:i},_init:bx}};de.memo=function(i,e){return{$$typeof:mx,type:i,compare:e===void 0?null:e}};de.startTransition=function(i){var e=jg.transition;jg.transition={};try{i()}finally{jg.transition=e}};de.unstable_act=f1;de.useCallback=function(i,e){return _n.current.useCallback(i,e)};de.useContext=function(i){return _n.current.useContext(i)};de.useDebugValue=function(){};de.useDeferredValue=function(i){return _n.current.useDeferredValue(i)};de.useEffect=function(i,e){return _n.current.useEffect(i,e)};de.useId=function(){return _n.current.useId()};de.useImperativeHandle=function(i,e,t){return _n.current.useImperativeHandle(i,e,t)};de.useInsertionEffect=function(i,e){return _n.current.useInsertionEffect(i,e)};de.useLayoutEffect=function(i,e){return _n.current.useLayoutEffect(i,e)};de.useMemo=function(i,e){return _n.current.useMemo(i,e)};de.useReducer=function(i,e,t){return _n.current.useReducer(i,e,t)};de.useRef=function(i){return _n.current.useRef(i)};de.useState=function(i){return _n.current.useState(i)};de.useSyncExternalStore=function(i,e,t){return _n.current.useSyncExternalStore(i,e,t)};de.useTransition=function(){return _n.current.useTransition()};de.version="18.3.1";r1.exports=de;var mn=r1.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sx=mn,Ex=Symbol.for("react.element"),kx=Symbol.for("react.fragment"),Cx=Object.prototype.hasOwnProperty,Tx=Sx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,xx={key:!0,ref:!0,__self:!0,__source:!0};function p1(i,e,t){var n,s={},r=null,o=null;t!==void 0&&(r=""+t),e.key!==void 0&&(r=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)Cx.call(e,n)&&!xx.hasOwnProperty(n)&&(s[n]=e[n]);if(i&&i.defaultProps)for(n in e=i.defaultProps,e)s[n]===void 0&&(s[n]=e[n]);return{$$typeof:Ex,type:i,key:r,ref:o,props:s,_owner:Tx.current}}My.Fragment=kx;My.jsx=p1;My.jsxs=p1;s1.exports=My;var le=s1.exports,g1={exports:{}},hi={},m1={exports:{}},y1={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function e(L,x){var P=L.length;L.push(x);e:for(;0<P;){var I=P-1>>>1,N=L[I];if(0<s(N,x))L[I]=x,L[P]=N,P=I;else break e}}function t(L){return L.length===0?null:L[0]}function n(L){if(L.length===0)return null;var x=L[0],P=L.pop();if(P!==x){L[0]=P;e:for(var I=0,N=L.length,$=N>>>1;I<$;){var Q=2*(I+1)-1,we=L[Q],_e=Q+1,ce=L[_e];if(0>s(we,P))_e<N&&0>s(ce,we)?(L[I]=ce,L[_e]=P,I=_e):(L[I]=we,L[Q]=P,I=Q);else if(_e<N&&0>s(ce,P))L[I]=ce,L[_e]=P,I=_e;else break e}}return x}function s(L,x){var P=L.sortIndex-x.sortIndex;return P!==0?P:L.id-x.id}if(typeof performance=="object"&&typeof performance.now=="function"){var r=performance;i.unstable_now=function(){return r.now()}}else{var o=Date,l=o.now();i.unstable_now=function(){return o.now()-l}}var c=[],u=[],h=1,d=null,f=3,p=!1,v=!1,b=!1,S=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function w(L){for(var x=t(u);x!==null;){if(x.callback===null)n(u);else if(x.startTime<=L)n(u),x.sortIndex=x.expirationTime,e(c,x);else break;x=t(u)}}function E(L){if(b=!1,w(L),!v)if(t(c)!==null)v=!0,q(k);else{var x=t(u);x!==null&&M(E,x.startTime-L)}}function k(L,x){v=!1,b&&(b=!1,m(R),R=-1),p=!0;var P=f;try{for(w(x),d=t(c);d!==null&&(!(d.expirationTime>x)||L&&!B());){var I=d.callback;if(typeof I=="function"){d.callback=null,f=d.priorityLevel;var N=I(d.expirationTime<=x);x=i.unstable_now(),typeof N=="function"?d.callback=N:d===t(c)&&n(c),w(x)}else n(c);d=t(c)}if(d!==null)var $=!0;else{var Q=t(u);Q!==null&&M(E,Q.startTime-x),$=!1}return $}finally{d=null,f=P,p=!1}}var C=!1,T=null,R=-1,D=5,O=-1;function B(){return!(i.unstable_now()-O<D)}function H(){if(T!==null){var L=i.unstable_now();O=L;var x=!0;try{x=T(!0,L)}finally{x?Y():(C=!1,T=null)}}else C=!1}var Y;if(typeof _=="function")Y=function(){_(H)};else if(typeof MessageChannel<"u"){var X=new MessageChannel,ee=X.port2;X.port1.onmessage=H,Y=function(){ee.postMessage(null)}}else Y=function(){S(H,0)};function q(L){T=L,C||(C=!0,Y())}function M(L,x){R=S(function(){L(i.unstable_now())},x)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(L){L.callback=null},i.unstable_continueExecution=function(){v||p||(v=!0,q(k))},i.unstable_forceFrameRate=function(L){0>L||125<L?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):D=0<L?Math.floor(1e3/L):5},i.unstable_getCurrentPriorityLevel=function(){return f},i.unstable_getFirstCallbackNode=function(){return t(c)},i.unstable_next=function(L){switch(f){case 1:case 2:case 3:var x=3;break;default:x=f}var P=f;f=x;try{return L()}finally{f=P}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(L,x){switch(L){case 1:case 2:case 3:case 4:case 5:break;default:L=3}var P=f;f=L;try{return x()}finally{f=P}},i.unstable_scheduleCallback=function(L,x,P){var I=i.unstable_now();switch(typeof P=="object"&&P!==null?(P=P.delay,P=typeof P=="number"&&0<P?I+P:I):P=I,L){case 1:var N=-1;break;case 2:N=250;break;case 5:N=1073741823;break;case 4:N=1e4;break;default:N=5e3}return N=P+N,L={id:h++,callback:x,priorityLevel:L,startTime:P,expirationTime:N,sortIndex:-1},P>I?(L.sortIndex=P,e(u,L),t(c)===null&&L===t(u)&&(b?(m(R),R=-1):b=!0,M(E,P-I))):(L.sortIndex=N,e(c,L),v||p||(v=!0,q(k))),L},i.unstable_shouldYield=B,i.unstable_wrapCallback=function(L){var x=f;return function(){var P=f;f=x;try{return L.apply(this,arguments)}finally{f=P}}}})(y1);m1.exports=y1;var Px=m1.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rx=mn,ui=Px;function j(i){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+i,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+i+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var v1=new Set,Id={};function nc(i,e){_h(i,e),_h(i+"Capture",e)}function _h(i,e){for(Id[i]=e,i=0;i<e.length;i++)v1.add(e[i])}var $r=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),n0=Object.prototype.hasOwnProperty,Lx=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,tA={},nA={};function Ix(i){return n0.call(nA,i)?!0:n0.call(tA,i)?!1:Lx.test(i)?nA[i]=!0:(tA[i]=!0,!1)}function Dx(i,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function Ox(i,e,t,n){if(e===null||typeof e>"u"||Dx(i,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function bn(i,e,t,n,s,r,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=s,this.mustUseProperty=t,this.propertyName=i,this.type=e,this.sanitizeURL=r,this.removeEmptyString=o}var qt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){qt[i]=new bn(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var e=i[0];qt[e]=new bn(e,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){qt[i]=new bn(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){qt[i]=new bn(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){qt[i]=new bn(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){qt[i]=new bn(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){qt[i]=new bn(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){qt[i]=new bn(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){qt[i]=new bn(i,5,!1,i.toLowerCase(),null,!1,!1)});var B_=/[\-:]([a-z])/g;function j_(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var e=i.replace(B_,j_);qt[e]=new bn(e,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var e=i.replace(B_,j_);qt[e]=new bn(e,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var e=i.replace(B_,j_);qt[e]=new bn(e,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){qt[i]=new bn(i,1,!1,i.toLowerCase(),null,!1,!1)});qt.xlinkHref=new bn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){qt[i]=new bn(i,1,!1,i.toLowerCase(),null,!0,!0)});function $_(i,e,t,n){var s=qt.hasOwnProperty(e)?qt[e]:null;(s!==null?s.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(Ox(e,t,s,n)&&(t=null),n||s===null?Ix(e)&&(t===null?i.removeAttribute(e):i.setAttribute(e,""+t)):s.mustUseProperty?i[s.propertyName]=t===null?s.type===3?!1:"":t:(e=s.attributeName,n=s.attributeNamespace,t===null?i.removeAttribute(e):(s=s.type,t=s===3||s===4&&t===!0?"":""+t,n?i.setAttributeNS(n,e,t):i.setAttribute(e,t))))}var Gr=Rx.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,lg=Symbol.for("react.element"),Ec=Symbol.for("react.portal"),kc=Symbol.for("react.fragment"),U_=Symbol.for("react.strict_mode"),i0=Symbol.for("react.profiler"),w1=Symbol.for("react.provider"),_1=Symbol.for("react.context"),z_=Symbol.for("react.forward_ref"),s0=Symbol.for("react.suspense"),r0=Symbol.for("react.suspense_list"),H_=Symbol.for("react.memo"),Qr=Symbol.for("react.lazy"),b1=Symbol.for("react.offscreen"),iA=Symbol.iterator;function Oh(i){return i===null||typeof i!="object"?null:(i=iA&&i[iA]||i["@@iterator"],typeof i=="function"?i:null)}var Ze=Object.assign,hv;function Kh(i){if(hv===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);hv=e&&e[1]||""}return`
`+hv+i}var dv=!1;function fv(i,e){if(!i||dv)return"";dv=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var n=u}Reflect.construct(i,[],e)}else{try{e.call()}catch(u){n=u}i.call(e.prototype)}else{try{throw Error()}catch(u){n=u}i()}}catch(u){if(u&&n&&typeof u.stack=="string"){for(var s=u.stack.split(`
`),r=n.stack.split(`
`),o=s.length-1,l=r.length-1;1<=o&&0<=l&&s[o]!==r[l];)l--;for(;1<=o&&0<=l;o--,l--)if(s[o]!==r[l]){if(o!==1||l!==1)do if(o--,l--,0>l||s[o]!==r[l]){var c=`
`+s[o].replace(" at new "," at ");return i.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",i.displayName)),c}while(1<=o&&0<=l);break}}}finally{dv=!1,Error.prepareStackTrace=t}return(i=i?i.displayName||i.name:"")?Kh(i):""}function Mx(i){switch(i.tag){case 5:return Kh(i.type);case 16:return Kh("Lazy");case 13:return Kh("Suspense");case 19:return Kh("SuspenseList");case 0:case 2:case 15:return i=fv(i.type,!1),i;case 11:return i=fv(i.type.render,!1),i;case 1:return i=fv(i.type,!0),i;default:return""}}function o0(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case kc:return"Fragment";case Ec:return"Portal";case i0:return"Profiler";case U_:return"StrictMode";case s0:return"Suspense";case r0:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case _1:return(i.displayName||"Context")+".Consumer";case w1:return(i._context.displayName||"Context")+".Provider";case z_:var e=i.render;return i=i.displayName,i||(i=e.displayName||e.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case H_:return e=i.displayName||null,e!==null?e:o0(i.type)||"Memo";case Qr:e=i._payload,i=i._init;try{return o0(i(e))}catch{}}return null}function Nx(i){var e=i.type;switch(i.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=e.render,i=i.displayName||i.name||"",e.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return o0(e);case 8:return e===U_?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ra(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function A1(i){var e=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function Fx(i){var e=A1(i)?"checked":"value",t=Object.getOwnPropertyDescriptor(i.constructor.prototype,e),n=""+i[e];if(!i.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var s=t.get,r=t.set;return Object.defineProperty(i,e,{configurable:!0,get:function(){return s.call(this)},set:function(o){n=""+o,r.call(this,o)}}),Object.defineProperty(i,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){i._valueTracker=null,delete i[e]}}}}function cg(i){i._valueTracker||(i._valueTracker=Fx(i))}function S1(i){if(!i)return!1;var e=i._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return i&&(n=A1(i)?i.checked?"true":"false":i.value),i=n,i!==t?(e.setValue(i),!0):!1}function Rm(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function a0(i,e){var t=e.checked;return Ze({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??i._wrapperState.initialChecked})}function sA(i,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=ra(e.value!=null?e.value:t),i._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function E1(i,e){e=e.checked,e!=null&&$_(i,"checked",e,!1)}function l0(i,e){E1(i,e);var t=ra(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&i.value===""||i.value!=t)&&(i.value=""+t):i.value!==""+t&&(i.value=""+t);else if(n==="submit"||n==="reset"){i.removeAttribute("value");return}e.hasOwnProperty("value")?c0(i,e.type,t):e.hasOwnProperty("defaultValue")&&c0(i,e.type,ra(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(i.defaultChecked=!!e.defaultChecked)}function rA(i,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+i._wrapperState.initialValue,t||e===i.value||(i.value=e),i.defaultValue=e}t=i.name,t!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,t!==""&&(i.name=t)}function c0(i,e,t){(e!=="number"||Rm(i.ownerDocument)!==i)&&(t==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+t&&(i.defaultValue=""+t))}var Xh=Array.isArray;function zc(i,e,t,n){if(i=i.options,e){e={};for(var s=0;s<t.length;s++)e["$"+t[s]]=!0;for(t=0;t<i.length;t++)s=e.hasOwnProperty("$"+i[t].value),i[t].selected!==s&&(i[t].selected=s),s&&n&&(i[t].defaultSelected=!0)}else{for(t=""+ra(t),e=null,s=0;s<i.length;s++){if(i[s].value===t){i[s].selected=!0,n&&(i[s].defaultSelected=!0);return}e!==null||i[s].disabled||(e=i[s])}e!==null&&(e.selected=!0)}}function u0(i,e){if(e.dangerouslySetInnerHTML!=null)throw Error(j(91));return Ze({},e,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function oA(i,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(j(92));if(Xh(t)){if(1<t.length)throw Error(j(93));t=t[0]}e=t}e==null&&(e=""),t=e}i._wrapperState={initialValue:ra(t)}}function k1(i,e){var t=ra(e.value),n=ra(e.defaultValue);t!=null&&(t=""+t,t!==i.value&&(i.value=t),e.defaultValue==null&&i.defaultValue!==t&&(i.defaultValue=t)),n!=null&&(i.defaultValue=""+n)}function aA(i){var e=i.textContent;e===i._wrapperState.initialValue&&e!==""&&e!==null&&(i.value=e)}function C1(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function h0(i,e){return i==null||i==="http://www.w3.org/1999/xhtml"?C1(e):i==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var ug,T1=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,s){MSApp.execUnsafeLocalFunction(function(){return i(e,t,n,s)})}:i}(function(i,e){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=e;else{for(ug=ug||document.createElement("div"),ug.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ug.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;e.firstChild;)i.appendChild(e.firstChild)}});function Dd(i,e){if(e){var t=i.firstChild;if(t&&t===i.lastChild&&t.nodeType===3){t.nodeValue=e;return}}i.textContent=e}var _d={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Bx=["Webkit","ms","Moz","O"];Object.keys(_d).forEach(function(i){Bx.forEach(function(e){e=e+i.charAt(0).toUpperCase()+i.substring(1),_d[e]=_d[i]})});function x1(i,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||_d.hasOwnProperty(i)&&_d[i]?(""+e).trim():e+"px"}function P1(i,e){i=i.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,s=x1(t,e[t],n);t==="float"&&(t="cssFloat"),n?i.setProperty(t,s):i[t]=s}}var jx=Ze({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function d0(i,e){if(e){if(jx[i]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(j(137,i));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(j(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(j(61))}if(e.style!=null&&typeof e.style!="object")throw Error(j(62))}}function f0(i,e){if(i.indexOf("-")===-1)return typeof e.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var p0=null;function W_(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var g0=null,Hc=null,Wc=null;function lA(i){if(i=Kp(i)){if(typeof g0!="function")throw Error(j(280));var e=i.stateNode;e&&(e=$y(e),g0(i.stateNode,i.type,e))}}function R1(i){Hc?Wc?Wc.push(i):Wc=[i]:Hc=i}function L1(){if(Hc){var i=Hc,e=Wc;if(Wc=Hc=null,lA(i),e)for(i=0;i<e.length;i++)lA(e[i])}}function I1(i,e){return i(e)}function D1(){}var pv=!1;function O1(i,e,t){if(pv)return i(e,t);pv=!0;try{return I1(i,e,t)}finally{pv=!1,(Hc!==null||Wc!==null)&&(D1(),L1())}}function Od(i,e){var t=i.stateNode;if(t===null)return null;var n=$y(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(i=i.type,n=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!n;break e;default:i=!1}if(i)return null;if(t&&typeof t!="function")throw Error(j(231,e,typeof t));return t}var m0=!1;if($r)try{var Mh={};Object.defineProperty(Mh,"passive",{get:function(){m0=!0}}),window.addEventListener("test",Mh,Mh),window.removeEventListener("test",Mh,Mh)}catch{m0=!1}function $x(i,e,t,n,s,r,o,l,c){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(h){this.onError(h)}}var bd=!1,Lm=null,Im=!1,y0=null,Ux={onError:function(i){bd=!0,Lm=i}};function zx(i,e,t,n,s,r,o,l,c){bd=!1,Lm=null,$x.apply(Ux,arguments)}function Hx(i,e,t,n,s,r,o,l,c){if(zx.apply(this,arguments),bd){if(bd){var u=Lm;bd=!1,Lm=null}else throw Error(j(198));Im||(Im=!0,y0=u)}}function ic(i){var e=i,t=i;if(i.alternate)for(;e.return;)e=e.return;else{i=e;do e=i,e.flags&4098&&(t=e.return),i=e.return;while(i)}return e.tag===3?t:null}function M1(i){if(i.tag===13){var e=i.memoizedState;if(e===null&&(i=i.alternate,i!==null&&(e=i.memoizedState)),e!==null)return e.dehydrated}return null}function cA(i){if(ic(i)!==i)throw Error(j(188))}function Wx(i){var e=i.alternate;if(!e){if(e=ic(i),e===null)throw Error(j(188));return e!==i?null:i}for(var t=i,n=e;;){var s=t.return;if(s===null)break;var r=s.alternate;if(r===null){if(n=s.return,n!==null){t=n;continue}break}if(s.child===r.child){for(r=s.child;r;){if(r===t)return cA(s),i;if(r===n)return cA(s),e;r=r.sibling}throw Error(j(188))}if(t.return!==n.return)t=s,n=r;else{for(var o=!1,l=s.child;l;){if(l===t){o=!0,t=s,n=r;break}if(l===n){o=!0,n=s,t=r;break}l=l.sibling}if(!o){for(l=r.child;l;){if(l===t){o=!0,t=r,n=s;break}if(l===n){o=!0,n=r,t=s;break}l=l.sibling}if(!o)throw Error(j(189))}}if(t.alternate!==n)throw Error(j(190))}if(t.tag!==3)throw Error(j(188));return t.stateNode.current===t?i:e}function N1(i){return i=Wx(i),i!==null?F1(i):null}function F1(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var e=F1(i);if(e!==null)return e;i=i.sibling}return null}var B1=ui.unstable_scheduleCallback,uA=ui.unstable_cancelCallback,Vx=ui.unstable_shouldYield,Gx=ui.unstable_requestPaint,ct=ui.unstable_now,qx=ui.unstable_getCurrentPriorityLevel,V_=ui.unstable_ImmediatePriority,j1=ui.unstable_UserBlockingPriority,Dm=ui.unstable_NormalPriority,Kx=ui.unstable_LowPriority,$1=ui.unstable_IdlePriority,Ny=null,$s=null;function Xx(i){if($s&&typeof $s.onCommitFiberRoot=="function")try{$s.onCommitFiberRoot(Ny,i,void 0,(i.current.flags&128)===128)}catch{}}var os=Math.clz32?Math.clz32:Jx,Yx=Math.log,Qx=Math.LN2;function Jx(i){return i>>>=0,i===0?32:31-(Yx(i)/Qx|0)|0}var hg=64,dg=4194304;function Yh(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function Om(i,e){var t=i.pendingLanes;if(t===0)return 0;var n=0,s=i.suspendedLanes,r=i.pingedLanes,o=t&268435455;if(o!==0){var l=o&~s;l!==0?n=Yh(l):(r&=o,r!==0&&(n=Yh(r)))}else o=t&~s,o!==0?n=Yh(o):r!==0&&(n=Yh(r));if(n===0)return 0;if(e!==0&&e!==n&&!(e&s)&&(s=n&-n,r=e&-e,s>=r||s===16&&(r&4194240)!==0))return e;if(n&4&&(n|=t&16),e=i.entangledLanes,e!==0)for(i=i.entanglements,e&=n;0<e;)t=31-os(e),s=1<<t,n|=i[t],e&=~s;return n}function Zx(i,e){switch(i){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function eP(i,e){for(var t=i.suspendedLanes,n=i.pingedLanes,s=i.expirationTimes,r=i.pendingLanes;0<r;){var o=31-os(r),l=1<<o,c=s[o];c===-1?(!(l&t)||l&n)&&(s[o]=Zx(l,e)):c<=e&&(i.expiredLanes|=l),r&=~l}}function v0(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function U1(){var i=hg;return hg<<=1,!(hg&4194240)&&(hg=64),i}function gv(i){for(var e=[],t=0;31>t;t++)e.push(i);return e}function Gp(i,e,t){i.pendingLanes|=e,e!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,e=31-os(e),i[e]=t}function tP(i,e){var t=i.pendingLanes&~e;i.pendingLanes=e,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=e,i.mutableReadLanes&=e,i.entangledLanes&=e,e=i.entanglements;var n=i.eventTimes;for(i=i.expirationTimes;0<t;){var s=31-os(t),r=1<<s;e[s]=0,n[s]=-1,i[s]=-1,t&=~r}}function G_(i,e){var t=i.entangledLanes|=e;for(i=i.entanglements;t;){var n=31-os(t),s=1<<n;s&e|i[n]&e&&(i[n]|=e),t&=~s}}var ke=0;function z1(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var H1,q_,W1,V1,G1,w0=!1,fg=[],Qo=null,Jo=null,Zo=null,Md=new Map,Nd=new Map,Zr=[],nP="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function hA(i,e){switch(i){case"focusin":case"focusout":Qo=null;break;case"dragenter":case"dragleave":Jo=null;break;case"mouseover":case"mouseout":Zo=null;break;case"pointerover":case"pointerout":Md.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Nd.delete(e.pointerId)}}function Nh(i,e,t,n,s,r){return i===null||i.nativeEvent!==r?(i={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:r,targetContainers:[s]},e!==null&&(e=Kp(e),e!==null&&q_(e)),i):(i.eventSystemFlags|=n,e=i.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),i)}function iP(i,e,t,n,s){switch(e){case"focusin":return Qo=Nh(Qo,i,e,t,n,s),!0;case"dragenter":return Jo=Nh(Jo,i,e,t,n,s),!0;case"mouseover":return Zo=Nh(Zo,i,e,t,n,s),!0;case"pointerover":var r=s.pointerId;return Md.set(r,Nh(Md.get(r)||null,i,e,t,n,s)),!0;case"gotpointercapture":return r=s.pointerId,Nd.set(r,Nh(Nd.get(r)||null,i,e,t,n,s)),!0}return!1}function q1(i){var e=xa(i.target);if(e!==null){var t=ic(e);if(t!==null){if(e=t.tag,e===13){if(e=M1(t),e!==null){i.blockedOn=e,G1(i.priority,function(){W1(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){i.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}i.blockedOn=null}function $g(i){if(i.blockedOn!==null)return!1;for(var e=i.targetContainers;0<e.length;){var t=_0(i.domEventName,i.eventSystemFlags,e[0],i.nativeEvent);if(t===null){t=i.nativeEvent;var n=new t.constructor(t.type,t);p0=n,t.target.dispatchEvent(n),p0=null}else return e=Kp(t),e!==null&&q_(e),i.blockedOn=t,!1;e.shift()}return!0}function dA(i,e,t){$g(i)&&t.delete(e)}function sP(){w0=!1,Qo!==null&&$g(Qo)&&(Qo=null),Jo!==null&&$g(Jo)&&(Jo=null),Zo!==null&&$g(Zo)&&(Zo=null),Md.forEach(dA),Nd.forEach(dA)}function Fh(i,e){i.blockedOn===e&&(i.blockedOn=null,w0||(w0=!0,ui.unstable_scheduleCallback(ui.unstable_NormalPriority,sP)))}function Fd(i){function e(s){return Fh(s,i)}if(0<fg.length){Fh(fg[0],i);for(var t=1;t<fg.length;t++){var n=fg[t];n.blockedOn===i&&(n.blockedOn=null)}}for(Qo!==null&&Fh(Qo,i),Jo!==null&&Fh(Jo,i),Zo!==null&&Fh(Zo,i),Md.forEach(e),Nd.forEach(e),t=0;t<Zr.length;t++)n=Zr[t],n.blockedOn===i&&(n.blockedOn=null);for(;0<Zr.length&&(t=Zr[0],t.blockedOn===null);)q1(t),t.blockedOn===null&&Zr.shift()}var Vc=Gr.ReactCurrentBatchConfig,Mm=!0;function rP(i,e,t,n){var s=ke,r=Vc.transition;Vc.transition=null;try{ke=1,K_(i,e,t,n)}finally{ke=s,Vc.transition=r}}function oP(i,e,t,n){var s=ke,r=Vc.transition;Vc.transition=null;try{ke=4,K_(i,e,t,n)}finally{ke=s,Vc.transition=r}}function K_(i,e,t,n){if(Mm){var s=_0(i,e,t,n);if(s===null)kv(i,e,n,Nm,t),hA(i,n);else if(iP(s,i,e,t,n))n.stopPropagation();else if(hA(i,n),e&4&&-1<nP.indexOf(i)){for(;s!==null;){var r=Kp(s);if(r!==null&&H1(r),r=_0(i,e,t,n),r===null&&kv(i,e,n,Nm,t),r===s)break;s=r}s!==null&&n.stopPropagation()}else kv(i,e,n,null,t)}}var Nm=null;function _0(i,e,t,n){if(Nm=null,i=W_(n),i=xa(i),i!==null)if(e=ic(i),e===null)i=null;else if(t=e.tag,t===13){if(i=M1(e),i!==null)return i;i=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;i=null}else e!==i&&(i=null);return Nm=i,null}function K1(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(qx()){case V_:return 1;case j1:return 4;case Dm:case Kx:return 16;case $1:return 536870912;default:return 16}default:return 16}}var Xo=null,X_=null,Ug=null;function X1(){if(Ug)return Ug;var i,e=X_,t=e.length,n,s="value"in Xo?Xo.value:Xo.textContent,r=s.length;for(i=0;i<t&&e[i]===s[i];i++);var o=t-i;for(n=1;n<=o&&e[t-n]===s[r-n];n++);return Ug=s.slice(i,1<n?1-n:void 0)}function zg(i){var e=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&e===13&&(i=13)):i=e,i===10&&(i=13),32<=i||i===13?i:0}function pg(){return!0}function fA(){return!1}function di(i){function e(t,n,s,r,o){this._reactName=t,this._targetInst=s,this.type=n,this.nativeEvent=r,this.target=o,this.currentTarget=null;for(var l in i)i.hasOwnProperty(l)&&(t=i[l],this[l]=t?t(r):r[l]);return this.isDefaultPrevented=(r.defaultPrevented!=null?r.defaultPrevented:r.returnValue===!1)?pg:fA,this.isPropagationStopped=fA,this}return Ze(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=pg)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=pg)},persist:function(){},isPersistent:pg}),e}var Ph={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Y_=di(Ph),qp=Ze({},Ph,{view:0,detail:0}),aP=di(qp),mv,yv,Bh,Fy=Ze({},qp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Q_,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Bh&&(Bh&&i.type==="mousemove"?(mv=i.screenX-Bh.screenX,yv=i.screenY-Bh.screenY):yv=mv=0,Bh=i),mv)},movementY:function(i){return"movementY"in i?i.movementY:yv}}),pA=di(Fy),lP=Ze({},Fy,{dataTransfer:0}),cP=di(lP),uP=Ze({},qp,{relatedTarget:0}),vv=di(uP),hP=Ze({},Ph,{animationName:0,elapsedTime:0,pseudoElement:0}),dP=di(hP),fP=Ze({},Ph,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),pP=di(fP),gP=Ze({},Ph,{data:0}),gA=di(gP),mP={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},yP={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},vP={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function wP(i){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(i):(i=vP[i])?!!e[i]:!1}function Q_(){return wP}var _P=Ze({},qp,{key:function(i){if(i.key){var e=mP[i.key]||i.key;if(e!=="Unidentified")return e}return i.type==="keypress"?(i=zg(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?yP[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Q_,charCode:function(i){return i.type==="keypress"?zg(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?zg(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),bP=di(_P),AP=Ze({},Fy,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),mA=di(AP),SP=Ze({},qp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Q_}),EP=di(SP),kP=Ze({},Ph,{propertyName:0,elapsedTime:0,pseudoElement:0}),CP=di(kP),TP=Ze({},Fy,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),xP=di(TP),PP=[9,13,27,32],J_=$r&&"CompositionEvent"in window,Ad=null;$r&&"documentMode"in document&&(Ad=document.documentMode);var RP=$r&&"TextEvent"in window&&!Ad,Y1=$r&&(!J_||Ad&&8<Ad&&11>=Ad),yA=" ",vA=!1;function Q1(i,e){switch(i){case"keyup":return PP.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function J1(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var Cc=!1;function LP(i,e){switch(i){case"compositionend":return J1(e);case"keypress":return e.which!==32?null:(vA=!0,yA);case"textInput":return i=e.data,i===yA&&vA?null:i;default:return null}}function IP(i,e){if(Cc)return i==="compositionend"||!J_&&Q1(i,e)?(i=X1(),Ug=X_=Xo=null,Cc=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return Y1&&e.locale!=="ko"?null:e.data;default:return null}}var DP={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function wA(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e==="input"?!!DP[i.type]:e==="textarea"}function Z1(i,e,t,n){R1(n),e=Fm(e,"onChange"),0<e.length&&(t=new Y_("onChange","change",null,t,n),i.push({event:t,listeners:e}))}var Sd=null,Bd=null;function OP(i){uE(i,0)}function By(i){var e=Pc(i);if(S1(e))return i}function MP(i,e){if(i==="change")return e}var eE=!1;if($r){var wv;if($r){var _v="oninput"in document;if(!_v){var _A=document.createElement("div");_A.setAttribute("oninput","return;"),_v=typeof _A.oninput=="function"}wv=_v}else wv=!1;eE=wv&&(!document.documentMode||9<document.documentMode)}function bA(){Sd&&(Sd.detachEvent("onpropertychange",tE),Bd=Sd=null)}function tE(i){if(i.propertyName==="value"&&By(Bd)){var e=[];Z1(e,Bd,i,W_(i)),O1(OP,e)}}function NP(i,e,t){i==="focusin"?(bA(),Sd=e,Bd=t,Sd.attachEvent("onpropertychange",tE)):i==="focusout"&&bA()}function FP(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return By(Bd)}function BP(i,e){if(i==="click")return By(e)}function jP(i,e){if(i==="input"||i==="change")return By(e)}function $P(i,e){return i===e&&(i!==0||1/i===1/e)||i!==i&&e!==e}var ls=typeof Object.is=="function"?Object.is:$P;function jd(i,e){if(ls(i,e))return!0;if(typeof i!="object"||i===null||typeof e!="object"||e===null)return!1;var t=Object.keys(i),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var s=t[n];if(!n0.call(e,s)||!ls(i[s],e[s]))return!1}return!0}function AA(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function SA(i,e){var t=AA(i);i=0;for(var n;t;){if(t.nodeType===3){if(n=i+t.textContent.length,i<=e&&n>=e)return{node:t,offset:e-i};i=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=AA(t)}}function nE(i,e){return i&&e?i===e?!0:i&&i.nodeType===3?!1:e&&e.nodeType===3?nE(i,e.parentNode):"contains"in i?i.contains(e):i.compareDocumentPosition?!!(i.compareDocumentPosition(e)&16):!1:!1}function iE(){for(var i=window,e=Rm();e instanceof i.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)i=e.contentWindow;else break;e=Rm(i.document)}return e}function Z_(i){var e=i&&i.nodeName&&i.nodeName.toLowerCase();return e&&(e==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||e==="textarea"||i.contentEditable==="true")}function UP(i){var e=iE(),t=i.focusedElem,n=i.selectionRange;if(e!==t&&t&&t.ownerDocument&&nE(t.ownerDocument.documentElement,t)){if(n!==null&&Z_(t)){if(e=n.start,i=n.end,i===void 0&&(i=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(i,t.value.length);else if(i=(e=t.ownerDocument||document)&&e.defaultView||window,i.getSelection){i=i.getSelection();var s=t.textContent.length,r=Math.min(n.start,s);n=n.end===void 0?r:Math.min(n.end,s),!i.extend&&r>n&&(s=n,n=r,r=s),s=SA(t,r);var o=SA(t,n);s&&o&&(i.rangeCount!==1||i.anchorNode!==s.node||i.anchorOffset!==s.offset||i.focusNode!==o.node||i.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),i.removeAllRanges(),r>n?(i.addRange(e),i.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),i.addRange(e)))}}for(e=[],i=t;i=i.parentNode;)i.nodeType===1&&e.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)i=e[t],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var zP=$r&&"documentMode"in document&&11>=document.documentMode,Tc=null,b0=null,Ed=null,A0=!1;function EA(i,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;A0||Tc==null||Tc!==Rm(n)||(n=Tc,"selectionStart"in n&&Z_(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Ed&&jd(Ed,n)||(Ed=n,n=Fm(b0,"onSelect"),0<n.length&&(e=new Y_("onSelect","select",null,e,t),i.push({event:e,listeners:n}),e.target=Tc)))}function gg(i,e){var t={};return t[i.toLowerCase()]=e.toLowerCase(),t["Webkit"+i]="webkit"+e,t["Moz"+i]="moz"+e,t}var xc={animationend:gg("Animation","AnimationEnd"),animationiteration:gg("Animation","AnimationIteration"),animationstart:gg("Animation","AnimationStart"),transitionend:gg("Transition","TransitionEnd")},bv={},sE={};$r&&(sE=document.createElement("div").style,"AnimationEvent"in window||(delete xc.animationend.animation,delete xc.animationiteration.animation,delete xc.animationstart.animation),"TransitionEvent"in window||delete xc.transitionend.transition);function jy(i){if(bv[i])return bv[i];if(!xc[i])return i;var e=xc[i],t;for(t in e)if(e.hasOwnProperty(t)&&t in sE)return bv[i]=e[t];return i}var rE=jy("animationend"),oE=jy("animationiteration"),aE=jy("animationstart"),lE=jy("transitionend"),cE=new Map,kA="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function ua(i,e){cE.set(i,e),nc(e,[i])}for(var Av=0;Av<kA.length;Av++){var Sv=kA[Av],HP=Sv.toLowerCase(),WP=Sv[0].toUpperCase()+Sv.slice(1);ua(HP,"on"+WP)}ua(rE,"onAnimationEnd");ua(oE,"onAnimationIteration");ua(aE,"onAnimationStart");ua("dblclick","onDoubleClick");ua("focusin","onFocus");ua("focusout","onBlur");ua(lE,"onTransitionEnd");_h("onMouseEnter",["mouseout","mouseover"]);_h("onMouseLeave",["mouseout","mouseover"]);_h("onPointerEnter",["pointerout","pointerover"]);_h("onPointerLeave",["pointerout","pointerover"]);nc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));nc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));nc("onBeforeInput",["compositionend","keypress","textInput","paste"]);nc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));nc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));nc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Qh="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),VP=new Set("cancel close invalid load scroll toggle".split(" ").concat(Qh));function CA(i,e,t){var n=i.type||"unknown-event";i.currentTarget=t,Hx(n,e,void 0,i),i.currentTarget=null}function uE(i,e){e=(e&4)!==0;for(var t=0;t<i.length;t++){var n=i[t],s=n.event;n=n.listeners;e:{var r=void 0;if(e)for(var o=n.length-1;0<=o;o--){var l=n[o],c=l.instance,u=l.currentTarget;if(l=l.listener,c!==r&&s.isPropagationStopped())break e;CA(s,l,u),r=c}else for(o=0;o<n.length;o++){if(l=n[o],c=l.instance,u=l.currentTarget,l=l.listener,c!==r&&s.isPropagationStopped())break e;CA(s,l,u),r=c}}}if(Im)throw i=y0,Im=!1,y0=null,i}function Ue(i,e){var t=e[T0];t===void 0&&(t=e[T0]=new Set);var n=i+"__bubble";t.has(n)||(hE(e,i,2,!1),t.add(n))}function Ev(i,e,t){var n=0;e&&(n|=4),hE(t,i,n,e)}var mg="_reactListening"+Math.random().toString(36).slice(2);function $d(i){if(!i[mg]){i[mg]=!0,v1.forEach(function(t){t!=="selectionchange"&&(VP.has(t)||Ev(t,!1,i),Ev(t,!0,i))});var e=i.nodeType===9?i:i.ownerDocument;e===null||e[mg]||(e[mg]=!0,Ev("selectionchange",!1,e))}}function hE(i,e,t,n){switch(K1(e)){case 1:var s=rP;break;case 4:s=oP;break;default:s=K_}t=s.bind(null,e,t,i),s=void 0,!m0||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),n?s!==void 0?i.addEventListener(e,t,{capture:!0,passive:s}):i.addEventListener(e,t,!0):s!==void 0?i.addEventListener(e,t,{passive:s}):i.addEventListener(e,t,!1)}function kv(i,e,t,n,s){var r=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var l=n.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(o===4)for(o=n.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;o=o.return}for(;l!==null;){if(o=xa(l),o===null)return;if(c=o.tag,c===5||c===6){n=r=o;continue e}l=l.parentNode}}n=n.return}O1(function(){var u=r,h=W_(t),d=[];e:{var f=cE.get(i);if(f!==void 0){var p=Y_,v=i;switch(i){case"keypress":if(zg(t)===0)break e;case"keydown":case"keyup":p=bP;break;case"focusin":v="focus",p=vv;break;case"focusout":v="blur",p=vv;break;case"beforeblur":case"afterblur":p=vv;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=pA;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=cP;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=EP;break;case rE:case oE:case aE:p=dP;break;case lE:p=CP;break;case"scroll":p=aP;break;case"wheel":p=xP;break;case"copy":case"cut":case"paste":p=pP;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=mA}var b=(e&4)!==0,S=!b&&i==="scroll",m=b?f!==null?f+"Capture":null:f;b=[];for(var _=u,w;_!==null;){w=_;var E=w.stateNode;if(w.tag===5&&E!==null&&(w=E,m!==null&&(E=Od(_,m),E!=null&&b.push(Ud(_,E,w)))),S)break;_=_.return}0<b.length&&(f=new p(f,v,null,t,h),d.push({event:f,listeners:b}))}}if(!(e&7)){e:{if(f=i==="mouseover"||i==="pointerover",p=i==="mouseout"||i==="pointerout",f&&t!==p0&&(v=t.relatedTarget||t.fromElement)&&(xa(v)||v[Ur]))break e;if((p||f)&&(f=h.window===h?h:(f=h.ownerDocument)?f.defaultView||f.parentWindow:window,p?(v=t.relatedTarget||t.toElement,p=u,v=v?xa(v):null,v!==null&&(S=ic(v),v!==S||v.tag!==5&&v.tag!==6)&&(v=null)):(p=null,v=u),p!==v)){if(b=pA,E="onMouseLeave",m="onMouseEnter",_="mouse",(i==="pointerout"||i==="pointerover")&&(b=mA,E="onPointerLeave",m="onPointerEnter",_="pointer"),S=p==null?f:Pc(p),w=v==null?f:Pc(v),f=new b(E,_+"leave",p,t,h),f.target=S,f.relatedTarget=w,E=null,xa(h)===u&&(b=new b(m,_+"enter",v,t,h),b.target=w,b.relatedTarget=S,E=b),S=E,p&&v)t:{for(b=p,m=v,_=0,w=b;w;w=ac(w))_++;for(w=0,E=m;E;E=ac(E))w++;for(;0<_-w;)b=ac(b),_--;for(;0<w-_;)m=ac(m),w--;for(;_--;){if(b===m||m!==null&&b===m.alternate)break t;b=ac(b),m=ac(m)}b=null}else b=null;p!==null&&TA(d,f,p,b,!1),v!==null&&S!==null&&TA(d,S,v,b,!0)}}e:{if(f=u?Pc(u):window,p=f.nodeName&&f.nodeName.toLowerCase(),p==="select"||p==="input"&&f.type==="file")var k=MP;else if(wA(f))if(eE)k=jP;else{k=FP;var C=NP}else(p=f.nodeName)&&p.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(k=BP);if(k&&(k=k(i,u))){Z1(d,k,t,h);break e}C&&C(i,f,u),i==="focusout"&&(C=f._wrapperState)&&C.controlled&&f.type==="number"&&c0(f,"number",f.value)}switch(C=u?Pc(u):window,i){case"focusin":(wA(C)||C.contentEditable==="true")&&(Tc=C,b0=u,Ed=null);break;case"focusout":Ed=b0=Tc=null;break;case"mousedown":A0=!0;break;case"contextmenu":case"mouseup":case"dragend":A0=!1,EA(d,t,h);break;case"selectionchange":if(zP)break;case"keydown":case"keyup":EA(d,t,h)}var T;if(J_)e:{switch(i){case"compositionstart":var R="onCompositionStart";break e;case"compositionend":R="onCompositionEnd";break e;case"compositionupdate":R="onCompositionUpdate";break e}R=void 0}else Cc?Q1(i,t)&&(R="onCompositionEnd"):i==="keydown"&&t.keyCode===229&&(R="onCompositionStart");R&&(Y1&&t.locale!=="ko"&&(Cc||R!=="onCompositionStart"?R==="onCompositionEnd"&&Cc&&(T=X1()):(Xo=h,X_="value"in Xo?Xo.value:Xo.textContent,Cc=!0)),C=Fm(u,R),0<C.length&&(R=new gA(R,i,null,t,h),d.push({event:R,listeners:C}),T?R.data=T:(T=J1(t),T!==null&&(R.data=T)))),(T=RP?LP(i,t):IP(i,t))&&(u=Fm(u,"onBeforeInput"),0<u.length&&(h=new gA("onBeforeInput","beforeinput",null,t,h),d.push({event:h,listeners:u}),h.data=T))}uE(d,e)})}function Ud(i,e,t){return{instance:i,listener:e,currentTarget:t}}function Fm(i,e){for(var t=e+"Capture",n=[];i!==null;){var s=i,r=s.stateNode;s.tag===5&&r!==null&&(s=r,r=Od(i,t),r!=null&&n.unshift(Ud(i,r,s)),r=Od(i,e),r!=null&&n.push(Ud(i,r,s))),i=i.return}return n}function ac(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function TA(i,e,t,n,s){for(var r=e._reactName,o=[];t!==null&&t!==n;){var l=t,c=l.alternate,u=l.stateNode;if(c!==null&&c===n)break;l.tag===5&&u!==null&&(l=u,s?(c=Od(t,r),c!=null&&o.unshift(Ud(t,c,l))):s||(c=Od(t,r),c!=null&&o.push(Ud(t,c,l)))),t=t.return}o.length!==0&&i.push({event:e,listeners:o})}var GP=/\r\n?/g,qP=/\u0000|\uFFFD/g;function xA(i){return(typeof i=="string"?i:""+i).replace(GP,`
`).replace(qP,"")}function yg(i,e,t){if(e=xA(e),xA(i)!==e&&t)throw Error(j(425))}function Bm(){}var S0=null,E0=null;function k0(i,e){return i==="textarea"||i==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var C0=typeof setTimeout=="function"?setTimeout:void 0,KP=typeof clearTimeout=="function"?clearTimeout:void 0,PA=typeof Promise=="function"?Promise:void 0,XP=typeof queueMicrotask=="function"?queueMicrotask:typeof PA<"u"?function(i){return PA.resolve(null).then(i).catch(YP)}:C0;function YP(i){setTimeout(function(){throw i})}function Cv(i,e){var t=e,n=0;do{var s=t.nextSibling;if(i.removeChild(t),s&&s.nodeType===8)if(t=s.data,t==="/$"){if(n===0){i.removeChild(s),Fd(e);return}n--}else t!=="$"&&t!=="$?"&&t!=="$!"||n++;t=s}while(t);Fd(e)}function ea(i){for(;i!=null;i=i.nextSibling){var e=i.nodeType;if(e===1||e===3)break;if(e===8){if(e=i.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return i}function RA(i){i=i.previousSibling;for(var e=0;i;){if(i.nodeType===8){var t=i.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return i;e--}else t==="/$"&&e++}i=i.previousSibling}return null}var Rh=Math.random().toString(36).slice(2),js="__reactFiber$"+Rh,zd="__reactProps$"+Rh,Ur="__reactContainer$"+Rh,T0="__reactEvents$"+Rh,QP="__reactListeners$"+Rh,JP="__reactHandles$"+Rh;function xa(i){var e=i[js];if(e)return e;for(var t=i.parentNode;t;){if(e=t[Ur]||t[js]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(i=RA(i);i!==null;){if(t=i[js])return t;i=RA(i)}return e}i=t,t=i.parentNode}return null}function Kp(i){return i=i[js]||i[Ur],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function Pc(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(j(33))}function $y(i){return i[zd]||null}var x0=[],Rc=-1;function ha(i){return{current:i}}function He(i){0>Rc||(i.current=x0[Rc],x0[Rc]=null,Rc--)}function je(i,e){Rc++,x0[Rc]=i.current,i.current=e}var oa={},rn=ha(oa),Mn=ha(!1),Kl=oa;function bh(i,e){var t=i.type.contextTypes;if(!t)return oa;var n=i.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var s={},r;for(r in t)s[r]=e[r];return n&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=e,i.__reactInternalMemoizedMaskedChildContext=s),s}function Nn(i){return i=i.childContextTypes,i!=null}function jm(){He(Mn),He(rn)}function LA(i,e,t){if(rn.current!==oa)throw Error(j(168));je(rn,e),je(Mn,t)}function dE(i,e,t){var n=i.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var s in n)if(!(s in e))throw Error(j(108,Nx(i)||"Unknown",s));return Ze({},t,n)}function $m(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||oa,Kl=rn.current,je(rn,i),je(Mn,Mn.current),!0}function IA(i,e,t){var n=i.stateNode;if(!n)throw Error(j(169));t?(i=dE(i,e,Kl),n.__reactInternalMemoizedMergedChildContext=i,He(Mn),He(rn),je(rn,i)):He(Mn),je(Mn,t)}var Js=null,Uy=!1,Tv=!1;function fE(i){Js===null?Js=[i]:Js.push(i)}function ZP(i){Uy=!0,fE(i)}function da(){if(!Tv&&Js!==null){Tv=!0;var i=0,e=ke;try{var t=Js;for(ke=1;i<t.length;i++){var n=t[i];do n=n(!0);while(n!==null)}Js=null,Uy=!1}catch(s){throw Js!==null&&(Js=Js.slice(i+1)),B1(V_,da),s}finally{ke=e,Tv=!1}}return null}var Lc=[],Ic=0,Um=null,zm=0,Ti=[],xi=0,Xl=null,Or=1,Mr="";function va(i,e){Lc[Ic++]=zm,Lc[Ic++]=Um,Um=i,zm=e}function pE(i,e,t){Ti[xi++]=Or,Ti[xi++]=Mr,Ti[xi++]=Xl,Xl=i;var n=Or;i=Mr;var s=32-os(n)-1;n&=~(1<<s),t+=1;var r=32-os(e)+s;if(30<r){var o=s-s%5;r=(n&(1<<o)-1).toString(32),n>>=o,s-=o,Or=1<<32-os(e)+s|t<<s|n,Mr=r+i}else Or=1<<r|t<<s|n,Mr=i}function eb(i){i.return!==null&&(va(i,1),pE(i,1,0))}function tb(i){for(;i===Um;)Um=Lc[--Ic],Lc[Ic]=null,zm=Lc[--Ic],Lc[Ic]=null;for(;i===Xl;)Xl=Ti[--xi],Ti[xi]=null,Mr=Ti[--xi],Ti[xi]=null,Or=Ti[--xi],Ti[xi]=null}var li=null,ai=null,qe=!1,is=null;function gE(i,e){var t=Ri(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=i,e=i.deletions,e===null?(i.deletions=[t],i.flags|=16):e.push(t)}function DA(i,e){switch(i.tag){case 5:var t=i.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(i.stateNode=e,li=i,ai=ea(e.firstChild),!0):!1;case 6:return e=i.pendingProps===""||e.nodeType!==3?null:e,e!==null?(i.stateNode=e,li=i,ai=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Xl!==null?{id:Or,overflow:Mr}:null,i.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Ri(18,null,null,0),t.stateNode=e,t.return=i,i.child=t,li=i,ai=null,!0):!1;default:return!1}}function P0(i){return(i.mode&1)!==0&&(i.flags&128)===0}function R0(i){if(qe){var e=ai;if(e){var t=e;if(!DA(i,e)){if(P0(i))throw Error(j(418));e=ea(t.nextSibling);var n=li;e&&DA(i,e)?gE(n,t):(i.flags=i.flags&-4097|2,qe=!1,li=i)}}else{if(P0(i))throw Error(j(418));i.flags=i.flags&-4097|2,qe=!1,li=i}}}function OA(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;li=i}function vg(i){if(i!==li)return!1;if(!qe)return OA(i),qe=!0,!1;var e;if((e=i.tag!==3)&&!(e=i.tag!==5)&&(e=i.type,e=e!=="head"&&e!=="body"&&!k0(i.type,i.memoizedProps)),e&&(e=ai)){if(P0(i))throw mE(),Error(j(418));for(;e;)gE(i,e),e=ea(e.nextSibling)}if(OA(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(j(317));e:{for(i=i.nextSibling,e=0;i;){if(i.nodeType===8){var t=i.data;if(t==="/$"){if(e===0){ai=ea(i.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}i=i.nextSibling}ai=null}}else ai=li?ea(i.stateNode.nextSibling):null;return!0}function mE(){for(var i=ai;i;)i=ea(i.nextSibling)}function Ah(){ai=li=null,qe=!1}function nb(i){is===null?is=[i]:is.push(i)}var eR=Gr.ReactCurrentBatchConfig;function jh(i,e,t){if(i=t.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(j(309));var n=t.stateNode}if(!n)throw Error(j(147,i));var s=n,r=""+i;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===r?e.ref:(e=function(o){var l=s.refs;o===null?delete l[r]:l[r]=o},e._stringRef=r,e)}if(typeof i!="string")throw Error(j(284));if(!t._owner)throw Error(j(290,i))}return i}function wg(i,e){throw i=Object.prototype.toString.call(e),Error(j(31,i==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":i))}function MA(i){var e=i._init;return e(i._payload)}function yE(i){function e(m,_){if(i){var w=m.deletions;w===null?(m.deletions=[_],m.flags|=16):w.push(_)}}function t(m,_){if(!i)return null;for(;_!==null;)e(m,_),_=_.sibling;return null}function n(m,_){for(m=new Map;_!==null;)_.key!==null?m.set(_.key,_):m.set(_.index,_),_=_.sibling;return m}function s(m,_){return m=sa(m,_),m.index=0,m.sibling=null,m}function r(m,_,w){return m.index=w,i?(w=m.alternate,w!==null?(w=w.index,w<_?(m.flags|=2,_):w):(m.flags|=2,_)):(m.flags|=1048576,_)}function o(m){return i&&m.alternate===null&&(m.flags|=2),m}function l(m,_,w,E){return _===null||_.tag!==6?(_=Ov(w,m.mode,E),_.return=m,_):(_=s(_,w),_.return=m,_)}function c(m,_,w,E){var k=w.type;return k===kc?h(m,_,w.props.children,E,w.key):_!==null&&(_.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Qr&&MA(k)===_.type)?(E=s(_,w.props),E.ref=jh(m,_,w),E.return=m,E):(E=Xg(w.type,w.key,w.props,null,m.mode,E),E.ref=jh(m,_,w),E.return=m,E)}function u(m,_,w,E){return _===null||_.tag!==4||_.stateNode.containerInfo!==w.containerInfo||_.stateNode.implementation!==w.implementation?(_=Mv(w,m.mode,E),_.return=m,_):(_=s(_,w.children||[]),_.return=m,_)}function h(m,_,w,E,k){return _===null||_.tag!==7?(_=ql(w,m.mode,E,k),_.return=m,_):(_=s(_,w),_.return=m,_)}function d(m,_,w){if(typeof _=="string"&&_!==""||typeof _=="number")return _=Ov(""+_,m.mode,w),_.return=m,_;if(typeof _=="object"&&_!==null){switch(_.$$typeof){case lg:return w=Xg(_.type,_.key,_.props,null,m.mode,w),w.ref=jh(m,null,_),w.return=m,w;case Ec:return _=Mv(_,m.mode,w),_.return=m,_;case Qr:var E=_._init;return d(m,E(_._payload),w)}if(Xh(_)||Oh(_))return _=ql(_,m.mode,w,null),_.return=m,_;wg(m,_)}return null}function f(m,_,w,E){var k=_!==null?_.key:null;if(typeof w=="string"&&w!==""||typeof w=="number")return k!==null?null:l(m,_,""+w,E);if(typeof w=="object"&&w!==null){switch(w.$$typeof){case lg:return w.key===k?c(m,_,w,E):null;case Ec:return w.key===k?u(m,_,w,E):null;case Qr:return k=w._init,f(m,_,k(w._payload),E)}if(Xh(w)||Oh(w))return k!==null?null:h(m,_,w,E,null);wg(m,w)}return null}function p(m,_,w,E,k){if(typeof E=="string"&&E!==""||typeof E=="number")return m=m.get(w)||null,l(_,m,""+E,k);if(typeof E=="object"&&E!==null){switch(E.$$typeof){case lg:return m=m.get(E.key===null?w:E.key)||null,c(_,m,E,k);case Ec:return m=m.get(E.key===null?w:E.key)||null,u(_,m,E,k);case Qr:var C=E._init;return p(m,_,w,C(E._payload),k)}if(Xh(E)||Oh(E))return m=m.get(w)||null,h(_,m,E,k,null);wg(_,E)}return null}function v(m,_,w,E){for(var k=null,C=null,T=_,R=_=0,D=null;T!==null&&R<w.length;R++){T.index>R?(D=T,T=null):D=T.sibling;var O=f(m,T,w[R],E);if(O===null){T===null&&(T=D);break}i&&T&&O.alternate===null&&e(m,T),_=r(O,_,R),C===null?k=O:C.sibling=O,C=O,T=D}if(R===w.length)return t(m,T),qe&&va(m,R),k;if(T===null){for(;R<w.length;R++)T=d(m,w[R],E),T!==null&&(_=r(T,_,R),C===null?k=T:C.sibling=T,C=T);return qe&&va(m,R),k}for(T=n(m,T);R<w.length;R++)D=p(T,m,R,w[R],E),D!==null&&(i&&D.alternate!==null&&T.delete(D.key===null?R:D.key),_=r(D,_,R),C===null?k=D:C.sibling=D,C=D);return i&&T.forEach(function(B){return e(m,B)}),qe&&va(m,R),k}function b(m,_,w,E){var k=Oh(w);if(typeof k!="function")throw Error(j(150));if(w=k.call(w),w==null)throw Error(j(151));for(var C=k=null,T=_,R=_=0,D=null,O=w.next();T!==null&&!O.done;R++,O=w.next()){T.index>R?(D=T,T=null):D=T.sibling;var B=f(m,T,O.value,E);if(B===null){T===null&&(T=D);break}i&&T&&B.alternate===null&&e(m,T),_=r(B,_,R),C===null?k=B:C.sibling=B,C=B,T=D}if(O.done)return t(m,T),qe&&va(m,R),k;if(T===null){for(;!O.done;R++,O=w.next())O=d(m,O.value,E),O!==null&&(_=r(O,_,R),C===null?k=O:C.sibling=O,C=O);return qe&&va(m,R),k}for(T=n(m,T);!O.done;R++,O=w.next())O=p(T,m,R,O.value,E),O!==null&&(i&&O.alternate!==null&&T.delete(O.key===null?R:O.key),_=r(O,_,R),C===null?k=O:C.sibling=O,C=O);return i&&T.forEach(function(H){return e(m,H)}),qe&&va(m,R),k}function S(m,_,w,E){if(typeof w=="object"&&w!==null&&w.type===kc&&w.key===null&&(w=w.props.children),typeof w=="object"&&w!==null){switch(w.$$typeof){case lg:e:{for(var k=w.key,C=_;C!==null;){if(C.key===k){if(k=w.type,k===kc){if(C.tag===7){t(m,C.sibling),_=s(C,w.props.children),_.return=m,m=_;break e}}else if(C.elementType===k||typeof k=="object"&&k!==null&&k.$$typeof===Qr&&MA(k)===C.type){t(m,C.sibling),_=s(C,w.props),_.ref=jh(m,C,w),_.return=m,m=_;break e}t(m,C);break}else e(m,C);C=C.sibling}w.type===kc?(_=ql(w.props.children,m.mode,E,w.key),_.return=m,m=_):(E=Xg(w.type,w.key,w.props,null,m.mode,E),E.ref=jh(m,_,w),E.return=m,m=E)}return o(m);case Ec:e:{for(C=w.key;_!==null;){if(_.key===C)if(_.tag===4&&_.stateNode.containerInfo===w.containerInfo&&_.stateNode.implementation===w.implementation){t(m,_.sibling),_=s(_,w.children||[]),_.return=m,m=_;break e}else{t(m,_);break}else e(m,_);_=_.sibling}_=Mv(w,m.mode,E),_.return=m,m=_}return o(m);case Qr:return C=w._init,S(m,_,C(w._payload),E)}if(Xh(w))return v(m,_,w,E);if(Oh(w))return b(m,_,w,E);wg(m,w)}return typeof w=="string"&&w!==""||typeof w=="number"?(w=""+w,_!==null&&_.tag===6?(t(m,_.sibling),_=s(_,w),_.return=m,m=_):(t(m,_),_=Ov(w,m.mode,E),_.return=m,m=_),o(m)):t(m,_)}return S}var Sh=yE(!0),vE=yE(!1),Hm=ha(null),Wm=null,Dc=null,ib=null;function sb(){ib=Dc=Wm=null}function rb(i){var e=Hm.current;He(Hm),i._currentValue=e}function L0(i,e,t){for(;i!==null;){var n=i.alternate;if((i.childLanes&e)!==e?(i.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),i===t)break;i=i.return}}function Gc(i,e){Wm=i,ib=Dc=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&e&&(On=!0),i.firstContext=null)}function Oi(i){var e=i._currentValue;if(ib!==i)if(i={context:i,memoizedValue:e,next:null},Dc===null){if(Wm===null)throw Error(j(308));Dc=i,Wm.dependencies={lanes:0,firstContext:i}}else Dc=Dc.next=i;return e}var Pa=null;function ob(i){Pa===null?Pa=[i]:Pa.push(i)}function wE(i,e,t,n){var s=e.interleaved;return s===null?(t.next=t,ob(e)):(t.next=s.next,s.next=t),e.interleaved=t,zr(i,n)}function zr(i,e){i.lanes|=e;var t=i.alternate;for(t!==null&&(t.lanes|=e),t=i,i=i.return;i!==null;)i.childLanes|=e,t=i.alternate,t!==null&&(t.childLanes|=e),t=i,i=i.return;return t.tag===3?t.stateNode:null}var Jr=!1;function ab(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function _E(i,e){i=i.updateQueue,e.updateQueue===i&&(e.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function Nr(i,e){return{eventTime:i,lane:e,tag:0,payload:null,callback:null,next:null}}function ta(i,e,t){var n=i.updateQueue;if(n===null)return null;if(n=n.shared,me&2){var s=n.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),n.pending=e,zr(i,t)}return s=n.interleaved,s===null?(e.next=e,ob(n)):(e.next=s.next,s.next=e),n.interleaved=e,zr(i,t)}function Hg(i,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var n=e.lanes;n&=i.pendingLanes,t|=n,e.lanes=t,G_(i,t)}}function NA(i,e){var t=i.updateQueue,n=i.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var s=null,r=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};r===null?s=r=o:r=r.next=o,t=t.next}while(t!==null);r===null?s=r=e:r=r.next=e}else s=r=e;t={baseState:n.baseState,firstBaseUpdate:s,lastBaseUpdate:r,shared:n.shared,effects:n.effects},i.updateQueue=t;return}i=t.lastBaseUpdate,i===null?t.firstBaseUpdate=e:i.next=e,t.lastBaseUpdate=e}function Vm(i,e,t,n){var s=i.updateQueue;Jr=!1;var r=s.firstBaseUpdate,o=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var c=l,u=c.next;c.next=null,o===null?r=u:o.next=u,o=c;var h=i.alternate;h!==null&&(h=h.updateQueue,l=h.lastBaseUpdate,l!==o&&(l===null?h.firstBaseUpdate=u:l.next=u,h.lastBaseUpdate=c))}if(r!==null){var d=s.baseState;o=0,h=u=c=null,l=r;do{var f=l.lane,p=l.eventTime;if((n&f)===f){h!==null&&(h=h.next={eventTime:p,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var v=i,b=l;switch(f=e,p=t,b.tag){case 1:if(v=b.payload,typeof v=="function"){d=v.call(p,d,f);break e}d=v;break e;case 3:v.flags=v.flags&-65537|128;case 0:if(v=b.payload,f=typeof v=="function"?v.call(p,d,f):v,f==null)break e;d=Ze({},d,f);break e;case 2:Jr=!0}}l.callback!==null&&l.lane!==0&&(i.flags|=64,f=s.effects,f===null?s.effects=[l]:f.push(l))}else p={eventTime:p,lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},h===null?(u=h=p,c=d):h=h.next=p,o|=f;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;f=l,l=f.next,f.next=null,s.lastBaseUpdate=f,s.shared.pending=null}}while(!0);if(h===null&&(c=d),s.baseState=c,s.firstBaseUpdate=u,s.lastBaseUpdate=h,e=s.shared.interleaved,e!==null){s=e;do o|=s.lane,s=s.next;while(s!==e)}else r===null&&(s.shared.lanes=0);Ql|=o,i.lanes=o,i.memoizedState=d}}function FA(i,e,t){if(i=e.effects,e.effects=null,i!==null)for(e=0;e<i.length;e++){var n=i[e],s=n.callback;if(s!==null){if(n.callback=null,n=t,typeof s!="function")throw Error(j(191,s));s.call(n)}}}var Xp={},Us=ha(Xp),Hd=ha(Xp),Wd=ha(Xp);function Ra(i){if(i===Xp)throw Error(j(174));return i}function lb(i,e){switch(je(Wd,e),je(Hd,i),je(Us,Xp),i=e.nodeType,i){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:h0(null,"");break;default:i=i===8?e.parentNode:e,e=i.namespaceURI||null,i=i.tagName,e=h0(e,i)}He(Us),je(Us,e)}function Eh(){He(Us),He(Hd),He(Wd)}function bE(i){Ra(Wd.current);var e=Ra(Us.current),t=h0(e,i.type);e!==t&&(je(Hd,i),je(Us,t))}function cb(i){Hd.current===i&&(He(Us),He(Hd))}var Ye=ha(0);function Gm(i){for(var e=i;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var xv=[];function ub(){for(var i=0;i<xv.length;i++)xv[i]._workInProgressVersionPrimary=null;xv.length=0}var Wg=Gr.ReactCurrentDispatcher,Pv=Gr.ReactCurrentBatchConfig,Yl=0,Qe=null,At=null,Dt=null,qm=!1,kd=!1,Vd=0,tR=0;function Kt(){throw Error(j(321))}function hb(i,e){if(e===null)return!1;for(var t=0;t<e.length&&t<i.length;t++)if(!ls(i[t],e[t]))return!1;return!0}function db(i,e,t,n,s,r){if(Yl=r,Qe=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Wg.current=i===null||i.memoizedState===null?rR:oR,i=t(n,s),kd){r=0;do{if(kd=!1,Vd=0,25<=r)throw Error(j(301));r+=1,Dt=At=null,e.updateQueue=null,Wg.current=aR,i=t(n,s)}while(kd)}if(Wg.current=Km,e=At!==null&&At.next!==null,Yl=0,Dt=At=Qe=null,qm=!1,e)throw Error(j(300));return i}function fb(){var i=Vd!==0;return Vd=0,i}function gs(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Dt===null?Qe.memoizedState=Dt=i:Dt=Dt.next=i,Dt}function Mi(){if(At===null){var i=Qe.alternate;i=i!==null?i.memoizedState:null}else i=At.next;var e=Dt===null?Qe.memoizedState:Dt.next;if(e!==null)Dt=e,At=i;else{if(i===null)throw Error(j(310));At=i,i={memoizedState:At.memoizedState,baseState:At.baseState,baseQueue:At.baseQueue,queue:At.queue,next:null},Dt===null?Qe.memoizedState=Dt=i:Dt=Dt.next=i}return Dt}function Gd(i,e){return typeof e=="function"?e(i):e}function Rv(i){var e=Mi(),t=e.queue;if(t===null)throw Error(j(311));t.lastRenderedReducer=i;var n=At,s=n.baseQueue,r=t.pending;if(r!==null){if(s!==null){var o=s.next;s.next=r.next,r.next=o}n.baseQueue=s=r,t.pending=null}if(s!==null){r=s.next,n=n.baseState;var l=o=null,c=null,u=r;do{var h=u.lane;if((Yl&h)===h)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),n=u.hasEagerState?u.eagerState:i(n,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(l=c=d,o=n):c=c.next=d,Qe.lanes|=h,Ql|=h}u=u.next}while(u!==null&&u!==r);c===null?o=n:c.next=l,ls(n,e.memoizedState)||(On=!0),e.memoizedState=n,e.baseState=o,e.baseQueue=c,t.lastRenderedState=n}if(i=t.interleaved,i!==null){s=i;do r=s.lane,Qe.lanes|=r,Ql|=r,s=s.next;while(s!==i)}else s===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function Lv(i){var e=Mi(),t=e.queue;if(t===null)throw Error(j(311));t.lastRenderedReducer=i;var n=t.dispatch,s=t.pending,r=e.memoizedState;if(s!==null){t.pending=null;var o=s=s.next;do r=i(r,o.action),o=o.next;while(o!==s);ls(r,e.memoizedState)||(On=!0),e.memoizedState=r,e.baseQueue===null&&(e.baseState=r),t.lastRenderedState=r}return[r,n]}function AE(){}function SE(i,e){var t=Qe,n=Mi(),s=e(),r=!ls(n.memoizedState,s);if(r&&(n.memoizedState=s,On=!0),n=n.queue,pb(CE.bind(null,t,n,i),[i]),n.getSnapshot!==e||r||Dt!==null&&Dt.memoizedState.tag&1){if(t.flags|=2048,qd(9,kE.bind(null,t,n,s,e),void 0,null),Ot===null)throw Error(j(349));Yl&30||EE(t,e,s)}return s}function EE(i,e,t){i.flags|=16384,i={getSnapshot:e,value:t},e=Qe.updateQueue,e===null?(e={lastEffect:null,stores:null},Qe.updateQueue=e,e.stores=[i]):(t=e.stores,t===null?e.stores=[i]:t.push(i))}function kE(i,e,t,n){e.value=t,e.getSnapshot=n,TE(e)&&xE(i)}function CE(i,e,t){return t(function(){TE(e)&&xE(i)})}function TE(i){var e=i.getSnapshot;i=i.value;try{var t=e();return!ls(i,t)}catch{return!0}}function xE(i){var e=zr(i,1);e!==null&&as(e,i,1,-1)}function BA(i){var e=gs();return typeof i=="function"&&(i=i()),e.memoizedState=e.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Gd,lastRenderedState:i},e.queue=i,i=i.dispatch=sR.bind(null,Qe,i),[e.memoizedState,i]}function qd(i,e,t,n){return i={tag:i,create:e,destroy:t,deps:n,next:null},e=Qe.updateQueue,e===null?(e={lastEffect:null,stores:null},Qe.updateQueue=e,e.lastEffect=i.next=i):(t=e.lastEffect,t===null?e.lastEffect=i.next=i:(n=t.next,t.next=i,i.next=n,e.lastEffect=i)),i}function PE(){return Mi().memoizedState}function Vg(i,e,t,n){var s=gs();Qe.flags|=i,s.memoizedState=qd(1|e,t,void 0,n===void 0?null:n)}function zy(i,e,t,n){var s=Mi();n=n===void 0?null:n;var r=void 0;if(At!==null){var o=At.memoizedState;if(r=o.destroy,n!==null&&hb(n,o.deps)){s.memoizedState=qd(e,t,r,n);return}}Qe.flags|=i,s.memoizedState=qd(1|e,t,r,n)}function jA(i,e){return Vg(8390656,8,i,e)}function pb(i,e){return zy(2048,8,i,e)}function RE(i,e){return zy(4,2,i,e)}function LE(i,e){return zy(4,4,i,e)}function IE(i,e){if(typeof e=="function")return i=i(),e(i),function(){e(null)};if(e!=null)return i=i(),e.current=i,function(){e.current=null}}function DE(i,e,t){return t=t!=null?t.concat([i]):null,zy(4,4,IE.bind(null,e,i),t)}function gb(){}function OE(i,e){var t=Mi();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&hb(e,n[1])?n[0]:(t.memoizedState=[i,e],i)}function ME(i,e){var t=Mi();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&hb(e,n[1])?n[0]:(i=i(),t.memoizedState=[i,e],i)}function NE(i,e,t){return Yl&21?(ls(t,e)||(t=U1(),Qe.lanes|=t,Ql|=t,i.baseState=!0),e):(i.baseState&&(i.baseState=!1,On=!0),i.memoizedState=t)}function nR(i,e){var t=ke;ke=t!==0&&4>t?t:4,i(!0);var n=Pv.transition;Pv.transition={};try{i(!1),e()}finally{ke=t,Pv.transition=n}}function FE(){return Mi().memoizedState}function iR(i,e,t){var n=ia(i);if(t={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null},BE(i))jE(e,t);else if(t=wE(i,e,t,n),t!==null){var s=vn();as(t,i,n,s),$E(t,e,n)}}function sR(i,e,t){var n=ia(i),s={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null};if(BE(i))jE(e,s);else{var r=i.alternate;if(i.lanes===0&&(r===null||r.lanes===0)&&(r=e.lastRenderedReducer,r!==null))try{var o=e.lastRenderedState,l=r(o,t);if(s.hasEagerState=!0,s.eagerState=l,ls(l,o)){var c=e.interleaved;c===null?(s.next=s,ob(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}t=wE(i,e,s,n),t!==null&&(s=vn(),as(t,i,n,s),$E(t,e,n))}}function BE(i){var e=i.alternate;return i===Qe||e!==null&&e===Qe}function jE(i,e){kd=qm=!0;var t=i.pending;t===null?e.next=e:(e.next=t.next,t.next=e),i.pending=e}function $E(i,e,t){if(t&4194240){var n=e.lanes;n&=i.pendingLanes,t|=n,e.lanes=t,G_(i,t)}}var Km={readContext:Oi,useCallback:Kt,useContext:Kt,useEffect:Kt,useImperativeHandle:Kt,useInsertionEffect:Kt,useLayoutEffect:Kt,useMemo:Kt,useReducer:Kt,useRef:Kt,useState:Kt,useDebugValue:Kt,useDeferredValue:Kt,useTransition:Kt,useMutableSource:Kt,useSyncExternalStore:Kt,useId:Kt,unstable_isNewReconciler:!1},rR={readContext:Oi,useCallback:function(i,e){return gs().memoizedState=[i,e===void 0?null:e],i},useContext:Oi,useEffect:jA,useImperativeHandle:function(i,e,t){return t=t!=null?t.concat([i]):null,Vg(4194308,4,IE.bind(null,e,i),t)},useLayoutEffect:function(i,e){return Vg(4194308,4,i,e)},useInsertionEffect:function(i,e){return Vg(4,2,i,e)},useMemo:function(i,e){var t=gs();return e=e===void 0?null:e,i=i(),t.memoizedState=[i,e],i},useReducer:function(i,e,t){var n=gs();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:e},n.queue=i,i=i.dispatch=iR.bind(null,Qe,i),[n.memoizedState,i]},useRef:function(i){var e=gs();return i={current:i},e.memoizedState=i},useState:BA,useDebugValue:gb,useDeferredValue:function(i){return gs().memoizedState=i},useTransition:function(){var i=BA(!1),e=i[0];return i=nR.bind(null,i[1]),gs().memoizedState=i,[e,i]},useMutableSource:function(){},useSyncExternalStore:function(i,e,t){var n=Qe,s=gs();if(qe){if(t===void 0)throw Error(j(407));t=t()}else{if(t=e(),Ot===null)throw Error(j(349));Yl&30||EE(n,e,t)}s.memoizedState=t;var r={value:t,getSnapshot:e};return s.queue=r,jA(CE.bind(null,n,r,i),[i]),n.flags|=2048,qd(9,kE.bind(null,n,r,t,e),void 0,null),t},useId:function(){var i=gs(),e=Ot.identifierPrefix;if(qe){var t=Mr,n=Or;t=(n&~(1<<32-os(n)-1)).toString(32)+t,e=":"+e+"R"+t,t=Vd++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=tR++,e=":"+e+"r"+t.toString(32)+":";return i.memoizedState=e},unstable_isNewReconciler:!1},oR={readContext:Oi,useCallback:OE,useContext:Oi,useEffect:pb,useImperativeHandle:DE,useInsertionEffect:RE,useLayoutEffect:LE,useMemo:ME,useReducer:Rv,useRef:PE,useState:function(){return Rv(Gd)},useDebugValue:gb,useDeferredValue:function(i){var e=Mi();return NE(e,At.memoizedState,i)},useTransition:function(){var i=Rv(Gd)[0],e=Mi().memoizedState;return[i,e]},useMutableSource:AE,useSyncExternalStore:SE,useId:FE,unstable_isNewReconciler:!1},aR={readContext:Oi,useCallback:OE,useContext:Oi,useEffect:pb,useImperativeHandle:DE,useInsertionEffect:RE,useLayoutEffect:LE,useMemo:ME,useReducer:Lv,useRef:PE,useState:function(){return Lv(Gd)},useDebugValue:gb,useDeferredValue:function(i){var e=Mi();return At===null?e.memoizedState=i:NE(e,At.memoizedState,i)},useTransition:function(){var i=Lv(Gd)[0],e=Mi().memoizedState;return[i,e]},useMutableSource:AE,useSyncExternalStore:SE,useId:FE,unstable_isNewReconciler:!1};function zi(i,e){if(i&&i.defaultProps){e=Ze({},e),i=i.defaultProps;for(var t in i)e[t]===void 0&&(e[t]=i[t]);return e}return e}function I0(i,e,t,n){e=i.memoizedState,t=t(n,e),t=t==null?e:Ze({},e,t),i.memoizedState=t,i.lanes===0&&(i.updateQueue.baseState=t)}var Hy={isMounted:function(i){return(i=i._reactInternals)?ic(i)===i:!1},enqueueSetState:function(i,e,t){i=i._reactInternals;var n=vn(),s=ia(i),r=Nr(n,s);r.payload=e,t!=null&&(r.callback=t),e=ta(i,r,s),e!==null&&(as(e,i,s,n),Hg(e,i,s))},enqueueReplaceState:function(i,e,t){i=i._reactInternals;var n=vn(),s=ia(i),r=Nr(n,s);r.tag=1,r.payload=e,t!=null&&(r.callback=t),e=ta(i,r,s),e!==null&&(as(e,i,s,n),Hg(e,i,s))},enqueueForceUpdate:function(i,e){i=i._reactInternals;var t=vn(),n=ia(i),s=Nr(t,n);s.tag=2,e!=null&&(s.callback=e),e=ta(i,s,n),e!==null&&(as(e,i,n,t),Hg(e,i,n))}};function $A(i,e,t,n,s,r,o){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(n,r,o):e.prototype&&e.prototype.isPureReactComponent?!jd(t,n)||!jd(s,r):!0}function UE(i,e,t){var n=!1,s=oa,r=e.contextType;return typeof r=="object"&&r!==null?r=Oi(r):(s=Nn(e)?Kl:rn.current,n=e.contextTypes,r=(n=n!=null)?bh(i,s):oa),e=new e(t,r),i.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Hy,i.stateNode=e,e._reactInternals=i,n&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=s,i.__reactInternalMemoizedMaskedChildContext=r),e}function UA(i,e,t,n){i=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==i&&Hy.enqueueReplaceState(e,e.state,null)}function D0(i,e,t,n){var s=i.stateNode;s.props=t,s.state=i.memoizedState,s.refs={},ab(i);var r=e.contextType;typeof r=="object"&&r!==null?s.context=Oi(r):(r=Nn(e)?Kl:rn.current,s.context=bh(i,r)),s.state=i.memoizedState,r=e.getDerivedStateFromProps,typeof r=="function"&&(I0(i,e,r,t),s.state=i.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Hy.enqueueReplaceState(s,s.state,null),Vm(i,t,s,n),s.state=i.memoizedState),typeof s.componentDidMount=="function"&&(i.flags|=4194308)}function kh(i,e){try{var t="",n=e;do t+=Mx(n),n=n.return;while(n);var s=t}catch(r){s=`
Error generating stack: `+r.message+`
`+r.stack}return{value:i,source:e,stack:s,digest:null}}function Iv(i,e,t){return{value:i,source:null,stack:t??null,digest:e??null}}function O0(i,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var lR=typeof WeakMap=="function"?WeakMap:Map;function zE(i,e,t){t=Nr(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){Ym||(Ym=!0,W0=n),O0(i,e)},t}function HE(i,e,t){t=Nr(-1,t),t.tag=3;var n=i.type.getDerivedStateFromError;if(typeof n=="function"){var s=e.value;t.payload=function(){return n(s)},t.callback=function(){O0(i,e)}}var r=i.stateNode;return r!==null&&typeof r.componentDidCatch=="function"&&(t.callback=function(){O0(i,e),typeof n!="function"&&(na===null?na=new Set([this]):na.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function zA(i,e,t){var n=i.pingCache;if(n===null){n=i.pingCache=new lR;var s=new Set;n.set(e,s)}else s=n.get(e),s===void 0&&(s=new Set,n.set(e,s));s.has(t)||(s.add(t),i=AR.bind(null,i,e,t),e.then(i,i))}function HA(i){do{var e;if((e=i.tag===13)&&(e=i.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return i;i=i.return}while(i!==null);return null}function WA(i,e,t,n,s){return i.mode&1?(i.flags|=65536,i.lanes=s,i):(i===e?i.flags|=65536:(i.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Nr(-1,1),e.tag=2,ta(t,e,1))),t.lanes|=1),i)}var cR=Gr.ReactCurrentOwner,On=!1;function gn(i,e,t,n){e.child=i===null?vE(e,null,t,n):Sh(e,i.child,t,n)}function VA(i,e,t,n,s){t=t.render;var r=e.ref;return Gc(e,s),n=db(i,e,t,n,r,s),t=fb(),i!==null&&!On?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~s,Hr(i,e,s)):(qe&&t&&eb(e),e.flags|=1,gn(i,e,n,s),e.child)}function GA(i,e,t,n,s){if(i===null){var r=t.type;return typeof r=="function"&&!Sb(r)&&r.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=r,WE(i,e,r,n,s)):(i=Xg(t.type,null,n,e,e.mode,s),i.ref=e.ref,i.return=e,e.child=i)}if(r=i.child,!(i.lanes&s)){var o=r.memoizedProps;if(t=t.compare,t=t!==null?t:jd,t(o,n)&&i.ref===e.ref)return Hr(i,e,s)}return e.flags|=1,i=sa(r,n),i.ref=e.ref,i.return=e,e.child=i}function WE(i,e,t,n,s){if(i!==null){var r=i.memoizedProps;if(jd(r,n)&&i.ref===e.ref)if(On=!1,e.pendingProps=n=r,(i.lanes&s)!==0)i.flags&131072&&(On=!0);else return e.lanes=i.lanes,Hr(i,e,s)}return M0(i,e,t,n,s)}function VE(i,e,t){var n=e.pendingProps,s=n.children,r=i!==null?i.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},je(Mc,si),si|=t;else{if(!(t&1073741824))return i=r!==null?r.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:i,cachePool:null,transitions:null},e.updateQueue=null,je(Mc,si),si|=i,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=r!==null?r.baseLanes:t,je(Mc,si),si|=n}else r!==null?(n=r.baseLanes|t,e.memoizedState=null):n=t,je(Mc,si),si|=n;return gn(i,e,s,t),e.child}function GE(i,e){var t=e.ref;(i===null&&t!==null||i!==null&&i.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function M0(i,e,t,n,s){var r=Nn(t)?Kl:rn.current;return r=bh(e,r),Gc(e,s),t=db(i,e,t,n,r,s),n=fb(),i!==null&&!On?(e.updateQueue=i.updateQueue,e.flags&=-2053,i.lanes&=~s,Hr(i,e,s)):(qe&&n&&eb(e),e.flags|=1,gn(i,e,t,s),e.child)}function qA(i,e,t,n,s){if(Nn(t)){var r=!0;$m(e)}else r=!1;if(Gc(e,s),e.stateNode===null)Gg(i,e),UE(e,t,n),D0(e,t,n,s),n=!0;else if(i===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var c=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=Oi(u):(u=Nn(t)?Kl:rn.current,u=bh(e,u));var h=t.getDerivedStateFromProps,d=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==n||c!==u)&&UA(e,o,n,u),Jr=!1;var f=e.memoizedState;o.state=f,Vm(e,n,o,s),c=e.memoizedState,l!==n||f!==c||Mn.current||Jr?(typeof h=="function"&&(I0(e,t,h,n),c=e.memoizedState),(l=Jr||$A(e,t,l,n,f,c,u))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=c),o.props=n,o.state=c,o.context=u,n=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{o=e.stateNode,_E(i,e),l=e.memoizedProps,u=e.type===e.elementType?l:zi(e.type,l),o.props=u,d=e.pendingProps,f=o.context,c=t.contextType,typeof c=="object"&&c!==null?c=Oi(c):(c=Nn(t)?Kl:rn.current,c=bh(e,c));var p=t.getDerivedStateFromProps;(h=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==d||f!==c)&&UA(e,o,n,c),Jr=!1,f=e.memoizedState,o.state=f,Vm(e,n,o,s);var v=e.memoizedState;l!==d||f!==v||Mn.current||Jr?(typeof p=="function"&&(I0(e,t,p,n),v=e.memoizedState),(u=Jr||$A(e,t,u,n,f,v,c)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,v,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,v,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===i.memoizedProps&&f===i.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===i.memoizedProps&&f===i.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=v),o.props=n,o.state=v,o.context=c,n=u):(typeof o.componentDidUpdate!="function"||l===i.memoizedProps&&f===i.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===i.memoizedProps&&f===i.memoizedState||(e.flags|=1024),n=!1)}return N0(i,e,t,n,r,s)}function N0(i,e,t,n,s,r){GE(i,e);var o=(e.flags&128)!==0;if(!n&&!o)return s&&IA(e,t,!1),Hr(i,e,r);n=e.stateNode,cR.current=e;var l=o&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,i!==null&&o?(e.child=Sh(e,i.child,null,r),e.child=Sh(e,null,l,r)):gn(i,e,l,r),e.memoizedState=n.state,s&&IA(e,t,!0),e.child}function qE(i){var e=i.stateNode;e.pendingContext?LA(i,e.pendingContext,e.pendingContext!==e.context):e.context&&LA(i,e.context,!1),lb(i,e.containerInfo)}function KA(i,e,t,n,s){return Ah(),nb(s),e.flags|=256,gn(i,e,t,n),e.child}var F0={dehydrated:null,treeContext:null,retryLane:0};function B0(i){return{baseLanes:i,cachePool:null,transitions:null}}function KE(i,e,t){var n=e.pendingProps,s=Ye.current,r=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=i!==null&&i.memoizedState===null?!1:(s&2)!==0),l?(r=!0,e.flags&=-129):(i===null||i.memoizedState!==null)&&(s|=1),je(Ye,s&1),i===null)return R0(e),i=e.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(e.mode&1?i.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=n.children,i=n.fallback,r?(n=e.mode,r=e.child,o={mode:"hidden",children:o},!(n&1)&&r!==null?(r.childLanes=0,r.pendingProps=o):r=Gy(o,n,0,null),i=ql(i,n,t,null),r.return=e,i.return=e,r.sibling=i,e.child=r,e.child.memoizedState=B0(t),e.memoizedState=F0,i):mb(e,o));if(s=i.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return uR(i,e,o,n,l,s,t);if(r){r=n.fallback,o=e.mode,s=i.child,l=s.sibling;var c={mode:"hidden",children:n.children};return!(o&1)&&e.child!==s?(n=e.child,n.childLanes=0,n.pendingProps=c,e.deletions=null):(n=sa(s,c),n.subtreeFlags=s.subtreeFlags&14680064),l!==null?r=sa(l,r):(r=ql(r,o,t,null),r.flags|=2),r.return=e,n.return=e,n.sibling=r,e.child=n,n=r,r=e.child,o=i.child.memoizedState,o=o===null?B0(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},r.memoizedState=o,r.childLanes=i.childLanes&~t,e.memoizedState=F0,n}return r=i.child,i=r.sibling,n=sa(r,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=t),n.return=e,n.sibling=null,i!==null&&(t=e.deletions,t===null?(e.deletions=[i],e.flags|=16):t.push(i)),e.child=n,e.memoizedState=null,n}function mb(i,e){return e=Gy({mode:"visible",children:e},i.mode,0,null),e.return=i,i.child=e}function _g(i,e,t,n){return n!==null&&nb(n),Sh(e,i.child,null,t),i=mb(e,e.pendingProps.children),i.flags|=2,e.memoizedState=null,i}function uR(i,e,t,n,s,r,o){if(t)return e.flags&256?(e.flags&=-257,n=Iv(Error(j(422))),_g(i,e,o,n)):e.memoizedState!==null?(e.child=i.child,e.flags|=128,null):(r=n.fallback,s=e.mode,n=Gy({mode:"visible",children:n.children},s,0,null),r=ql(r,s,o,null),r.flags|=2,n.return=e,r.return=e,n.sibling=r,e.child=n,e.mode&1&&Sh(e,i.child,null,o),e.child.memoizedState=B0(o),e.memoizedState=F0,r);if(!(e.mode&1))return _g(i,e,o,null);if(s.data==="$!"){if(n=s.nextSibling&&s.nextSibling.dataset,n)var l=n.dgst;return n=l,r=Error(j(419)),n=Iv(r,n,void 0),_g(i,e,o,n)}if(l=(o&i.childLanes)!==0,On||l){if(n=Ot,n!==null){switch(o&-o){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(n.suspendedLanes|o)?0:s,s!==0&&s!==r.retryLane&&(r.retryLane=s,zr(i,s),as(n,i,s,-1))}return Ab(),n=Iv(Error(j(421))),_g(i,e,o,n)}return s.data==="$?"?(e.flags|=128,e.child=i.child,e=SR.bind(null,i),s._reactRetry=e,null):(i=r.treeContext,ai=ea(s.nextSibling),li=e,qe=!0,is=null,i!==null&&(Ti[xi++]=Or,Ti[xi++]=Mr,Ti[xi++]=Xl,Or=i.id,Mr=i.overflow,Xl=e),e=mb(e,n.children),e.flags|=4096,e)}function XA(i,e,t){i.lanes|=e;var n=i.alternate;n!==null&&(n.lanes|=e),L0(i.return,e,t)}function Dv(i,e,t,n,s){var r=i.memoizedState;r===null?i.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:s}:(r.isBackwards=e,r.rendering=null,r.renderingStartTime=0,r.last=n,r.tail=t,r.tailMode=s)}function XE(i,e,t){var n=e.pendingProps,s=n.revealOrder,r=n.tail;if(gn(i,e,n.children,t),n=Ye.current,n&2)n=n&1|2,e.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=e.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&XA(i,t,e);else if(i.tag===19)XA(i,t,e);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===e)break e;for(;i.sibling===null;){if(i.return===null||i.return===e)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}n&=1}if(je(Ye,n),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(t=e.child,s=null;t!==null;)i=t.alternate,i!==null&&Gm(i)===null&&(s=t),t=t.sibling;t=s,t===null?(s=e.child,e.child=null):(s=t.sibling,t.sibling=null),Dv(e,!1,s,t,r);break;case"backwards":for(t=null,s=e.child,e.child=null;s!==null;){if(i=s.alternate,i!==null&&Gm(i)===null){e.child=s;break}i=s.sibling,s.sibling=t,t=s,s=i}Dv(e,!0,t,null,r);break;case"together":Dv(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Gg(i,e){!(e.mode&1)&&i!==null&&(i.alternate=null,e.alternate=null,e.flags|=2)}function Hr(i,e,t){if(i!==null&&(e.dependencies=i.dependencies),Ql|=e.lanes,!(t&e.childLanes))return null;if(i!==null&&e.child!==i.child)throw Error(j(153));if(e.child!==null){for(i=e.child,t=sa(i,i.pendingProps),e.child=t,t.return=e;i.sibling!==null;)i=i.sibling,t=t.sibling=sa(i,i.pendingProps),t.return=e;t.sibling=null}return e.child}function hR(i,e,t){switch(e.tag){case 3:qE(e),Ah();break;case 5:bE(e);break;case 1:Nn(e.type)&&$m(e);break;case 4:lb(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,s=e.memoizedProps.value;je(Hm,n._currentValue),n._currentValue=s;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?(je(Ye,Ye.current&1),e.flags|=128,null):t&e.child.childLanes?KE(i,e,t):(je(Ye,Ye.current&1),i=Hr(i,e,t),i!==null?i.sibling:null);je(Ye,Ye.current&1);break;case 19:if(n=(t&e.childLanes)!==0,i.flags&128){if(n)return XE(i,e,t);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),je(Ye,Ye.current),n)break;return null;case 22:case 23:return e.lanes=0,VE(i,e,t)}return Hr(i,e,t)}var YE,j0,QE,JE;YE=function(i,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)i.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};j0=function(){};QE=function(i,e,t,n){var s=i.memoizedProps;if(s!==n){i=e.stateNode,Ra(Us.current);var r=null;switch(t){case"input":s=a0(i,s),n=a0(i,n),r=[];break;case"select":s=Ze({},s,{value:void 0}),n=Ze({},n,{value:void 0}),r=[];break;case"textarea":s=u0(i,s),n=u0(i,n),r=[];break;default:typeof s.onClick!="function"&&typeof n.onClick=="function"&&(i.onclick=Bm)}d0(t,n);var o;t=null;for(u in s)if(!n.hasOwnProperty(u)&&s.hasOwnProperty(u)&&s[u]!=null)if(u==="style"){var l=s[u];for(o in l)l.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(Id.hasOwnProperty(u)?r||(r=[]):(r=r||[]).push(u,null));for(u in n){var c=n[u];if(l=s!=null?s[u]:void 0,n.hasOwnProperty(u)&&c!==l&&(c!=null||l!=null))if(u==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(t||(t={}),t[o]=c[o])}else t||(r||(r=[]),r.push(u,t)),t=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(r=r||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(r=r||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(Id.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&Ue("scroll",i),r||l===c||(r=[])):(r=r||[]).push(u,c))}t&&(r=r||[]).push("style",t);var u=r;(e.updateQueue=u)&&(e.flags|=4)}};JE=function(i,e,t,n){t!==n&&(e.flags|=4)};function $h(i,e){if(!qe)switch(i.tailMode){case"hidden":e=i.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?i.tail=null:t.sibling=null;break;case"collapsed":t=i.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||i.tail===null?i.tail=null:i.tail.sibling=null:n.sibling=null}}function Xt(i){var e=i.alternate!==null&&i.alternate.child===i.child,t=0,n=0;if(e)for(var s=i.child;s!==null;)t|=s.lanes|s.childLanes,n|=s.subtreeFlags&14680064,n|=s.flags&14680064,s.return=i,s=s.sibling;else for(s=i.child;s!==null;)t|=s.lanes|s.childLanes,n|=s.subtreeFlags,n|=s.flags,s.return=i,s=s.sibling;return i.subtreeFlags|=n,i.childLanes=t,e}function dR(i,e,t){var n=e.pendingProps;switch(tb(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Xt(e),null;case 1:return Nn(e.type)&&jm(),Xt(e),null;case 3:return n=e.stateNode,Eh(),He(Mn),He(rn),ub(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(i===null||i.child===null)&&(vg(e)?e.flags|=4:i===null||i.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,is!==null&&(q0(is),is=null))),j0(i,e),Xt(e),null;case 5:cb(e);var s=Ra(Wd.current);if(t=e.type,i!==null&&e.stateNode!=null)QE(i,e,t,n,s),i.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error(j(166));return Xt(e),null}if(i=Ra(Us.current),vg(e)){n=e.stateNode,t=e.type;var r=e.memoizedProps;switch(n[js]=e,n[zd]=r,i=(e.mode&1)!==0,t){case"dialog":Ue("cancel",n),Ue("close",n);break;case"iframe":case"object":case"embed":Ue("load",n);break;case"video":case"audio":for(s=0;s<Qh.length;s++)Ue(Qh[s],n);break;case"source":Ue("error",n);break;case"img":case"image":case"link":Ue("error",n),Ue("load",n);break;case"details":Ue("toggle",n);break;case"input":sA(n,r),Ue("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!r.multiple},Ue("invalid",n);break;case"textarea":oA(n,r),Ue("invalid",n)}d0(t,r),s=null;for(var o in r)if(r.hasOwnProperty(o)){var l=r[o];o==="children"?typeof l=="string"?n.textContent!==l&&(r.suppressHydrationWarning!==!0&&yg(n.textContent,l,i),s=["children",l]):typeof l=="number"&&n.textContent!==""+l&&(r.suppressHydrationWarning!==!0&&yg(n.textContent,l,i),s=["children",""+l]):Id.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&Ue("scroll",n)}switch(t){case"input":cg(n),rA(n,r,!0);break;case"textarea":cg(n),aA(n);break;case"select":case"option":break;default:typeof r.onClick=="function"&&(n.onclick=Bm)}n=s,e.updateQueue=n,n!==null&&(e.flags|=4)}else{o=s.nodeType===9?s:s.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=C1(t)),i==="http://www.w3.org/1999/xhtml"?t==="script"?(i=o.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof n.is=="string"?i=o.createElement(t,{is:n.is}):(i=o.createElement(t),t==="select"&&(o=i,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):i=o.createElementNS(i,t),i[js]=e,i[zd]=n,YE(i,e,!1,!1),e.stateNode=i;e:{switch(o=f0(t,n),t){case"dialog":Ue("cancel",i),Ue("close",i),s=n;break;case"iframe":case"object":case"embed":Ue("load",i),s=n;break;case"video":case"audio":for(s=0;s<Qh.length;s++)Ue(Qh[s],i);s=n;break;case"source":Ue("error",i),s=n;break;case"img":case"image":case"link":Ue("error",i),Ue("load",i),s=n;break;case"details":Ue("toggle",i),s=n;break;case"input":sA(i,n),s=a0(i,n),Ue("invalid",i);break;case"option":s=n;break;case"select":i._wrapperState={wasMultiple:!!n.multiple},s=Ze({},n,{value:void 0}),Ue("invalid",i);break;case"textarea":oA(i,n),s=u0(i,n),Ue("invalid",i);break;default:s=n}d0(t,s),l=s;for(r in l)if(l.hasOwnProperty(r)){var c=l[r];r==="style"?P1(i,c):r==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&T1(i,c)):r==="children"?typeof c=="string"?(t!=="textarea"||c!=="")&&Dd(i,c):typeof c=="number"&&Dd(i,""+c):r!=="suppressContentEditableWarning"&&r!=="suppressHydrationWarning"&&r!=="autoFocus"&&(Id.hasOwnProperty(r)?c!=null&&r==="onScroll"&&Ue("scroll",i):c!=null&&$_(i,r,c,o))}switch(t){case"input":cg(i),rA(i,n,!1);break;case"textarea":cg(i),aA(i);break;case"option":n.value!=null&&i.setAttribute("value",""+ra(n.value));break;case"select":i.multiple=!!n.multiple,r=n.value,r!=null?zc(i,!!n.multiple,r,!1):n.defaultValue!=null&&zc(i,!!n.multiple,n.defaultValue,!0);break;default:typeof s.onClick=="function"&&(i.onclick=Bm)}switch(t){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Xt(e),null;case 6:if(i&&e.stateNode!=null)JE(i,e,i.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error(j(166));if(t=Ra(Wd.current),Ra(Us.current),vg(e)){if(n=e.stateNode,t=e.memoizedProps,n[js]=e,(r=n.nodeValue!==t)&&(i=li,i!==null))switch(i.tag){case 3:yg(n.nodeValue,t,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&yg(n.nodeValue,t,(i.mode&1)!==0)}r&&(e.flags|=4)}else n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[js]=e,e.stateNode=n}return Xt(e),null;case 13:if(He(Ye),n=e.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(qe&&ai!==null&&e.mode&1&&!(e.flags&128))mE(),Ah(),e.flags|=98560,r=!1;else if(r=vg(e),n!==null&&n.dehydrated!==null){if(i===null){if(!r)throw Error(j(318));if(r=e.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(j(317));r[js]=e}else Ah(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Xt(e),r=!1}else is!==null&&(q0(is),is=null),r=!0;if(!r)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(n=n!==null,n!==(i!==null&&i.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(i===null||Ye.current&1?St===0&&(St=3):Ab())),e.updateQueue!==null&&(e.flags|=4),Xt(e),null);case 4:return Eh(),j0(i,e),i===null&&$d(e.stateNode.containerInfo),Xt(e),null;case 10:return rb(e.type._context),Xt(e),null;case 17:return Nn(e.type)&&jm(),Xt(e),null;case 19:if(He(Ye),r=e.memoizedState,r===null)return Xt(e),null;if(n=(e.flags&128)!==0,o=r.rendering,o===null)if(n)$h(r,!1);else{if(St!==0||i!==null&&i.flags&128)for(i=e.child;i!==null;){if(o=Gm(i),o!==null){for(e.flags|=128,$h(r,!1),n=o.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=t,t=e.child;t!==null;)r=t,i=n,r.flags&=14680066,o=r.alternate,o===null?(r.childLanes=0,r.lanes=i,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=o.childLanes,r.lanes=o.lanes,r.child=o.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=o.memoizedProps,r.memoizedState=o.memoizedState,r.updateQueue=o.updateQueue,r.type=o.type,i=o.dependencies,r.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),t=t.sibling;return je(Ye,Ye.current&1|2),e.child}i=i.sibling}r.tail!==null&&ct()>Ch&&(e.flags|=128,n=!0,$h(r,!1),e.lanes=4194304)}else{if(!n)if(i=Gm(o),i!==null){if(e.flags|=128,n=!0,t=i.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),$h(r,!0),r.tail===null&&r.tailMode==="hidden"&&!o.alternate&&!qe)return Xt(e),null}else 2*ct()-r.renderingStartTime>Ch&&t!==1073741824&&(e.flags|=128,n=!0,$h(r,!1),e.lanes=4194304);r.isBackwards?(o.sibling=e.child,e.child=o):(t=r.last,t!==null?t.sibling=o:e.child=o,r.last=o)}return r.tail!==null?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=ct(),e.sibling=null,t=Ye.current,je(Ye,n?t&1|2:t&1),e):(Xt(e),null);case 22:case 23:return bb(),n=e.memoizedState!==null,i!==null&&i.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?si&1073741824&&(Xt(e),e.subtreeFlags&6&&(e.flags|=8192)):Xt(e),null;case 24:return null;case 25:return null}throw Error(j(156,e.tag))}function fR(i,e){switch(tb(e),e.tag){case 1:return Nn(e.type)&&jm(),i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 3:return Eh(),He(Mn),He(rn),ub(),i=e.flags,i&65536&&!(i&128)?(e.flags=i&-65537|128,e):null;case 5:return cb(e),null;case 13:if(He(Ye),i=e.memoizedState,i!==null&&i.dehydrated!==null){if(e.alternate===null)throw Error(j(340));Ah()}return i=e.flags,i&65536?(e.flags=i&-65537|128,e):null;case 19:return He(Ye),null;case 4:return Eh(),null;case 10:return rb(e.type._context),null;case 22:case 23:return bb(),null;case 24:return null;default:return null}}var bg=!1,sn=!1,pR=typeof WeakSet=="function"?WeakSet:Set,V=null;function Oc(i,e){var t=i.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){rt(i,e,n)}else t.current=null}function $0(i,e,t){try{t()}catch(n){rt(i,e,n)}}var YA=!1;function gR(i,e){if(S0=Mm,i=iE(),Z_(i)){if("selectionStart"in i)var t={start:i.selectionStart,end:i.selectionEnd};else e:{t=(t=i.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var s=n.anchorOffset,r=n.focusNode;n=n.focusOffset;try{t.nodeType,r.nodeType}catch{t=null;break e}var o=0,l=-1,c=-1,u=0,h=0,d=i,f=null;t:for(;;){for(var p;d!==t||s!==0&&d.nodeType!==3||(l=o+s),d!==r||n!==0&&d.nodeType!==3||(c=o+n),d.nodeType===3&&(o+=d.nodeValue.length),(p=d.firstChild)!==null;)f=d,d=p;for(;;){if(d===i)break t;if(f===t&&++u===s&&(l=o),f===r&&++h===n&&(c=o),(p=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=p}t=l===-1||c===-1?null:{start:l,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(E0={focusedElem:i,selectionRange:t},Mm=!1,V=e;V!==null;)if(e=V,i=e.child,(e.subtreeFlags&1028)!==0&&i!==null)i.return=e,V=i;else for(;V!==null;){e=V;try{var v=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(v!==null){var b=v.memoizedProps,S=v.memoizedState,m=e.stateNode,_=m.getSnapshotBeforeUpdate(e.elementType===e.type?b:zi(e.type,b),S);m.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var w=e.stateNode.containerInfo;w.nodeType===1?w.textContent="":w.nodeType===9&&w.documentElement&&w.removeChild(w.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(j(163))}}catch(E){rt(e,e.return,E)}if(i=e.sibling,i!==null){i.return=e.return,V=i;break}V=e.return}return v=YA,YA=!1,v}function Cd(i,e,t){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var s=n=n.next;do{if((s.tag&i)===i){var r=s.destroy;s.destroy=void 0,r!==void 0&&$0(e,t,r)}s=s.next}while(s!==n)}}function Wy(i,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&i)===i){var n=t.create;t.destroy=n()}t=t.next}while(t!==e)}}function U0(i){var e=i.ref;if(e!==null){var t=i.stateNode;switch(i.tag){case 5:i=t;break;default:i=t}typeof e=="function"?e(i):e.current=i}}function ZE(i){var e=i.alternate;e!==null&&(i.alternate=null,ZE(e)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(e=i.stateNode,e!==null&&(delete e[js],delete e[zd],delete e[T0],delete e[QP],delete e[JP])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function ek(i){return i.tag===5||i.tag===3||i.tag===4}function QA(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||ek(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function z0(i,e,t){var n=i.tag;if(n===5||n===6)i=i.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(i,e):t.insertBefore(i,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(i,t)):(e=t,e.appendChild(i)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Bm));else if(n!==4&&(i=i.child,i!==null))for(z0(i,e,t),i=i.sibling;i!==null;)z0(i,e,t),i=i.sibling}function H0(i,e,t){var n=i.tag;if(n===5||n===6)i=i.stateNode,e?t.insertBefore(i,e):t.appendChild(i);else if(n!==4&&(i=i.child,i!==null))for(H0(i,e,t),i=i.sibling;i!==null;)H0(i,e,t),i=i.sibling}var Ut=null,ts=!1;function qr(i,e,t){for(t=t.child;t!==null;)tk(i,e,t),t=t.sibling}function tk(i,e,t){if($s&&typeof $s.onCommitFiberUnmount=="function")try{$s.onCommitFiberUnmount(Ny,t)}catch{}switch(t.tag){case 5:sn||Oc(t,e);case 6:var n=Ut,s=ts;Ut=null,qr(i,e,t),Ut=n,ts=s,Ut!==null&&(ts?(i=Ut,t=t.stateNode,i.nodeType===8?i.parentNode.removeChild(t):i.removeChild(t)):Ut.removeChild(t.stateNode));break;case 18:Ut!==null&&(ts?(i=Ut,t=t.stateNode,i.nodeType===8?Cv(i.parentNode,t):i.nodeType===1&&Cv(i,t),Fd(i)):Cv(Ut,t.stateNode));break;case 4:n=Ut,s=ts,Ut=t.stateNode.containerInfo,ts=!0,qr(i,e,t),Ut=n,ts=s;break;case 0:case 11:case 14:case 15:if(!sn&&(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){s=n=n.next;do{var r=s,o=r.destroy;r=r.tag,o!==void 0&&(r&2||r&4)&&$0(t,e,o),s=s.next}while(s!==n)}qr(i,e,t);break;case 1:if(!sn&&(Oc(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=t.memoizedProps,n.state=t.memoizedState,n.componentWillUnmount()}catch(l){rt(t,e,l)}qr(i,e,t);break;case 21:qr(i,e,t);break;case 22:t.mode&1?(sn=(n=sn)||t.memoizedState!==null,qr(i,e,t),sn=n):qr(i,e,t);break;default:qr(i,e,t)}}function JA(i){var e=i.updateQueue;if(e!==null){i.updateQueue=null;var t=i.stateNode;t===null&&(t=i.stateNode=new pR),e.forEach(function(n){var s=ER.bind(null,i,n);t.has(n)||(t.add(n),n.then(s,s))})}}function Bi(i,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var s=t[n];try{var r=i,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:Ut=l.stateNode,ts=!1;break e;case 3:Ut=l.stateNode.containerInfo,ts=!0;break e;case 4:Ut=l.stateNode.containerInfo,ts=!0;break e}l=l.return}if(Ut===null)throw Error(j(160));tk(r,o,s),Ut=null,ts=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(u){rt(s,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)nk(e,i),e=e.sibling}function nk(i,e){var t=i.alternate,n=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(Bi(e,i),us(i),n&4){try{Cd(3,i,i.return),Wy(3,i)}catch(b){rt(i,i.return,b)}try{Cd(5,i,i.return)}catch(b){rt(i,i.return,b)}}break;case 1:Bi(e,i),us(i),n&512&&t!==null&&Oc(t,t.return);break;case 5:if(Bi(e,i),us(i),n&512&&t!==null&&Oc(t,t.return),i.flags&32){var s=i.stateNode;try{Dd(s,"")}catch(b){rt(i,i.return,b)}}if(n&4&&(s=i.stateNode,s!=null)){var r=i.memoizedProps,o=t!==null?t.memoizedProps:r,l=i.type,c=i.updateQueue;if(i.updateQueue=null,c!==null)try{l==="input"&&r.type==="radio"&&r.name!=null&&E1(s,r),f0(l,o);var u=f0(l,r);for(o=0;o<c.length;o+=2){var h=c[o],d=c[o+1];h==="style"?P1(s,d):h==="dangerouslySetInnerHTML"?T1(s,d):h==="children"?Dd(s,d):$_(s,h,d,u)}switch(l){case"input":l0(s,r);break;case"textarea":k1(s,r);break;case"select":var f=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!r.multiple;var p=r.value;p!=null?zc(s,!!r.multiple,p,!1):f!==!!r.multiple&&(r.defaultValue!=null?zc(s,!!r.multiple,r.defaultValue,!0):zc(s,!!r.multiple,r.multiple?[]:"",!1))}s[zd]=r}catch(b){rt(i,i.return,b)}}break;case 6:if(Bi(e,i),us(i),n&4){if(i.stateNode===null)throw Error(j(162));s=i.stateNode,r=i.memoizedProps;try{s.nodeValue=r}catch(b){rt(i,i.return,b)}}break;case 3:if(Bi(e,i),us(i),n&4&&t!==null&&t.memoizedState.isDehydrated)try{Fd(e.containerInfo)}catch(b){rt(i,i.return,b)}break;case 4:Bi(e,i),us(i);break;case 13:Bi(e,i),us(i),s=i.child,s.flags&8192&&(r=s.memoizedState!==null,s.stateNode.isHidden=r,!r||s.alternate!==null&&s.alternate.memoizedState!==null||(wb=ct())),n&4&&JA(i);break;case 22:if(h=t!==null&&t.memoizedState!==null,i.mode&1?(sn=(u=sn)||h,Bi(e,i),sn=u):Bi(e,i),us(i),n&8192){if(u=i.memoizedState!==null,(i.stateNode.isHidden=u)&&!h&&i.mode&1)for(V=i,h=i.child;h!==null;){for(d=V=h;V!==null;){switch(f=V,p=f.child,f.tag){case 0:case 11:case 14:case 15:Cd(4,f,f.return);break;case 1:Oc(f,f.return);var v=f.stateNode;if(typeof v.componentWillUnmount=="function"){n=f,t=f.return;try{e=n,v.props=e.memoizedProps,v.state=e.memoizedState,v.componentWillUnmount()}catch(b){rt(n,t,b)}}break;case 5:Oc(f,f.return);break;case 22:if(f.memoizedState!==null){eS(d);continue}}p!==null?(p.return=f,V=p):eS(d)}h=h.sibling}e:for(h=null,d=i;;){if(d.tag===5){if(h===null){h=d;try{s=d.stateNode,u?(r=s.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none"):(l=d.stateNode,c=d.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=x1("display",o))}catch(b){rt(i,i.return,b)}}}else if(d.tag===6){if(h===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(b){rt(i,i.return,b)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===i)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===i)break e;for(;d.sibling===null;){if(d.return===null||d.return===i)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Bi(e,i),us(i),n&4&&JA(i);break;case 21:break;default:Bi(e,i),us(i)}}function us(i){var e=i.flags;if(e&2){try{e:{for(var t=i.return;t!==null;){if(ek(t)){var n=t;break e}t=t.return}throw Error(j(160))}switch(n.tag){case 5:var s=n.stateNode;n.flags&32&&(Dd(s,""),n.flags&=-33);var r=QA(i);H0(i,r,s);break;case 3:case 4:var o=n.stateNode.containerInfo,l=QA(i);z0(i,l,o);break;default:throw Error(j(161))}}catch(c){rt(i,i.return,c)}i.flags&=-3}e&4096&&(i.flags&=-4097)}function mR(i,e,t){V=i,ik(i)}function ik(i,e,t){for(var n=(i.mode&1)!==0;V!==null;){var s=V,r=s.child;if(s.tag===22&&n){var o=s.memoizedState!==null||bg;if(!o){var l=s.alternate,c=l!==null&&l.memoizedState!==null||sn;l=bg;var u=sn;if(bg=o,(sn=c)&&!u)for(V=s;V!==null;)o=V,c=o.child,o.tag===22&&o.memoizedState!==null?tS(s):c!==null?(c.return=o,V=c):tS(s);for(;r!==null;)V=r,ik(r),r=r.sibling;V=s,bg=l,sn=u}ZA(i)}else s.subtreeFlags&8772&&r!==null?(r.return=s,V=r):ZA(i)}}function ZA(i){for(;V!==null;){var e=V;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:sn||Wy(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!sn)if(t===null)n.componentDidMount();else{var s=e.elementType===e.type?t.memoizedProps:zi(e.type,t.memoizedProps);n.componentDidUpdate(s,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var r=e.updateQueue;r!==null&&FA(e,r,n);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}FA(e,o,t)}break;case 5:var l=e.stateNode;if(t===null&&e.flags&4){t=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var d=h.dehydrated;d!==null&&Fd(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(j(163))}sn||e.flags&512&&U0(e)}catch(f){rt(e,e.return,f)}}if(e===i){V=null;break}if(t=e.sibling,t!==null){t.return=e.return,V=t;break}V=e.return}}function eS(i){for(;V!==null;){var e=V;if(e===i){V=null;break}var t=e.sibling;if(t!==null){t.return=e.return,V=t;break}V=e.return}}function tS(i){for(;V!==null;){var e=V;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Wy(4,e)}catch(c){rt(e,t,c)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var s=e.return;try{n.componentDidMount()}catch(c){rt(e,s,c)}}var r=e.return;try{U0(e)}catch(c){rt(e,r,c)}break;case 5:var o=e.return;try{U0(e)}catch(c){rt(e,o,c)}}}catch(c){rt(e,e.return,c)}if(e===i){V=null;break}var l=e.sibling;if(l!==null){l.return=e.return,V=l;break}V=e.return}}var yR=Math.ceil,Xm=Gr.ReactCurrentDispatcher,yb=Gr.ReactCurrentOwner,Li=Gr.ReactCurrentBatchConfig,me=0,Ot=null,ft=null,Vt=0,si=0,Mc=ha(0),St=0,Kd=null,Ql=0,Vy=0,vb=0,Td=null,In=null,wb=0,Ch=1/0,Ks=null,Ym=!1,W0=null,na=null,Ag=!1,Yo=null,Qm=0,xd=0,V0=null,qg=-1,Kg=0;function vn(){return me&6?ct():qg!==-1?qg:qg=ct()}function ia(i){return i.mode&1?me&2&&Vt!==0?Vt&-Vt:eR.transition!==null?(Kg===0&&(Kg=U1()),Kg):(i=ke,i!==0||(i=window.event,i=i===void 0?16:K1(i.type)),i):1}function as(i,e,t,n){if(50<xd)throw xd=0,V0=null,Error(j(185));Gp(i,t,n),(!(me&2)||i!==Ot)&&(i===Ot&&(!(me&2)&&(Vy|=t),St===4&&eo(i,Vt)),Fn(i,n),t===1&&me===0&&!(e.mode&1)&&(Ch=ct()+500,Uy&&da()))}function Fn(i,e){var t=i.callbackNode;eP(i,e);var n=Om(i,i===Ot?Vt:0);if(n===0)t!==null&&uA(t),i.callbackNode=null,i.callbackPriority=0;else if(e=n&-n,i.callbackPriority!==e){if(t!=null&&uA(t),e===1)i.tag===0?ZP(nS.bind(null,i)):fE(nS.bind(null,i)),XP(function(){!(me&6)&&da()}),t=null;else{switch(z1(n)){case 1:t=V_;break;case 4:t=j1;break;case 16:t=Dm;break;case 536870912:t=$1;break;default:t=Dm}t=hk(t,sk.bind(null,i))}i.callbackPriority=e,i.callbackNode=t}}function sk(i,e){if(qg=-1,Kg=0,me&6)throw Error(j(327));var t=i.callbackNode;if(qc()&&i.callbackNode!==t)return null;var n=Om(i,i===Ot?Vt:0);if(n===0)return null;if(n&30||n&i.expiredLanes||e)e=Jm(i,n);else{e=n;var s=me;me|=2;var r=ok();(Ot!==i||Vt!==e)&&(Ks=null,Ch=ct()+500,Gl(i,e));do try{_R();break}catch(l){rk(i,l)}while(!0);sb(),Xm.current=r,me=s,ft!==null?e=0:(Ot=null,Vt=0,e=St)}if(e!==0){if(e===2&&(s=v0(i),s!==0&&(n=s,e=G0(i,s))),e===1)throw t=Kd,Gl(i,0),eo(i,n),Fn(i,ct()),t;if(e===6)eo(i,n);else{if(s=i.current.alternate,!(n&30)&&!vR(s)&&(e=Jm(i,n),e===2&&(r=v0(i),r!==0&&(n=r,e=G0(i,r))),e===1))throw t=Kd,Gl(i,0),eo(i,n),Fn(i,ct()),t;switch(i.finishedWork=s,i.finishedLanes=n,e){case 0:case 1:throw Error(j(345));case 2:wa(i,In,Ks);break;case 3:if(eo(i,n),(n&130023424)===n&&(e=wb+500-ct(),10<e)){if(Om(i,0)!==0)break;if(s=i.suspendedLanes,(s&n)!==n){vn(),i.pingedLanes|=i.suspendedLanes&s;break}i.timeoutHandle=C0(wa.bind(null,i,In,Ks),e);break}wa(i,In,Ks);break;case 4:if(eo(i,n),(n&4194240)===n)break;for(e=i.eventTimes,s=-1;0<n;){var o=31-os(n);r=1<<o,o=e[o],o>s&&(s=o),n&=~r}if(n=s,n=ct()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*yR(n/1960))-n,10<n){i.timeoutHandle=C0(wa.bind(null,i,In,Ks),n);break}wa(i,In,Ks);break;case 5:wa(i,In,Ks);break;default:throw Error(j(329))}}}return Fn(i,ct()),i.callbackNode===t?sk.bind(null,i):null}function G0(i,e){var t=Td;return i.current.memoizedState.isDehydrated&&(Gl(i,e).flags|=256),i=Jm(i,e),i!==2&&(e=In,In=t,e!==null&&q0(e)),i}function q0(i){In===null?In=i:In.push.apply(In,i)}function vR(i){for(var e=i;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var n=0;n<t.length;n++){var s=t[n],r=s.getSnapshot;s=s.value;try{if(!ls(r(),s))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===i)break;for(;e.sibling===null;){if(e.return===null||e.return===i)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function eo(i,e){for(e&=~vb,e&=~Vy,i.suspendedLanes|=e,i.pingedLanes&=~e,i=i.expirationTimes;0<e;){var t=31-os(e),n=1<<t;i[t]=-1,e&=~n}}function nS(i){if(me&6)throw Error(j(327));qc();var e=Om(i,0);if(!(e&1))return Fn(i,ct()),null;var t=Jm(i,e);if(i.tag!==0&&t===2){var n=v0(i);n!==0&&(e=n,t=G0(i,n))}if(t===1)throw t=Kd,Gl(i,0),eo(i,e),Fn(i,ct()),t;if(t===6)throw Error(j(345));return i.finishedWork=i.current.alternate,i.finishedLanes=e,wa(i,In,Ks),Fn(i,ct()),null}function _b(i,e){var t=me;me|=1;try{return i(e)}finally{me=t,me===0&&(Ch=ct()+500,Uy&&da())}}function Jl(i){Yo!==null&&Yo.tag===0&&!(me&6)&&qc();var e=me;me|=1;var t=Li.transition,n=ke;try{if(Li.transition=null,ke=1,i)return i()}finally{ke=n,Li.transition=t,me=e,!(me&6)&&da()}}function bb(){si=Mc.current,He(Mc)}function Gl(i,e){i.finishedWork=null,i.finishedLanes=0;var t=i.timeoutHandle;if(t!==-1&&(i.timeoutHandle=-1,KP(t)),ft!==null)for(t=ft.return;t!==null;){var n=t;switch(tb(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&jm();break;case 3:Eh(),He(Mn),He(rn),ub();break;case 5:cb(n);break;case 4:Eh();break;case 13:He(Ye);break;case 19:He(Ye);break;case 10:rb(n.type._context);break;case 22:case 23:bb()}t=t.return}if(Ot=i,ft=i=sa(i.current,null),Vt=si=e,St=0,Kd=null,vb=Vy=Ql=0,In=Td=null,Pa!==null){for(e=0;e<Pa.length;e++)if(t=Pa[e],n=t.interleaved,n!==null){t.interleaved=null;var s=n.next,r=t.pending;if(r!==null){var o=r.next;r.next=s,n.next=o}t.pending=n}Pa=null}return i}function rk(i,e){do{var t=ft;try{if(sb(),Wg.current=Km,qm){for(var n=Qe.memoizedState;n!==null;){var s=n.queue;s!==null&&(s.pending=null),n=n.next}qm=!1}if(Yl=0,Dt=At=Qe=null,kd=!1,Vd=0,yb.current=null,t===null||t.return===null){St=1,Kd=e,ft=null;break}e:{var r=i,o=t.return,l=t,c=e;if(e=Vt,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,h=l,d=h.tag;if(!(h.mode&1)&&(d===0||d===11||d===15)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=HA(o);if(p!==null){p.flags&=-257,WA(p,o,l,r,e),p.mode&1&&zA(r,u,e),e=p,c=u;var v=e.updateQueue;if(v===null){var b=new Set;b.add(c),e.updateQueue=b}else v.add(c);break e}else{if(!(e&1)){zA(r,u,e),Ab();break e}c=Error(j(426))}}else if(qe&&l.mode&1){var S=HA(o);if(S!==null){!(S.flags&65536)&&(S.flags|=256),WA(S,o,l,r,e),nb(kh(c,l));break e}}r=c=kh(c,l),St!==4&&(St=2),Td===null?Td=[r]:Td.push(r),r=o;do{switch(r.tag){case 3:r.flags|=65536,e&=-e,r.lanes|=e;var m=zE(r,c,e);NA(r,m);break e;case 1:l=c;var _=r.type,w=r.stateNode;if(!(r.flags&128)&&(typeof _.getDerivedStateFromError=="function"||w!==null&&typeof w.componentDidCatch=="function"&&(na===null||!na.has(w)))){r.flags|=65536,e&=-e,r.lanes|=e;var E=HE(r,l,e);NA(r,E);break e}}r=r.return}while(r!==null)}lk(t)}catch(k){e=k,ft===t&&t!==null&&(ft=t=t.return);continue}break}while(!0)}function ok(){var i=Xm.current;return Xm.current=Km,i===null?Km:i}function Ab(){(St===0||St===3||St===2)&&(St=4),Ot===null||!(Ql&268435455)&&!(Vy&268435455)||eo(Ot,Vt)}function Jm(i,e){var t=me;me|=2;var n=ok();(Ot!==i||Vt!==e)&&(Ks=null,Gl(i,e));do try{wR();break}catch(s){rk(i,s)}while(!0);if(sb(),me=t,Xm.current=n,ft!==null)throw Error(j(261));return Ot=null,Vt=0,St}function wR(){for(;ft!==null;)ak(ft)}function _R(){for(;ft!==null&&!Vx();)ak(ft)}function ak(i){var e=uk(i.alternate,i,si);i.memoizedProps=i.pendingProps,e===null?lk(i):ft=e,yb.current=null}function lk(i){var e=i;do{var t=e.alternate;if(i=e.return,e.flags&32768){if(t=fR(t,e),t!==null){t.flags&=32767,ft=t;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{St=6,ft=null;return}}else if(t=dR(t,e,si),t!==null){ft=t;return}if(e=e.sibling,e!==null){ft=e;return}ft=e=i}while(e!==null);St===0&&(St=5)}function wa(i,e,t){var n=ke,s=Li.transition;try{Li.transition=null,ke=1,bR(i,e,t,n)}finally{Li.transition=s,ke=n}return null}function bR(i,e,t,n){do qc();while(Yo!==null);if(me&6)throw Error(j(327));t=i.finishedWork;var s=i.finishedLanes;if(t===null)return null;if(i.finishedWork=null,i.finishedLanes=0,t===i.current)throw Error(j(177));i.callbackNode=null,i.callbackPriority=0;var r=t.lanes|t.childLanes;if(tP(i,r),i===Ot&&(ft=Ot=null,Vt=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Ag||(Ag=!0,hk(Dm,function(){return qc(),null})),r=(t.flags&15990)!==0,t.subtreeFlags&15990||r){r=Li.transition,Li.transition=null;var o=ke;ke=1;var l=me;me|=4,yb.current=null,gR(i,t),nk(t,i),UP(E0),Mm=!!S0,E0=S0=null,i.current=t,mR(t),Gx(),me=l,ke=o,Li.transition=r}else i.current=t;if(Ag&&(Ag=!1,Yo=i,Qm=s),r=i.pendingLanes,r===0&&(na=null),Xx(t.stateNode),Fn(i,ct()),e!==null)for(n=i.onRecoverableError,t=0;t<e.length;t++)s=e[t],n(s.value,{componentStack:s.stack,digest:s.digest});if(Ym)throw Ym=!1,i=W0,W0=null,i;return Qm&1&&i.tag!==0&&qc(),r=i.pendingLanes,r&1?i===V0?xd++:(xd=0,V0=i):xd=0,da(),null}function qc(){if(Yo!==null){var i=z1(Qm),e=Li.transition,t=ke;try{if(Li.transition=null,ke=16>i?16:i,Yo===null)var n=!1;else{if(i=Yo,Yo=null,Qm=0,me&6)throw Error(j(331));var s=me;for(me|=4,V=i.current;V!==null;){var r=V,o=r.child;if(V.flags&16){var l=r.deletions;if(l!==null){for(var c=0;c<l.length;c++){var u=l[c];for(V=u;V!==null;){var h=V;switch(h.tag){case 0:case 11:case 15:Cd(8,h,r)}var d=h.child;if(d!==null)d.return=h,V=d;else for(;V!==null;){h=V;var f=h.sibling,p=h.return;if(ZE(h),h===u){V=null;break}if(f!==null){f.return=p,V=f;break}V=p}}}var v=r.alternate;if(v!==null){var b=v.child;if(b!==null){v.child=null;do{var S=b.sibling;b.sibling=null,b=S}while(b!==null)}}V=r}}if(r.subtreeFlags&2064&&o!==null)o.return=r,V=o;else e:for(;V!==null;){if(r=V,r.flags&2048)switch(r.tag){case 0:case 11:case 15:Cd(9,r,r.return)}var m=r.sibling;if(m!==null){m.return=r.return,V=m;break e}V=r.return}}var _=i.current;for(V=_;V!==null;){o=V;var w=o.child;if(o.subtreeFlags&2064&&w!==null)w.return=o,V=w;else e:for(o=_;V!==null;){if(l=V,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Wy(9,l)}}catch(k){rt(l,l.return,k)}if(l===o){V=null;break e}var E=l.sibling;if(E!==null){E.return=l.return,V=E;break e}V=l.return}}if(me=s,da(),$s&&typeof $s.onPostCommitFiberRoot=="function")try{$s.onPostCommitFiberRoot(Ny,i)}catch{}n=!0}return n}finally{ke=t,Li.transition=e}}return!1}function iS(i,e,t){e=kh(t,e),e=zE(i,e,1),i=ta(i,e,1),e=vn(),i!==null&&(Gp(i,1,e),Fn(i,e))}function rt(i,e,t){if(i.tag===3)iS(i,i,t);else for(;e!==null;){if(e.tag===3){iS(e,i,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(na===null||!na.has(n))){i=kh(t,i),i=HE(e,i,1),e=ta(e,i,1),i=vn(),e!==null&&(Gp(e,1,i),Fn(e,i));break}}e=e.return}}function AR(i,e,t){var n=i.pingCache;n!==null&&n.delete(e),e=vn(),i.pingedLanes|=i.suspendedLanes&t,Ot===i&&(Vt&t)===t&&(St===4||St===3&&(Vt&130023424)===Vt&&500>ct()-wb?Gl(i,0):vb|=t),Fn(i,e)}function ck(i,e){e===0&&(i.mode&1?(e=dg,dg<<=1,!(dg&130023424)&&(dg=4194304)):e=1);var t=vn();i=zr(i,e),i!==null&&(Gp(i,e,t),Fn(i,t))}function SR(i){var e=i.memoizedState,t=0;e!==null&&(t=e.retryLane),ck(i,t)}function ER(i,e){var t=0;switch(i.tag){case 13:var n=i.stateNode,s=i.memoizedState;s!==null&&(t=s.retryLane);break;case 19:n=i.stateNode;break;default:throw Error(j(314))}n!==null&&n.delete(e),ck(i,t)}var uk;uk=function(i,e,t){if(i!==null)if(i.memoizedProps!==e.pendingProps||Mn.current)On=!0;else{if(!(i.lanes&t)&&!(e.flags&128))return On=!1,hR(i,e,t);On=!!(i.flags&131072)}else On=!1,qe&&e.flags&1048576&&pE(e,zm,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;Gg(i,e),i=e.pendingProps;var s=bh(e,rn.current);Gc(e,t),s=db(null,e,n,i,s,t);var r=fb();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,Nn(n)?(r=!0,$m(e)):r=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,ab(e),s.updater=Hy,e.stateNode=s,s._reactInternals=e,D0(e,n,i,t),e=N0(null,e,n,!0,r,t)):(e.tag=0,qe&&r&&eb(e),gn(null,e,s,t),e=e.child),e;case 16:n=e.elementType;e:{switch(Gg(i,e),i=e.pendingProps,s=n._init,n=s(n._payload),e.type=n,s=e.tag=CR(n),i=zi(n,i),s){case 0:e=M0(null,e,n,i,t);break e;case 1:e=qA(null,e,n,i,t);break e;case 11:e=VA(null,e,n,i,t);break e;case 14:e=GA(null,e,n,zi(n.type,i),t);break e}throw Error(j(306,n,""))}return e;case 0:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:zi(n,s),M0(i,e,n,s,t);case 1:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:zi(n,s),qA(i,e,n,s,t);case 3:e:{if(qE(e),i===null)throw Error(j(387));n=e.pendingProps,r=e.memoizedState,s=r.element,_E(i,e),Vm(e,n,null,t);var o=e.memoizedState;if(n=o.element,r.isDehydrated)if(r={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=r,e.memoizedState=r,e.flags&256){s=kh(Error(j(423)),e),e=KA(i,e,n,t,s);break e}else if(n!==s){s=kh(Error(j(424)),e),e=KA(i,e,n,t,s);break e}else for(ai=ea(e.stateNode.containerInfo.firstChild),li=e,qe=!0,is=null,t=vE(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Ah(),n===s){e=Hr(i,e,t);break e}gn(i,e,n,t)}e=e.child}return e;case 5:return bE(e),i===null&&R0(e),n=e.type,s=e.pendingProps,r=i!==null?i.memoizedProps:null,o=s.children,k0(n,s)?o=null:r!==null&&k0(n,r)&&(e.flags|=32),GE(i,e),gn(i,e,o,t),e.child;case 6:return i===null&&R0(e),null;case 13:return KE(i,e,t);case 4:return lb(e,e.stateNode.containerInfo),n=e.pendingProps,i===null?e.child=Sh(e,null,n,t):gn(i,e,n,t),e.child;case 11:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:zi(n,s),VA(i,e,n,s,t);case 7:return gn(i,e,e.pendingProps,t),e.child;case 8:return gn(i,e,e.pendingProps.children,t),e.child;case 12:return gn(i,e,e.pendingProps.children,t),e.child;case 10:e:{if(n=e.type._context,s=e.pendingProps,r=e.memoizedProps,o=s.value,je(Hm,n._currentValue),n._currentValue=o,r!==null)if(ls(r.value,o)){if(r.children===s.children&&!Mn.current){e=Hr(i,e,t);break e}}else for(r=e.child,r!==null&&(r.return=e);r!==null;){var l=r.dependencies;if(l!==null){o=r.child;for(var c=l.firstContext;c!==null;){if(c.context===n){if(r.tag===1){c=Nr(-1,t&-t),c.tag=2;var u=r.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}r.lanes|=t,c=r.alternate,c!==null&&(c.lanes|=t),L0(r.return,t,e),l.lanes|=t;break}c=c.next}}else if(r.tag===10)o=r.type===e.type?null:r.child;else if(r.tag===18){if(o=r.return,o===null)throw Error(j(341));o.lanes|=t,l=o.alternate,l!==null&&(l.lanes|=t),L0(o,t,e),o=r.sibling}else o=r.child;if(o!==null)o.return=r;else for(o=r;o!==null;){if(o===e){o=null;break}if(r=o.sibling,r!==null){r.return=o.return,o=r;break}o=o.return}r=o}gn(i,e,s.children,t),e=e.child}return e;case 9:return s=e.type,n=e.pendingProps.children,Gc(e,t),s=Oi(s),n=n(s),e.flags|=1,gn(i,e,n,t),e.child;case 14:return n=e.type,s=zi(n,e.pendingProps),s=zi(n.type,s),GA(i,e,n,s,t);case 15:return WE(i,e,e.type,e.pendingProps,t);case 17:return n=e.type,s=e.pendingProps,s=e.elementType===n?s:zi(n,s),Gg(i,e),e.tag=1,Nn(n)?(i=!0,$m(e)):i=!1,Gc(e,t),UE(e,n,s),D0(e,n,s,t),N0(null,e,n,!0,i,t);case 19:return XE(i,e,t);case 22:return VE(i,e,t)}throw Error(j(156,e.tag))};function hk(i,e){return B1(i,e)}function kR(i,e,t,n){this.tag=i,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ri(i,e,t,n){return new kR(i,e,t,n)}function Sb(i){return i=i.prototype,!(!i||!i.isReactComponent)}function CR(i){if(typeof i=="function")return Sb(i)?1:0;if(i!=null){if(i=i.$$typeof,i===z_)return 11;if(i===H_)return 14}return 2}function sa(i,e){var t=i.alternate;return t===null?(t=Ri(i.tag,e,i.key,i.mode),t.elementType=i.elementType,t.type=i.type,t.stateNode=i.stateNode,t.alternate=i,i.alternate=t):(t.pendingProps=e,t.type=i.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=i.flags&14680064,t.childLanes=i.childLanes,t.lanes=i.lanes,t.child=i.child,t.memoizedProps=i.memoizedProps,t.memoizedState=i.memoizedState,t.updateQueue=i.updateQueue,e=i.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=i.sibling,t.index=i.index,t.ref=i.ref,t}function Xg(i,e,t,n,s,r){var o=2;if(n=i,typeof i=="function")Sb(i)&&(o=1);else if(typeof i=="string")o=5;else e:switch(i){case kc:return ql(t.children,s,r,e);case U_:o=8,s|=8;break;case i0:return i=Ri(12,t,e,s|2),i.elementType=i0,i.lanes=r,i;case s0:return i=Ri(13,t,e,s),i.elementType=s0,i.lanes=r,i;case r0:return i=Ri(19,t,e,s),i.elementType=r0,i.lanes=r,i;case b1:return Gy(t,s,r,e);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case w1:o=10;break e;case _1:o=9;break e;case z_:o=11;break e;case H_:o=14;break e;case Qr:o=16,n=null;break e}throw Error(j(130,i==null?i:typeof i,""))}return e=Ri(o,t,e,s),e.elementType=i,e.type=n,e.lanes=r,e}function ql(i,e,t,n){return i=Ri(7,i,n,e),i.lanes=t,i}function Gy(i,e,t,n){return i=Ri(22,i,n,e),i.elementType=b1,i.lanes=t,i.stateNode={isHidden:!1},i}function Ov(i,e,t){return i=Ri(6,i,null,e),i.lanes=t,i}function Mv(i,e,t){return e=Ri(4,i.children!==null?i.children:[],i.key,e),e.lanes=t,e.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},e}function TR(i,e,t,n,s){this.tag=e,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=gv(0),this.expirationTimes=gv(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=gv(0),this.identifierPrefix=n,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Eb(i,e,t,n,s,r,o,l,c){return i=new TR(i,e,t,l,c),e===1?(e=1,r===!0&&(e|=8)):e=0,r=Ri(3,null,null,e),i.current=r,r.stateNode=i,r.memoizedState={element:n,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},ab(r),i}function xR(i,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ec,key:n==null?null:""+n,children:i,containerInfo:e,implementation:t}}function dk(i){if(!i)return oa;i=i._reactInternals;e:{if(ic(i)!==i||i.tag!==1)throw Error(j(170));var e=i;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(Nn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(j(171))}if(i.tag===1){var t=i.type;if(Nn(t))return dE(i,t,e)}return e}function fk(i,e,t,n,s,r,o,l,c){return i=Eb(t,n,!0,i,s,r,o,l,c),i.context=dk(null),t=i.current,n=vn(),s=ia(t),r=Nr(n,s),r.callback=e??null,ta(t,r,s),i.current.lanes=s,Gp(i,s,n),Fn(i,n),i}function qy(i,e,t,n){var s=e.current,r=vn(),o=ia(s);return t=dk(t),e.context===null?e.context=t:e.pendingContext=t,e=Nr(r,o),e.payload={element:i},n=n===void 0?null:n,n!==null&&(e.callback=n),i=ta(s,e,o),i!==null&&(as(i,s,o,r),Hg(i,s,o)),o}function Zm(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function sS(i,e){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var t=i.retryLane;i.retryLane=t!==0&&t<e?t:e}}function kb(i,e){sS(i,e),(i=i.alternate)&&sS(i,e)}function PR(){return null}var pk=typeof reportError=="function"?reportError:function(i){console.error(i)};function Cb(i){this._internalRoot=i}Ky.prototype.render=Cb.prototype.render=function(i){var e=this._internalRoot;if(e===null)throw Error(j(409));qy(i,e,null,null)};Ky.prototype.unmount=Cb.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var e=i.containerInfo;Jl(function(){qy(null,i,null,null)}),e[Ur]=null}};function Ky(i){this._internalRoot=i}Ky.prototype.unstable_scheduleHydration=function(i){if(i){var e=V1();i={blockedOn:null,target:i,priority:e};for(var t=0;t<Zr.length&&e!==0&&e<Zr[t].priority;t++);Zr.splice(t,0,i),t===0&&q1(i)}};function Tb(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function Xy(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function rS(){}function RR(i,e,t,n,s){if(s){if(typeof n=="function"){var r=n;n=function(){var u=Zm(o);r.call(u)}}var o=fk(e,n,i,0,null,!1,!1,"",rS);return i._reactRootContainer=o,i[Ur]=o.current,$d(i.nodeType===8?i.parentNode:i),Jl(),o}for(;s=i.lastChild;)i.removeChild(s);if(typeof n=="function"){var l=n;n=function(){var u=Zm(c);l.call(u)}}var c=Eb(i,0,!1,null,null,!1,!1,"",rS);return i._reactRootContainer=c,i[Ur]=c.current,$d(i.nodeType===8?i.parentNode:i),Jl(function(){qy(e,c,t,n)}),c}function Yy(i,e,t,n,s){var r=t._reactRootContainer;if(r){var o=r;if(typeof s=="function"){var l=s;s=function(){var c=Zm(o);l.call(c)}}qy(e,o,i,s)}else o=RR(t,e,i,s,n);return Zm(o)}H1=function(i){switch(i.tag){case 3:var e=i.stateNode;if(e.current.memoizedState.isDehydrated){var t=Yh(e.pendingLanes);t!==0&&(G_(e,t|1),Fn(e,ct()),!(me&6)&&(Ch=ct()+500,da()))}break;case 13:Jl(function(){var n=zr(i,1);if(n!==null){var s=vn();as(n,i,1,s)}}),kb(i,1)}};q_=function(i){if(i.tag===13){var e=zr(i,134217728);if(e!==null){var t=vn();as(e,i,134217728,t)}kb(i,134217728)}};W1=function(i){if(i.tag===13){var e=ia(i),t=zr(i,e);if(t!==null){var n=vn();as(t,i,e,n)}kb(i,e)}};V1=function(){return ke};G1=function(i,e){var t=ke;try{return ke=i,e()}finally{ke=t}};g0=function(i,e,t){switch(e){case"input":if(l0(i,t),e=t.name,t.type==="radio"&&e!=null){for(t=i;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==i&&n.form===i.form){var s=$y(n);if(!s)throw Error(j(90));S1(n),l0(n,s)}}}break;case"textarea":k1(i,t);break;case"select":e=t.value,e!=null&&zc(i,!!t.multiple,e,!1)}};I1=_b;D1=Jl;var LR={usingClientEntryPoint:!1,Events:[Kp,Pc,$y,R1,L1,_b]},Uh={findFiberByHostInstance:xa,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},IR={bundleType:Uh.bundleType,version:Uh.version,rendererPackageName:Uh.rendererPackageName,rendererConfig:Uh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Gr.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=N1(i),i===null?null:i.stateNode},findFiberByHostInstance:Uh.findFiberByHostInstance||PR,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Sg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Sg.isDisabled&&Sg.supportsFiber)try{Ny=Sg.inject(IR),$s=Sg}catch{}}hi.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=LR;hi.createPortal=function(i,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Tb(e))throw Error(j(200));return xR(i,e,null,t)};hi.createRoot=function(i,e){if(!Tb(i))throw Error(j(299));var t=!1,n="",s=pk;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Eb(i,1,!1,null,null,t,!1,n,s),i[Ur]=e.current,$d(i.nodeType===8?i.parentNode:i),new Cb(e)};hi.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var e=i._reactInternals;if(e===void 0)throw typeof i.render=="function"?Error(j(188)):(i=Object.keys(i).join(","),Error(j(268,i)));return i=N1(e),i=i===null?null:i.stateNode,i};hi.flushSync=function(i){return Jl(i)};hi.hydrate=function(i,e,t){if(!Xy(e))throw Error(j(200));return Yy(null,i,e,!0,t)};hi.hydrateRoot=function(i,e,t){if(!Tb(i))throw Error(j(405));var n=t!=null&&t.hydratedSources||null,s=!1,r="",o=pk;if(t!=null&&(t.unstable_strictMode===!0&&(s=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=fk(e,null,i,1,t??null,s,!1,r,o),i[Ur]=e.current,$d(i),n)for(i=0;i<n.length;i++)t=n[i],s=t._getVersion,s=s(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,s]:e.mutableSourceEagerHydrationData.push(t,s);return new Ky(e)};hi.render=function(i,e,t){if(!Xy(e))throw Error(j(200));return Yy(null,i,e,!1,t)};hi.unmountComponentAtNode=function(i){if(!Xy(i))throw Error(j(40));return i._reactRootContainer?(Jl(function(){Yy(null,null,i,!1,function(){i._reactRootContainer=null,i[Ur]=null})}),!0):!1};hi.unstable_batchedUpdates=_b;hi.unstable_renderSubtreeIntoContainer=function(i,e,t,n){if(!Xy(t))throw Error(j(200));if(i==null||i._reactInternals===void 0)throw Error(j(38));return Yy(i,e,t,!1,n)};hi.version="18.3.1-next-f1338f8080-20240426";function gk(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(gk)}catch(i){console.error(i)}}gk(),g1.exports=hi;var DR=g1.exports,mk,oS=DR;mk=oS.createRoot,oS.hydrateRoot;/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var OR={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MR=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),Yp=(i,e)=>{const t=mn.forwardRef(({color:n="currentColor",size:s=24,strokeWidth:r=2,absoluteStrokeWidth:o,className:l="",children:c,...u},h)=>mn.createElement("svg",{ref:h,...OR,width:s,height:s,stroke:n,strokeWidth:o?Number(r)*24/Number(s):r,className:["lucide",`lucide-${MR(i)}`,l].join(" "),...u},[...e.map(([d,f])=>mn.createElement(d,f)),...Array.isArray(c)?c:[c]]));return t.displayName=`${i}`,t};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aS=Yp("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const NR=Yp("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FR=Yp("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BR=Yp("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const jR=Yp("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function $R({onFilesSelected:i,disabled:e,accept:t=".pdf,.jpg,.jpeg,.png"}){const[n,s]=mn.useState(!1),[r,o]=mn.useState([]),l=mn.useCallback(f=>{f.preventDefault(),f.stopPropagation(),f.type==="dragenter"||f.type==="dragover"?s(!0):f.type==="dragleave"&&s(!1)},[]),c=mn.useCallback(f=>{if(f.preventDefault(),f.stopPropagation(),s(!1),e)return;const p=Array.from(f.dataTransfer.files);p.length>0&&o(p)},[e]),u=mn.useCallback(f=>{if(e)return;const p=Array.from(f.target.files||[]);p.length>0&&o(p)},[e]),h=()=>{r.length>0&&(i(r),o([]))},d=f=>{o(p=>p.filter((v,b)=>b!==f))};return le.jsxs("div",{className:"w-full",children:[le.jsxs("div",{className:`relative border-2 border-dashed rounded-lg p-8 transition-colors ${n?"border-blue-500 bg-blue-50":e?"border-gray-200 bg-gray-50":"border-gray-300 hover:border-gray-400"}`,onDragEnter:l,onDragLeave:l,onDragOver:l,onDrop:c,children:[le.jsx("input",{type:"file",multiple:!0,accept:t,onChange:u,disabled:e,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),le.jsxs("div",{className:"flex flex-col items-center justify-center space-y-3",children:[le.jsx(BR,{className:"h-10 w-10 text-gray-400"}),le.jsxs("div",{className:"text-center",children:[le.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Arrastra archivos aqu o haz clic para seleccionar"}),le.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"PDF, JPG, JPEG o PNG"})]})]})]}),r.length>0&&le.jsxs("div",{className:"mt-4 space-y-2",children:[le.jsxs("div",{className:"flex items-center justify-between",children:[le.jsxs("p",{className:"text-sm font-medium text-gray-700",children:["Archivos seleccionados (",r.length,")"]}),le.jsx("button",{onClick:h,disabled:e,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium",children:"Procesar Archivos"})]}),le.jsx("div",{className:"space-y-1",children:r.map((f,p)=>le.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded border border-gray-200",children:[le.jsx("span",{className:"text-sm text-gray-700 truncate",children:f.name}),le.jsx("button",{onClick:()=>d(p),disabled:e,className:"text-gray-400 hover:text-red-600 disabled:opacity-50",children:le.jsx(jR,{className:"h-4 w-4"})})]},p))})]})]})}function yk(i){const e=i.replace(/[-\s]/g,"");if(e.length!==11||!/^\d+$/.test(e))return!1;const t=[5,4,3,2,7,6,5,4,3,2],n=e.split("").map(Number),s=n[10];let r=0;for(let c=0;c<10;c++)r+=n[c]*t[c];const o=r%11,l=o===0?0:o===1?9:11-o;return s===l}function UR(i){const e=[],t=i.netTaxed+i.netUntaxed+i.netExempt+i.ivaAmount+i.otherTaxesAmount;return Math.abs(t-i.totalAmount)>.01&&e.push(`El total calculado ($${t.toFixed(2)}) no coincide con el total ingresado ($${i.totalAmount.toFixed(2)})`),{valid:e.length===0,errors:e}}const zR={1:"FACTURA_A",6:"FACTURA_B",11:"FACTURA_C",51:"FACTURA_M",3:"NOTA_CREDITO_A",8:"NOTA_CREDITO_B",13:"NOTA_CREDITO_C",2:"NOTA_DEBITO_A",7:"NOTA_DEBITO_B",12:"NOTA_DEBITO_C"};function HR(i){return zR[i]||"FACTURA_B"}const fn=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),K0=[.001,0,0,.001,0,0],Nv=1.35,ii={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},to={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Xd="pdfjs_internal_editor_",ne={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},pe={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},WR={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},X0={TRIANGLES:1,LATTICE:2,PATCH:3},Mt={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Yg={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},ht={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},pc={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Qy={ERRORS:0,WARNINGS:1,INFOS:5},Yd={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},zh={moveTo:0,lineTo:1,curveTo:2,quadraticCurveTo:3,closePath:4},VR={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Jy=Qy.WARNINGS;function GR(i){Number.isInteger(i)&&(Jy=i)}function qR(){return Jy}function Zy(i){Jy>=Qy.INFOS&&console.info(`Info: ${i}`)}function Z(i){Jy>=Qy.WARNINGS&&console.warn(`Warning: ${i}`)}function Me(i){throw new Error(i)}function ge(i,e){i||Me(e)}function KR(i){switch(i==null?void 0:i.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function vk(i,e=null,t=null){if(!i)return null;if(t&&typeof i=="string"){if(t.addDefaultProtocol&&i.startsWith("www.")){const s=i.match(/\./g);(s==null?void 0:s.length)>=2&&(i=`http://${i}`)}if(t.tryConvertEncoding)try{i=ZR(i)}catch{}}const n=e?URL.parse(i,e):URL.parse(i);return KR(n)?n:null}function wk(i,e,t=!1){const n=URL.parse(i);return n?(n.hash=e,n.href):t&&vk(i,"http://example.com")?i.split("#",1)[0]+`${e?`#${e}`:""}`:""}function re(i,e,t,n=!1){return Object.defineProperty(i,e,{value:t,enumerable:!n,configurable:!0,writable:!1}),t}const sc=function(){function e(t,n){this.message=t,this.name=n}return e.prototype=new Error,e.constructor=e,e}();class lS extends sc{constructor(e,t){super(e,"PasswordException"),this.code=t}}class Fv extends sc{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class Y0 extends sc{constructor(e){super(e,"InvalidPDFException")}}class ey extends sc{constructor(e,t,n){super(e,"ResponseException"),this.status=t,this.missing=n}}class XR extends sc{constructor(e){super(e,"FormatError")}}class aa extends sc{constructor(e){super(e,"AbortException")}}function _k(i){(typeof i!="object"||(i==null?void 0:i.length)===void 0)&&Me("Invalid argument for bytesToString");const e=i.length,t=8192;if(e<t)return String.fromCharCode.apply(null,i);const n=[];for(let s=0;s<e;s+=t){const r=Math.min(s+t,e),o=i.subarray(s,r);n.push(String.fromCharCode.apply(null,o))}return n.join("")}function Qp(i){typeof i!="string"&&Me("Invalid argument for stringToBytes");const e=i.length,t=new Uint8Array(e);for(let n=0;n<e;++n)t[n]=i.charCodeAt(n)&255;return t}function YR(i){return String.fromCharCode(i>>24&255,i>>16&255,i>>8&255,i&255)}function QR(){const i=new Uint8Array(4);return i[0]=1,new Uint32Array(i.buffer,0,1)[0]===1}function JR(){try{return new Function(""),!0}catch{return!1}}class Gt{static get isLittleEndian(){return re(this,"isLittleEndian",QR())}static get isEvalSupported(){return re(this,"isEvalSupported",JR())}static get isOffscreenCanvasSupported(){return re(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return re(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get isFloat16ArraySupported(){return re(this,"isFloat16ArraySupported",typeof Float16Array<"u")}static get isSanitizerSupported(){return re(this,"isSanitizerSupported",typeof Sanitizer<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return re(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){var e,t;return re(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const Bv=Array.from(Array(256).keys(),i=>i.toString(16).padStart(2,"0"));var Fr,Qg,Q0;class G{static makeHexColor(e,t,n){return`#${Bv[e]}${Bv[t]}${Bv[n]}`}static domMatrixToTransform(e){return[e.a,e.b,e.c,e.d,e.e,e.f]}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[1],t[1]=n,n=t[2],t[2]=t[3],t[3]=n,e[1]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static multiplyByDOMMatrix(e,t){return[e[0]*t.a+e[2]*t.b,e[1]*t.a+e[3]*t.b,e[0]*t.c+e[2]*t.d,e[1]*t.c+e[3]*t.d,e[0]*t.e+e[2]*t.f+e[4],e[1]*t.e+e[3]*t.f+e[5]]}static applyTransform(e,t,n=0){const s=e[n],r=e[n+1];e[n]=s*t[0]+r*t[2]+t[4],e[n+1]=s*t[1]+r*t[3]+t[5]}static applyTransformToBezier(e,t,n=0){const s=t[0],r=t[1],o=t[2],l=t[3],c=t[4],u=t[5];for(let h=0;h<6;h+=2){const d=e[n+h],f=e[n+h+1];e[n+h]=d*s+f*o+c,e[n+h+1]=d*r+f*l+u}}static applyInverseTransform(e,t){const n=e[0],s=e[1],r=t[0]*t[3]-t[1]*t[2];e[0]=(n*t[3]-s*t[2]+t[2]*t[5]-t[4]*t[3])/r,e[1]=(-n*t[1]+s*t[0]+t[4]*t[1]-t[5]*t[0])/r}static axialAlignedBoundingBox(e,t,n){const s=t[0],r=t[1],o=t[2],l=t[3],c=t[4],u=t[5],h=e[0],d=e[1],f=e[2],p=e[3];let v=s*h+c,b=v,S=s*f+c,m=S,_=l*d+u,w=_,E=l*p+u,k=E;if(r!==0||o!==0){const C=r*h,T=r*f,R=o*d,D=o*p;v+=R,m+=R,S+=D,b+=D,_+=C,k+=C,E+=T,w+=T}n[0]=Math.min(n[0],v,S,b,m),n[1]=Math.min(n[1],_,E,w,k),n[2]=Math.max(n[2],v,S,b,m),n[3]=Math.max(n[3],_,E,w,k)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const n=e[0],s=e[1],r=e[2],o=e[3],l=n**2+s**2,c=n*r+s*o,u=r**2+o**2,h=(l+u)/2,d=Math.sqrt(h**2-(l*u-c**2));t[0]=Math.sqrt(h+d||1),t[1]=Math.sqrt(h-d||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),s=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>s)return null;const r=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),o=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return r>o?null:[n,r,s,o]}static pointBoundingBox(e,t,n){n[0]=Math.min(n[0],e),n[1]=Math.min(n[1],t),n[2]=Math.max(n[2],e),n[3]=Math.max(n[3],t)}static rectBoundingBox(e,t,n,s,r){r[0]=Math.min(r[0],e,n),r[1]=Math.min(r[1],t,s),r[2]=Math.max(r[2],e,n),r[3]=Math.max(r[3],t,s)}static bezierBoundingBox(e,t,n,s,r,o,l,c,u){u[0]=Math.min(u[0],e,l),u[1]=Math.min(u[1],t,c),u[2]=Math.max(u[2],e,l),u[3]=Math.max(u[3],t,c),A(this,Fr,Q0).call(this,e,n,r,l,t,s,o,c,3*(-e+3*(n-r)+l),6*(e-2*n+r),3*(n-e),u),A(this,Fr,Q0).call(this,e,n,r,l,t,s,o,c,3*(-t+3*(s-o)+c),6*(t-2*s+o),3*(s-t),u)}}Fr=new WeakSet,Qg=function(e,t,n,s,r,o,l,c,u,h){if(u<=0||u>=1)return;const d=1-u,f=u*u,p=f*u,v=d*(d*(d*e+3*u*t)+3*f*n)+p*s,b=d*(d*(d*r+3*u*o)+3*f*l)+p*c;h[0]=Math.min(h[0],v),h[1]=Math.min(h[1],b),h[2]=Math.max(h[2],v),h[3]=Math.max(h[3],b)},Q0=function(e,t,n,s,r,o,l,c,u,h,d,f){if(Math.abs(u)<1e-12){Math.abs(h)>=1e-12&&A(this,Fr,Qg).call(this,e,t,n,s,r,o,l,c,-d/h,f);return}const p=h**2-4*d*u;if(p<0)return;const v=Math.sqrt(p),b=2*u;A(this,Fr,Qg).call(this,e,t,n,s,r,o,l,c,(-h+v)/b,f),A(this,Fr,Qg).call(this,e,t,n,s,r,o,l,c,(-h-v)/b,f)},y(G,Fr);function ZR(i){return decodeURIComponent(escape(i))}let jv=null,cS=null;function eL(i){return jv||(jv=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,cS=new Map([["","t"]])),i.replaceAll(jv,(e,t,n)=>t?t.normalize("NFKC"):cS.get(n))}function bk(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const i=new Uint8Array(32);return crypto.getRandomValues(i),_k(i)}const Nc="pdfjs_internal_id_";function tL(i,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[n,s,...r]=t;if(!i(n)&&!Number.isInteger(n)||!e(s))return!1;const o=r.length;let l=!0;switch(s.name){case"XYZ":if(o<2||o>3)return!1;break;case"Fit":case"FitB":return o===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(o>1)return!1;break;case"FitR":if(o!==4)return!1;l=!1;break;default:return!1}for(const c of r)if(!(typeof c=="number"||l&&c===null))return!1;return!0}function pn(i,e,t){return Math.min(Math.max(i,e),t)}function Ak(i){return Uint8Array.prototype.toBase64?i.toBase64():btoa(_k(i))}function nL(i){return Uint8Array.fromBase64?Uint8Array.fromBase64(i):Qp(atob(i))}typeof Promise.try!="function"&&(Promise.try=function(i,...e){return new Promise(t=>{t(i(...e))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(i){return i.reduce((e,t)=>e+t,0)});class Qd{static textContent(e){const t=[],n={items:t,styles:Object.create(null)};function s(r){var c;if(!r)return;let o=null;const l=r.name;if(l==="#text")o=r.value;else if(Qd.shouldBuildText(l))(c=r==null?void 0:r.attributes)!=null&&c.textContent?o=r.attributes.textContent:r.value&&(o=r.value);else return;if(o!==null&&t.push({str:o}),!!r.children)for(const u of r.children)s(u)}return s(e),n}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}class Sk{static setupStorage(e,t,n,s,r){const o=s.getValue(t,{value:null});switch(n.name){case"textarea":if(o.value!==null&&(e.textContent=o.value),r==="print")break;e.addEventListener("input",l=>{s.setValue(t,{value:l.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(o.value===n.attributes.xfaOn?e.setAttribute("checked",!0):o.value===n.attributes.xfaOff&&e.removeAttribute("checked"),r==="print")break;e.addEventListener("change",l=>{s.setValue(t,{value:l.target.checked?l.target.getAttribute("xfaOn"):l.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&e.setAttribute("value",o.value),r==="print")break;e.addEventListener("input",l=>{s.setValue(t,{value:l.target.value})})}break;case"select":if(o.value!==null){e.setAttribute("value",o.value);for(const l of n.children)l.attributes.value===o.value?l.attributes.selected=!0:l.attributes.hasOwnProperty("selected")&&delete l.attributes.selected}e.addEventListener("input",l=>{const c=l.target.options,u=c.selectedIndex===-1?"":c[c.selectedIndex].value;s.setValue(t,{value:u})});break}}static setAttributes({html:e,element:t,storage:n=null,intent:s,linkService:r}){const{attributes:o}=t,l=e instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${s}`);for(const[c,u]of Object.entries(o))if(u!=null)switch(c){case"class":u.length&&e.setAttribute(c,u.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",u);break;case"style":Object.assign(e.style,u);break;case"textContent":e.textContent=u;break;default:(!l||c!=="href"&&c!=="newWindow")&&e.setAttribute(c,u)}l&&r.addLinkAttributes(e,o.href,o.newWindow),n&&o.dataId&&this.setupStorage(e,o.dataId,t,n)}static render(e){var d,f;const t=e.annotationStorage,n=e.linkService,s=e.xfaHtml,r=e.intent||"display",o=document.createElement(s.name);s.attributes&&this.setAttributes({html:o,element:s,intent:r,linkService:n});const l=r!=="richText",c=e.div;if(c.append(o),e.viewport){const p=`matrix(${e.viewport.transform.join(",")})`;c.style.transform=p}l&&c.setAttribute("class","xfaLayer xfaFont");const u=[];if(s.children.length===0){if(s.value){const p=document.createTextNode(s.value);o.append(p),l&&Qd.shouldBuildText(s.name)&&u.push(p)}return{textDivs:u}}const h=[[s,-1,o]];for(;h.length>0;){const[p,v,b]=h.at(-1);if(v+1===p.children.length){h.pop();continue}const S=p.children[++h.at(-1)[1]];if(S===null)continue;const{name:m}=S;if(m==="#text"){const w=document.createTextNode(S.value);u.push(w),b.append(w);continue}const _=(d=S==null?void 0:S.attributes)!=null&&d.xmlns?document.createElementNS(S.attributes.xmlns,m):document.createElement(m);if(b.append(_),S.attributes&&this.setAttributes({html:_,element:S,storage:t,intent:r,linkService:n}),((f=S.children)==null?void 0:f.length)>0)h.push([S,-1,_]);else if(S.value){const w=document.createTextNode(S.value);l&&Qd.shouldBuildText(m)&&u.push(w),_.append(w)}}for(const p of c.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))p.setAttribute("readOnly",!0);return{textDivs:u}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const Ws="http://www.w3.org/2000/svg",ka=class ka{};F(ka,"CSS",96),F(ka,"PDF",72),F(ka,"PDF_TO_CSS_UNITS",ka.CSS/ka.PDF);let la=ka;async function Jp(i,e="text"){if(Jh(i,document.baseURI)){const t=await fetch(i);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,n)=>{const s=new XMLHttpRequest;s.open("GET",i,!0),s.responseType=e,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(s.response);return}t(s.responseText);return}n(new Error(s.statusText))}},s.send(null)})}class Zp{constructor({viewBox:e,userUnit:t,scale:n,rotation:s,offsetX:r=0,offsetY:o=0,dontFlip:l=!1}){this.viewBox=e,this.userUnit=t,this.scale=n,this.rotation=s,this.offsetX=r,this.offsetY=o,n*=t;const c=(e[2]+e[0])/2,u=(e[3]+e[1])/2;let h,d,f,p;switch(s%=360,s<0&&(s+=360),s){case 180:h=-1,d=0,f=0,p=1;break;case 90:h=0,d=1,f=1,p=0;break;case 270:h=0,d=-1,f=-1,p=0;break;case 0:h=1,d=0,f=0,p=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}l&&(f=-f,p=-p);let v,b,S,m;h===0?(v=Math.abs(u-e[1])*n+r,b=Math.abs(c-e[0])*n+o,S=(e[3]-e[1])*n,m=(e[2]-e[0])*n):(v=Math.abs(c-e[0])*n+r,b=Math.abs(u-e[1])*n+o,S=(e[2]-e[0])*n,m=(e[3]-e[1])*n),this.transform=[h*n,d*n,f*n,p*n,v-h*n*c-f*n*u,b-d*n*c-p*n*u],this.width=S,this.height=m}get rawDims(){const e=this.viewBox;return re(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:s=this.offsetY,dontFlip:r=!1}={}){return new Zp({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:s,dontFlip:r})}convertToViewportPoint(e,t){const n=[e,t];return G.applyTransform(n,this.transform),n}convertToViewportRectangle(e){const t=[e[0],e[1]];G.applyTransform(t,this.transform);const n=[e[2],e[3]];return G.applyTransform(n,this.transform),[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){const n=[e,t];return G.applyInverseTransform(n,this.transform),n}}class xb extends sc{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function ev(i){const e=i.length;let t=0;for(;t<e&&i[t].trim()==="";)t++;return i.substring(t,t+5).toLowerCase()==="data:"}function Pb(i){return typeof i=="string"&&/\.pdf$/i.test(i)}function iL(i){return[i]=i.split(/[#?]/,1),i.substring(i.lastIndexOf("/")+1)}function sL(i,e="document.pdf"){if(typeof i!="string")return e;if(ev(i))return Z('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const n=(l=>{try{return new URL(l)}catch{try{return new URL(decodeURIComponent(l))}catch{try{return new URL(l,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(l),"https://foo.bar")}catch{return null}}}}})(i);if(!n)return e;const s=l=>{try{let c=decodeURIComponent(l);return c.includes("/")?(c=c.split("/").at(-1),c.test(/^\.pdf$/i)?c:l):c}catch{return l}},r=/\.pdf$/i,o=n.pathname.split("/").at(-1);if(r.test(o))return s(o);if(n.searchParams.size>0){const l=Array.from(n.searchParams.values()).reverse();for(const u of l)if(r.test(u))return s(u);const c=Array.from(n.searchParams.keys()).reverse();for(const u of c)if(r.test(u))return s(u)}if(n.hash){const c=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(n.hash);if(c)return s(c[0])}return e}class uS{constructor(){F(this,"started",Object.create(null));F(this,"times",[])}time(e){e in this.started&&Z(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||Z(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:n}of this.times)t=Math.max(n.length,t);for(const{name:n,start:s,end:r}of this.times)e.push(`${n.padEnd(t)} ${r-s}ms
`);return e.join("")}}function Jh(i,e){const t=e?URL.parse(i,e):URL.parse(i);return(t==null?void 0:t.protocol)==="http:"||(t==null?void 0:t.protocol)==="https:"}function Ni(i){i.preventDefault()}function ot(i){i.preventDefault(),i.stopPropagation()}function rL(i){console.log("Deprecated API usage: "+i)}var tf;class ty{static toDateObject(e){if(e instanceof Date)return e;if(!e||typeof e!="string")return null;a(this,tf)||g(this,tf,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=a(this,tf).exec(e);if(!t)return null;const n=parseInt(t[1],10);let s=parseInt(t[2],10);s=s>=1&&s<=12?s-1:0;let r=parseInt(t[3],10);r=r>=1&&r<=31?r:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let l=parseInt(t[5],10);l=l>=0&&l<=59?l:0;let c=parseInt(t[6],10);c=c>=0&&c<=59?c:0;const u=t[7]||"Z";let h=parseInt(t[8],10);h=h>=0&&h<=23?h:0;let d=parseInt(t[9],10)||0;return d=d>=0&&d<=59?d:0,u==="-"?(o+=h,l+=d):u==="+"&&(o-=h,l-=d),new Date(Date.UTC(n,s,r,o,l,c))}}tf=new WeakMap,y(ty,tf);function oL(i,{scale:e=1,rotation:t=0}){const{width:n,height:s}=i.attributes.style,r=[0,0,parseInt(n),parseInt(s)];return new Zp({viewBox:r,userUnit:1,scale:e,rotation:t})}function eg(i){if(i.startsWith("#")){const e=parseInt(i.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return i.startsWith("rgb(")?i.slice(4,-1).split(",").map(e=>parseInt(e)):i.startsWith("rgba(")?i.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(Z(`Not a valid color format: "${i}"`),[0,0,0])}function aL(i){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of i.keys()){e.style.color=t;const n=window.getComputedStyle(e).color;i.set(t,eg(n))}e.remove()}function Xe(i){const{a:e,b:t,c:n,d:s,e:r,f:o}=i.getTransform();return[e,t,n,s,r,o]}function hs(i){const{a:e,b:t,c:n,d:s,e:r,f:o}=i.getTransform().invertSelf();return[e,t,n,s,r,o]}function Zl(i,e,t=!1,n=!0){if(e instanceof Zp){const{pageWidth:s,pageHeight:r}=e.rawDims,{style:o}=i,l=Gt.isCSSRoundSupported,c=`var(--total-scale-factor) * ${s}px`,u=`var(--total-scale-factor) * ${r}px`,h=l?`round(down, ${c}, var(--scale-round-x))`:`calc(${c})`,d=l?`round(down, ${u}, var(--scale-round-y))`:`calc(${u})`;!t||e.rotation%180===0?(o.width=h,o.height=d):(o.width=d,o.height=h)}n&&i.setAttribute("data-main-rotation",e.rotation)}class zs{constructor(){const{pixelRatio:e}=zs;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,n,s,r=-1){let o=1/0,l=1/0,c=1/0;n=zs.capPixels(n,r),n>0&&(o=Math.sqrt(n/(e*t))),s!==-1&&(l=s/e,c=s/t);const u=Math.min(o,l,c);return this.sx>u||this.sy>u?(this.sx=u,this.sy=u,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const n=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,n):n}return e}}const J0=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class lL{static get isDarkMode(){var e;return re(this,"isDarkMode",!!((e=window==null?void 0:window.matchMedia)!=null&&e.call(window,"(prefers-color-scheme: dark)").matches))}}class cL{static get commentForegroundColor(){const e=document.createElement("span");e.classList.add("comment","sidebar");const{style:t}=e;t.width=t.height="0",t.display="none",t.color="var(--comment-fg-color)",document.body.append(e);const{color:n}=window.getComputedStyle(e);return e.remove(),re(this,"commentForegroundColor",eg(n))}}function uL(i,e,t,n){n=Math.min(Math.max(n??1,0),1);const s=255*(1-n);return i=Math.round(i*n+s),e=Math.round(e*n+s),t=Math.round(t*n+s),[i,e,t]}function hS(i,e){const t=i[0]/255,n=i[1]/255,s=i[2]/255,r=Math.max(t,n,s),o=Math.min(t,n,s),l=(r+o)/2;if(r===o)e[0]=e[1]=0;else{const c=r-o;switch(e[1]=l<.5?c/(r+o):c/(2-r-o),r){case t:e[0]=((n-s)/c+(n<s?6:0))*60;break;case n:e[0]=((s-t)/c+2)*60;break;case s:e[0]=((t-n)/c+4)*60;break}}e[2]=l}function Z0(i,e){const t=i[0],n=i[1],s=i[2],r=(1-Math.abs(2*s-1))*n,o=r*(1-Math.abs(t/60%2-1)),l=s-r/2;switch(Math.floor(t/60)){case 0:e[0]=r+l,e[1]=o+l,e[2]=l;break;case 1:e[0]=o+l,e[1]=r+l,e[2]=l;break;case 2:e[0]=l,e[1]=r+l,e[2]=o+l;break;case 3:e[0]=l,e[1]=o+l,e[2]=r+l;break;case 4:e[0]=o+l,e[1]=l,e[2]=r+l;break;case 5:case 6:e[0]=r+l,e[1]=l,e[2]=o+l;break}}function dS(i){return i<=.03928?i/12.92:((i+.055)/1.055)**2.4}function fS(i,e,t){Z0(i,t),t.map(dS);const n=.2126*t[0]+.7152*t[1]+.0722*t[2];Z0(e,t),t.map(dS);const s=.2126*t[0]+.7152*t[1]+.0722*t[2];return n>s?(n+.05)/(s+.05):(s+.05)/(n+.05)}const pS=new Map;function hL(i,e){const t=i[0]+i[1]*256+i[2]*65536+e[0]*16777216+e[1]*4294967296+e[2]*1099511627776;let n=pS.get(t);if(n)return n;const s=new Float32Array(9),r=s.subarray(0,3),o=s.subarray(3,6);hS(i,o);const l=s.subarray(6,9);hS(e,l);const c=l[2]<.5,u=c?12:4.5;if(o[2]=c?Math.sqrt(o[2]):1-Math.sqrt(1-o[2]),fS(o,l,r)<u){let h,d;c?(h=o[2],d=1):(h=0,d=o[2]);const f=.005;for(;d-h>f;){const p=o[2]=(h+d)/2;c===fS(o,l,r)<u?h=p:d=p}o[2]=c?d:h}return Z0(o,r),n=G.makeHexColor(Math.round(r[0]*255),Math.round(r[1]*255),Math.round(r[2]*255)),pS.set(t,n),n}function Ek({html:i,dir:e,className:t},n){const s=document.createDocumentFragment();if(typeof i=="string"){const r=document.createElement("p");r.dir=e||"auto";const o=i.split(/(?:\r\n?|\n)/);for(let l=0,c=o.length;l<c;++l){const u=o[l];r.append(document.createTextNode(u)),l<c-1&&r.append(document.createElement("br"))}s.append(r)}else Sk.render({xfaHtml:i,div:s,intent:"richText"});s.firstChild.classList.add("richText",t),n.append(s)}function kk(i){const e=new Path2D;if(!i)return e;for(let t=0,n=i.length;t<n;)switch(i[t++]){case zh.moveTo:e.moveTo(i[t++],i[t++]);break;case zh.lineTo:e.lineTo(i[t++],i[t++]);break;case zh.curveTo:e.bezierCurveTo(i[t++],i[t++],i[t++],i[t++],i[t++],i[t++]);break;case zh.quadraticCurveTo:e.quadraticCurveTo(i[t++],i[t++],i[t++],i[t++]);break;case zh.closePath:e.closePath();break;default:Z(`Unrecognized drawing path operator: ${i[t-1]}`);break}return e}var io,so,gi,mi,nf,ro,Xc,Yc,sf,my,Ck,Wt,Tk,xk,gc,Zh;const Ys=class Ys{constructor(e){y(this,Wt);y(this,io,null);y(this,so,null);y(this,gi);y(this,mi,null);y(this,nf,null);y(this,ro,null);y(this,Xc,null);y(this,Yc,null);g(this,gi,e),a(Ys,sf)||g(Ys,sf,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}render(){const e=g(this,io,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=a(this,gi)._uiManager._signal;t instanceof AbortSignal&&!t.aborted&&(e.addEventListener("contextmenu",Ni,{signal:t}),e.addEventListener("pointerdown",A(Ys,my,Ck),{signal:t}));const n=g(this,mi,document.createElement("div"));n.className="buttons",e.append(n);const s=a(this,gi).toolbarPosition;if(s){const{style:r}=e,o=a(this,gi)._uiManager.direction==="ltr"?1-s[0]:s[0];r.insetInlineEnd=`${100*o}%`,r.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return a(this,io)}hide(){var e;a(this,io).classList.add("hidden"),(e=a(this,so))==null||e.hideDropdown()}show(){var e,t;a(this,io).classList.remove("hidden"),(e=a(this,nf))==null||e.shown(),(t=a(this,ro))==null||t.shown()}addDeleteButton(){const{editorType:e,_uiManager:t}=a(this,gi),n=document.createElement("button");n.classList.add("basic","deleteButton"),n.tabIndex=0,n.setAttribute("data-l10n-id",a(Ys,sf)[e]),A(this,Wt,gc).call(this,n)&&n.addEventListener("click",s=>{t.delete()},{signal:t._signal}),a(this,mi).append(n)}async addAltText(e){const t=await e.render();A(this,Wt,gc).call(this,t),a(this,mi).append(t,a(this,Wt,Zh)),g(this,nf,e)}addComment(e,t=null){if(a(this,ro))return;const n=e.renderForToolbar();if(!n)return;A(this,Wt,gc).call(this,n);const s=g(this,Xc,a(this,Wt,Zh));t?(a(this,mi).insertBefore(n,t),a(this,mi).insertBefore(s,t)):a(this,mi).append(n,s),g(this,ro,e),e.toolbar=this}addColorPicker(e){if(a(this,so))return;g(this,so,e);const t=e.renderButton();A(this,Wt,gc).call(this,t),a(this,mi).append(t,a(this,Wt,Zh))}async addEditSignatureButton(e){const t=g(this,Yc,await e.renderEditButton(a(this,gi)));A(this,Wt,gc).call(this,t),a(this,mi).append(t,a(this,Wt,Zh))}removeButton(e){var t,n;switch(e){case"comment":(t=a(this,ro))==null||t.removeToolbarCommentButton(),g(this,ro,null),(n=a(this,Xc))==null||n.remove(),g(this,Xc,null);break}}async addButton(e,t){switch(e){case"colorPicker":t&&this.addColorPicker(t);break;case"altText":t&&await this.addAltText(t);break;case"editSignature":t&&await this.addEditSignatureButton(t);break;case"delete":this.addDeleteButton();break;case"comment":t&&this.addComment(t);break}}async addButtonBefore(e,t,n){if(!t&&e==="comment")return;const s=a(this,mi).querySelector(n);s&&e==="comment"&&this.addComment(t,s)}updateEditSignatureButton(e){a(this,Yc)&&(a(this,Yc).title=e)}remove(){var e;a(this,io).remove(),(e=a(this,so))==null||e.destroy(),g(this,so,null)}};io=new WeakMap,so=new WeakMap,gi=new WeakMap,mi=new WeakMap,nf=new WeakMap,ro=new WeakMap,Xc=new WeakMap,Yc=new WeakMap,sf=new WeakMap,my=new WeakSet,Ck=function(e){e.stopPropagation()},Wt=new WeakSet,Tk=function(e){a(this,gi)._focusEventsAllowed=!1,ot(e)},xk=function(e){a(this,gi)._focusEventsAllowed=!0,ot(e)},gc=function(e){const t=a(this,gi)._uiManager._signal;return!(t instanceof AbortSignal)||t.aborted?!1:(e.addEventListener("focusin",A(this,Wt,Tk).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",A(this,Wt,xk).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",Ni,{signal:t}),!0)},Zh=function(){const e=document.createElement("div");return e.className="divider",e},y(Ys,my),y(Ys,sf,null);let ew=Ys;var rf,La,Zs,Wr,Pk,Rk,tw;class dL{constructor(e){y(this,Wr);y(this,rf,null);y(this,La,null);y(this,Zs);g(this,Zs,e)}show(e,t,n){const[s,r]=A(this,Wr,Rk).call(this,t,n),{style:o}=a(this,La)||g(this,La,A(this,Wr,Pk).call(this));e.append(a(this,La)),o.insetInlineEnd=`${100*s}%`,o.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){a(this,La).remove()}}rf=new WeakMap,La=new WeakMap,Zs=new WeakMap,Wr=new WeakSet,Pk=function(){const e=g(this,La,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar");const t=a(this,Zs)._signal;t instanceof AbortSignal&&!t.aborted&&e.addEventListener("contextmenu",Ni,{signal:t});const n=g(this,rf,document.createElement("div"));return n.className="buttons",e.append(n),a(this,Zs).hasCommentManager()&&A(this,Wr,tw).call(this,"commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{a(this,Zs).commentSelection("floating_button")}),A(this,Wr,tw).call(this,"highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{a(this,Zs).highlightSelection("floating_button")}),e},Rk=function(e,t){let n=0,s=0;for(const r of e){const o=r.y+r.height;if(o<n)continue;const l=r.x+(t?r.width:0);if(o>n){s=l,n=o;continue}t?l>s&&(s=l):l<s&&(s=l)}return[t?1-s:s,n]},tw=function(e,t,n,s){const r=document.createElement("button");r.classList.add("basic",e),r.tabIndex=0,r.setAttribute("data-l10n-id",t);const o=document.createElement("span");r.append(o),o.className="visuallyHidden",o.setAttribute("data-l10n-id",n);const l=a(this,Zs)._signal;l instanceof AbortSignal&&!l.aborted&&(r.addEventListener("contextmenu",Ni,{signal:l}),r.addEventListener("click",s,{signal:l})),a(this,rf).append(r)};function Lk(i,e,t){for(const n of t)e.addEventListener(n,i[n].bind(i))}var Ia,Da,Qc,Oa;const Ce=class Ce{static initializeAndAddPointerId(e){(a(Ce,Da)||g(Ce,Da,new Set)).add(e)}static setPointer(e,t){a(Ce,Ia)||g(Ce,Ia,t),a(Ce,Oa)??g(Ce,Oa,e)}static setTimeStamp(e){g(Ce,Qc,e)}static isSamePointerId(e){return a(Ce,Ia)===e}static isSamePointerIdOrRemove(e){var t;return a(Ce,Ia)===e?!0:((t=a(Ce,Da))==null||t.delete(e),!1)}static isSamePointerType(e){return a(Ce,Oa)===e}static isInitializedAndDifferentPointerType(e){return a(Ce,Oa)!==null&&!Ce.isSamePointerType(e)}static isSameTimeStamp(e){return a(Ce,Qc)===e}static isUsingMultiplePointers(){var e;return((e=a(Ce,Da))==null?void 0:e.size)>=1}static clearPointerType(){g(Ce,Oa,null)}static clearPointerIds(){g(Ce,Ia,NaN),g(Ce,Da,null)}static clearTimeStamp(){g(Ce,Qc,NaN)}};Ia=new WeakMap,Da=new WeakMap,Qc=new WeakMap,Oa=new WeakMap,y(Ce,Ia,NaN),y(Ce,Da,null),y(Ce,Qc,NaN),y(Ce,Oa,null);let Qt=Ce;var yy;class fL{constructor(){y(this,yy,0)}get id(){return`${Xd}${gt(this,yy)._++}`}}yy=new WeakMap;var Jc,of,Jt,Zc,Jg;const Wb=class Wb{constructor(){y(this,Zc);y(this,Jc,bk());y(this,of,0);y(this,Jt,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=e;const r=s.decode().then(()=>(n.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return re(this,"_isSVGFittingCanvas",r)}async getFromFile(e){const{lastModified:t,name:n,size:s,type:r}=e;return A(this,Zc,Jg).call(this,`${t}_${n}_${s}_${r}`,e)}async getFromUrl(e){return A(this,Zc,Jg).call(this,e,e)}async getFromBlob(e,t){const n=await t;return A(this,Zc,Jg).call(this,e,n)}async getFromId(e){a(this,Jt)||g(this,Jt,new Map);const t=a(this,Jt).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:n}=t;return delete t.blobPromise,this.getFromBlob(t.id,n)}return this.getFromUrl(t.url)}getFromCanvas(e,t){a(this,Jt)||g(this,Jt,new Map);let n=a(this,Jt).get(e);if(n!=null&&n.bitmap)return n.refCounter+=1,n;const s=new OffscreenCanvas(t.width,t.height);return s.getContext("2d").drawImage(t,0,0),n={bitmap:s.transferToImageBitmap(),id:`image_${a(this,Jc)}_${gt(this,of)._++}`,refCounter:1,isSvg:!1},a(this,Jt).set(e,n),a(this,Jt).set(n.id,n),n}getSvgUrl(e){const t=a(this,Jt).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var s;a(this,Jt)||g(this,Jt,new Map);const t=a(this,Jt).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:n}=t;if(!t.url&&!t.file){const r=new OffscreenCanvas(n.width,n.height);r.getContext("bitmaprenderer").transferFromImageBitmap(n),t.blobPromise=r.convertToBlob()}(s=n.close)==null||s.call(n),t.bitmap=null}isValidId(e){return e.startsWith(`image_${a(this,Jc)}_`)}};Jc=new WeakMap,of=new WeakMap,Jt=new WeakMap,Zc=new WeakSet,Jg=async function(e,t){a(this,Jt)||g(this,Jt,new Map);let n=a(this,Jt).get(e);if(n===null)return null;if(n!=null&&n.bitmap)return n.refCounter+=1,n;try{n||(n={bitmap:null,id:`image_${a(this,Jc)}_${gt(this,of)._++}`,refCounter:0,isSvg:!1});let s;if(typeof t=="string"?(n.url=t,s=await Jp(t,"blob")):t instanceof File?s=n.file=t:t instanceof Blob&&(s=t),s.type==="image/svg+xml"){const r=Wb._isSVGFittingCanvas,o=new FileReader,l=new Image,c=new Promise((u,h)=>{l.onload=()=>{n.bitmap=l,n.isSvg=!0,u()},o.onload=async()=>{const d=n.svgUrl=o.result;l.src=await r?`${d}#svgView(preserveAspectRatio(none))`:d},l.onerror=o.onerror=h});o.readAsDataURL(s),await c}else n.bitmap=await createImageBitmap(s);n.refCounter=1}catch(s){Z(s),n=null}return a(this,Jt).set(e,n),n&&a(this,Jt).set(n.id,n),n};let nw=Wb;var at,oo,af,Ke;class pL{constructor(e=128){y(this,at,[]);y(this,oo,!1);y(this,af);y(this,Ke,-1);g(this,af,e)}add({cmd:e,undo:t,post:n,mustExec:s,type:r=NaN,overwriteIfSameType:o=!1,keepUndo:l=!1}){if(s&&e(),a(this,oo))return;const c={cmd:e,undo:t,post:n,type:r};if(a(this,Ke)===-1){a(this,at).length>0&&(a(this,at).length=0),g(this,Ke,0),a(this,at).push(c);return}if(o&&a(this,at)[a(this,Ke)].type===r){l&&(c.undo=a(this,at)[a(this,Ke)].undo),a(this,at)[a(this,Ke)]=c;return}const u=a(this,Ke)+1;u===a(this,af)?a(this,at).splice(0,1):(g(this,Ke,u),u<a(this,at).length&&a(this,at).splice(u)),a(this,at).push(c)}undo(){if(a(this,Ke)===-1)return;g(this,oo,!0);const{undo:e,post:t}=a(this,at)[a(this,Ke)];e(),t==null||t(),g(this,oo,!1),g(this,Ke,a(this,Ke)-1)}redo(){if(a(this,Ke)<a(this,at).length-1){g(this,Ke,a(this,Ke)+1),g(this,oo,!0);const{cmd:e,post:t}=a(this,at)[a(this,Ke)];e(),t==null||t(),g(this,oo,!1)}}hasSomethingToUndo(){return a(this,Ke)!==-1}hasSomethingToRedo(){return a(this,Ke)<a(this,at).length-1}cleanType(e){if(a(this,Ke)!==-1){for(let t=a(this,Ke);t>=0;t--)if(a(this,at)[t].type!==e){a(this,at).splice(t+1,a(this,Ke)-t),g(this,Ke,t);return}a(this,at).length=0,g(this,Ke,-1)}}destroy(){g(this,at,null)}}at=new WeakMap,oo=new WeakMap,af=new WeakMap,Ke=new WeakMap;var vy,Ik;class tg{constructor(e){y(this,vy);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=Gt.platform;for(const[n,s,r={}]of e)for(const o of n){const l=o.startsWith("mac+");t&&l?(this.callbacks.set(o.slice(4),{callback:s,options:r}),this.allKeys.add(o.split("+").at(-1))):!t&&!l&&(this.callbacks.set(o,{callback:s,options:r}),this.allKeys.add(o.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const n=this.callbacks.get(A(this,vy,Ik).call(this,t));if(!n)return;const{callback:s,options:{bubbles:r=!1,args:o=[],checker:l=null}}=n;l&&!l(e,t)||(s.bind(e,...o,t)(),r||ot(t))}}vy=new WeakSet,Ik=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const wy=class wy{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return aL(e),re(this,"_colors",e)}convert(e){const t=eg(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[n,s]of this._colors)if(s.every((r,o)=>r===t[o]))return wy._colorsMapping.get(n);return t}getHexCode(e){const t=this._colors.get(e);return t?G.makeHexColor(...t):e}};F(wy,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let iw=wy;var eu,jn,tu,et,wt,nu,yi,iu,vi,Zt,ao,lo,su,co,ys,wi,Ma,lf,cf,ru,uf,vs,uo,ou,ho,ws,_y,fo,au,hf,po,Na,lu,go,df,dt,Se,er,mo,yo,ff,cu,pf,vo,_s,tr,gf,mf,_i,U,Zg,sw,Dk,Ok,ed,Mk,Nk,Fk,rw,Bk,jk,$k,Uk,ln,Vs,zk,Hk,ow,Wk,td,aw;const Bc=class Bc{constructor(e,t,n,s,r,o,l,c,u,h,d,f,p,v,b,S){y(this,U);y(this,eu,new AbortController);y(this,jn,null);y(this,tu,null);y(this,et,new Map);y(this,wt,new Map);y(this,nu,null);y(this,yi,null);y(this,iu,null);y(this,vi,new pL);y(this,Zt,null);y(this,ao,null);y(this,lo,null);y(this,su,0);y(this,co,new Set);y(this,ys,null);y(this,wi,null);y(this,Ma,new Set);F(this,"_editorUndoBar",null);y(this,lf,!1);y(this,cf,!1);y(this,ru,!1);y(this,uf,null);y(this,vs,null);y(this,uo,null);y(this,ou,null);y(this,ho,!1);y(this,ws,null);y(this,_y,new fL);y(this,fo,!1);y(this,au,!1);y(this,hf,!1);y(this,po,null);y(this,Na,null);y(this,lu,null);y(this,go,null);y(this,df,null);y(this,dt,ne.NONE);y(this,Se,new Set);y(this,er,null);y(this,mo,null);y(this,yo,null);y(this,ff,null);y(this,cu,null);y(this,pf,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});y(this,vo,[0,0]);y(this,_s,null);y(this,tr,null);y(this,gf,null);y(this,mf,null);y(this,_i,null);const m=this._signal=a(this,eu).signal;g(this,tr,e),g(this,gf,t),g(this,mf,n),g(this,nu,s),g(this,Zt,r),g(this,mo,o),g(this,cu,c),this._eventBus=l,l._on("editingaction",this.onEditingAction.bind(this),{signal:m}),l._on("pagechanging",this.onPageChanging.bind(this),{signal:m}),l._on("scalechanging",this.onScaleChanging.bind(this),{signal:m}),l._on("rotationchanging",this.onRotationChanging.bind(this),{signal:m}),l._on("setpreference",this.onSetPreference.bind(this),{signal:m}),l._on("switchannotationeditorparams",_=>this.updateParams(_.type,_.value),{signal:m}),window.addEventListener("pointerdown",()=>{g(this,au,!0)},{capture:!0,signal:m}),window.addEventListener("pointerup",()=>{g(this,au,!1)},{capture:!0,signal:m}),A(this,U,Mk).call(this),A(this,U,Uk).call(this),A(this,U,rw).call(this),g(this,yi,c.annotationStorage),g(this,uf,c.filterFactory),g(this,yo,u),g(this,ou,h||null),g(this,lf,d),g(this,cf,f),g(this,ru,p),g(this,df,v||null),this.viewParameters={realScale:la.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=b||null,this._supportsPinchToZoom=S!==!1,r==null||r.setSidebarUiManager(this)}static get _keyboardManager(){const e=Bc.prototype,t=o=>a(o,tr).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),n=(o,{target:l})=>{if(l instanceof HTMLInputElement){const{type:c}=l;return c!=="text"&&c!=="number"}return!0},s=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return re(this,"_keyboardManager",new tg([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],e.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:n}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(o,{target:l})=>!(l instanceof HTMLButtonElement)&&a(o,tr).contains(l)&&!o.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(o,{target:l})=>!(l instanceof HTMLButtonElement)&&a(o,tr).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-s,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[s,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-s],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,s],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}]]))}destroy(){var e,t,n,s,r,o,l,c,u;(e=a(this,_i))==null||e.resolve(),g(this,_i,null),(t=a(this,eu))==null||t.abort(),g(this,eu,null),this._signal=null;for(const h of a(this,wt).values())h.destroy();a(this,wt).clear(),a(this,et).clear(),a(this,Ma).clear(),(n=a(this,go))==null||n.clear(),g(this,jn,null),a(this,Se).clear(),a(this,vi).destroy(),(s=a(this,nu))==null||s.destroy(),(r=a(this,Zt))==null||r.destroy(),(o=a(this,mo))==null||o.destroy(),(l=a(this,ws))==null||l.hide(),g(this,ws,null),(c=a(this,lu))==null||c.destroy(),g(this,lu,null),g(this,tu,null),a(this,vs)&&(clearTimeout(a(this,vs)),g(this,vs,null)),a(this,_s)&&(clearTimeout(a(this,_s)),g(this,_s,null)),(u=this._editorUndoBar)==null||u.destroy(),g(this,cu,null)}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return a(this,df)}get useNewAltTextFlow(){return a(this,cf)}get useNewAltTextWhenAddingImage(){return a(this,ru)}get hcmFilter(){return re(this,"hcmFilter",a(this,yo)?a(this,uf).addHCMFilter(a(this,yo).foreground,a(this,yo).background):"none")}get direction(){return re(this,"direction",getComputedStyle(a(this,tr)).direction)}get _highlightColors(){return re(this,"_highlightColors",a(this,ou)?new Map(a(this,ou).split(",").map(e=>(e=e.split("=").map(t=>t.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColors(){const{_highlightColors:e}=this;if(!e)return re(this,"highlightColors",null);const t=new Map,n=!!a(this,yo);for(const[s,r]of e){const o=s.endsWith("_HCM");if(n&&o){t.set(s.replace("_HCM",""),r);continue}!n&&!o&&t.set(s,r)}return re(this,"highlightColors",t)}get highlightColorNames(){return re(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}getNonHCMColor(e){if(!this._highlightColors)return e;const t=this.highlightColorNames.get(e);return this._highlightColors.get(t)||e}getNonHCMColorName(e){return this.highlightColorNames.get(e)||e}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),g(this,lo,e)}setMainHighlightColorPicker(e){g(this,lu,e)}editAltText(e,t=!1){var n;(n=a(this,nu))==null||n.editAltText(this,e,t)}hasCommentManager(){return!!a(this,Zt)}editComment(e,t,n,s){var r;(r=a(this,Zt))==null||r.showDialog(this,e,t,n,s)}selectComment(e,t){const n=a(this,wt).get(e),s=n==null?void 0:n.getEditorByUID(t);s==null||s.toggleComment(!0,!0)}updateComment(e){var t;(t=a(this,Zt))==null||t.updateComment(e.getData())}updatePopupColor(e){var t;(t=a(this,Zt))==null||t.updatePopupColor(e)}removeComment(e){var t;(t=a(this,Zt))==null||t.removeComments([e.uid])}toggleComment(e,t,n=void 0){var s;(s=a(this,Zt))==null||s.toggleCommentPopup(e,t,n)}makeCommentColor(e,t){var n;return e&&((n=a(this,Zt))==null?void 0:n.makeCommentColor(e,t))||null}getCommentDialogElement(){var e;return((e=a(this,Zt))==null?void 0:e.dialogElement)||null}async waitForEditorsRendered(e){if(a(this,wt).has(e-1))return;const{resolve:t,promise:n}=Promise.withResolvers(),s=r=>{r.pageNumber===e&&(this._eventBus._off("editorsrendered",s),t())};this._eventBus.on("editorsrendered",s),await n}getSignature(e){var t;(t=a(this,mo))==null||t.getSignature({uiManager:this,editor:e})}get signatureManager(){return a(this,mo)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":g(this,ru,t);break}}onPageChanging({pageNumber:e}){g(this,su,e-1)}focusMainContainer(){a(this,tr).focus()}findParent(e,t){for(const n of a(this,wt).values()){const{x:s,y:r,width:o,height:l}=n.div.getBoundingClientRect();if(e>=s&&e<=s+o&&t>=r&&t<=r+l)return n}return null}disableUserSelect(e=!1){a(this,gf).classList.toggle("noUserSelect",e)}addShouldRescale(e){a(this,Ma).add(e)}removeShouldRescale(e){a(this,Ma).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*la.PDF_TO_CSS_UNITS;for(const n of a(this,Ma))n.onScaleChanging();(t=a(this,lo))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e="",t=!1){const n=document.getSelection();if(!n||n.isCollapsed)return;const{anchorNode:s,anchorOffset:r,focusNode:o,focusOffset:l}=n,c=n.toString(),h=A(this,U,Zg).call(this,n).closest(".textLayer"),d=this.getSelectionBoxes(h);if(!d)return;n.empty();const f=A(this,U,sw).call(this,h),p=a(this,dt)===ne.NONE,v=()=>{const b=f==null?void 0:f.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:d,anchorNode:s,anchorOffset:r,focusNode:o,focusOffset:l,text:c});p&&this.showAllEditors("highlight",!0,!0),t&&(b==null||b.editComment())};if(p){this.switchToMode(ne.HIGHLIGHT,v);return}v()}commentSelection(e=""){this.highlightSelection(e,!0)}getAndRemoveDataFromAnnotationStorage(e){if(!a(this,yi))return null;const t=`${Xd}${e}`,n=a(this,yi).getRawValue(t);return n&&a(this,yi).remove(t),n}addToAnnotationStorage(e){!e.isEmpty()&&a(this,yi)&&!a(this,yi).has(e.id)&&a(this,yi).setValue(e.id,e)}a11yAlert(e,t=null){const n=a(this,mf);n&&(n.setAttribute("data-l10n-id",e),t?n.setAttribute("data-l10n-args",JSON.stringify(t)):n.removeAttribute("data-l10n-args"))}blur(){if(this.isShiftKeyDown=!1,a(this,ho)&&(g(this,ho,!1),A(this,U,ed).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of a(this,Se))if(t.div.contains(e)){g(this,Na,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!a(this,Na))return;const[e,t]=a(this,Na);g(this,Na,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){A(this,U,rw).call(this),this.setEditingState(!0)}removeEditListeners(){A(this,U,Bk).call(this),this.setEditingState(!1)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const n of a(this,wi))if(n.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const n of a(this,wi))if(n.isHandlingMimeForPasting(t.type)){n.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var n;if(e.preventDefault(),(n=a(this,jn))==null||n.commitOrRemove(),!this.hasSelection)return;const t=[];for(const s of a(this,Se)){const r=s.serialize(!0);r&&t.push(r)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const r of t.items)for(const o of a(this,wi))if(o.isHandlingMimeForPasting(r.type)){o.paste(r,this.currentLayer);return}let n=t.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(r){Z(`paste: "${r.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();const s=this.currentLayer;try{const r=[];for(const c of n){const u=await s.deserialize(c);if(!u)return;r.push(u)}const o=()=>{for(const c of r)A(this,U,ow).call(this,c);A(this,U,aw).call(this,r)},l=()=>{for(const c of r)c.remove()};this.addCommands({cmd:o,undo:l,mustExec:!0})}catch(r){Z(`paste: "${r.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),a(this,dt)!==ne.NONE&&!this.isEditorHandlingKeyboard&&Bc._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,a(this,ho)&&(g(this,ho,!1),A(this,U,ed).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}setEditingState(e){e?(A(this,U,Nk).call(this),A(this,U,jk).call(this),A(this,U,ln).call(this,{isEditing:a(this,dt)!==ne.NONE,isEmpty:A(this,U,td).call(this),hasSomethingToUndo:a(this,vi).hasSomethingToUndo(),hasSomethingToRedo:a(this,vi).hasSomethingToRedo(),hasSelectedEditor:!1})):(A(this,U,Fk).call(this),A(this,U,$k).call(this),A(this,U,ln).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!a(this,wi)){g(this,wi,e);for(const t of a(this,wi))A(this,U,Vs).call(this,t.defaultPropertiesToUpdate)}}getId(){return a(this,_y).id}get currentLayer(){return a(this,wt).get(a(this,su))}getLayer(e){return a(this,wt).get(e)}get currentPageIndex(){return a(this,su)}addLayer(e){a(this,wt).set(e.pageIndex,e),a(this,fo)?e.enable():e.disable()}removeLayer(e){a(this,wt).delete(e.pageIndex)}async updateMode(e,t=null,n=!1,s=!1,r=!1){var o,l,c,u,h,d;if(a(this,dt)!==e&&!(a(this,_i)&&(await a(this,_i).promise,!a(this,_i)))){if(g(this,_i,Promise.withResolvers()),(o=a(this,lo))==null||o.commitOrRemove(),a(this,dt)===ne.POPUP&&((l=a(this,Zt))==null||l.hideSidebar()),(c=a(this,Zt))==null||c.destroyPopup(),g(this,dt,e),e===ne.NONE){this.setEditingState(!1),A(this,U,Hk).call(this);for(const f of a(this,et).values())f.hideStandaloneCommentButton();(u=this._editorUndoBar)==null||u.hide(),this.toggleComment(null),a(this,_i).resolve();return}for(const f of a(this,et).values())f.addStandaloneCommentButton();e===ne.SIGNATURE&&await((h=a(this,mo))==null?void 0:h.loadSignatures()),this.setEditingState(!0),await A(this,U,zk).call(this),this.unselectAll();for(const f of a(this,wt).values())f.updateMode(e);if(e===ne.POPUP){a(this,tu)||g(this,tu,await a(this,cu).getAnnotationsByType(new Set(a(this,wi).map(v=>v._editorType))));const f=new Set,p=[];for(const v of a(this,et).values()){const{annotationElementId:b,hasComment:S,deleted:m}=v;b&&f.add(b),S&&!m&&p.push(v.getData())}for(const v of a(this,tu)){const{id:b,popupRef:S,contentsObj:m}=v;S&&(m!=null&&m.str)&&!f.has(b)&&!a(this,co).has(b)&&p.push(v)}(d=a(this,Zt))==null||d.showSidebar(p)}if(!t){n&&this.addNewEditorFromKeyboard(),a(this,_i).resolve();return}for(const f of a(this,et).values())f.uid===t?(this.setSelected(f),r?f.editComment():s?f.enterInEditMode():f.focus()):f.unselect();a(this,_i).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==a(this,dt)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){if(a(this,wi)){switch(e){case pe.CREATE:this.currentLayer.addNewEditor(t);return;case pe.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(a(this,ff)||g(this,ff,new Map)).set(e,t),this.showAllEditors("highlight",t);break}if(this.hasSelection)for(const n of a(this,Se))n.updateParams(e,t);else for(const n of a(this,wi))n.updateDefaultParams(e,t)}}showAllEditors(e,t,n=!1){var r;for(const o of a(this,et).values())o.editorType===e&&o.show(t);(((r=a(this,ff))==null?void 0:r.get(pe.HIGHLIGHT_SHOW_ALL))??!0)!==t&&A(this,U,Vs).call(this,[[pe.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(a(this,hf)!==e){g(this,hf,e);for(const t of a(this,wt).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}*getEditors(e){for(const t of a(this,et).values())t.pageIndex===e&&(yield t)}getEditor(e){return a(this,et).get(e)}addEditor(e){a(this,et).set(e.id,e)}removeEditor(e){var t,n;e.div.contains(document.activeElement)&&(a(this,vs)&&clearTimeout(a(this,vs)),g(this,vs,setTimeout(()=>{this.focusMainContainer(),g(this,vs,null)},0))),a(this,et).delete(e.id),e.annotationElementId&&((t=a(this,go))==null||t.delete(e.annotationElementId)),this.unselect(e),(!e.annotationElementId||!a(this,co).has(e.annotationElementId))&&((n=a(this,yi))==null||n.remove(e.id))}addDeletedAnnotationElement(e){a(this,co).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return a(this,co).has(e)}removeDeletedAnnotationElement(e){a(this,co).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){a(this,jn)!==e&&(g(this,jn,e),e&&A(this,U,Vs).call(this,e.propertiesToUpdate))}updateUI(e){a(this,U,Wk)===e&&A(this,U,Vs).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){A(this,U,Vs).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(a(this,Se).has(e)){a(this,Se).delete(e),e.unselect(),A(this,U,ln).call(this,{hasSelectedEditor:this.hasSelection});return}a(this,Se).add(e),e.select(),A(this,U,Vs).call(this,e.propertiesToUpdate),A(this,U,ln).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;this.updateToolbar({mode:e.mode,editId:e.uid}),(t=a(this,lo))==null||t.commitOrRemove();for(const n of a(this,Se))n!==e&&n.unselect();a(this,Se).clear(),a(this,Se).add(e),e.select(),A(this,U,Vs).call(this,e.propertiesToUpdate),A(this,U,ln).call(this,{hasSelectedEditor:!0})}isSelected(e){return a(this,Se).has(e)}get firstSelectedEditor(){return a(this,Se).values().next().value}unselect(e){e.unselect(),a(this,Se).delete(e),A(this,U,ln).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return a(this,Se).size!==0}get isEnterHandled(){return a(this,Se).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;a(this,vi).undo(),A(this,U,ln).call(this,{hasSomethingToUndo:a(this,vi).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:A(this,U,td).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){a(this,vi).redo(),A(this,U,ln).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:a(this,vi).hasSomethingToRedo(),isEmpty:A(this,U,td).call(this)})}addCommands(e){a(this,vi).add(e),A(this,U,ln).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:A(this,U,td).call(this)})}cleanUndoStack(e){a(this,vi).cleanType(e)}delete(){var r;this.commitOrRemove();const e=(r=this.currentLayer)==null?void 0:r.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...a(this,Se)],n=()=>{var o;(o=this._editorUndoBar)==null||o.show(s,t.length===1?t[0].editorType:t.length);for(const l of t)l.remove()},s=()=>{for(const o of t)A(this,U,ow).call(this,o)};this.addCommands({cmd:n,undo:s,mustExec:!0})}commitOrRemove(){var e;(e=a(this,jn))==null||e.commitOrRemove()}hasSomethingToControl(){return a(this,jn)||this.hasSelection}selectAll(){for(const e of a(this,Se))e.commit();A(this,U,aw).call(this,a(this,et).values())}unselectAll(){var e;if(!(a(this,jn)&&(a(this,jn).commitOrRemove(),a(this,dt)!==ne.NONE))&&!((e=a(this,lo))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of a(this,Se))t.unselect();a(this,Se).clear(),A(this,U,ln).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;a(this,vo)[0]+=e,a(this,vo)[1]+=t;const[s,r]=a(this,vo),o=[...a(this,Se)],l=1e3;a(this,_s)&&clearTimeout(a(this,_s)),g(this,_s,setTimeout(()=>{g(this,_s,null),a(this,vo)[0]=a(this,vo)[1]=0,this.addCommands({cmd:()=>{for(const c of o)a(this,et).has(c.id)&&(c.translateInPage(s,r),c.translationDone())},undo:()=>{for(const c of o)a(this,et).has(c.id)&&(c.translateInPage(-s,-r),c.translationDone())},mustExec:!1})},l));for(const c of o)c.translateInPage(e,t),c.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),g(this,ys,new Map);for(const e of a(this,Se))a(this,ys).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!a(this,ys))return!1;this.disableUserSelect(!1);const e=a(this,ys);g(this,ys,null);let t=!1;for(const[{x:s,y:r,pageIndex:o},l]of e)l.newX=s,l.newY=r,l.newPageIndex=o,t||(t=s!==l.savedX||r!==l.savedY||o!==l.savedPageIndex);if(!t)return!1;const n=(s,r,o,l)=>{if(a(this,et).has(s.id)){const c=a(this,wt).get(l);c?s._setParentAndPosition(c,r,o):(s.pageIndex=l,s.x=r,s.y=o)}};return this.addCommands({cmd:()=>{for(const[s,{newX:r,newY:o,newPageIndex:l}]of e)n(s,r,o,l)},undo:()=>{for(const[s,{savedX:r,savedY:o,savedPageIndex:l}]of e)n(s,r,o,l)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(a(this,ys))for(const n of a(this,ys).keys())n.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||a(this,Se).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return a(this,jn)===e}getActive(){return a(this,jn)}getMode(){return a(this,dt)}isEditingMode(){return a(this,dt)!==ne.NONE}get imageManager(){return re(this,"imageManager",new nw)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let u=0,h=t.rangeCount;u<h;u++)if(!e.contains(t.getRangeAt(u).commonAncestorContainer))return null;const{x:n,y:s,width:r,height:o}=e.getBoundingClientRect();let l;switch(e.getAttribute("data-main-rotation")){case"90":l=(u,h,d,f)=>({x:(h-s)/o,y:1-(u+d-n)/r,width:f/o,height:d/r});break;case"180":l=(u,h,d,f)=>({x:1-(u+d-n)/r,y:1-(h+f-s)/o,width:d/r,height:f/o});break;case"270":l=(u,h,d,f)=>({x:1-(h+f-s)/o,y:(u-n)/r,width:f/o,height:d/r});break;default:l=(u,h,d,f)=>({x:(u-n)/r,y:(h-s)/o,width:d/r,height:f/o});break}const c=[];for(let u=0,h=t.rangeCount;u<h;u++){const d=t.getRangeAt(u);if(!d.collapsed)for(const{x:f,y:p,width:v,height:b}of d.getClientRects())v===0||b===0||c.push(l(f,p,v,b))}return c.length===0?null:c}addChangedExistingAnnotation({annotationElementId:e,id:t}){(a(this,iu)||g(this,iu,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=a(this,iu))==null||t.delete(e)}renderAnnotationElement(e){var s;const t=(s=a(this,iu))==null?void 0:s.get(e.data.id);if(!t)return;const n=a(this,yi).getRawValue(t);n&&(a(this,dt)===ne.NONE&&!n.hasBeenModified||n.renderAnnotationElement(e))}setMissingCanvas(e,t,n){var r;const s=(r=a(this,go))==null?void 0:r.get(e);s&&(s.setCanvas(t,n),a(this,go).delete(e))}addMissingCanvas(e,t){(a(this,go)||g(this,go,new Map)).set(e,t)}};eu=new WeakMap,jn=new WeakMap,tu=new WeakMap,et=new WeakMap,wt=new WeakMap,nu=new WeakMap,yi=new WeakMap,iu=new WeakMap,vi=new WeakMap,Zt=new WeakMap,ao=new WeakMap,lo=new WeakMap,su=new WeakMap,co=new WeakMap,ys=new WeakMap,wi=new WeakMap,Ma=new WeakMap,lf=new WeakMap,cf=new WeakMap,ru=new WeakMap,uf=new WeakMap,vs=new WeakMap,uo=new WeakMap,ou=new WeakMap,ho=new WeakMap,ws=new WeakMap,_y=new WeakMap,fo=new WeakMap,au=new WeakMap,hf=new WeakMap,po=new WeakMap,Na=new WeakMap,lu=new WeakMap,go=new WeakMap,df=new WeakMap,dt=new WeakMap,Se=new WeakMap,er=new WeakMap,mo=new WeakMap,yo=new WeakMap,ff=new WeakMap,cu=new WeakMap,pf=new WeakMap,vo=new WeakMap,_s=new WeakMap,tr=new WeakMap,gf=new WeakMap,mf=new WeakMap,_i=new WeakMap,U=new WeakSet,Zg=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},sw=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const n of a(this,wt).values())if(n.hasTextLayer(e))return n;return null},Dk=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const n=A(this,U,Zg).call(this,e).closest(".textLayer"),s=this.getSelectionBoxes(n);s&&(a(this,ws)||g(this,ws,new dL(this)),a(this,ws).show(n,s,this.direction==="ltr"))},Ok=function(){var r,o,l;const e=document.getSelection();if(!e||e.isCollapsed){a(this,er)&&((r=a(this,ws))==null||r.hide(),g(this,er,null),A(this,U,ln).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===a(this,er))return;const s=A(this,U,Zg).call(this,e).closest(".textLayer");if(!s){a(this,er)&&((o=a(this,ws))==null||o.hide(),g(this,er,null),A(this,U,ln).call(this,{hasSelectedText:!1}));return}if((l=a(this,ws))==null||l.hide(),g(this,er,t),A(this,U,ln).call(this,{hasSelectedText:!0}),!(a(this,dt)!==ne.HIGHLIGHT&&a(this,dt)!==ne.NONE)&&(a(this,dt)===ne.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),g(this,ho,this.isShiftKeyDown),!this.isShiftKeyDown)){const c=a(this,dt)===ne.HIGHLIGHT?A(this,U,sw).call(this,s):null;if(c==null||c.toggleDrawing(),a(this,au)){const u=new AbortController,h=this.combinedSignal(u),d=f=>{f.type==="pointerup"&&f.button!==0||(u.abort(),c==null||c.toggleDrawing(!0),f.type==="pointerup"&&A(this,U,ed).call(this,"main_toolbar"))};window.addEventListener("pointerup",d,{signal:h}),window.addEventListener("blur",d,{signal:h})}else c==null||c.toggleDrawing(!0),A(this,U,ed).call(this,"main_toolbar")}},ed=function(e=""){a(this,dt)===ne.HIGHLIGHT?this.highlightSelection(e):a(this,lf)&&A(this,U,Dk).call(this)},Mk=function(){document.addEventListener("selectionchange",A(this,U,Ok).bind(this),{signal:this._signal})},Nk=function(){if(a(this,uo))return;g(this,uo,new AbortController);const e=this.combinedSignal(a(this,uo));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},Fk=function(){var e;(e=a(this,uo))==null||e.abort(),g(this,uo,null)},rw=function(){if(a(this,po))return;g(this,po,new AbortController);const e=this.combinedSignal(a(this,po));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},Bk=function(){var e;(e=a(this,po))==null||e.abort(),g(this,po,null)},jk=function(){if(a(this,ao))return;g(this,ao,new AbortController);const e=this.combinedSignal(a(this,ao));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},$k=function(){var e;(e=a(this,ao))==null||e.abort(),g(this,ao,null)},Uk=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},ln=function(e){Object.entries(e).some(([n,s])=>a(this,pf)[n]!==s)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(a(this,pf),e)}),a(this,dt)===ne.HIGHLIGHT&&e.hasSelectedEditor===!1&&A(this,U,Vs).call(this,[[pe.HIGHLIGHT_FREE,!0]]))},Vs=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},zk=async function(){if(!a(this,fo)){g(this,fo,!0);const e=[];for(const t of a(this,wt).values())e.push(t.enable());await Promise.all(e);for(const t of a(this,et).values())t.enable()}},Hk=function(){if(this.unselectAll(),a(this,fo)){g(this,fo,!1);for(const e of a(this,wt).values())e.disable();for(const e of a(this,et).values())e.disable()}},ow=function(e){const t=a(this,wt).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},Wk=function(){let e=null;for(e of a(this,Se));return e},td=function(){if(a(this,et).size===0)return!0;if(a(this,et).size===1)for(const e of a(this,et).values())return e.isEmpty();return!1},aw=function(e){for(const t of a(this,Se))t.unselect();a(this,Se).clear();for(const t of e)t.isEmpty()||(a(this,Se).add(t),t.select());A(this,U,ln).call(this,{hasSelectedEditor:this.hasSelection})},F(Bc,"TRANSLATE_SMALL",1),F(Bc,"TRANSLATE_BIG",10);let ec=Bc;var Ct,bs,Hi,uu,As,$n,hu,Ss,En,nr,Fa,Es,wo,rs,nd,em;const cn=class cn{constructor(e){y(this,rs);y(this,Ct,null);y(this,bs,!1);y(this,Hi,null);y(this,uu,null);y(this,As,null);y(this,$n,null);y(this,hu,!1);y(this,Ss,null);y(this,En,null);y(this,nr,null);y(this,Fa,null);y(this,Es,!1);g(this,En,e),g(this,Es,e._uiManager.useNewAltTextFlow),a(cn,wo)||g(cn,wo,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){cn._l10n??(cn._l10n=e)}async render(){const e=g(this,Hi,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=g(this,uu,document.createElement("span"));e.append(t),a(this,Es)?(e.classList.add("new"),e.setAttribute("data-l10n-id",a(cn,wo).missing),t.setAttribute("data-l10n-id",a(cn,wo)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const n=a(this,En)._uiManager._signal;e.addEventListener("contextmenu",Ni,{signal:n}),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:n});const s=r=>{r.preventDefault(),a(this,En)._uiManager.editAltText(a(this,En)),a(this,Es)&&a(this,En)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:a(this,rs,nd)}})};return e.addEventListener("click",s,{capture:!0,signal:n}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(g(this,hu,!0),s(r))},{signal:n}),await A(this,rs,em).call(this),e}finish(){a(this,Hi)&&(a(this,Hi).focus({focusVisible:a(this,hu)}),g(this,hu,!1))}isEmpty(){return a(this,Es)?a(this,Ct)===null:!a(this,Ct)&&!a(this,bs)}hasData(){return a(this,Es)?a(this,Ct)!==null||!!a(this,nr):this.isEmpty()}get guessedText(){return a(this,nr)}async setGuessedText(e){a(this,Ct)===null&&(g(this,nr,e),g(this,Fa,await cn._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),A(this,rs,em).call(this))}toggleAltTextBadge(e=!1){var t;if(!a(this,Es)||a(this,Ct)){(t=a(this,Ss))==null||t.remove(),g(this,Ss,null);return}if(!a(this,Ss)){const n=g(this,Ss,document.createElement("div"));n.className="noAltTextBadge",a(this,En).div.append(n)}a(this,Ss).classList.toggle("hidden",!e)}serialize(e){let t=a(this,Ct);return!e&&a(this,nr)===t&&(t=a(this,Fa)),{altText:t,decorative:a(this,bs),guessedText:a(this,nr),textWithDisclaimer:a(this,Fa)}}get data(){return{altText:a(this,Ct),decorative:a(this,bs)}}set data({altText:e,decorative:t,guessedText:n,textWithDisclaimer:s,cancel:r=!1}){n&&(g(this,nr,n),g(this,Fa,s)),!(a(this,Ct)===e&&a(this,bs)===t)&&(r||(g(this,Ct,e),g(this,bs,t)),A(this,rs,em).call(this))}toggle(e=!1){a(this,Hi)&&(!e&&a(this,$n)&&(clearTimeout(a(this,$n)),g(this,$n,null)),a(this,Hi).disabled=!e)}shown(){a(this,En)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:a(this,rs,nd)}})}destroy(){var e,t;(e=a(this,Hi))==null||e.remove(),g(this,Hi,null),g(this,uu,null),g(this,As,null),(t=a(this,Ss))==null||t.remove(),g(this,Ss,null)}};Ct=new WeakMap,bs=new WeakMap,Hi=new WeakMap,uu=new WeakMap,As=new WeakMap,$n=new WeakMap,hu=new WeakMap,Ss=new WeakMap,En=new WeakMap,nr=new WeakMap,Fa=new WeakMap,Es=new WeakMap,wo=new WeakMap,rs=new WeakSet,nd=function(){return a(this,Ct)&&"added"||a(this,Ct)===null&&this.guessedText&&"review"||"missing"},em=async function(){var s,r,o;const e=a(this,Hi);if(!e)return;if(a(this,Es)){if(e.classList.toggle("done",!!a(this,Ct)),e.setAttribute("data-l10n-id",a(cn,wo)[a(this,rs,nd)]),(s=a(this,uu))==null||s.setAttribute("data-l10n-id",a(cn,wo)[`${a(this,rs,nd)}-label`]),!a(this,Ct)){(r=a(this,As))==null||r.remove();return}}else{if(!a(this,Ct)&&!a(this,bs)){e.classList.remove("done"),(o=a(this,As))==null||o.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=a(this,As);if(!t){g(this,As,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${a(this,En).id}`;const l=100,c=a(this,En)._uiManager._signal;c.addEventListener("abort",()=>{clearTimeout(a(this,$n)),g(this,$n,null)},{once:!0}),e.addEventListener("mouseenter",()=>{g(this,$n,setTimeout(()=>{g(this,$n,null),a(this,As).classList.add("show"),a(this,En)._reportTelemetry({action:"alt_text_tooltip"})},l))},{signal:c}),e.addEventListener("mouseleave",()=>{var u;a(this,$n)&&(clearTimeout(a(this,$n)),g(this,$n,null)),(u=a(this,As))==null||u.classList.remove("show")},{signal:c})}a(this,bs)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=a(this,Ct)),t.parentNode||e.append(t);const n=a(this,En).getElementForAltText();n==null||n.setAttribute("aria-describedby",t.id)},y(cn,wo,null),F(cn,"_l10n",null);let ny=cn;var Nt,bi,Ba,Be,yf,ja,Wi,$a,Ua,za,vf,lw;class Eg{constructor(e){y(this,vf);y(this,Nt,null);y(this,bi,null);y(this,Ba,!1);y(this,Be,null);y(this,yf,null);y(this,ja,null);y(this,Wi,null);y(this,$a,null);y(this,Ua,!1);y(this,za,null);g(this,Be,e)}renderForToolbar(){const e=g(this,bi,document.createElement("button"));return e.className="comment",A(this,vf,lw).call(this,e,!1)}renderForStandalone(){const e=g(this,Nt,document.createElement("button"));e.className="annotationCommentButton";const t=a(this,Be).commentButtonPosition;if(t){const{style:n}=e;n.insetInlineEnd=`calc(${100*(a(this,Be)._uiManager.direction==="ltr"?1-t[0]:t[0])}% - var(--comment-button-dim))`,n.top=`calc(${100*t[1]}% - var(--comment-button-dim))`;const s=a(this,Be).commentButtonColor;s&&(n.backgroundColor=s)}return A(this,vf,lw).call(this,e,!0)}focusButton(){setTimeout(()=>{var e;(e=a(this,Nt)??a(this,bi))==null||e.focus()},0)}onUpdatedColor(){if(!a(this,Nt))return;const e=a(this,Be).commentButtonColor;e&&(a(this,Nt).style.backgroundColor=e),a(this,Be)._uiManager.updatePopupColor(a(this,Be))}get commentButtonWidth(){var e;return(((e=a(this,Nt))==null?void 0:e.getBoundingClientRect().width)??0)/a(this,Be).parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(a(this,za))return a(this,za);if(!a(this,Nt))return null;const{x:e,y:t,height:n}=a(this,Nt).getBoundingClientRect(),{x:s,y:r,width:o,height:l}=a(this,Be).parent.boundingClientRect;return[(e-s)/o,(t+n-r)/l]}set commentPopupPositionInLayer(e){g(this,za,e)}hasDefaultPopupPosition(){return a(this,za)===null}removeStandaloneCommentButton(){var e;(e=a(this,Nt))==null||e.remove(),g(this,Nt,null)}removeToolbarCommentButton(){var e;(e=a(this,bi))==null||e.remove(),g(this,bi,null)}setCommentButtonStates({selected:e,hasPopup:t}){a(this,Nt)&&(a(this,Nt).classList.toggle("selected",e),a(this,Nt).ariaExpanded=t)}edit(e){const t=this.commentPopupPositionInLayer;let n,s;if(t)[n,s]=t;else{[n,s]=a(this,Be).commentButtonPosition;const{width:h,height:d,x:f,y:p}=a(this,Be);n=f+n*h,s=p+s*d}const r=a(this,Be).parent.boundingClientRect,{x:o,y:l,width:c,height:u}=r;a(this,Be)._uiManager.editComment(a(this,Be),o+n*c,l+s*u,{...e,parentDimensions:r})}finish(){a(this,bi)&&(a(this,bi).focus({focusVisible:a(this,Ba)}),g(this,Ba,!1))}isDeleted(){return a(this,Ua)||a(this,Wi)===""}isEmpty(){return a(this,Wi)===null}hasBeenEdited(){return this.isDeleted()||a(this,Wi)!==a(this,yf)}serialize(){return this.data}get data(){return{text:a(this,Wi),richText:a(this,ja),date:a(this,$a),deleted:this.isDeleted()}}set data(e){if(e!==a(this,Wi)&&g(this,ja,null),e===null){g(this,Wi,""),g(this,Ua,!0);return}g(this,Wi,e),g(this,$a,new Date),g(this,Ua,!1)}setInitialText(e,t=null){g(this,yf,e),this.data=e,g(this,$a,null),g(this,ja,t)}shown(){}destroy(){var e,t;(e=a(this,bi))==null||e.remove(),g(this,bi,null),(t=a(this,Nt))==null||t.remove(),g(this,Nt,null),g(this,Wi,""),g(this,ja,null),g(this,$a,null),g(this,Be,null),g(this,Ba,!1),g(this,Ua,!1)}}Nt=new WeakMap,bi=new WeakMap,Ba=new WeakMap,Be=new WeakMap,yf=new WeakMap,ja=new WeakMap,Wi=new WeakMap,$a=new WeakMap,Ua=new WeakMap,za=new WeakMap,vf=new WeakSet,lw=function(e,t){if(!a(this,Be)._uiManager.hasCommentManager())return null;e.tabIndex="0",e.ariaHasPopup="dialog",t?(e.ariaControls="commentPopup",e.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(e.ariaControlsElements=[a(this,Be)._uiManager.getCommentDialogElement()],e.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const n=a(this,Be)._uiManager._signal;if(!(n instanceof AbortSignal)||n.aborted)return e;e.addEventListener("contextmenu",Ni,{signal:n}),t&&(e.addEventListener("focusin",r=>{a(this,Be)._focusEventsAllowed=!1,ot(r)},{capture:!0,signal:n}),e.addEventListener("focusout",r=>{a(this,Be)._focusEventsAllowed=!0,ot(r)},{capture:!0,signal:n})),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:n});const s=r=>{r.preventDefault(),e===a(this,bi)?this.edit():a(this,Be).toggleComment(!0)};return e.addEventListener("click",s,{capture:!0,signal:n}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(g(this,Ba,!0),s(r))},{signal:n}),e.addEventListener("pointerenter",()=>{a(this,Be).toggleComment(!1,!0)},{signal:n}),e.addEventListener("pointerleave",()=>{a(this,Be).toggleComment(!1,!1)},{signal:n}),e};var du,Ha,wf,_f,bf,Af,Sf,ir,Wa,sr,Va,rr,ca,Vk,Gk,qk;const Vb=class Vb{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:n=null,onPinchStart:s=null,onPinching:r=null,onPinchEnd:o=null,signal:l}){y(this,ca);y(this,du);y(this,Ha,!1);y(this,wf,null);y(this,_f);y(this,bf);y(this,Af);y(this,Sf);y(this,ir,null);y(this,Wa);y(this,sr,null);y(this,Va);y(this,rr,null);g(this,du,e),g(this,wf,n),g(this,_f,t),g(this,bf,s),g(this,Af,r),g(this,Sf,o),g(this,Va,new AbortController),g(this,Wa,AbortSignal.any([l,a(this,Va).signal])),e.addEventListener("touchstart",A(this,ca,Vk).bind(this),{passive:!1,signal:a(this,Wa)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/zs.pixelRatio}destroy(){var e,t;(e=a(this,Va))==null||e.abort(),g(this,Va,null),(t=a(this,ir))==null||t.abort(),g(this,ir,null)}};du=new WeakMap,Ha=new WeakMap,wf=new WeakMap,_f=new WeakMap,bf=new WeakMap,Af=new WeakMap,Sf=new WeakMap,ir=new WeakMap,Wa=new WeakMap,sr=new WeakMap,Va=new WeakMap,rr=new WeakMap,ca=new WeakSet,Vk=function(e){var s,r,o;if((s=a(this,_f))!=null&&s.call(this))return;if(e.touches.length===1){if(a(this,ir))return;const l=g(this,ir,new AbortController),c=AbortSignal.any([a(this,Wa),l.signal]),u=a(this,du),h={capture:!0,signal:c,passive:!1},d=f=>{var p;f.pointerType==="touch"&&((p=a(this,ir))==null||p.abort(),g(this,ir,null))};u.addEventListener("pointerdown",f=>{f.pointerType==="touch"&&(ot(f),d(f))},h),u.addEventListener("pointerup",d,h),u.addEventListener("pointercancel",d,h);return}if(!a(this,rr)){g(this,rr,new AbortController);const l=AbortSignal.any([a(this,Wa),a(this,rr).signal]),c=a(this,du),u={signal:l,capture:!1,passive:!1};c.addEventListener("touchmove",A(this,ca,Gk).bind(this),u);const h=A(this,ca,qk).bind(this);c.addEventListener("touchend",h,u),c.addEventListener("touchcancel",h,u),u.capture=!0,c.addEventListener("pointerdown",ot,u),c.addEventListener("pointermove",ot,u),c.addEventListener("pointercancel",ot,u),c.addEventListener("pointerup",ot,u),(r=a(this,bf))==null||r.call(this)}if(ot(e),e.touches.length!==2||(o=a(this,wf))!=null&&o.call(this)){g(this,sr,null);return}let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]),g(this,sr,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:n.screenX,touch1Y:n.screenY})},Gk=function(e){var E;if(!a(this,sr)||e.touches.length!==2)return;ot(e);let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]);const{screenX:s,screenY:r}=t,{screenX:o,screenY:l}=n,c=a(this,sr),{touch0X:u,touch0Y:h,touch1X:d,touch1Y:f}=c,p=d-u,v=f-h,b=o-s,S=l-r,m=Math.hypot(b,S)||1,_=Math.hypot(p,v)||1;if(!a(this,Ha)&&Math.abs(_-m)<=Vb.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(c.touch0X=s,c.touch0Y=r,c.touch1X=o,c.touch1Y=l,!a(this,Ha)){g(this,Ha,!0);return}const w=[(s+o)/2,(r+l)/2];(E=a(this,Af))==null||E.call(this,w,_,m)},qk=function(e){var t;e.touches.length>=2||(a(this,rr)&&(a(this,rr).abort(),g(this,rr,null),(t=a(this,Sf))==null||t.call(this)),a(this,sr)&&(ot(e),g(this,sr,null),g(this,Ha,!1)))};let iy=Vb;var Ga,Vi,Ve,Ie,or,fu,_o,Ef,Ft,qa,ar,Ai,bo,kf,Ka,Un,Cf,Xa,lr,ks,pu,gu,Si,Ya,Tf,by,J,cw,xf,uw,tm,Kk,Xk,hw,nm,dw,Yk,Qk,Jk,fw,Zk,pw,eC,tC,nC,gw,id;const te=class te{constructor(e){y(this,J);y(this,Ga,null);y(this,Vi,null);y(this,Ve,null);y(this,Ie,null);y(this,or,null);y(this,fu,!1);y(this,_o,null);y(this,Ef,"");y(this,Ft,null);y(this,qa,null);y(this,ar,null);y(this,Ai,null);y(this,bo,null);y(this,kf,"");y(this,Ka,!1);y(this,Un,null);y(this,Cf,!1);y(this,Xa,!1);y(this,lr,!1);y(this,ks,null);y(this,pu,0);y(this,gu,0);y(this,Si,null);y(this,Ya,null);F(this,"isSelected",!1);F(this,"_isCopy",!1);F(this,"_editToolbar",null);F(this,"_initialOptions",Object.create(null));F(this,"_initialData",null);F(this,"_isVisible",!0);F(this,"_uiManager",null);F(this,"_focusEventsAllowed",!0);y(this,Tf,!1);y(this,by,te._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null,this.creationDate=e.creationDate||new Date,this.modificationDate=e.modificationDate||null,this.canAddComment=!0;const{rotation:t,rawDims:{pageWidth:n,pageHeight:s,pageX:r,pageY:o}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,s],this.pageTranslation=[r,o];const[l,c]=this.parentDimensions;this.x=e.x/l,this.y=e.y/c,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=te.prototype._resizeWithKeyboard,t=ec.TRANSLATE_SMALL,n=ec.TRANSLATE_BIG;return re(this,"_resizerKeyboardManager",new tg([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,n]}],[["Escape","mac+Escape"],te.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return re(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new gL({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(te._l10n??(te._l10n=e),te._l10nResizer||(te._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),te._borderLineWidth!==-1)return;const n=getComputedStyle(document.documentElement);te._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){Me("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return a(this,Tf)}set _isDraggable(e){var t;g(this,Tf,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=a(this,by)}setParent(e){var t;e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):(A(this,J,id).call(this),(t=a(this,Ai))==null||t.remove(),g(this,Ai,null)),this.parent=e}focusin(e){this._focusEventsAllowed&&(a(this,Ka)?g(this,Ka,!1):this.parent.setSelected(this))}focusout(e){var n;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(n=this.parent)!=null&&n.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,n,s){const[r,o]=this.parentDimensions;[n,s]=this.screenToPageTranslation(n,s),this.x=(e+n)/r,this.y=(t+s)/o,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[n,s]=this.parentDimensions;this.setAt(e*n,t*s,this.width*n,this.height*s),this._onTranslated()}translate(e,t){A(this,J,cw).call(this,this.parentDimensions,e,t)}translateInPage(e,t){a(this,Un)||g(this,Un,[this.x,this.y,this.width,this.height]),A(this,J,cw).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){a(this,Un)||g(this,Un,[this.x,this.y,this.width,this.height]);const{div:n,parentDimensions:[s,r]}=this;if(this.x+=e/s,this.y+=t/r,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:d,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,d,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:l}=this;const[c,u]=this.getBaseTranslation();o+=c,l+=u;const{style:h}=n;h.left=`${(100*o).toFixed(2)}%`,h.top=`${(100*l).toFixed(2)}%`,this._onTranslating(o,l),n.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!a(this,Un)&&(a(this,Un)[0]!==this.x||a(this,Un)[1]!==this.y)}get _hasBeenResized(){return!!a(this,Un)&&(a(this,Un)[2]!==this.width||a(this,Un)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:n}=te,s=n/e,r=n/t;switch(this.rotation){case 90:return[-s,r];case 180:return[s,r];case 270:return[s,-r];default:return[-s,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[n,s]}=this;let{x:r,y:o,width:l,height:c}=this;if(l*=n,c*=s,r*=n,o*=s,this._mustFixPosition)switch(e){case 0:r=pn(r,0,n-l),o=pn(o,0,s-c);break;case 90:r=pn(r,0,n-c),o=pn(o,l,s);break;case 180:r=pn(r,l,n),o=pn(o,c,s);break;case 270:r=pn(r,c,n),o=pn(o,0,s-l);break}this.x=r/=n,this.y=o/=s;const[u,h]=this.getBaseTranslation();r+=u,o+=h,t.left=`${(100*r).toFixed(2)}%`,t.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var n;return A(n=te,xf,uw).call(n,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var n;return A(n=te,xf,uw).call(n,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,n]}=this;return[t*e,n*e]}setDims(){const{div:{style:e},width:t,height:n}=this;e.width=`${(100*t).toFixed(2)}%`,e.height=`${(100*n).toFixed(2)}%`}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=a(this,Ve))==null||e.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||a(this,Xa))return this._editToolbar;this._editToolbar=new ew(this),this.div.append(this._editToolbar.render());const{toolbarButtons:e}=this;if(e)for(const[t,n]of e)await this._editToolbar.addButton(t,n);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){var e;(e=this._editToolbar)==null||e.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){var e;(e=this._editToolbar)==null||e.removeButton("comment")}removeEditToolbar(){var e,t;(e=this._editToolbar)==null||e.remove(),this._editToolbar=null,(t=a(this,Ve))==null||t.destroy()}addContainer(e){var n;const t=(n=this._editToolbar)==null?void 0:n.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return a(this,Ve)||(ny.initialize(te._l10n),g(this,Ve,new ny(this)),a(this,Ga)&&(a(this,Ve).data=a(this,Ga),g(this,Ga,null))),a(this,Ve)}get altTextData(){var e;return(e=a(this,Ve))==null?void 0:e.data}set altTextData(e){a(this,Ve)&&(a(this,Ve).data=e)}get guessedAltText(){var e;return(e=a(this,Ve))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=a(this,Ve))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=a(this,Ve))==null?void 0:t.serialize(e)}hasAltText(){return!!a(this,Ve)&&!a(this,Ve).isEmpty()}hasAltTextData(){var e;return((e=a(this,Ve))==null?void 0:e.hasData())??!1}focusCommentButton(){var e;(e=a(this,Ie))==null||e.focusButton()}addCommentButton(){return this.canAddComment?a(this,Ie)||g(this,Ie,new Eg(this)):null}addStandaloneCommentButton(){if(this._uiManager.hasCommentManager()){if(a(this,or)){this._uiManager.isEditingMode()&&a(this,or).classList.remove("hidden");return}this.hasComment&&(g(this,or,a(this,Ie).renderForStandalone()),this.div.append(a(this,or)))}}removeStandaloneCommentButton(){a(this,Ie).removeStandaloneCommentButton(),g(this,or,null)}hideStandaloneCommentButton(){var e;(e=a(this,or))==null||e.classList.add("hidden")}get comment(){const{data:{richText:e,text:t,date:n,deleted:s}}=a(this,Ie);return{text:t,richText:e,date:n,deleted:s,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(e){a(this,Ie)||g(this,Ie,new Eg(this)),a(this,Ie).data=e,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:e,popupRef:t,richText:n}){if(!t||(a(this,Ie)||g(this,Ie,new Eg(this)),a(this,Ie).setInitialText(e,n),!this.annotationElementId))return;const s=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);s&&this.updateFromAnnotationLayer(s)}get hasEditedComment(){var e;return(e=a(this,Ie))==null?void 0:e.hasBeenEdited()}get hasDeletedComment(){var e;return(e=a(this,Ie))==null?void 0:e.isDeleted()}get hasComment(){return!!a(this,Ie)&&!a(this,Ie).isEmpty()&&!a(this,Ie).isDeleted()}async editComment(e){a(this,Ie)||g(this,Ie,new Eg(this)),a(this,Ie).edit(e)}toggleComment(e,t=void 0){this.hasComment&&this._uiManager.toggleComment(this,e,t)}setSelectedCommentButton(e){a(this,Ie).setSelectedButton(e)}addComment(e){if(this.hasEditedComment){const[,,,s]=e.rect,[r]=this.pageDimensions,[o]=this.pageTranslation,l=o+r+1,c=s-100,u=l+180;e.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[l,c,u,s]}}}updateFromAnnotationLayer({popup:{contents:e,deleted:t}}){a(this,Ie).data=t?null:e}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){var o;const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=a(this,fu)?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),A(this,J,pw).call(this);const[t,n]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*n/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/n).toFixed(2)}%`);const[s,r]=this.getInitialTranslation();return this.translate(s,r),Lk(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(a(this,Ya)||g(this,Ya,new iy({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:A(this,J,Yk).bind(this),onPinching:A(this,J,Qk).bind(this),onPinchEnd:A(this,J,Jk).bind(this),signal:this._uiManager._signal}))),this.addStandaloneCommentButton(),(o=this._uiManager._editorUndoBar)==null||o.hide(),e}pointerdown(e){const{isMac:t}=Gt.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(g(this,Ka,!0),this._isDraggable){A(this,J,Zk).call(this,e);return}A(this,J,fw).call(this,e)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){a(this,ks)&&clearTimeout(a(this,ks)),g(this,ks,setTimeout(()=>{var e;g(this,ks,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,n){e.changeParent(this),this.x=t,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,n=this.rotation){const s=this.parentScale,[r,o]=this.pageDimensions,[l,c]=this.pageTranslation,u=e/s,h=t/s,d=this.x*r,f=this.y*o,p=this.width*r,v=this.height*o;switch(n){case 0:return[d+u+l,o-f-h-v+c,d+u+p+l,o-f-h+c];case 90:return[d+h+l,o-f+u+c,d+h+v+l,o-f+u+p+c];case 180:return[d-u-p+l,o-f+h+c,d-u+l,o-f+h+v+c];case 270:return[d-h-v+l,o-f-u-p+c,d-h+l,o-f-u+c];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[n,s,r,o]=e,l=r-n,c=o-s;switch(this.rotation){case 0:return[n,t-o,l,c];case 90:return[n,t-s,c,l];case 180:return[r,t-s,l,c];case 270:return[r,t-o,c,l];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&te._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){var e;(e=a(this,Ie))==null||e.onUpdatedColor()}getData(){const{comment:{text:e,color:t,date:n,opacity:s,deleted:r,richText:o},uid:l,pageIndex:c,creationDate:u,modificationDate:h}=this;return{id:l,pageIndex:c,rect:this.getPDFRect(),richText:o,contentsObj:{str:e},creationDate:u,modificationDate:n||h,popupRef:!r,color:t,opacity:s}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),g(this,Xa,!0),!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),g(this,Xa,!1),!0):!1}isInEditMode(){return a(this,Xa)}shouldGetKeyboardEvents(){return a(this,lr)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:n,right:s}=this.getClientDimensions(),{innerHeight:r,innerWidth:o}=window;return t<o&&s>0&&e<r&&n>0}rebuild(){A(this,J,pw).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){var n;return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:((n=this._initialData)==null?void 0:n.popupRef)||""}}static async deserialize(e,t,n){const s=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n,annotationElementId:e.annotationElementId,creationDate:e.creationDate,modificationDate:e.modificationDate});s.rotation=e.rotation,g(s,Ga,e.accessibilityData),s._isCopy=e.isCopy||!1;const[r,o]=s.pageDimensions,[l,c,u,h]=s.getRectInCurrentCoords(e.rect,o);return s.x=l/r,s.y=c/o,s.width=u/r,s.height=h/o,s}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t,n;if((e=a(this,bo))==null||e.abort(),g(this,bo,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),a(this,ks)&&(clearTimeout(a(this,ks)),g(this,ks,null)),A(this,J,id).call(this),this.removeEditToolbar(),a(this,Si)){for(const s of a(this,Si).values())clearTimeout(s);g(this,Si,null)}this.parent=null,(t=a(this,Ya))==null||t.destroy(),g(this,Ya,null),(n=a(this,Ai))==null||n.remove(),g(this,Ai,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(A(this,J,Kk).call(this),a(this,Ft).classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[e,t]}=this,[n,s,r,o]=this.getPDFRect();return[te._round(n+(r-n)*e),te._round(s+(o-s)*(1-t))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return a(this,Ie).commentPopupPositionInLayer}set commentPopupPosition(e){a(this,Ie).commentPopupPositionInLayer=e}hasDefaultPopupPosition(){return a(this,Ie).hasDefaultPopupPosition()}get commentButtonWidth(){return a(this,Ie).commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(e){var t;(t=a(this,Ie))==null||t.setCommentButtonStates(e)}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),g(this,ar,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=a(this,Ft).children;if(!a(this,Vi)){g(this,Vi,Array.from(t));const o=A(this,J,eC).bind(this),l=A(this,J,tC).bind(this),c=this._uiManager._signal;for(const u of a(this,Vi)){const h=u.getAttribute("data-resizer-name");u.setAttribute("role","spinbutton"),u.addEventListener("keydown",o,{signal:c}),u.addEventListener("blur",l,{signal:c}),u.addEventListener("focus",A(this,J,nC).bind(this,h),{signal:c}),u.setAttribute("data-l10n-id",te._l10nResizer[h])}}const n=a(this,Vi)[0];let s=0;for(const o of t){if(o===n)break;s++}const r=(360-this.rotation+this.parentRotation)%360/90*(a(this,Vi).length/4);if(r!==s){if(r<s)for(let l=0;l<s-r;l++)a(this,Ft).append(a(this,Ft).firstChild);else if(r>s)for(let l=0;l<r-s;l++)a(this,Ft).firstChild.before(a(this,Ft).lastChild);let o=0;for(const l of t){const u=a(this,Vi)[o++].getAttribute("data-resizer-name");l.setAttribute("data-l10n-id",te._l10nResizer[u])}}A(this,J,gw).call(this,0),g(this,lr,!0),a(this,Ft).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){a(this,lr)&&A(this,J,dw).call(this,a(this,kf),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){A(this,J,id).call(this),this.div.focus()}select(){var e,t,n;if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var s,r;(s=this.div)!=null&&s.classList.contains("selectedEditor")&&((r=this._editToolbar)==null||r.show())});return}(t=this._editToolbar)==null||t.show(),(n=a(this,Ve))==null||n.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>{var e;return(e=this.div)==null?void 0:e.focus({preventScroll:!0})},0)}unselect(){var e,t,n,s,r;this.isSelected&&(this.isSelected=!1,(e=a(this,Ft))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(n=this.div)!=null&&n.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(s=this._editToolbar)==null||s.hide(),(r=a(this,Ve))==null||r.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){e.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return a(this,Cf)}set isEditing(e){g(this,Cf,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){a(this,Si)||g(this,Si,new Map);const{action:n}=e;let s=a(this,Si).get(n);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(e),a(this,Si).delete(n),a(this,Si).size===0&&g(this,Si,null)},te._telemetryTimeout),a(this,Si).set(n,s);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),g(this,fu,!1)}disable(){this.div&&(this.div.tabIndex=-1),g(this,fu,!0)}updateFakeAnnotationElement(e){if(!a(this,Ai)&&!this.deleted){g(this,Ai,e.addFakeAnnotation(this));return}if(this.deleted){a(this,Ai).remove(),g(this,Ai,null);return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&a(this,Ai).updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const n=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),n.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};Ga=new WeakMap,Vi=new WeakMap,Ve=new WeakMap,Ie=new WeakMap,or=new WeakMap,fu=new WeakMap,_o=new WeakMap,Ef=new WeakMap,Ft=new WeakMap,qa=new WeakMap,ar=new WeakMap,Ai=new WeakMap,bo=new WeakMap,kf=new WeakMap,Ka=new WeakMap,Un=new WeakMap,Cf=new WeakMap,Xa=new WeakMap,lr=new WeakMap,ks=new WeakMap,pu=new WeakMap,gu=new WeakMap,Si=new WeakMap,Ya=new WeakMap,Tf=new WeakMap,by=new WeakMap,J=new WeakSet,cw=function([e,t],n,s){[n,s]=this.screenToPageTranslation(n,s),this.x+=n/e,this.y+=s/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},xf=new WeakSet,uw=function(e,t,n){switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},tm=function(e){switch(e){case 90:{const[t,n]=this.pageDimensions;return[0,-t/n,n/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,n]=this.pageDimensions;return[0,t/n,-n/t,0]}default:return[1,0,0,1]}},Kk=function(){if(a(this,Ft))return;g(this,Ft,document.createElement("div")),a(this,Ft).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const n of e){const s=document.createElement("div");a(this,Ft).append(s),s.classList.add("resizer",n),s.setAttribute("data-resizer-name",n),s.addEventListener("pointerdown",A(this,J,Xk).bind(this,n),{signal:t}),s.addEventListener("contextmenu",Ni,{signal:t}),s.tabIndex=-1}this.div.prepend(a(this,Ft))},Xk=function(e,t){var h;t.preventDefault();const{isMac:n}=Gt.platform;if(t.button!==0||t.ctrlKey&&n)return;(h=a(this,Ve))==null||h.toggle(!1);const s=this._isDraggable;this._isDraggable=!1,g(this,qa,[t.screenX,t.screenY]);const r=new AbortController,o=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",A(this,J,dw).bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",ot,{passive:!1,signal:o}),window.addEventListener("contextmenu",Ni,{signal:o}),g(this,ar,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const l=this.parent.div.style.cursor,c=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const u=()=>{var d;r.abort(),this.parent.togglePointerEvents(!0),(d=a(this,Ve))==null||d.toggle(!0),this._isDraggable=s,this.parent.div.style.cursor=l,this.div.style.cursor=c,A(this,J,nm).call(this)};window.addEventListener("pointerup",u,{signal:o}),window.addEventListener("blur",u,{signal:o})},hw=function(e,t,n,s){this.width=n,this.height=s,this.x=e,this.y=t,this.setDims(),this.fixAndSetPosition(),this._onResized()},nm=function(){if(!a(this,ar))return;const{savedX:e,savedY:t,savedWidth:n,savedHeight:s}=a(this,ar);g(this,ar,null);const r=this.x,o=this.y,l=this.width,c=this.height;r===e&&o===t&&l===n&&c===s||this.addCommands({cmd:A(this,J,hw).bind(this,r,o,l,c),undo:A(this,J,hw).bind(this,e,t,n,s),mustExec:!0})},dw=function(e,t){const[n,s]=this.parentDimensions,r=this.x,o=this.y,l=this.width,c=this.height,u=te.MIN_SIZE/n,h=te.MIN_SIZE/s,d=A(this,J,tm).call(this,this.rotation),f=(q,M)=>[d[0]*q+d[2]*M,d[1]*q+d[3]*M],p=A(this,J,tm).call(this,360-this.rotation),v=(q,M)=>[p[0]*q+p[2]*M,p[1]*q+p[3]*M];let b,S,m=!1,_=!1;switch(e){case"topLeft":m=!0,b=(q,M)=>[0,0],S=(q,M)=>[q,M];break;case"topMiddle":b=(q,M)=>[q/2,0],S=(q,M)=>[q/2,M];break;case"topRight":m=!0,b=(q,M)=>[q,0],S=(q,M)=>[0,M];break;case"middleRight":_=!0,b=(q,M)=>[q,M/2],S=(q,M)=>[0,M/2];break;case"bottomRight":m=!0,b=(q,M)=>[q,M],S=(q,M)=>[0,0];break;case"bottomMiddle":b=(q,M)=>[q/2,M],S=(q,M)=>[q/2,0];break;case"bottomLeft":m=!0,b=(q,M)=>[0,M],S=(q,M)=>[q,0];break;case"middleLeft":_=!0,b=(q,M)=>[0,M/2],S=(q,M)=>[q,M/2];break}const w=b(l,c),E=S(l,c);let k=f(...E);const C=te._round(r+k[0]),T=te._round(o+k[1]);let R=1,D=1,O,B;if(t.fromKeyboard)({deltaX:O,deltaY:B}=t);else{const{screenX:q,screenY:M}=t,[L,x]=a(this,qa);[O,B]=this.screenToPageTranslation(q-L,M-x),a(this,qa)[0]=q,a(this,qa)[1]=M}if([O,B]=v(O/n,B/s),m){const q=Math.hypot(l,c);R=D=Math.max(Math.min(Math.hypot(E[0]-w[0]-O,E[1]-w[1]-B)/q,1/l,1/c),u/l,h/c)}else _?R=pn(Math.abs(E[0]-w[0]-O),u,1)/l:D=pn(Math.abs(E[1]-w[1]-B),h,1)/c;const H=te._round(l*R),Y=te._round(c*D);k=f(...S(H,Y));const X=C-k[0],ee=T-k[1];a(this,Un)||g(this,Un,[this.x,this.y,this.width,this.height]),this.width=H,this.height=Y,this.x=X,this.y=ee,this.setDims(),this.fixAndSetPosition(),this._onResizing()},Yk=function(){var e;g(this,ar,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=a(this,Ve))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},Qk=function(e,t,n){let r=.7*(n/t)+1-.7;if(r===1)return;const o=A(this,J,tm).call(this,this.rotation),l=(C,T)=>[o[0]*C+o[2]*T,o[1]*C+o[3]*T],[c,u]=this.parentDimensions,h=this.x,d=this.y,f=this.width,p=this.height,v=te.MIN_SIZE/c,b=te.MIN_SIZE/u;r=Math.max(Math.min(r,1/f,1/p),v/f,b/p);const S=te._round(f*r),m=te._round(p*r);if(S===f&&m===p)return;a(this,Un)||g(this,Un,[h,d,f,p]);const _=l(f/2,p/2),w=te._round(h+_[0]),E=te._round(d+_[1]),k=l(S/2,m/2);this.x=w-k[0],this.y=E-k[1],this.width=S,this.height=m,this.setDims(),this.fixAndSetPosition(),this._onResizing()},Jk=function(){var e;(e=a(this,Ve))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),A(this,J,nm).call(this)},fw=function(e){const{isMac:t}=Gt.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},Zk=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let n=!1;const s=new AbortController,r=this._uiManager.combinedSignal(s),o={capture:!0,passive:!1,signal:r},l=u=>{s.abort(),g(this,_o,null),g(this,Ka,!1),this._uiManager.endDragSession()||A(this,J,fw).call(this,u),n&&this._onStopDragging()};t&&(g(this,pu,e.clientX),g(this,gu,e.clientY),g(this,_o,e.pointerId),g(this,Ef,e.pointerType),window.addEventListener("pointermove",u=>{n||(n=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:h,clientY:d,pointerId:f}=u;if(f!==a(this,_o)){ot(u);return}const[p,v]=this.screenToPageTranslation(h-a(this,pu),d-a(this,gu));g(this,pu,h),g(this,gu,d),this._uiManager.dragSelectedEditors(p,v)},o),window.addEventListener("touchmove",ot,o),window.addEventListener("pointerdown",u=>{u.pointerType===a(this,Ef)&&(a(this,Ya)||u.isPrimary)&&l(u),ot(u)},o));const c=u=>{if(!a(this,_o)||a(this,_o)===u.pointerId){l(u);return}ot(u)};window.addEventListener("pointerup",c,{signal:r}),window.addEventListener("blur",c,{signal:r})},pw=function(){if(a(this,bo)||!this.div)return;g(this,bo,new AbortController);const e=this._uiManager.combinedSignal(a(this,bo));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},eC=function(e){te._resizerKeyboardManager.exec(this,e)},tC=function(e){var t;a(this,lr)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==a(this,Ft)&&A(this,J,id).call(this)},nC=function(e){g(this,kf,a(this,lr)?e:"")},gw=function(e){if(a(this,Vi))for(const t of a(this,Vi))t.tabIndex=e},id=function(){g(this,lr,!1),A(this,J,gw).call(this,-1),A(this,J,nm).call(this)},y(te,xf),F(te,"_l10n",null),F(te,"_l10nResizer",null),F(te,"_borderLineWidth",-1),F(te,"_colorManager",new iw),F(te,"_zIndex",1),F(te,"_telemetryTimeout",1e3);let $e=te;class gL extends $e{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const gS=3285377520,fi=4294901760,ds=65535;class iC{constructor(e){this.h1=e?e&4294967295:gS,this.h2=e?e&4294967295:gS}update(e){let t,n;if(typeof e=="string"){t=new Uint8Array(e.length*2),n=0;for(let b=0,S=e.length;b<S;b++){const m=e.charCodeAt(b);m<=255?t[n++]=m:(t[n++]=m>>>8,t[n++]=m&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),n=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const s=n>>2,r=n-s*4,o=new Uint32Array(t.buffer,0,s);let l=0,c=0,u=this.h1,h=this.h2;const d=3432918353,f=461845907,p=d&ds,v=f&ds;for(let b=0;b<s;b++)b&1?(l=o[b],l=l*d&fi|l*p&ds,l=l<<15|l>>>17,l=l*f&fi|l*v&ds,u^=l,u=u<<13|u>>>19,u=u*5+3864292196):(c=o[b],c=c*d&fi|c*p&ds,c=c<<15|c>>>17,c=c*f&fi|c*v&ds,h^=c,h=h<<13|h>>>19,h=h*5+3864292196);switch(l=0,r){case 3:l^=t[s*4+2]<<16;case 2:l^=t[s*4+1]<<8;case 1:l^=t[s*4],l=l*d&fi|l*p&ds,l=l<<15|l>>>17,l=l*f&fi|l*v&ds,s&1?u^=l:h^=l}this.h1=u,this.h2=h}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&fi|e*36045&ds,t=t*4283543511&fi|((t<<16|e>>>16)*2950163797&fi)>>>16,e^=t>>>1,e=e*444984403&fi|e*60499&ds,t=t*3301882366&fi|((t<<16|e>>>16)*3120437893&fi)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const mw=Object.freeze({map:null,hash:"",transfer:void 0});var Qa,Ja,cr,Bt,Ay,sC;class Rb{constructor(){y(this,Ay);y(this,Qa,!1);y(this,Ja,null);y(this,cr,null);y(this,Bt,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const n=a(this,Bt).get(e);return n===void 0?t:Object.assign(t,n)}getRawValue(e){return a(this,Bt).get(e)}remove(e){const t=a(this,Bt).get(e);if(t!==void 0&&(t instanceof $e&&a(this,cr).delete(t.annotationElementId),a(this,Bt).delete(e),a(this,Bt).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const n of a(this,Bt).values())if(n instanceof $e)return;this.onAnnotationEditor(null)}}setValue(e,t){const n=a(this,Bt).get(e);let s=!1;if(n!==void 0)for(const[r,o]of Object.entries(t))n[r]!==o&&(s=!0,n[r]=o);else s=!0,a(this,Bt).set(e,t);s&&A(this,Ay,sC).call(this),t instanceof $e&&((a(this,cr)||g(this,cr,new Map)).set(t.annotationElementId,t),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type))}has(e){return a(this,Bt).has(e)}get size(){return a(this,Bt).size}resetModified(){a(this,Qa)&&(g(this,Qa,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new rC(this)}get serializable(){if(a(this,Bt).size===0)return mw;const e=new Map,t=new iC,n=[],s=Object.create(null);let r=!1;for(const[o,l]of a(this,Bt)){const c=l instanceof $e?l.serialize(!1,s):l;c&&(e.set(o,c),t.update(`${o}:${JSON.stringify(c)}`),r||(r=!!c.bitmap))}if(r)for(const o of e.values())o.bitmap&&n.push(o.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:n}:mw}get editorStats(){let e=null;const t=new Map;let n=0,s=0;for(const r of a(this,Bt).values()){if(!(r instanceof $e)){r.popup&&(r.popup.deleted?s+=1:n+=1);continue}r.isCommentDeleted?s+=1:r.hasEditedComment&&(n+=1);const o=r.telemetryFinalData;if(!o)continue;const{type:l}=o;t.has(l)||t.set(l,Object.getPrototypeOf(r).constructor),e||(e=Object.create(null));const c=e[l]||(e[l]=new Map);for(const[u,h]of Object.entries(o)){if(u==="type")continue;let d=c.get(u);d||(d=new Map,c.set(u,d));const f=d.get(h)??0;d.set(h,f+1)}}if((s>0||n>0)&&(e||(e=Object.create(null)),e.comments={deleted:s,edited:n}),!e)return null;for(const[r,o]of t)e[r]=o.computeTelemetryFinalData(e[r]);return e}resetModifiedIds(){g(this,Ja,null)}updateEditor(e,t){var s;const n=(s=a(this,cr))==null?void 0:s.get(e);return n?(n.updateFromAnnotationLayer(t),!0):!1}getEditor(e){var t;return((t=a(this,cr))==null?void 0:t.get(e))||null}get modifiedIds(){if(a(this,Ja))return a(this,Ja);const e=[];if(a(this,cr))for(const t of a(this,cr).values())t.serialize()&&e.push(t.annotationElementId);return g(this,Ja,{ids:new Set(e),hash:e.join(",")})}[Symbol.iterator](){return a(this,Bt).entries()}}Qa=new WeakMap,Ja=new WeakMap,cr=new WeakMap,Bt=new WeakMap,Ay=new WeakSet,sC=function(){a(this,Qa)||(g(this,Qa,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var Pf;class rC extends Rb{constructor(t){super();y(this,Pf);const{map:n,hash:s,transfer:r}=t.serializable,o=structuredClone(n,r?{transfer:r}:null);g(this,Pf,{map:o,hash:s,transfer:r})}get print(){Me("Should not call PrintAnnotationStorage.print")}get serializable(){return a(this,Pf)}get modifiedIds(){return re(this,"modifiedIds",{ids:new Set,hash:""})}}Pf=new WeakMap;var mu;class mL{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){y(this,mu,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),a(this,mu).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:n}){if(!(!e||a(this,mu).has(e.loadedName))){if(ge(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:s,src:r,style:o}=e,l=new FontFace(s,r,o);this.addNativeFontFace(l);try{await l.load(),a(this,mu).add(s),n==null||n(e)}catch{Z(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(l)}return}Me("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const n=e.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(s){throw Z(`Failed to load font '${n.family}': '${s}'.`),e.disableFontFace=!0,s}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const s=this._queueLoadingCallback(n);this._prepareFontLoadEvent(e,s)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return re(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return re(this,"isSyncFontLoadingSupported",fn||Gt.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(ge(!s.done,"completeRequest() cannot be called twice."),s.done=!0;n.length>0&&n[0].done;){const r=n.shift();setTimeout(r.callback,0)}}const{loadingRequests:n}=this,s={done:!1,complete:t,callback:e};return n.push(s),s}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return re(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function n(E,k){return E.charCodeAt(k)<<24|E.charCodeAt(k+1)<<16|E.charCodeAt(k+2)<<8|E.charCodeAt(k+3)&255}function s(E,k,C,T){const R=E.substring(0,k),D=E.substring(k+C);return R+T+D}let r,o;const l=this._document.createElement("canvas");l.width=1,l.height=1;const c=l.getContext("2d");let u=0;function h(E,k){if(++u>30){Z("Load test font never loaded."),k();return}if(c.font="30px "+E,c.fillText(".",0,20),c.getImageData(0,0,1,1).data[3]>0){k();return}setTimeout(h.bind(null,E,k))}const d=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=s(f,976,d.length,d);const v=16,b=1482184792;let S=n(f,v);for(r=0,o=d.length-3;r<o;r+=4)S=S-b+n(d,r)|0;r<d.length&&(S=S-b+n(d+"XXX",r)|0),f=s(f,v,4,YR(S));const m=`url(data:font/opentype;base64,${btoa(f)});`,_=`@font-face {font-family:"${d}";src:${m}}`;this.insertRule(_);const w=this._document.createElement("div");w.style.visibility="hidden",w.style.width=w.style.height="10px",w.style.position="absolute",w.style.top=w.style.left="0px";for(const E of[e.loadedName,d]){const k=this._document.createElement("span");k.textContent="Hi",k.style.fontFamily=E,w.append(k)}this._document.body.append(w),h(d,()=>{w.remove(),t.complete()})}}mu=new WeakMap;var Te;class yL{constructor(e,t=null,n,s){y(this,Te);this.compiledGlyphs=Object.create(null),g(this,Te,e),this._inspectFont=t,n&&Object.assign(this,n),s&&(this.charProcOperatorList=s)}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const n={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(n.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,n)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var n;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${Ak(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let s=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(s+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${s}src:${e}}`}return(n=this._inspectFont)==null||n.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const n=this.loadedName+"_path_"+t;let s;try{s=e.get(n)}catch(o){Z(`getPathGenerator - ignoring character: "${o}".`)}const r=kk(s);return this.fontExtraProperties||e.delete(n),this.compiledGlyphs[t]=r}get black(){return a(this,Te).black}get bold(){return a(this,Te).bold}get disableFontFace(){return a(this,Te).disableFontFace??!1}get fontExtraProperties(){return a(this,Te).fontExtraProperties??!1}get isInvalidPDFjsFont(){return a(this,Te).isInvalidPDFjsFont}get isType3Font(){return a(this,Te).isType3Font}get italic(){return a(this,Te).italic}get missingFile(){return a(this,Te).missingFile}get remeasure(){return a(this,Te).remeasure}get vertical(){return a(this,Te).vertical}get ascent(){return a(this,Te).ascent}get defaultWidth(){return a(this,Te).defaultWidth}get descent(){return a(this,Te).descent}get bbox(){return a(this,Te).bbox}get fontMatrix(){return a(this,Te).fontMatrix}get fallbackName(){return a(this,Te).fallbackName}get loadedName(){return a(this,Te).loadedName}get mimetype(){return a(this,Te).mimetype}get name(){return a(this,Te).name}get data(){return a(this,Te).data}clearData(){a(this,Te).clearData()}get cssFontInfo(){return a(this,Te).cssFontInfo}get systemFontInfo(){return a(this,Te).systemFontInfo}get defaultVMetrics(){return a(this,Te).defaultVMetrics}}Te=new WeakMap;var yu,vu,Rf,wu,im;const jc=class jc{constructor(e){y(this,wu);y(this,yu);y(this,vu);y(this,Rf);g(this,yu,e),g(this,vu,new DataView(a(this,yu))),g(this,Rf,new TextDecoder)}static write(e){const t=new TextEncoder,n={};let s=0;for(const u of jc.strings){const h=t.encode(e[u]);n[u]=h,s+=4+h.length}const r=new ArrayBuffer(s),o=new Uint8Array(r),l=new DataView(r);let c=0;for(const u of jc.strings){const h=n[u],d=h.length;l.setUint32(c,d),o.set(h,c+4),c+=4+d}return ge(c===r.byteLength,"CssFontInfo.write: Buffer overflow"),r}get fontFamily(){return A(this,wu,im).call(this,0)}get fontWeight(){return A(this,wu,im).call(this,1)}get italicAngle(){return A(this,wu,im).call(this,2)}};yu=new WeakMap,vu=new WeakMap,Rf=new WeakMap,wu=new WeakSet,im=function(e){ge(e<jc.strings.length,"Invalid string index");let t=0;for(let s=0;s<e;s++)t+=a(this,vu).getUint32(t)+4;const n=a(this,vu).getUint32(t);return a(this,Rf).decode(new Uint8Array(a(this,yu),t+4,n))},F(jc,"strings",["fontFamily","fontWeight","italicAngle"]);let sy=jc;var Ao,Cs,Za,el,sd;const $c=class $c{constructor(e){y(this,el);y(this,Ao);y(this,Cs);y(this,Za);g(this,Ao,e),g(this,Cs,new DataView(a(this,Ao))),g(this,Za,new TextDecoder)}static write(e){const t=new TextEncoder,n={};let s=0;for(const f of $c.strings){const p=t.encode(e[f]);n[f]=p,s+=4+p.length}s+=4;let r,o,l=1+s;e.style&&(r=t.encode(e.style.style),o=t.encode(e.style.weight),l+=4+r.length+4+o.length);const c=new ArrayBuffer(l),u=new Uint8Array(c),h=new DataView(c);let d=0;h.setUint8(d++,e.guessFallback?1:0),h.setUint32(d,0),d+=4,s=0;for(const f of $c.strings){const p=n[f],v=p.length;s+=4+v,h.setUint32(d,v),u.set(p,d+4),d+=4+v}return h.setUint32(d-s-4,s),e.style&&(h.setUint32(d,r.length),u.set(r,d+4),d+=4+r.length,h.setUint32(d,o.length),u.set(o,d+4),d+=4+o.length),ge(d<=c.byteLength,"SubstitionInfo.write: Buffer overflow"),c.transferToFixedLength(d)}get guessFallback(){return a(this,Cs).getUint8(0)!==0}get css(){return A(this,el,sd).call(this,0)}get loadedName(){return A(this,el,sd).call(this,1)}get baseFontName(){return A(this,el,sd).call(this,2)}get src(){return A(this,el,sd).call(this,3)}get style(){let e=1;e+=4+a(this,Cs).getUint32(e);const t=a(this,Cs).getUint32(e),n=a(this,Za).decode(new Uint8Array(a(this,Ao),e+4,t));e+=4+t;const s=a(this,Cs).getUint32(e),r=a(this,Za).decode(new Uint8Array(a(this,Ao),e+4,s));return{style:n,weight:r}}};Ao=new WeakMap,Cs=new WeakMap,Za=new WeakMap,el=new WeakSet,sd=function(e){ge(e<$c.strings.length,"Invalid string index");let t=5;for(let s=0;s<e;s++)t+=a(this,Cs).getUint32(t)+4;const n=a(this,Cs).getUint32(t);return a(this,Za).decode(new Uint8Array(a(this,Ao),t+4,n))},F($c,"strings",["css","loadedName","baseFontName","src"]);let ry=$c;var _u,bu,Au,Su,zn,Ts,Lf,xe,st,ji,sm,rd;const ie=class ie{constructor({data:e,extra:t}){y(this,st);y(this,Ts);y(this,Lf);y(this,xe);g(this,Ts,e),g(this,Lf,new TextDecoder),g(this,xe,new DataView(a(this,Ts))),t&&Object.assign(this,t)}get black(){return A(this,st,ji).call(this,0)}get bold(){return A(this,st,ji).call(this,1)}get disableFontFace(){return A(this,st,ji).call(this,2)}get fontExtraProperties(){return A(this,st,ji).call(this,3)}get isInvalidPDFjsFont(){return A(this,st,ji).call(this,4)}get isType3Font(){return A(this,st,ji).call(this,5)}get italic(){return A(this,st,ji).call(this,6)}get missingFile(){return A(this,st,ji).call(this,7)}get remeasure(){return A(this,st,ji).call(this,8)}get vertical(){return A(this,st,ji).call(this,9)}get ascent(){return A(this,st,sm).call(this,0)}get defaultWidth(){return A(this,st,sm).call(this,1)}get descent(){return A(this,st,sm).call(this,2)}get bbox(){let e=a(ie,bu);if(a(this,xe).getUint8(e)===0)return;e+=1;const n=[];for(let s=0;s<4;s++)n.push(a(this,xe).getInt16(e,!0)),e+=2;return n}get fontMatrix(){let e=a(ie,Au);if(a(this,xe).getUint8(e)===0)return;e+=1;const n=[];for(let s=0;s<6;s++)n.push(a(this,xe).getFloat64(e,!0)),e+=8;return n}get defaultVMetrics(){let e=a(ie,Su);if(a(this,xe).getUint8(e)===0)return;e+=1;const n=[];for(let s=0;s<3;s++)n.push(a(this,xe).getInt16(e,!0)),e+=2;return n}get fallbackName(){return A(this,st,rd).call(this,0)}get loadedName(){return A(this,st,rd).call(this,1)}get mimetype(){return A(this,st,rd).call(this,2)}get name(){return A(this,st,rd).call(this,3)}get data(){let e=a(ie,zn);const t=a(this,xe).getUint32(e);e+=4+t;const n=a(this,xe).getUint32(e);e+=4+n;const s=a(this,xe).getUint32(e);e+=4+s;const r=a(this,xe).getUint32(e);if(r!==0)return new Uint8Array(a(this,Ts),e+4,r)}clearData(){let e=a(ie,zn);const t=a(this,xe).getUint32(e);e+=4+t;const n=a(this,xe).getUint32(e);e+=4+n;const s=a(this,xe).getUint32(e);e+=4+s;const r=a(this,xe).getUint32(e);new Uint8Array(a(this,Ts),e+4,r).fill(0),a(this,xe).setUint32(e,0)}get cssFontInfo(){let e=a(ie,zn);const t=a(this,xe).getUint32(e);e+=4+t;const n=a(this,xe).getUint32(e);e+=4+n;const s=a(this,xe).getUint32(e);if(s===0)return null;const r=new Uint8Array(s);return r.set(new Uint8Array(a(this,Ts),e+4,s)),new sy(r.buffer)}get systemFontInfo(){let e=a(ie,zn);const t=a(this,xe).getUint32(e);e+=4+t;const n=a(this,xe).getUint32(e);if(n===0)return null;const s=new Uint8Array(n);return s.set(new Uint8Array(a(this,Ts),e+4,n)),new ry(s.buffer)}static write(e){const t=e.systemFontInfo?ry.write(e.systemFontInfo):null,n=e.cssFontInfo?sy.write(e.cssFontInfo):null,s=new TextEncoder,r={};let o=0;for(const b of ie.strings)r[b]=s.encode(e[b]),o+=4+r[b].length;const l=a(ie,zn)+4+o+4+(t?t.byteLength:0)+4+(n?n.byteLength:0)+4+(e.data?e.data.length:0),c=new ArrayBuffer(l),u=new Uint8Array(c),h=new DataView(c);let d=0;const f=ie.bools.length;let p=0,v=0;for(let b=0;b<f;b++){const S=e[ie.bools[b]];p|=(S===void 0?0:S?2:1)<<v,v+=2,(v===8||b===f-1)&&(h.setUint8(d++,p),p=0,v=0)}ge(d===a(ie,_u),"FontInfo.write: Boolean properties offset mismatch");for(const b of ie.numbers)h.setFloat64(d,e[b]),d+=8;if(ge(d===a(ie,bu),"FontInfo.write: Number properties offset mismatch"),e.bbox){h.setUint8(d++,4);for(const b of e.bbox)h.setInt16(d,b,!0),d+=2}else h.setUint8(d++,0),d+=2*4;if(ge(d===a(ie,Au),"FontInfo.write: BBox properties offset mismatch"),e.fontMatrix){h.setUint8(d++,6);for(const b of e.fontMatrix)h.setFloat64(d,b,!0),d+=8}else h.setUint8(d++,0),d+=8*6;if(ge(d===a(ie,Su),"FontInfo.write: FontMatrix properties offset mismatch"),e.defaultVMetrics){h.setUint8(d++,1);for(const b of e.defaultVMetrics)h.setInt16(d,b,!0),d+=2}else h.setUint8(d++,0),d+=3*2;ge(d===a(ie,zn),"FontInfo.write: DefaultVMetrics properties offset mismatch"),h.setUint32(a(ie,zn),0),d+=4;for(const b of ie.strings){const S=r[b],m=S.length;h.setUint32(d,m),u.set(S,d+4),d+=4+m}if(h.setUint32(a(ie,zn),d-a(ie,zn)-4),!t)h.setUint32(d,0),d+=4;else{const b=t.byteLength;h.setUint32(d,b),ge(d+4+b<=c.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),u.set(new Uint8Array(t),d+4),d+=4+b}if(!n)h.setUint32(d,0),d+=4;else{const b=n.byteLength;h.setUint32(d,b),ge(d+4+b<=c.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),u.set(new Uint8Array(n),d+4),d+=4+b}return e.data===void 0?(h.setUint32(d,0),d+=4):(h.setUint32(d,e.data.length),u.set(e.data,d+4),d+=4+e.data.length),ge(d<=c.byteLength,"FontInfo.write: Buffer overflow"),c.transferToFixedLength(d)}};_u=new WeakMap,bu=new WeakMap,Au=new WeakMap,Su=new WeakMap,zn=new WeakMap,Ts=new WeakMap,Lf=new WeakMap,xe=new WeakMap,st=new WeakSet,ji=function(e){ge(e<ie.bools.length,"Invalid boolean index");const t=Math.floor(e/4),n=e*2%8,s=a(this,xe).getUint8(t)>>n&3;return s===0?void 0:s===2},sm=function(e){return ge(e<ie.numbers.length,"Invalid number index"),a(this,xe).getFloat64(a(ie,_u)+e*8)},rd=function(e){ge(e<ie.strings.length,"Invalid string index");let t=a(ie,zn)+4;for(let r=0;r<e;r++)t+=a(this,xe).getUint32(t)+4;const n=a(this,xe).getUint32(t),s=new Uint8Array(n);return s.set(new Uint8Array(a(this,Ts),t+4,n)),a(this,Lf).decode(s)},F(ie,"bools",["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"]),F(ie,"numbers",["ascent","defaultWidth","descent"]),F(ie,"strings",["fallbackName","loadedName","mimetype","name"]),y(ie,_u,Math.ceil(ie.bools.length*2/8)),y(ie,bu,a(ie,_u)+ie.numbers.length*8),y(ie,Au,a(ie,bu)+1+2*4),y(ie,Su,a(ie,Au)+1+8*6),y(ie,zn,a(ie,Su)+1+2*3);let yw=ie;var If,Df,Of,Mf,Nf,Ff,Bf,jf;const Fe=class Fe{constructor(e){this.buffer=e,this.view=new DataView(e),this.data=new Uint8Array(e)}static write(e){let t,n=null,s=[],r=[],o=[],l=[],c=null,u=null;switch(e[0]){case"RadialAxial":t=e[1]==="axial"?1:2,n=e[2],o=e[3],t===1?s.push(...e[4],...e[5]):s.push(e[4][0],e[4][1],e[6],e[5][0],e[5][1],e[7]);break;case"Mesh":t=3,c=e[1],s=e[2],r=e[3],l=e[4]||[],n=e[6],u=e[7];break;default:throw new Error(`Unsupported pattern type: ${e[0]}`)}const h=Math.floor(s.length/2),d=Math.floor(r.length/3),f=o.length,p=l.length;let v=0;for(const k of l)v+=1,v=Math.ceil(v/4)*4,v+=4+k.coords.length*4,v+=4+k.colors.length*4,k.verticesPerRow!==void 0&&(v+=4);const b=20+h*8+d*3+f*8+(n?16:0)+(u?3:0)+v,S=new ArrayBuffer(b),m=new DataView(S),_=new Uint8Array(S);m.setUint8(a(Fe,If),t),m.setUint8(a(Fe,Df),n?1:0),m.setUint8(a(Fe,Of),u?1:0),m.setUint8(a(Fe,Mf),c),m.setUint32(a(Fe,Nf),h,!0),m.setUint32(a(Fe,Ff),d,!0),m.setUint32(a(Fe,Bf),f,!0),m.setUint32(a(Fe,jf),p,!0);let w=20;new Float32Array(S,w,h*2).set(s),w+=h*8,_.set(r,w),w+=d*3;for(const[k,C]of o)m.setFloat32(w,k,!0),w+=4,m.setUint32(w,parseInt(C.slice(1),16),!0),w+=4;if(n)for(const k of n)m.setFloat32(w,k,!0),w+=4;u&&(_.set(u,w),w+=3);for(let k=0;k<l.length;k++){const C=l[k];m.setUint8(w,C.type),w+=1,w=Math.ceil(w/4)*4,m.setUint32(w,C.coords.length,!0),w+=4,new Int32Array(S,w,C.coords.length).set(C.coords),w+=C.coords.length*4,m.setUint32(w,C.colors.length,!0),w+=4,new Int32Array(S,w,C.colors.length).set(C.colors),w+=C.colors.length*4,C.verticesPerRow!==void 0&&(m.setUint32(w,C.verticesPerRow,!0),w+=4)}return S}getIR(){const e=this.view,t=this.data[a(Fe,If)],n=!!this.data[a(Fe,Df)],s=!!this.data[a(Fe,Of)],r=e.getUint32(a(Fe,Nf),!0),o=e.getUint32(a(Fe,Ff),!0),l=e.getUint32(a(Fe,Bf),!0),c=e.getUint32(a(Fe,jf),!0);let u=20;const h=new Float32Array(this.buffer,u,r*2);u+=r*8;const d=new Uint8Array(this.buffer,u,o*3);u+=o*3;const f=[];for(let S=0;S<l;++S){const m=e.getFloat32(u,!0);u+=4;const _=e.getUint32(u,!0);u+=4,f.push([m,`#${_.toString(16).padStart(6,"0")}`])}let p=null;if(n){p=[];for(let S=0;S<4;++S)p.push(e.getFloat32(u,!0)),u+=4}let v=null;s&&(v=new Uint8Array(this.buffer,u,3),u+=3);const b=[];for(let S=0;S<c;++S){const m=e.getUint8(u);u+=1,u=Math.ceil(u/4)*4;const _=e.getUint32(u,!0);u+=4;const w=new Int32Array(this.buffer,u,_);u+=_*4;const E=e.getUint32(u,!0);u+=4;const k=new Int32Array(this.buffer,u,E);u+=E*4;const C={type:m,coords:w,colors:k};m===X0.LATTICE&&(C.verticesPerRow=e.getUint32(u,!0),u+=4),b.push(C)}if(t===1)return["RadialAxial","axial",p,f,Array.from(h.slice(0,2)),Array.from(h.slice(2,4)),null,null];if(t===2)return["RadialAxial","radial",p,f,[h[0],h[1]],[h[3],h[4]],h[2],h[5]];if(t===3){const S=this.data[a(Fe,Mf)];let m=null;if(h.length>0){let _=h[0],w=h[0],E=h[1],k=h[1];for(let C=0;C<h.length;C+=2){const T=h[C],R=h[C+1];_=_>T?T:_,E=E>R?R:E,w=w<T?T:w,k=k<R?R:k}m=[_,E,w,k]}return["Mesh",S,h,d,b,m,p,v]}throw new Error(`Unsupported pattern kind: ${t}`)}};If=new WeakMap,Df=new WeakMap,Of=new WeakMap,Mf=new WeakMap,Nf=new WeakMap,Ff=new WeakMap,Bf=new WeakMap,jf=new WeakMap,y(Fe,If,0),y(Fe,Df,1),y(Fe,Of,2),y(Fe,Mf,3),y(Fe,Nf,4),y(Fe,Ff,8),y(Fe,Bf,12),y(Fe,jf,16);let vw=Fe;function vL(i){if(i instanceof URL)return i.href;if(typeof i=="string"){if(fn)return i;const e=URL.parse(i,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function wL(i){if(fn&&typeof Buffer<"u"&&i instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength)return i;if(typeof i=="string")return Qp(i);if(i instanceof ArrayBuffer||ArrayBuffer.isView(i)||typeof i=="object"&&!isNaN(i==null?void 0:i.length))return new Uint8Array(i);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function kg(i){if(typeof i!="string")return null;if(i.endsWith("/"))return i;throw new Error(`Invalid factory url: "${i}" must include trailing slash.`)}const ww=i=>typeof i=="object"&&Number.isInteger(i==null?void 0:i.num)&&i.num>=0&&Number.isInteger(i==null?void 0:i.gen)&&i.gen>=0,_L=i=>typeof i=="object"&&typeof(i==null?void 0:i.name)=="string",bL=tL.bind(null,ww,_L);var ur,Sy;class AL{constructor(){y(this,ur,new Map);y(this,Sy,Promise.resolve())}postMessage(e,t){const n={data:structuredClone(e,t?{transfer:t}:null)};a(this,Sy).then(()=>{for(const[s]of a(this,ur))s.call(this,n)})}addEventListener(e,t,n=null){let s=null;if((n==null?void 0:n.signal)instanceof AbortSignal){const{signal:r}=n;if(r.aborted){Z("LoopbackPort - cannot use an `aborted` signal.");return}const o=()=>this.removeEventListener(e,t);s=()=>r.removeEventListener("abort",o),r.addEventListener("abort",o)}a(this,ur).set(t,s)}removeEventListener(e,t){const n=a(this,ur).get(t);n==null||n(),a(this,ur).delete(t)}terminate(){for(const[,e]of a(this,ur))e==null||e();a(this,ur).clear()}}ur=new WeakMap,Sy=new WeakMap;const Cg={DATA:1,ERROR:2},ut={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function mS(){}function An(i){if(i instanceof aa||i instanceof Y0||i instanceof lS||i instanceof ey||i instanceof Fv)return i;switch(i instanceof Error||typeof i=="object"&&i!==null||Me('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),i.name){case"AbortException":return new aa(i.message);case"InvalidPDFException":return new Y0(i.message);case"PasswordException":return new lS(i.message,i.code);case"ResponseException":return new ey(i.message,i.status,i.missing);case"UnknownErrorException":return new Fv(i.message,i.details)}return new Fv(i.message,i.toString())}var Eu,Ii,oC,aC,lC,rm;class od{constructor(e,t,n){y(this,Ii);y(this,Eu,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",A(this,Ii,oC).bind(this),{signal:a(this,Eu).signal})}on(e,t){const n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){const s=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[s]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:s,data:t},n)}catch(o){r.reject(o)}return r.promise}sendWithStream(e,t,n,s){const r=this.streamId++,o=this.sourceName,l=this.targetName,c=this.comObj;return new ReadableStream({start:u=>{const h=Promise.withResolvers();return this.streamControllers[r]={controller:u,startCall:h,pullCall:null,cancelCall:null,isClosed:!1},c.postMessage({sourceName:o,targetName:l,action:e,streamId:r,data:t,desiredSize:u.desiredSize},s),h.promise},pull:u=>{const h=Promise.withResolvers();return this.streamControllers[r].pullCall=h,c.postMessage({sourceName:o,targetName:l,stream:ut.PULL,streamId:r,desiredSize:u.desiredSize}),h.promise},cancel:u=>{ge(u instanceof Error,"cancel must have a valid reason");const h=Promise.withResolvers();return this.streamControllers[r].cancelCall=h,this.streamControllers[r].isClosed=!0,c.postMessage({sourceName:o,targetName:l,stream:ut.CANCEL,streamId:r,reason:An(u)}),h.promise}},n)}destroy(){var e;(e=a(this,Eu))==null||e.abort(),g(this,Eu,null)}}Eu=new WeakMap,Ii=new WeakSet,oC=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){A(this,Ii,lC).call(this,e);return}if(e.callback){const n=e.callbackId,s=this.callbackCapabilities[n];if(!s)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],e.callback===Cg.DATA)s.resolve(e.data);else if(e.callback===Cg.ERROR)s.reject(An(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const n=this.sourceName,s=e.sourceName,r=this.comObj;Promise.try(t,e.data).then(function(o){r.postMessage({sourceName:n,targetName:s,callback:Cg.DATA,callbackId:e.callbackId,data:o})},function(o){r.postMessage({sourceName:n,targetName:s,callback:Cg.ERROR,callbackId:e.callbackId,reason:An(o)})});return}if(e.streamId){A(this,Ii,aC).call(this,e);return}t(e.data)},aC=function(e){const t=e.streamId,n=this.sourceName,s=e.sourceName,r=this.comObj,o=this,l=this.actionHandler[e.action],c={enqueue(u,h=1,d){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=h,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:n,targetName:s,stream:ut.ENQUEUE,streamId:t,chunk:u},d)},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:n,targetName:s,stream:ut.CLOSE,streamId:t}),delete o.streamSinks[t])},error(u){ge(u instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,r.postMessage({sourceName:n,targetName:s,stream:ut.ERROR,streamId:t,reason:An(u)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};c.sinkCapability.resolve(),c.ready=c.sinkCapability.promise,this.streamSinks[t]=c,Promise.try(l,e.data,c).then(function(){r.postMessage({sourceName:n,targetName:s,stream:ut.START_COMPLETE,streamId:t,success:!0})},function(u){r.postMessage({sourceName:n,targetName:s,stream:ut.START_COMPLETE,streamId:t,reason:An(u)})})},lC=function(e){const t=e.streamId,n=this.sourceName,s=e.sourceName,r=this.comObj,o=this.streamControllers[t],l=this.streamSinks[t];switch(e.stream){case ut.START_COMPLETE:e.success?o.startCall.resolve():o.startCall.reject(An(e.reason));break;case ut.PULL_COMPLETE:e.success?o.pullCall.resolve():o.pullCall.reject(An(e.reason));break;case ut.PULL:if(!l){r.postMessage({sourceName:n,targetName:s,stream:ut.PULL_COMPLETE,streamId:t,success:!0});break}l.desiredSize<=0&&e.desiredSize>0&&l.sinkCapability.resolve(),l.desiredSize=e.desiredSize,Promise.try(l.onPull||mS).then(function(){r.postMessage({sourceName:n,targetName:s,stream:ut.PULL_COMPLETE,streamId:t,success:!0})},function(u){r.postMessage({sourceName:n,targetName:s,stream:ut.PULL_COMPLETE,streamId:t,reason:An(u)})});break;case ut.ENQUEUE:if(ge(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(e.chunk);break;case ut.CLOSE:if(ge(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),A(this,Ii,rm).call(this,o,t);break;case ut.ERROR:ge(o,"error should have stream controller"),o.controller.error(An(e.reason)),A(this,Ii,rm).call(this,o,t);break;case ut.CANCEL_COMPLETE:e.success?o.cancelCall.resolve():o.cancelCall.reject(An(e.reason)),A(this,Ii,rm).call(this,o,t);break;case ut.CANCEL:if(!l)break;const c=An(e.reason);Promise.try(l.onCancel||mS,c).then(function(){r.postMessage({sourceName:n,targetName:s,stream:ut.CANCEL_COMPLETE,streamId:t,success:!0})},function(u){r.postMessage({sourceName:n,targetName:s,stream:ut.CANCEL_COMPLETE,streamId:t,reason:An(u)})}),l.sinkCapability.reject(c),l.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},rm=async function(e,t){var n,s,r;await Promise.allSettled([(n=e.startCall)==null?void 0:n.promise,(s=e.pullCall)==null?void 0:s.promise,(r=e.cancelCall)==null?void 0:r.promise]),delete this.streamControllers[t]};var $f;class cC{constructor({enableHWA:e=!1}){y(this,$f,!1);g(this,$f,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!a(this,$f)})}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){Me("Abstract method `_createCanvas` called.")}}$f=new WeakMap;class SL extends cC{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const n=this._document.createElement("canvas");return n.width=e,n.height=t,n}}class uC{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){Me("Abstract method `_fetch` called.")}}class yS extends uC{async _fetch(e){const t=await Jp(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):Qp(t)}}class hC{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,n,s,r){return"none"}destroy(e=!1){}}var tl,ku,hr,dr,en,nl,il,z,Yt,ad,mc,om,yc,dC,_w,vc,ld,cd,bw,ud;class EL extends hC{constructor({docId:t,ownerDocument:n=globalThis.document}){super();y(this,z);y(this,tl);y(this,ku);y(this,hr);y(this,dr);y(this,en);y(this,nl);y(this,il,0);g(this,dr,t),g(this,en,n)}addFilter(t){if(!t)return"none";let n=a(this,z,Yt).get(t);if(n)return n;const[s,r,o]=A(this,z,om).call(this,t),l=t.length===1?s:`${s}${r}${o}`;if(n=a(this,z,Yt).get(l),n)return a(this,z,Yt).set(t,n),n;const c=`g_${a(this,dr)}_transfer_map_${gt(this,il)._++}`,u=A(this,z,yc).call(this,c);a(this,z,Yt).set(t,u),a(this,z,Yt).set(l,u);const h=A(this,z,vc).call(this,c);return A(this,z,cd).call(this,s,r,o,h),u}addHCMFilter(t,n){var v;const s=`${t}-${n}`,r="base";let o=a(this,z,ad).get(r);if((o==null?void 0:o.key)===s||(o?((v=o.filter)==null||v.remove(),o.key=s,o.url="none",o.filter=null):(o={key:s,url:"none",filter:null},a(this,z,ad).set(r,o)),!t||!n))return o.url;const l=A(this,z,ud).call(this,t);t=G.makeHexColor(...l);const c=A(this,z,ud).call(this,n);if(n=G.makeHexColor(...c),a(this,z,mc).style.color="",t==="#000000"&&n==="#ffffff"||t===n)return o.url;const u=new Array(256);for(let b=0;b<=255;b++){const S=b/255;u[b]=S<=.03928?S/12.92:((S+.055)/1.055)**2.4}const h=u.join(","),d=`g_${a(this,dr)}_hcm_filter`,f=o.filter=A(this,z,vc).call(this,d);A(this,z,cd).call(this,h,h,h,f),A(this,z,_w).call(this,f);const p=(b,S)=>{const m=l[b]/255,_=c[b]/255,w=new Array(S+1);for(let E=0;E<=S;E++)w[E]=m+E/S*(_-m);return w.join(",")};return A(this,z,cd).call(this,p(0,5),p(1,5),p(2,5),f),o.url=A(this,z,yc).call(this,d),o.url}addAlphaFilter(t){let n=a(this,z,Yt).get(t);if(n)return n;const[s]=A(this,z,om).call(this,[t]),r=`alpha_${s}`;if(n=a(this,z,Yt).get(r),n)return a(this,z,Yt).set(t,n),n;const o=`g_${a(this,dr)}_alpha_map_${gt(this,il)._++}`,l=A(this,z,yc).call(this,o);a(this,z,Yt).set(t,l),a(this,z,Yt).set(r,l);const c=A(this,z,vc).call(this,o);return A(this,z,bw).call(this,s,c),l}addLuminosityFilter(t){let n=a(this,z,Yt).get(t||"luminosity");if(n)return n;let s,r;if(t?([s]=A(this,z,om).call(this,[t]),r=`luminosity_${s}`):r="luminosity",n=a(this,z,Yt).get(r),n)return a(this,z,Yt).set(t,n),n;const o=`g_${a(this,dr)}_luminosity_map_${gt(this,il)._++}`,l=A(this,z,yc).call(this,o);a(this,z,Yt).set(t,l),a(this,z,Yt).set(r,l);const c=A(this,z,vc).call(this,o);return A(this,z,dC).call(this,c),t&&A(this,z,bw).call(this,s,c),l}addHighlightHCMFilter(t,n,s,r,o){var _;const l=`${n}-${s}-${r}-${o}`;let c=a(this,z,ad).get(t);if((c==null?void 0:c.key)===l||(c?((_=c.filter)==null||_.remove(),c.key=l,c.url="none",c.filter=null):(c={key:l,url:"none",filter:null},a(this,z,ad).set(t,c)),!n||!s))return c.url;const[u,h]=[n,s].map(A(this,z,ud).bind(this));let d=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),f=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),[p,v]=[r,o].map(A(this,z,ud).bind(this));f<d&&([d,f,p,v]=[f,d,v,p]),a(this,z,mc).style.color="";const b=(w,E,k)=>{const C=new Array(256),T=(f-d)/k,R=w/255,D=(E-w)/(255*k);let O=0;for(let B=0;B<=k;B++){const H=Math.round(d+B*T),Y=R+B*D;for(let X=O;X<=H;X++)C[X]=Y;O=H+1}for(let B=O;B<256;B++)C[B]=C[O-1];return C.join(",")},S=`g_${a(this,dr)}_hcm_${t}_filter`,m=c.filter=A(this,z,vc).call(this,S);return A(this,z,_w).call(this,m),A(this,z,cd).call(this,b(p[0],v[0],5),b(p[1],v[1],5),b(p[2],v[2],5),m),c.url=A(this,z,yc).call(this,S),c.url}destroy(t=!1){var n,s,r,o;t&&((n=a(this,nl))!=null&&n.size)||((s=a(this,hr))==null||s.parentNode.parentNode.remove(),g(this,hr,null),(r=a(this,ku))==null||r.clear(),g(this,ku,null),(o=a(this,nl))==null||o.clear(),g(this,nl,null),g(this,il,0))}}tl=new WeakMap,ku=new WeakMap,hr=new WeakMap,dr=new WeakMap,en=new WeakMap,nl=new WeakMap,il=new WeakMap,z=new WeakSet,Yt=function(){return a(this,ku)||g(this,ku,new Map)},ad=function(){return a(this,nl)||g(this,nl,new Map)},mc=function(){if(!a(this,hr)){const t=a(this,en).createElement("div"),{style:n}=t;n.visibility="hidden",n.contain="strict",n.width=n.height=0,n.position="absolute",n.top=n.left=0,n.zIndex=-1;const s=a(this,en).createElementNS(Ws,"svg");s.setAttribute("width",0),s.setAttribute("height",0),g(this,hr,a(this,en).createElementNS(Ws,"defs")),t.append(s),s.append(a(this,hr)),a(this,en).body.append(t)}return a(this,hr)},om=function(t){if(t.length===1){const u=t[0],h=new Array(256);for(let f=0;f<256;f++)h[f]=u[f]/255;const d=h.join(",");return[d,d,d]}const[n,s,r]=t,o=new Array(256),l=new Array(256),c=new Array(256);for(let u=0;u<256;u++)o[u]=n[u]/255,l[u]=s[u]/255,c[u]=r[u]/255;return[o.join(","),l.join(","),c.join(",")]},yc=function(t){if(a(this,tl)===void 0){g(this,tl,"");const n=a(this,en).URL;n!==a(this,en).baseURI&&(ev(n)?Z('#createUrl: ignore "data:"-URL for performance reasons.'):g(this,tl,wk(n,"")))}return`url(${a(this,tl)}#${t})`},dC=function(t){const n=a(this,en).createElementNS(Ws,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(n)},_w=function(t){const n=a(this,en).createElementNS(Ws,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(n)},vc=function(t){const n=a(this,en).createElementNS(Ws,"filter");return n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("id",t),a(this,z,mc).append(n),n},ld=function(t,n,s){const r=a(this,en).createElementNS(Ws,n);r.setAttribute("type","discrete"),r.setAttribute("tableValues",s),t.append(r)},cd=function(t,n,s,r){const o=a(this,en).createElementNS(Ws,"feComponentTransfer");r.append(o),A(this,z,ld).call(this,o,"feFuncR",t),A(this,z,ld).call(this,o,"feFuncG",n),A(this,z,ld).call(this,o,"feFuncB",s)},bw=function(t,n){const s=a(this,en).createElementNS(Ws,"feComponentTransfer");n.append(s),A(this,z,ld).call(this,s,"feFuncA",t)},ud=function(t){return a(this,z,mc).style.color=t,eg(getComputedStyle(a(this,z,mc)).getPropertyValue("color"))};class fC{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){Me("Abstract method `_fetch` called.")}}class vS extends fC{async _fetch(e){const t=await Jp(e,"arraybuffer");return new Uint8Array(t)}}class pC{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){Me("Abstract method `_fetch` called.")}}class wS extends pC{async _fetch(e){const t=await Jp(e,"arraybuffer");return new Uint8Array(t)}}fn&&Z("Please use the `legacy` build in Node.js environments.");async function Lb(i){const t=await process.getBuiltinModule("fs").promises.readFile(i);return new Uint8Array(t)}class kL extends hC{}class CL extends cC{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class TL extends uC{async _fetch(e){return Lb(e)}}class xL extends fC{async _fetch(e){return Lb(e)}}class PL extends pC{async _fetch(e){return Lb(e)}}const lc="__forcedDependency",{floor:_S,ceil:bS}=Math;function Tg(i,e,t,n,s,r){i[e*4+0]=Math.min(i[e*4+0],t),i[e*4+1]=Math.min(i[e*4+1],n),i[e*4+2]=Math.max(i[e*4+2],s),i[e*4+3]=Math.max(i[e*4+3],r)}const Aw=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];var Cu,So;class RL{constructor(e,t){y(this,Cu);y(this,So);g(this,Cu,e),g(this,So,t)}get length(){return a(this,Cu).length}isEmpty(e){return a(this,Cu)[e]===Aw}minX(e){return a(this,So)[e*4+0]/256}minY(e){return a(this,So)[e*4+1]/256}maxX(e){return(a(this,So)[e*4+2]+1)/256}maxY(e){return(a(this,So)[e*4+3]+1)/256}}Cu=new WeakMap,So=new WeakMap;const xg=(i,e)=>{if(!i)return;let t=i.get(e);return t||(t={dependencies:new Set,isRenderingOperation:!1},i.set(e,t)),t};var kn,Cn,sl,Gi,rl,fr,Ee,Pe,pr,Tn,Uf,Tu,ol,al,gr,tn,xs,zf,Sw;class LL{constructor(e,t,n=!1){y(this,zf);y(this,kn,{__proto__:null});y(this,Cn,{__proto__:null,transform:[],moveText:[],sameLineText:[],[lc]:[]});y(this,sl,new Map);y(this,Gi,[]);y(this,rl,[]);y(this,fr,[[1,0,0,1,0,0]]);y(this,Ee,[-1/0,-1/0,1/0,1/0]);y(this,Pe,new Float64Array([1/0,1/0,-1/0,-1/0]));y(this,pr,-1);y(this,Tn,new Set);y(this,Uf,new Map);y(this,Tu,new Map);y(this,ol);y(this,al);y(this,gr);y(this,tn);y(this,xs);g(this,ol,e.width),g(this,al,e.height),A(this,zf,Sw).call(this,t),n&&g(this,xs,new Map)}growOperationsCount(e){e>=a(this,tn).length&&A(this,zf,Sw).call(this,e,a(this,tn))}save(e){return g(this,kn,{__proto__:a(this,kn)}),g(this,Cn,{__proto__:a(this,Cn),transform:{__proto__:a(this,Cn).transform},moveText:{__proto__:a(this,Cn).moveText},sameLineText:{__proto__:a(this,Cn).sameLineText},[lc]:{__proto__:a(this,Cn)[lc]}}),g(this,Ee,{__proto__:a(this,Ee)}),a(this,Gi).push(e),this}restore(e){var s;const t=Object.getPrototypeOf(a(this,kn));if(t===null)return this;g(this,kn,t),g(this,Cn,Object.getPrototypeOf(a(this,Cn))),g(this,Ee,Object.getPrototypeOf(a(this,Ee)));const n=a(this,Gi).pop();return n!==void 0&&((s=xg(a(this,xs),e))==null||s.dependencies.add(n),a(this,tn)[e]=a(this,tn)[n]),this}recordOpenMarker(e){return a(this,Gi).push(e),this}getOpenMarker(){return a(this,Gi).length===0?null:a(this,Gi).at(-1)}recordCloseMarker(e){var n;const t=a(this,Gi).pop();return t!==void 0&&((n=xg(a(this,xs),e))==null||n.dependencies.add(t),a(this,tn)[e]=a(this,tn)[t]),this}beginMarkedContent(e){return a(this,rl).push(e),this}endMarkedContent(e){var n;const t=a(this,rl).pop();return t!==void 0&&((n=xg(a(this,xs),e))==null||n.dependencies.add(t),a(this,tn)[e]=a(this,tn)[t]),this}pushBaseTransform(e){return a(this,fr).push(G.multiplyByDOMMatrix(a(this,fr).at(-1),e.getTransform())),this}popBaseTransform(){return a(this,fr).length>1&&a(this,fr).pop(),this}recordSimpleData(e,t){return a(this,kn)[e]=t,this}recordIncrementalData(e,t){return a(this,Cn)[e].push(t),this}resetIncrementalData(e,t){return a(this,Cn)[e].length=0,this}recordNamedData(e,t){return a(this,sl).set(e,t),this}recordSimpleDataFromNamed(e,t,n){a(this,kn)[e]=a(this,sl).get(t)??n}recordFutureForcedDependency(e,t){return this.recordIncrementalData(lc,t),this}inheritSimpleDataAsFutureForcedDependencies(e){for(const t of e)t in a(this,kn)&&this.recordFutureForcedDependency(t,a(this,kn)[t]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const e of a(this,Tn))this.recordFutureForcedDependency(lc,e);return this}resetBBox(e){return a(this,pr)!==e&&(g(this,pr,e),a(this,Pe)[0]=1/0,a(this,Pe)[1]=1/0,a(this,Pe)[2]=-1/0,a(this,Pe)[3]=-1/0),this}recordClipBox(e,t,n,s,r,o){const l=G.multiplyByDOMMatrix(a(this,fr).at(-1),t.getTransform()),c=[1/0,1/0,-1/0,-1/0];G.axialAlignedBoundingBox([n,r,s,o],l,c);const u=G.intersect(a(this,Ee),c);return u?(a(this,Ee)[0]=u[0],a(this,Ee)[1]=u[1],a(this,Ee)[2]=u[2],a(this,Ee)[3]=u[3]):(a(this,Ee)[0]=a(this,Ee)[1]=1/0,a(this,Ee)[2]=a(this,Ee)[3]=-1/0),this}recordBBox(e,t,n,s,r,o){const l=a(this,Ee);if(l[0]===1/0)return this;const c=G.multiplyByDOMMatrix(a(this,fr).at(-1),t.getTransform());if(l[0]===-1/0)return G.axialAlignedBoundingBox([n,r,s,o],c,a(this,Pe)),this;const u=[1/0,1/0,-1/0,-1/0];return G.axialAlignedBoundingBox([n,r,s,o],c,u),a(this,Pe)[0]=Math.min(a(this,Pe)[0],Math.max(u[0],l[0])),a(this,Pe)[1]=Math.min(a(this,Pe)[1],Math.max(u[1],l[1])),a(this,Pe)[2]=Math.max(a(this,Pe)[2],Math.min(u[2],l[2])),a(this,Pe)[3]=Math.max(a(this,Pe)[3],Math.min(u[3],l[3])),this}recordCharacterBBox(e,t,n,s=1,r=0,o=0,l){const c=n.bbox;let u,h;if(c&&(u=c[2]!==c[0]&&c[3]!==c[1]&&a(this,Tu).get(n),u!==!1&&(h=[0,0,0,0],G.axialAlignedBoundingBox(c,n.fontMatrix,h),(s!==1||r!==0||o!==0)&&G.scaleMinMax([s,0,0,-s,r,o],h),u)))return this.recordBBox(e,t,h[0],h[2],h[1],h[3]);if(!l)return this.recordFullPageBBox(e);const d=l();return c&&h&&u===void 0&&(u=h[0]<=r-d.actualBoundingBoxLeft&&h[2]>=r+d.actualBoundingBoxRight&&h[1]<=o-d.actualBoundingBoxAscent&&h[3]>=o+d.actualBoundingBoxDescent,a(this,Tu).set(n,u),u)?this.recordBBox(e,t,h[0],h[2],h[1],h[3]):this.recordBBox(e,t,r-d.actualBoundingBoxLeft,r+d.actualBoundingBoxRight,o-d.actualBoundingBoxAscent,o+d.actualBoundingBoxDescent)}recordFullPageBBox(e){return a(this,Pe)[0]=Math.max(0,a(this,Ee)[0]),a(this,Pe)[1]=Math.max(0,a(this,Ee)[1]),a(this,Pe)[2]=Math.min(a(this,ol),a(this,Ee)[2]),a(this,Pe)[3]=Math.min(a(this,al),a(this,Ee)[3]),this}getSimpleIndex(e){return a(this,kn)[e]}recordDependencies(e,t){const n=a(this,Tn),s=a(this,kn),r=a(this,Cn);for(const o of t)o in a(this,kn)?n.add(s[o]):o in r&&r[o].forEach(n.add,n);return this}recordNamedDependency(e,t){return a(this,sl).has(t)&&a(this,Tn).add(a(this,sl).get(t)),this}recordOperation(e,t=!1){if(this.recordDependencies(e,[lc]),a(this,xs)){const n=xg(a(this,xs),e),{dependencies:s}=n;a(this,Tn).forEach(s.add,s),a(this,Gi).forEach(s.add,s),a(this,rl).forEach(s.add,s),s.delete(e),n.isRenderingOperation=!0}if(a(this,pr)===e){const n=_S(a(this,Pe)[0]*256/a(this,ol)),s=_S(a(this,Pe)[1]*256/a(this,al)),r=bS(a(this,Pe)[2]*256/a(this,ol)),o=bS(a(this,Pe)[3]*256/a(this,al));Tg(a(this,gr),e,n,s,r,o);for(const l of a(this,Tn))l!==e&&Tg(a(this,gr),l,n,s,r,o);for(const l of a(this,Gi))l!==e&&Tg(a(this,gr),l,n,s,r,o);for(const l of a(this,rl))l!==e&&Tg(a(this,gr),l,n,s,r,o);t||(a(this,Tn).clear(),g(this,pr,-1))}return this}recordShowTextOperation(e,t=!1){const n=Array.from(a(this,Tn));this.recordOperation(e,t),this.recordIncrementalData("sameLineText",e);for(const s of n)this.recordIncrementalData("sameLineText",s);return this}bboxToClipBoxDropOperation(e,t=!1){return a(this,pr)===e&&(g(this,pr,-1),a(this,Ee)[0]=Math.max(a(this,Ee)[0],a(this,Pe)[0]),a(this,Ee)[1]=Math.max(a(this,Ee)[1],a(this,Pe)[1]),a(this,Ee)[2]=Math.min(a(this,Ee)[2],a(this,Pe)[2]),a(this,Ee)[3]=Math.min(a(this,Ee)[3],a(this,Pe)[3]),t||a(this,Tn).clear()),this}_takePendingDependencies(){const e=a(this,Tn);return g(this,Tn,new Set),e}_extractOperation(e){const t=a(this,Uf).get(e);return a(this,Uf).delete(e),t}_pushPendingDependencies(e){for(const t of e)a(this,Tn).add(t)}take(){return a(this,Tu).clear(),new RL(a(this,tn),a(this,gr))}takeDebugMetadata(){return a(this,xs)}}kn=new WeakMap,Cn=new WeakMap,sl=new WeakMap,Gi=new WeakMap,rl=new WeakMap,fr=new WeakMap,Ee=new WeakMap,Pe=new WeakMap,pr=new WeakMap,Tn=new WeakMap,Uf=new WeakMap,Tu=new WeakMap,ol=new WeakMap,al=new WeakMap,gr=new WeakMap,tn=new WeakMap,xs=new WeakMap,zf=new WeakSet,Sw=function(e,t){const n=new ArrayBuffer(e*4);g(this,gr,new Uint8ClampedArray(n)),g(this,tn,new Uint32Array(n)),t&&t.length>0?(a(this,tn).set(t),a(this,tn).fill(Aw,t.length)):a(this,tn).fill(Aw)};var De,tt,qi,xu,Pu;const Gb=class Gb{constructor(e,t,n){y(this,De);y(this,tt);y(this,qi);y(this,xu,0);y(this,Pu,0);if(e instanceof Gb&&a(e,qi)===!!n)return e;g(this,De,e),g(this,tt,t),g(this,qi,!!n)}growOperationsCount(){throw new Error("Unreachable")}save(e){return gt(this,Pu)._++,a(this,De).save(a(this,tt)),this}restore(e){return a(this,Pu)>0&&(a(this,De).restore(a(this,tt)),gt(this,Pu)._--),this}recordOpenMarker(e){return gt(this,xu)._++,this}getOpenMarker(){return a(this,xu)>0?a(this,tt):a(this,De).getOpenMarker()}recordCloseMarker(e){return gt(this,xu)._--,this}beginMarkedContent(e){return this}endMarkedContent(e){return this}pushBaseTransform(e){return a(this,De).pushBaseTransform(e),this}popBaseTransform(){return a(this,De).popBaseTransform(),this}recordSimpleData(e,t){return a(this,De).recordSimpleData(e,a(this,tt)),this}recordIncrementalData(e,t){return a(this,De).recordIncrementalData(e,a(this,tt)),this}resetIncrementalData(e,t){return a(this,De).resetIncrementalData(e,a(this,tt)),this}recordNamedData(e,t){return this}recordSimpleDataFromNamed(e,t,n){return a(this,De).recordSimpleDataFromNamed(e,t,a(this,tt)),this}recordFutureForcedDependency(e,t){return a(this,De).recordFutureForcedDependency(e,a(this,tt)),this}inheritSimpleDataAsFutureForcedDependencies(e){return a(this,De).inheritSimpleDataAsFutureForcedDependencies(e),this}inheritPendingDependenciesAsFutureForcedDependencies(){return a(this,De).inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(e){return a(this,qi)||a(this,De).resetBBox(a(this,tt)),this}recordClipBox(e,t,n,s,r,o){return a(this,qi)||a(this,De).recordClipBox(a(this,tt),t,n,s,r,o),this}recordBBox(e,t,n,s,r,o){return a(this,qi)||a(this,De).recordBBox(a(this,tt),t,n,s,r,o),this}recordCharacterBBox(e,t,n,s,r,o,l){return a(this,qi)||a(this,De).recordCharacterBBox(a(this,tt),t,n,s,r,o,l),this}recordFullPageBBox(e){return a(this,qi)||a(this,De).recordFullPageBBox(a(this,tt)),this}getSimpleIndex(e){return a(this,De).getSimpleIndex(e)}recordDependencies(e,t){return a(this,De).recordDependencies(a(this,tt),t),this}recordNamedDependency(e,t){return a(this,De).recordNamedDependency(a(this,tt),t),this}recordOperation(e){return a(this,De).recordOperation(a(this,tt),!0),this}recordShowTextOperation(e){return a(this,De).recordShowTextOperation(a(this,tt),!0),this}bboxToClipBoxDropOperation(e){return a(this,qi)||a(this,De).bboxToClipBoxDropOperation(a(this,tt),!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}};De=new WeakMap,tt=new WeakMap,qi=new WeakMap,xu=new WeakMap,Pu=new WeakMap;let oy=Gb;const pi={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},zt={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Ew(i,e){if(!e)return;const t=e[2]-e[0],n=e[3]-e[1],s=new Path2D;s.rect(e[0],e[1],t,n),i.clip(s)}class Ib{isModifyingCurrentTransform(){return!1}getPattern(){Me("Abstract method `getPattern` called.")}}class IL extends Ib{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const n of this._colorStops)t.addColorStop(n[0],n[1]);return t}getPattern(e,t,n,s){let r;if(s===zt.STROKE||s===zt.FILL){const o=t.current.getClippedPathBoundingBox(s,Xe(e))||[0,0,0,0],l=Math.ceil(o[2]-o[0])||1,c=Math.ceil(o[3]-o[1])||1,u=t.cachedCanvases.getCanvas("pattern",l,c),h=u.context;h.clearRect(0,0,h.canvas.width,h.canvas.height),h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.translate(-o[0],-o[1]),n=G.transform(n,[1,0,0,1,o[0],o[1]]),h.transform(...t.baseTransform),this.matrix&&h.transform(...this.matrix),Ew(h,this._bbox),h.fillStyle=this._createGradient(h),h.fill(),r=e.createPattern(u.canvas,"no-repeat");const d=new DOMMatrix(n);r.setTransform(d)}else Ew(e,this._bbox),r=this._createGradient(e);return r}}function $v(i,e,t,n,s,r,o,l){const c=e.coords,u=e.colors,h=i.data,d=i.width*4;let f;c[t+1]>c[n+1]&&(f=t,t=n,n=f,f=r,r=o,o=f),c[n+1]>c[s+1]&&(f=n,n=s,s=f,f=o,o=l,l=f),c[t+1]>c[n+1]&&(f=t,t=n,n=f,f=r,r=o,o=f);const p=(c[t]+e.offsetX)*e.scaleX,v=(c[t+1]+e.offsetY)*e.scaleY,b=(c[n]+e.offsetX)*e.scaleX,S=(c[n+1]+e.offsetY)*e.scaleY,m=(c[s]+e.offsetX)*e.scaleX,_=(c[s+1]+e.offsetY)*e.scaleY;if(v>=_)return;const w=u[r],E=u[r+1],k=u[r+2],C=u[o],T=u[o+1],R=u[o+2],D=u[l],O=u[l+1],B=u[l+2],H=Math.round(v),Y=Math.round(_);let X,ee,q,M,L,x,P,I;for(let N=H;N<=Y;N++){if(N<S){const ce=N<v?0:(v-N)/(v-S);X=p-(p-b)*ce,ee=w-(w-C)*ce,q=E-(E-T)*ce,M=k-(k-R)*ce}else{let ce;N>_?ce=1:S===_?ce=0:ce=(S-N)/(S-_),X=b-(b-m)*ce,ee=C-(C-D)*ce,q=T-(T-O)*ce,M=R-(R-B)*ce}let $;N<v?$=0:N>_?$=1:$=(v-N)/(v-_),L=p-(p-m)*$,x=w-(w-D)*$,P=E-(E-O)*$,I=k-(k-B)*$;const Q=Math.round(Math.min(X,L)),we=Math.round(Math.max(X,L));let _e=d*N+Q*4;for(let ce=Q;ce<=we;ce++)$=(X-ce)/(X-L),$<0?$=0:$>1&&($=1),h[_e++]=ee-(ee-x)*$|0,h[_e++]=q-(q-P)*$|0,h[_e++]=M-(M-I)*$|0,h[_e++]=255}}function DL(i,e,t){const n=e.coords,s=e.colors;let r,o;switch(e.type){case X0.LATTICE:const l=e.verticesPerRow,c=Math.floor(n.length/l)-1,u=l-1;for(r=0;r<c;r++){let h=r*l;for(let d=0;d<u;d++,h++)$v(i,t,n[h],n[h+1],n[h+l],s[h],s[h+1],s[h+l]),$v(i,t,n[h+l+1],n[h+1],n[h+l],s[h+l+1],s[h+1],s[h+l])}break;case X0.TRIANGLES:for(r=0,o=n.length;r<o;r+=3)$v(i,t,n[r],n[r+1],n[r+2],s[r],s[r+1],s[r+2]);break;default:throw new Error("illegal figure")}}class OL extends Ib{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,n){const l=Math.floor(this._bounds[0]),c=Math.floor(this._bounds[1]),u=Math.ceil(this._bounds[2])-l,h=Math.ceil(this._bounds[3])-c,d=Math.min(Math.ceil(Math.abs(u*e[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(h*e[1]*1.1)),3e3),p=u/d,v=h/f,b={coords:this._coords,colors:this._colors,offsetX:-l,offsetY:-c,scaleX:1/p,scaleY:1/v},S=d+2*2,m=f+2*2,_=n.getCanvas("mesh",S,m),w=_.context,E=w.createImageData(d,f);if(t){const C=E.data;for(let T=0,R=C.length;T<R;T+=4)C[T]=t[0],C[T+1]=t[1],C[T+2]=t[2],C[T+3]=255}for(const C of this._figures)DL(E,C,b);return w.putImageData(E,2,2),{canvas:_.canvas,offsetX:l-2*p,offsetY:c-2*v,scaleX:p,scaleY:v}}isModifyingCurrentTransform(){return!0}getPattern(e,t,n,s){Ew(e,this._bbox);const r=new Float32Array(2);if(s===zt.SHADING)G.singularValueDecompose2dScale(Xe(e),r);else if(this.matrix){G.singularValueDecompose2dScale(this.matrix,r);const[l,c]=r;G.singularValueDecompose2dScale(t.baseTransform,r),r[0]*=l,r[1]*=c}else G.singularValueDecompose2dScale(t.baseTransform,r);const o=this._createMeshCanvas(r,s===zt.SHADING?null:this._background,t.cachedCanvases);return s!==zt.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(o.offsetX,o.offsetY),e.scale(o.scaleX,o.scaleY),e.createPattern(o.canvas,"no-repeat")}}class ML extends Ib{getPattern(){return"hotpink"}}function NL(i){switch(i[0]){case"RadialAxial":return new IL(i);case"Mesh":return new OL(i);case"Dummy":return new ML}throw new Error(`Unknown IR type: ${i[0]}`)}const AS={COLORED:1,UNCOLORED:2},Ey=class Ey{constructor(e,t,n,s){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=n,this.baseTransform=s}createPatternCanvas(e,t){var x,P;const{bbox:n,operatorList:s,paintType:r,tilingType:o,color:l,canvasGraphicsFactory:c}=this;let{xstep:u,ystep:h}=this;u=Math.abs(u),h=Math.abs(h),Zy("TilingType: "+o);const d=n[0],f=n[1],p=n[2],v=n[3],b=p-d,S=v-f,m=new Float32Array(2);G.singularValueDecompose2dScale(this.matrix,m);const[_,w]=m;G.singularValueDecompose2dScale(this.baseTransform,m);const E=_*m[0],k=w*m[1];let C=b,T=S,R=!1,D=!1;const O=Math.ceil(u*E),B=Math.ceil(h*k),H=Math.ceil(b*E),Y=Math.ceil(S*k);O>=H?C=u:R=!0,B>=Y?T=h:D=!0;const X=this.getSizeAndScale(C,this.ctx.canvas.width,E),ee=this.getSizeAndScale(T,this.ctx.canvas.height,k),q=e.cachedCanvases.getCanvas("pattern",X.size,ee.size),M=q.context,L=c.createCanvasGraphics(M,t);if(L.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(L,r,l),M.translate(-X.scale*d,-ee.scale*f),L.transform(0,X.scale,0,0,ee.scale,0,0),M.save(),(x=L.dependencyTracker)==null||x.save(),this.clipBbox(L,d,f,p,v),L.baseTransform=Xe(L.ctx),L.executeOperatorList(s),L.endDrawing(),(P=L.dependencyTracker)==null||P.restore(),M.restore(),R||D){const I=q.canvas;R&&(C=u),D&&(T=h);const N=this.getSizeAndScale(C,this.ctx.canvas.width,E),$=this.getSizeAndScale(T,this.ctx.canvas.height,k),Q=N.size,we=$.size,_e=e.cachedCanvases.getCanvas("pattern-workaround",Q,we),ce=_e.context,kt=R?Math.floor(b/u):0,pa=D?Math.floor(S/h):0;for(let Fi=0;Fi<=kt;Fi++)for(let on=0;on<=pa;on++)ce.drawImage(I,Q*Fi,we*on,Q,we,0,0,Q,we);return{canvas:_e.canvas,scaleX:N.scale,scaleY:$.scale,offsetX:d,offsetY:f}}return{canvas:q.canvas,scaleX:X.scale,scaleY:ee.scale,offsetX:d,offsetY:f}}getSizeAndScale(e,t,n){const s=Math.max(Ey.MAX_PATTERN_SIZE,t);let r=Math.ceil(e*n);return r>=s?r=s:n=r/e,{scale:n,size:r}}clipBbox(e,t,n,s,r){const o=s-t,l=r-n;e.ctx.rect(t,n,o,l),G.axialAlignedBoundingBox([t,n,s,r],Xe(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){const s=e.ctx,r=e.current;switch(t){case AS.COLORED:const{fillStyle:o,strokeStyle:l}=this.ctx;s.fillStyle=r.fillColor=o,s.strokeStyle=r.strokeColor=l;break;case AS.UNCOLORED:s.fillStyle=s.strokeStyle=n,r.fillColor=r.strokeColor=n;break;default:throw new XR(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,n,s,r){let o=n;s!==zt.SHADING&&(o=G.transform(o,t.baseTransform),this.matrix&&(o=G.transform(o,this.matrix)));const l=this.createPatternCanvas(t,r);let c=new DOMMatrix(o);c=c.translate(l.offsetX,l.offsetY),c=c.scale(1/l.scaleX,1/l.scaleY);const u=e.createPattern(l.canvas,"repeat");return u.setTransform(c),u}};F(Ey,"MAX_PATTERN_SIZE",3e3);let kw=Ey;function FL({src:i,srcPos:e=0,dest:t,width:n,height:s,nonBlackColor:r=4294967295,inverseDecode:o=!1}){const l=Gt.isLittleEndian?4278190080:255,[c,u]=o?[r,l]:[l,r],h=n>>3,d=n&7,f=i.length;t=new Uint32Array(t.buffer);let p=0;for(let v=0;v<s;v++){for(const S=e+h;e<S;e++){const m=e<f?i[e]:255;t[p++]=m&128?u:c,t[p++]=m&64?u:c,t[p++]=m&32?u:c,t[p++]=m&16?u:c,t[p++]=m&8?u:c,t[p++]=m&4?u:c,t[p++]=m&2?u:c,t[p++]=m&1?u:c}if(d===0)continue;const b=e<f?i[e++]:255;for(let S=0;S<d;S++)t[p++]=b&1<<7-S?u:c}return{srcPos:e,destPos:p}}const SS=16,ES=100,BL=15,kS=10,Ln=16,Uv=new DOMMatrix,ri=new Float32Array(2),Fc=new Float32Array([1/0,1/0,-1/0,-1/0]);function jL(i,e){if(i._removeMirroring)throw new Error("Context is already forwarding operations.");i.__originalSave=i.save,i.__originalRestore=i.restore,i.__originalRotate=i.rotate,i.__originalScale=i.scale,i.__originalTranslate=i.translate,i.__originalTransform=i.transform,i.__originalSetTransform=i.setTransform,i.__originalResetTransform=i.resetTransform,i.__originalClip=i.clip,i.__originalMoveTo=i.moveTo,i.__originalLineTo=i.lineTo,i.__originalBezierCurveTo=i.bezierCurveTo,i.__originalRect=i.rect,i.__originalClosePath=i.closePath,i.__originalBeginPath=i.beginPath,i._removeMirroring=()=>{i.save=i.__originalSave,i.restore=i.__originalRestore,i.rotate=i.__originalRotate,i.scale=i.__originalScale,i.translate=i.__originalTranslate,i.transform=i.__originalTransform,i.setTransform=i.__originalSetTransform,i.resetTransform=i.__originalResetTransform,i.clip=i.__originalClip,i.moveTo=i.__originalMoveTo,i.lineTo=i.__originalLineTo,i.bezierCurveTo=i.__originalBezierCurveTo,i.rect=i.__originalRect,i.closePath=i.__originalClosePath,i.beginPath=i.__originalBeginPath,delete i._removeMirroring},i.save=function(){e.save(),this.__originalSave()},i.restore=function(){e.restore(),this.__originalRestore()},i.translate=function(t,n){e.translate(t,n),this.__originalTranslate(t,n)},i.scale=function(t,n){e.scale(t,n),this.__originalScale(t,n)},i.transform=function(t,n,s,r,o,l){e.transform(t,n,s,r,o,l),this.__originalTransform(t,n,s,r,o,l)},i.setTransform=function(t,n,s,r,o,l){e.setTransform(t,n,s,r,o,l),this.__originalSetTransform(t,n,s,r,o,l)},i.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},i.rotate=function(t){e.rotate(t),this.__originalRotate(t)},i.clip=function(t){e.clip(t),this.__originalClip(t)},i.moveTo=function(t,n){e.moveTo(t,n),this.__originalMoveTo(t,n)},i.lineTo=function(t,n){e.lineTo(t,n),this.__originalLineTo(t,n)},i.bezierCurveTo=function(t,n,s,r,o,l){e.bezierCurveTo(t,n,s,r,o,l),this.__originalBezierCurveTo(t,n,s,r,o,l)},i.rect=function(t,n,s,r){e.rect(t,n,s,r),this.__originalRect(t,n,s,r)},i.closePath=function(){e.closePath(),this.__originalClosePath()},i.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class $L{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n){let s;return this.cache[e]!==void 0?(s=this.cache[e],this.canvasFactory.reset(s,t,n)):(s=this.canvasFactory.create(t,n),this.cache[e]=s),s}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function Pg(i,e,t,n,s,r,o,l,c,u){const[h,d,f,p,v,b]=Xe(i);if(d===0&&f===0){const _=o*h+v,w=Math.round(_),E=l*p+b,k=Math.round(E),C=(o+c)*h+v,T=Math.abs(Math.round(C)-w)||1,R=(l+u)*p+b,D=Math.abs(Math.round(R)-k)||1;return i.setTransform(Math.sign(h),0,0,Math.sign(p),w,k),i.drawImage(e,t,n,s,r,0,0,T,D),i.setTransform(h,d,f,p,v,b),[T,D]}if(h===0&&p===0){const _=l*f+v,w=Math.round(_),E=o*d+b,k=Math.round(E),C=(l+u)*f+v,T=Math.abs(Math.round(C)-w)||1,R=(o+c)*d+b,D=Math.abs(Math.round(R)-k)||1;return i.setTransform(0,Math.sign(d),Math.sign(f),0,w,k),i.drawImage(e,t,n,s,r,0,0,D,T),i.setTransform(h,d,f,p,v,b),[D,T]}i.drawImage(e,t,n,s,r,o,l,c,u);const S=Math.hypot(h,d),m=Math.hypot(f,p);return[S*c,m*u]}class CS{constructor(e,t,n){F(this,"alphaIsShape",!1);F(this,"fontSize",0);F(this,"fontSizeScale",1);F(this,"textMatrix",null);F(this,"textMatrixScale",1);F(this,"fontMatrix",K0);F(this,"leading",0);F(this,"x",0);F(this,"y",0);F(this,"lineX",0);F(this,"lineY",0);F(this,"charSpacing",0);F(this,"wordSpacing",0);F(this,"textHScale",1);F(this,"textRenderingMode",Mt.FILL);F(this,"textRise",0);F(this,"fillColor","#000000");F(this,"strokeColor","#000000");F(this,"patternFill",!1);F(this,"patternStroke",!1);F(this,"fillAlpha",1);F(this,"strokeAlpha",1);F(this,"lineWidth",1);F(this,"activeSMask",null);F(this,"transferMaps","none");n==null||n(this),this.clipBox=new Float32Array([0,0,e,t]),this.minMax=Fc.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=zt.FILL,t=null){const n=this.minMax.slice();if(e===zt.STROKE){t||Me("Stroke bounding box must include transform."),G.singularValueDecompose2dScale(t,ri);const s=ri[0]*this.lineWidth/2,r=ri[1]*this.lineWidth/2;n[0]-=s,n[1]-=r,n[2]+=s,n[3]+=r}return n}updateClipFromPath(){const e=G.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(Fc,0)}getClippedPathBoundingBox(e=zt.FILL,t=null){return G.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function TS(i,e){if(e instanceof ImageData){i.putImageData(e,0,0);return}const t=e.height,n=e.width,s=t%Ln,r=(t-s)/Ln,o=s===0?r:r+1,l=i.createImageData(n,Ln);let c=0,u;const h=e.data,d=l.data;let f,p,v,b;if(e.kind===Yg.GRAYSCALE_1BPP){const S=h.byteLength,m=new Uint32Array(d.buffer,0,d.byteLength>>2),_=m.length,w=n+7>>3,E=4294967295,k=Gt.isLittleEndian?4278190080:255;for(f=0;f<o;f++){for(v=f<r?Ln:s,u=0,p=0;p<v;p++){const C=S-c;let T=0;const R=C>w?n:C*8-7,D=R&-8;let O=0,B=0;for(;T<D;T+=8)B=h[c++],m[u++]=B&128?E:k,m[u++]=B&64?E:k,m[u++]=B&32?E:k,m[u++]=B&16?E:k,m[u++]=B&8?E:k,m[u++]=B&4?E:k,m[u++]=B&2?E:k,m[u++]=B&1?E:k;for(;T<R;T++)O===0&&(B=h[c++],O=128),m[u++]=B&O?E:k,O>>=1}for(;u<_;)m[u++]=0;i.putImageData(l,0,f*Ln)}}else if(e.kind===Yg.RGBA_32BPP){for(p=0,b=n*Ln*4,f=0;f<r;f++)d.set(h.subarray(c,c+b)),c+=b,i.putImageData(l,0,p),p+=Ln;f<o&&(b=n*s*4,d.set(h.subarray(c,c+b)),i.putImageData(l,0,p))}else if(e.kind===Yg.RGB_24BPP)for(v=Ln,b=n*v,f=0;f<o;f++){for(f>=r&&(v=s,b=n*v),u=0,p=b;p--;)d[u++]=h[c++],d[u++]=h[c++],d[u++]=h[c++],d[u++]=255;i.putImageData(l,0,f*Ln)}else throw new Error(`bad image kind: ${e.kind}`)}function xS(i,e){if(e.bitmap){i.drawImage(e.bitmap,0,0);return}const t=e.height,n=e.width,s=t%Ln,r=(t-s)/Ln,o=s===0?r:r+1,l=i.createImageData(n,Ln);let c=0;const u=e.data,h=l.data;for(let d=0;d<o;d++){const f=d<r?Ln:s;({srcPos:c}=FL({src:u,srcPos:c,dest:h,width:n,height:f,nonBlackColor:0})),i.putImageData(l,0,d*Ln)}}function Hh(i,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const n of t)i[n]!==void 0&&(e[n]=i[n]);i.setLineDash!==void 0&&(e.setLineDash(i.getLineDash()),e.lineDashOffset=i.lineDashOffset)}function Rg(i){i.strokeStyle=i.fillStyle="#000000",i.fillRule="nonzero",i.globalAlpha=1,i.lineWidth=1,i.lineCap="butt",i.lineJoin="miter",i.miterLimit=10,i.globalCompositeOperation="source-over",i.font="10px sans-serif",i.setLineDash!==void 0&&(i.setLineDash([]),i.lineDashOffset=0);const{filter:e}=i;e!=="none"&&e!==""&&(i.filter="none")}function PS(i,e){if(e)return!0;G.singularValueDecompose2dScale(i,ri);const t=Math.fround(zs.pixelRatio*la.PDF_TO_CSS_UNITS);return ri[0]<=t&&ri[1]<=t}const UL=["butt","round","square"],zL=["miter","round","bevel"],HL={},RS={};var cs,Cw,Tw,xw;const qb=class qb{constructor(e,t,n,s,r,{optionalContentConfig:o,markedContentStack:l=null},c,u,h){y(this,cs);this.ctx=e,this.current=new CS(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=s,this.filterFactory=r,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=l||[],this.optionalContentConfig=o,this.cachedCanvases=new $L(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=c,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=u,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=h??null}getObject(e,t,n=null){var s;return typeof t=="string"?((s=this.dependencyTracker)==null||s.recordNamedDependency(e,t),t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t)):n}beginDrawing({transform:e,viewport:t,transparency:n=!1,background:s=null}){const r=this.ctx.canvas.width,o=this.ctx.canvas.height,l=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,r,o),this.ctx.fillStyle=l,n){const c=this.cachedCanvases.getCanvas("transparent",r,o);this.compositeCtx=this.ctx,this.transparentCanvas=c.canvas,this.ctx=c.context,this.ctx.save(),this.ctx.transform(...Xe(this.compositeCtx))}this.ctx.save(),Rg(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=Xe(this.ctx)}executeOperatorList(e,t,n,s,r){var m;const o=e.argsArray,l=e.fnArray;let c=t||0;const u=o.length;if(u===c)return c;const h=u-c>kS&&typeof n=="function",d=h?Date.now()+BL:0;let f=0;const p=this.commonObjs,v=this.objs;let b,S;for(;;){if(s!==void 0&&c===s.nextBreakPoint)return s.breakIt(c,n),c;if(!r||r(c))if(b=l[c],S=o[c]??null,b!==Yd.dependency)S===null?this[b](c):this[b](c,...S);else for(const _ of S){(m=this.dependencyTracker)==null||m.recordNamedData(_,c);const w=_.startsWith("g_")?p:v;if(!w.has(_))return w.get(_,n),c}if(c++,c===u)return c;if(h&&++f>kS){if(Date.now()>d)return n(),c;f=0}}}endDrawing(){A(this,cs,Cw).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),A(this,cs,Tw).call(this)}_scaleImage(e,t){const n=e.width??e.displayWidth,s=e.height??e.displayHeight;let r=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),l=n,c=s,u="prescale1",h,d;for(;r>2&&l>1||o>2&&c>1;){let f=l,p=c;r>2&&l>1&&(f=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l/2),r/=l/f),o>2&&c>1&&(p=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c)/2,o/=c/p),h=this.cachedCanvases.getCanvas(u,f,p),d=h.context,d.clearRect(0,0,f,p),d.drawImage(e,0,0,l,c,0,0,f,p),e=h.canvas,l=f,c=p,u=u==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:l,paintHeight:c}}_createMaskCanvas(e,t){var O,B;const n=this.ctx,{width:s,height:r}=t,o=this.current.fillColor,l=this.current.patternFill,c=Xe(n);let u,h,d,f;if((t.bitmap||t.data)&&t.count>1){const H=t.bitmap||t.data.buffer;h=JSON.stringify(l?c:[c.slice(0,4),o]),u=this._cachedBitmapsMap.get(H),u||(u=new Map,this._cachedBitmapsMap.set(H,u));const Y=u.get(h);if(Y&&!l){const X=Math.round(Math.min(c[0],c[2])+c[4]),ee=Math.round(Math.min(c[1],c[3])+c[5]);return(O=this.dependencyTracker)==null||O.recordDependencies(e,pi.transformAndFill),{canvas:Y,offsetX:X,offsetY:ee}}d=Y}d||(f=this.cachedCanvases.getCanvas("maskCanvas",s,r),xS(f.context,t));let p=G.transform(c,[1/s,0,0,-1/r,0,0]);p=G.transform(p,[1,0,0,1,0,-r]);const v=Fc.slice();G.axialAlignedBoundingBox([0,0,s,r],p,v);const[b,S,m,_]=v,w=Math.round(m-b)||1,E=Math.round(_-S)||1,k=this.cachedCanvases.getCanvas("fillCanvas",w,E),C=k.context,T=b,R=S;C.translate(-T,-R),C.transform(...p),d||(d=this._scaleImage(f.canvas,hs(C)),d=d.img,u&&l&&u.set(h,d)),C.imageSmoothingEnabled=PS(Xe(C),t.interpolate),Pg(C,d,0,0,d.width,d.height,0,0,s,r),C.globalCompositeOperation="source-in";const D=G.transform(hs(C),[1,0,0,1,-T,-R]);return C.fillStyle=l?o.getPattern(n,this,D,zt.FILL,e):o,C.fillRect(0,0,s,r),u&&!l&&(this.cachedCanvases.delete("fillCanvas"),u.set(h,k.canvas)),(B=this.dependencyTracker)==null||B.recordDependencies(e,pi.transformAndFill),{canvas:k.canvas,offsetX:Math.round(T),offsetY:Math.round(R)}}setLineWidth(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("lineWidth",e),t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("lineCap",e),this.ctx.lineCap=UL[t]}setLineJoin(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("lineJoin",e),this.ctx.lineJoin=zL[t]}setMiterLimit(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("miterLimit",e),this.ctx.miterLimit=t}setDash(e,t,n){var r;(r=this.dependencyTracker)==null||r.recordSimpleData("dash",e);const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(t),s.lineDashOffset=n)}setRenderingIntent(e,t){}setFlatness(e,t){}setGState(e,t){var n,s,r,o,l;for(const[c,u]of t)switch(c){case"LW":this.setLineWidth(e,u);break;case"LC":this.setLineCap(e,u);break;case"LJ":this.setLineJoin(e,u);break;case"ML":this.setMiterLimit(e,u);break;case"D":this.setDash(e,u[0],u[1]);break;case"RI":this.setRenderingIntent(e,u);break;case"FL":this.setFlatness(e,u);break;case"Font":this.setFont(e,u[0],u[1]);break;case"CA":(n=this.dependencyTracker)==null||n.recordSimpleData("strokeAlpha",e),this.current.strokeAlpha=u;break;case"ca":(s=this.dependencyTracker)==null||s.recordSimpleData("fillAlpha",e),this.ctx.globalAlpha=this.current.fillAlpha=u;break;case"BM":(r=this.dependencyTracker)==null||r.recordSimpleData("globalCompositeOperation",e),this.ctx.globalCompositeOperation=u;break;case"SMask":(o=this.dependencyTracker)==null||o.recordSimpleData("SMask",e),this.current.activeSMask=u?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":(l=this.dependencyTracker)==null||l.recordSimpleData("filter",e),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(u);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(e){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,n=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,r=this.cachedCanvases.getCanvas(s,t,n);this.suspendedCtx=this.ctx;const o=this.ctx=r.context;o.setTransform(this.suspendedCtx.getTransform()),Hh(this.suspendedCtx,o),jL(o,this.suspendedCtx),this.setGState(e,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Hh(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,n,s){const r=s[0],o=s[1],l=s[2]-r,c=s[3]-o;l===0||c===0||(this.genericComposeSMask(t.context,n,l,c,t.subtype,t.backdrop,t.transferMap,r,o,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())}genericComposeSMask(e,t,n,s,r,o,l,c,u,h,d){let f=e.canvas,p=c-h,v=u-d;if(o)if(p<0||v<0||p+n>f.width||v+s>f.height){const S=this.cachedCanvases.getCanvas("maskExtension",n,s),m=S.context;m.drawImage(f,-p,-v),m.globalCompositeOperation="destination-atop",m.fillStyle=o,m.fillRect(0,0,n,s),m.globalCompositeOperation="source-over",f=S.canvas,p=v=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const S=new Path2D;S.rect(p,v,n,s),e.clip(S),e.globalCompositeOperation="destination-atop",e.fillStyle=o,e.fillRect(p,v,n,s),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),r==="Alpha"&&l?t.filter=this.filterFactory.addAlphaFilter(l):r==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(l));const b=new Path2D;b.rect(c,u,n,s),t.clip(b),t.globalCompositeOperation="destination-in",t.drawImage(f,p,v,n,s,c,u,n,s),t.restore()}save(e){var n;this.inSMaskMode&&Hh(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone(),(n=this.dependencyTracker)==null||n.save(e)}restore(e){var t;if((t=this.dependencyTracker)==null||t.restore(e),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&Hh(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,n,s,r,o,l){var c;(c=this.dependencyTracker)==null||c.recordIncrementalData("transform",e),this.ctx.transform(t,n,s,r,o,l),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n,s){let[r]=n;if(!s){r||(r=n[0]=new Path2D),this[t](e,r);return}if(this.dependencyTracker!==null){const o=t===Yd.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(e).recordBBox(e,this.ctx,s[0]-o,s[2]+o,s[1]-o,s[3]+o).recordDependencies(e,["transform"])}r instanceof Path2D||(r=n[0]=kk(r)),G.axialAlignedBoundingBox(s,Xe(this.ctx),this.current.minMax),this[t](e,r),this._pathStartIdx=e}closePath(e){this.ctx.closePath()}stroke(e,t,n=!0){var o;const s=this.ctx,r=this.current.strokeColor;if(s.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof r=="object"&&(r!=null&&r.getPattern)){const l=r.isModifyingCurrentTransform()?s.getTransform():null;if(s.save(),s.strokeStyle=r.getPattern(s,this,hs(s),zt.STROKE,e),l){const c=new Path2D;c.addPath(t,s.getTransform().invertSelf().multiplySelf(l)),t=c}this.rescaleAndStroke(t,!1),s.restore()}else this.rescaleAndStroke(t,!0);(o=this.dependencyTracker)==null||o.recordDependencies(e,pi.stroke),n&&this.consumePath(e,t,this.current.getClippedPathBoundingBox(zt.STROKE,Xe(this.ctx))),s.globalAlpha=this.current.fillAlpha}closeStroke(e,t){this.stroke(e,t)}fill(e,t,n=!0){var u,h,d;const s=this.ctx,r=this.current.fillColor,o=this.current.patternFill;let l=!1;if(o){const f=r.isModifyingCurrentTransform()?s.getTransform():null;if((u=this.dependencyTracker)==null||u.save(e),s.save(),s.fillStyle=r.getPattern(s,this,hs(s),zt.FILL,e),f){const p=new Path2D;p.addPath(t,s.getTransform().invertSelf().multiplySelf(f)),t=p}l=!0}const c=this.current.getClippedPathBoundingBox();this.contentVisible&&c!==null&&(this.pendingEOFill?(s.fill(t,"evenodd"),this.pendingEOFill=!1):s.fill(t)),(h=this.dependencyTracker)==null||h.recordDependencies(e,pi.fill),l&&(s.restore(),(d=this.dependencyTracker)==null||d.restore(e)),n&&this.consumePath(e,t,c)}eoFill(e,t){this.pendingEOFill=!0,this.fill(e,t)}fillStroke(e,t){this.fill(e,t,!1),this.stroke(e,t,!1),this.consumePath(e,t)}eoFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}closeFillStroke(e,t){this.fillStroke(e,t)}closeEOFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}endPath(e,t){this.consumePath(e,t)}rawFillPath(e,t){var n;this.ctx.fill(t),(n=this.dependencyTracker)==null||n.recordDependencies(e,pi.rawFillPath).recordOperation(e)}clip(e){var t;(t=this.dependencyTracker)==null||t.recordFutureForcedDependency("clipMode",e),this.pendingClip=HL}eoClip(e){var t;(t=this.dependencyTracker)==null||t.recordFutureForcedDependency("clipMode",e),this.pendingClip=RS}beginText(e){var t;this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,(t=this.dependencyTracker)==null||t.recordOpenMarker(e).resetIncrementalData("sameLineText").resetIncrementalData("moveText",e)}endText(e){const t=this.pendingTextPaths,n=this.ctx;if(this.dependencyTracker){const{dependencyTracker:s}=this;t!==void 0&&s.recordFutureForcedDependency("textClip",s.getOpenMarker()).recordFutureForcedDependency("textClip",e),s.recordCloseMarker(e)}if(t!==void 0){const s=new Path2D,r=n.getTransform().invertSelf();for(const{transform:o,x:l,y:c,fontSize:u,path:h}of t)h&&s.addPath(h,new DOMMatrix(o).preMultiplySelf(r).translate(l,c).scale(u,-u));n.clip(s)}delete this.pendingTextPaths}setCharSpacing(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("charSpacing",e),this.current.charSpacing=t}setWordSpacing(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("wordSpacing",e),this.current.wordSpacing=t}setHScale(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("hScale",e),this.current.textHScale=t/100}setLeading(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("leading",e),this.current.leading=-t}setFont(e,t,n){var d,f;(d=this.dependencyTracker)==null||d.recordSimpleData("font",e).recordSimpleDataFromNamed("fontObj",t,e);const s=this.commonObjs.get(t),r=this.current;if(!s)throw new Error(`Can't find font for ${t}`);if(r.fontMatrix=s.fontMatrix||K0,(r.fontMatrix[0]===0||r.fontMatrix[3]===0)&&Z("Invalid font matrix for font "+t),n<0?(n=-n,r.fontDirection=-1):r.fontDirection=1,this.current.font=s,this.current.fontSize=n,s.isType3Font)return;const o=s.loadedName||"sans-serif",l=((f=s.systemFontInfo)==null?void 0:f.css)||`"${o}", ${s.fallbackName}`;let c="normal";s.black?c="900":s.bold&&(c="bold");const u=s.italic?"italic":"normal";let h=n;n<SS?h=SS:n>ES&&(h=ES),this.current.fontSizeScale=n/h,this.ctx.font=`${u} ${c} ${h}px ${l}`}setTextRenderingMode(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("textRenderingMode",e),this.current.textRenderingMode=t}setTextRise(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("textRise",e),this.current.textRise=t}moveText(e,t,n){var s;(s=this.dependencyTracker)==null||s.resetIncrementalData("sameLineText").recordIncrementalData("moveText",e),this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=n}setLeadingMoveText(e,t,n){this.setLeading(e,-n),this.moveText(e,t,n)}setTextMatrix(e,t){var s;(s=this.dependencyTracker)==null||s.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",e);const{current:n}=this;n.textMatrix=t,n.textMatrixScale=Math.hypot(t[0],t[1]),n.x=n.lineX=0,n.y=n.lineY=0}nextLine(e){var t;this.moveText(e,0,this.current.leading),(t=this.dependencyTracker)==null||t.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??e)}paintChar(e,t,n,s,r,o){var m,_,w,E;const l=this.ctx,c=this.current,u=c.font,h=c.textRenderingMode,d=c.fontSize/c.fontSizeScale,f=h&Mt.FILL_STROKE_MASK,p=!!(h&Mt.ADD_TO_PATH_FLAG),v=c.patternFill&&!u.missingFile,b=c.patternStroke&&!u.missingFile;let S;if((u.disableFontFace||p||v||b)&&!u.missingFile&&(S=u.getPathGenerator(this.commonObjs,t)),S&&(u.disableFontFace||v||b)){l.save(),l.translate(n,s),l.scale(d,-d),(m=this.dependencyTracker)==null||m.recordCharacterBBox(e,l,u);let k;if(f===Mt.FILL||f===Mt.FILL_STROKE)if(r){k=l.getTransform(),l.setTransform(...r);const C=A(this,cs,xw).call(this,S,k,r);l.fill(C)}else l.fill(S);if(f===Mt.STROKE||f===Mt.FILL_STROKE)if(o){k||(k=l.getTransform()),l.setTransform(...o);const{a:C,b:T,c:R,d:D}=k,O=G.inverseTransform(o),B=G.transform([C,T,R,D,0,0],O);G.singularValueDecompose2dScale(B,ri),l.lineWidth*=Math.max(ri[0],ri[1])/d,l.stroke(A(this,cs,xw).call(this,S,k,o))}else l.lineWidth/=d,l.stroke(S);l.restore()}else(f===Mt.FILL||f===Mt.FILL_STROKE)&&(l.fillText(t,n,s),(_=this.dependencyTracker)==null||_.recordCharacterBBox(e,l,u,d,n,s,()=>l.measureText(t))),(f===Mt.STROKE||f===Mt.FILL_STROKE)&&(this.dependencyTracker&&((w=this.dependencyTracker)==null||w.recordCharacterBBox(e,l,u,d,n,s,()=>l.measureText(t)).recordDependencies(e,pi.stroke)),l.strokeText(t,n,s));p&&((this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:Xe(l),x:n,y:s,fontSize:d,path:S}),(E=this.dependencyTracker)==null||E.recordCharacterBBox(e,l,u,d,n,s))}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let n=!1;for(let s=3;s<t.length;s+=4)if(t[s]>0&&t[s]<255){n=!0;break}return re(this,"isFontSubpixelAAEnabled",n)}showText(e,t){var R,D,O,B;this.dependencyTracker&&(this.dependencyTracker.recordDependencies(e,pi.showText).resetBBox(e),this.current.textRenderingMode&Mt.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",e).inheritPendingDependenciesAsFutureForcedDependencies());const n=this.current,s=n.font;if(s.isType3Font){this.showType3Text(e,t),(R=this.dependencyTracker)==null||R.recordShowTextOperation(e);return}const r=n.fontSize;if(r===0){(D=this.dependencyTracker)==null||D.recordOperation(e);return}const o=this.ctx,l=n.fontSizeScale,c=n.charSpacing,u=n.wordSpacing,h=n.fontDirection,d=n.textHScale*h,f=t.length,p=s.vertical,v=p?1:-1,b=s.defaultVMetrics,S=r*n.fontMatrix[0],m=n.textRenderingMode===Mt.FILL&&!s.disableFontFace&&!n.patternFill;o.save(),n.textMatrix&&o.transform(...n.textMatrix),o.translate(n.x,n.y+n.textRise),h>0?o.scale(d,-1):o.scale(d,1);let _,w;if(n.patternFill){o.save();const H=n.fillColor.getPattern(o,this,hs(o),zt.FILL,e);_=Xe(o),o.restore(),o.fillStyle=H}if(n.patternStroke){o.save();const H=n.strokeColor.getPattern(o,this,hs(o),zt.STROKE,e);w=Xe(o),o.restore(),o.strokeStyle=H}let E=n.lineWidth;const k=n.textMatrixScale;if(k===0||E===0){const H=n.textRenderingMode&Mt.FILL_STROKE_MASK;(H===Mt.STROKE||H===Mt.FILL_STROKE)&&(E=this.getSinglePixelWidth())}else E/=k;if(l!==1&&(o.scale(l,l),E/=l),o.lineWidth=E,s.isInvalidPDFjsFont){const H=[];let Y=0;for(const ee of t)H.push(ee.unicode),Y+=ee.width;const X=H.join("");if(o.fillText(X,0,0),this.dependencyTracker!==null){const ee=o.measureText(X);this.dependencyTracker.recordBBox(e,this.ctx,-ee.actualBoundingBoxLeft,ee.actualBoundingBoxRight,-ee.actualBoundingBoxAscent,ee.actualBoundingBoxDescent).recordShowTextOperation(e)}n.x+=Y*S*d,o.restore(),this.compose();return}let C=0,T;for(T=0;T<f;++T){const H=t[T];if(typeof H=="number"){C+=v*H*r/1e3;continue}let Y=!1;const X=(H.isSpace?u:0)+c,ee=H.fontChar,q=H.accent;let M,L,x=H.width;if(p){const N=H.vmetric||b,$=-(H.vmetric?N[1]:x*.5)*S,Q=N[2]*S;x=N?-N[0]:x,M=$/l,L=(C+Q)/l}else M=C/l,L=0;let P;if(s.remeasure&&x>0){P=o.measureText(ee);const N=P.width*1e3/r*l;if(x<N&&this.isFontSubpixelAAEnabled){const $=x/N;Y=!0,o.save(),o.scale($,1),M/=$}else x!==N&&(M+=(x-N)/2e3*r/l)}if(this.contentVisible&&(H.isInFont||s.missingFile)){if(m&&!q)o.fillText(ee,M,L),(O=this.dependencyTracker)==null||O.recordCharacterBBox(e,o,P?{bbox:null}:s,r/l,M,L,()=>P??o.measureText(ee));else if(this.paintChar(e,ee,M,L,_,w),q){const N=M+r*q.offset.x/l,$=L-r*q.offset.y/l;this.paintChar(e,q.fontChar,N,$,_,w)}}const I=p?x*S-X*h:x*S+X*h;C+=I,Y&&o.restore()}p?n.y-=C:n.x+=C*d,o.restore(),this.compose(),(B=this.dependencyTracker)==null||B.recordShowTextOperation(e)}showType3Text(e,t){const n=this.ctx,s=this.current,r=s.font,o=s.fontSize,l=s.fontDirection,c=r.vertical?1:-1,u=s.charSpacing,h=s.wordSpacing,d=s.textHScale*l,f=s.fontMatrix||K0,p=t.length,v=s.textRenderingMode===Mt.INVISIBLE;let b,S,m,_;if(v||o===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,n.save(),s.textMatrix&&n.transform(...s.textMatrix),n.translate(s.x,s.y+s.textRise),n.scale(d,l);const w=this.dependencyTracker;for(this.dependencyTracker=w?new oy(w,e):null,b=0;b<p;++b){if(S=t[b],typeof S=="number"){_=c*S*o/1e3,this.ctx.translate(_,0),s.x+=_*d;continue}const E=(S.isSpace?h:0)+u,k=r.charProcOperatorList[S.operatorListId];k?this.contentVisible&&(this.save(),n.scale(o,o),n.transform(...f),this.executeOperatorList(k),this.restore()):Z(`Type3 character "${S.operatorListId}" is not available.`);const C=[S.width,0];G.applyTransform(C,f),m=C[0]*o+E,n.translate(m,0),s.x+=m*d}n.restore(),w&&(this.dependencyTracker=w)}setCharWidth(e,t,n){}setCharWidthAndBounds(e,t,n,s,r,o,l){var u;const c=new Path2D;c.rect(s,r,o-s,l-r),this.ctx.clip(c),(u=this.dependencyTracker)==null||u.recordBBox(e,this.ctx,s,o,r,l).recordClipBox(e,this.ctx,s,o,r,l),this.endPath(e)}getColorN_Pattern(e,t){let n;if(t[0]==="TilingPattern"){const s=this.baseTransform||Xe(this.ctx),r={createCanvasGraphics:(o,l)=>new qb(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new oy(this.dependencyTracker,l,!0):null)};n=new kw(t,this.ctx,r,s)}else n=this._getPattern(e,t[1],t[2]);return n}setStrokeColorN(e,...t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("strokeColor",e),this.current.strokeColor=this.getColorN_Pattern(e,t),this.current.patternStroke=!0}setFillColorN(e,...t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("fillColor",e),this.current.fillColor=this.getColorN_Pattern(e,t),this.current.patternFill=!0}setStrokeRGBColor(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(e){var t;(t=this.dependencyTracker)==null||t.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(e){var t;(t=this.dependencyTracker)==null||t.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t,n=null){let s;return this.cachedPatterns.has(t)?s=this.cachedPatterns.get(t):(s=NL(this.getObject(e,t)),this.cachedPatterns.set(t,s)),n&&(s.matrix=n),s}shadingFill(e,t){var o;if(!this.contentVisible)return;const n=this.ctx;this.save(e);const s=this._getPattern(e,t);n.fillStyle=s.getPattern(n,this,hs(n),zt.SHADING,e);const r=hs(n);if(r){const{width:l,height:c}=n.canvas,u=Fc.slice();G.axialAlignedBoundingBox([0,0,l,c],r,u);const[h,d,f,p]=u;this.ctx.fillRect(h,d,f-h,p-d)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);(o=this.dependencyTracker)==null||o.resetBBox(e).recordFullPageBBox(e).recordDependencies(e,pi.transform).recordDependencies(e,pi.fill).recordOperation(e),this.compose(this.current.getClippedPathBoundingBox()),this.restore(e)}beginInlineImage(){Me("Should not call beginInlineImage")}beginImageData(){Me("Should not call beginImageData")}paintFormXObjectBegin(e,t,n){var s;if(this.contentVisible&&(this.save(e),this.baseTransformStack.push(this.baseTransform),t&&this.transform(e,...t),this.baseTransform=Xe(this.ctx),n)){G.axialAlignedBoundingBox(n,this.baseTransform,this.current.minMax);const[r,o,l,c]=n,u=new Path2D;u.rect(r,o,l-r,c-o),this.ctx.clip(u),(s=this.dependencyTracker)==null||s.recordClipBox(e,this.ctx,r,l,o,c),this.endPath(e)}}paintFormXObjectEnd(e){this.contentVisible&&(this.restore(e),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e,t){var w;if(!this.contentVisible)return;this.save(e),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const n=this.ctx;t.isolated||Zy("TODO: Support non-isolated groups."),t.knockout&&Z("Knockout groups not supported.");const s=Xe(n);if(t.matrix&&n.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let r=Fc.slice();G.axialAlignedBoundingBox(t.bbox,Xe(n),r);const o=[0,0,n.canvas.width,n.canvas.height];r=G.intersect(r,o)||[0,0,0,0];const l=Math.floor(r[0]),c=Math.floor(r[1]),u=Math.max(Math.ceil(r[2])-l,1),h=Math.max(Math.ceil(r[3])-c,1);this.current.startNewPathAndClipBox([0,0,u,h]);let d="groupAt"+this.groupLevel;t.smask&&(d+="_smask_"+this.smaskCounter++%2);const f=this.cachedCanvases.getCanvas(d,u,h),p=f.context;p.translate(-l,-c),p.transform(...s);let v=new Path2D;const[b,S,m,_]=t.bbox;if(v.rect(b,S,m-b,_-S),t.matrix){const E=new Path2D;E.addPath(v,new DOMMatrix(t.matrix)),v=E}p.clip(v),t.smask&&this.smaskStack.push({canvas:f.canvas,context:p,offsetX:l,offsetY:c,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}),(!t.smask||this.dependencyTracker)&&(n.setTransform(1,0,0,1,0,0),n.translate(l,c),n.save()),Hh(n,p),this.ctx=p,(w=this.dependencyTracker)==null||w.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(n),this.setGState(e,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(n),this.groupLevel++}endGroup(e,t){var r;if(!this.contentVisible)return;this.groupLevel--;const n=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,(r=this.dependencyTracker)==null||r.popBaseTransform(),t.smask)this.tempSMask=this.smaskStack.pop(),this.restore(e),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const o=Xe(this.ctx);this.restore(e),this.ctx.save(),this.ctx.setTransform(...o);const l=Fc.slice();G.axialAlignedBoundingBox([0,0,n.canvas.width,n.canvas.height],o,l),this.ctx.drawImage(n.canvas,0,0),this.ctx.restore(),this.compose(l)}}beginAnnotation(e,t,n,s,r,o){if(A(this,cs,Cw).call(this),Rg(this.ctx),this.ctx.save(),this.save(e),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),n){const l=n[2]-n[0],c=n[3]-n[1];if(o&&this.annotationCanvasMap){s=s.slice(),s[4]-=n[0],s[5]-=n[1],n=n.slice(),n[0]=n[1]=0,n[2]=l,n[3]=c,G.singularValueDecompose2dScale(Xe(this.ctx),ri);const{viewportScale:u}=this,h=Math.ceil(l*this.outputScaleX*u),d=Math.ceil(c*this.outputScaleY*u);this.annotationCanvas=this.canvasFactory.create(h,d);const{canvas:f,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(t,f),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(ri[0],0,0,-ri[1],0,c*ri[1]),Rg(this.ctx)}else{Rg(this.ctx),this.endPath(e);const u=new Path2D;u.rect(n[0],n[1],l,c),this.ctx.clip(u)}}this.current=new CS(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(e,...s),this.transform(e,...r)}endAnnotation(e){this.annotationCanvas&&(this.ctx.restore(),A(this,cs,Tw).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e,t){var l;if(!this.contentVisible)return;const n=t.count;t=this.getObject(e,t.data,t),t.count=n;const s=this.ctx,r=this._createMaskCanvas(e,t),o=r.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(o,r.offsetX,r.offsetY),(l=this.dependencyTracker)==null||l.resetBBox(e).recordBBox(e,this.ctx,r.offsetX,r.offsetX+o.width,r.offsetY,r.offsetY+o.height).recordOperation(e),s.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,n,s=0,r=0,o,l){var d,f,p;if(!this.contentVisible)return;t=this.getObject(e,t.data,t);const c=this.ctx;c.save();const u=Xe(c);c.transform(n,s,r,o,0,0);const h=this._createMaskCanvas(e,t);c.setTransform(1,0,0,1,h.offsetX-u[4],h.offsetY-u[5]),(d=this.dependencyTracker)==null||d.resetBBox(e);for(let v=0,b=l.length;v<b;v+=2){const S=G.transform(u,[n,s,r,o,l[v],l[v+1]]);c.drawImage(h.canvas,S[4],S[5]),(f=this.dependencyTracker)==null||f.recordBBox(e,this.ctx,S[4],S[4]+h.canvas.width,S[5],S[5]+h.canvas.height)}c.restore(),this.compose(),(p=this.dependencyTracker)==null||p.recordOperation(e)}paintImageMaskXObjectGroup(e,t){var o,l,c;if(!this.contentVisible)return;const n=this.ctx,s=this.current.fillColor,r=this.current.patternFill;(o=this.dependencyTracker)==null||o.resetBBox(e).recordDependencies(e,pi.transformAndFill);for(const u of t){const{data:h,width:d,height:f,transform:p}=u,v=this.cachedCanvases.getCanvas("maskCanvas",d,f),b=v.context;b.save();const S=this.getObject(e,h,u);xS(b,S),b.globalCompositeOperation="source-in",b.fillStyle=r?s.getPattern(b,this,hs(n),zt.FILL,e):s,b.fillRect(0,0,d,f),b.restore(),n.save(),n.transform(...p),n.scale(1,-1),Pg(n,v.canvas,0,0,d,f,0,-1,1,1),(l=this.dependencyTracker)==null||l.recordBBox(e,n,0,d,0,f),n.restore()}this.compose(),(c=this.dependencyTracker)==null||c.recordOperation(e)}paintImageXObject(e,t){if(!this.contentVisible)return;const n=this.getObject(e,t);if(!n){Z("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e,n)}paintImageXObjectRepeat(e,t,n,s,r){if(!this.contentVisible)return;const o=this.getObject(e,t);if(!o){Z("Dependent image isn't ready yet");return}const l=o.width,c=o.height,u=[];for(let h=0,d=r.length;h<d;h+=2)u.push({transform:[n,0,0,s,r[h],r[h+1]],x:0,y:0,w:l,h:c});this.paintInlineImageXObjectGroup(e,o,u)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:n,height:s}=e,r=this.cachedCanvases.getCanvas("inlineImage",n,s),o=r.context;return o.filter=this.current.transferMaps,o.drawImage(t,0,0),o.filter="none",r.canvas}paintInlineImageXObject(e,t){var u;if(!this.contentVisible)return;const n=t.width,s=t.height,r=this.ctx;this.save(e);const{filter:o}=r;o!=="none"&&o!==""&&(r.filter="none"),r.scale(1/n,-1/s);let l;if(t.bitmap)l=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)l=t;else{const d=this.cachedCanvases.getCanvas("inlineImage",n,s).context;TS(d,t),l=this.applyTransferMapsToCanvas(d)}const c=this._scaleImage(l,hs(r));r.imageSmoothingEnabled=PS(Xe(r),t.interpolate),(u=this.dependencyTracker)==null||u.resetBBox(e).recordBBox(e,r,0,n,-s,0).recordDependencies(e,pi.imageXObject).recordOperation(e),Pg(r,c.img,0,0,c.paintWidth,c.paintHeight,0,-s,n,s),this.compose(),this.restore(e)}paintInlineImageXObjectGroup(e,t,n){var o,l,c;if(!this.contentVisible)return;const s=this.ctx;let r;if(t.bitmap)r=t.bitmap;else{const u=t.width,h=t.height,f=this.cachedCanvases.getCanvas("inlineImage",u,h).context;TS(f,t),r=this.applyTransferMapsToCanvas(f)}(o=this.dependencyTracker)==null||o.resetBBox(e);for(const u of n)s.save(),s.transform(...u.transform),s.scale(1,-1),Pg(s,r,u.x,u.y,u.w,u.h,0,-1,1,1),(l=this.dependencyTracker)==null||l.recordBBox(e,s,0,1,-1,0),s.restore();(c=this.dependencyTracker)==null||c.recordOperation(e),this.compose()}paintSolidColorImageMask(e){var t;this.contentVisible&&((t=this.dependencyTracker)==null||t.resetBBox(e).recordBBox(e,this.ctx,0,1,0,1).recordDependencies(e,pi.fill).recordOperation(e),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e,t){}markPointProps(e,t,n){}beginMarkedContent(e,t){var n;(n=this.dependencyTracker)==null||n.beginMarkedContent(e),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t,n){var s;(s=this.dependencyTracker)==null||s.beginMarkedContent(e),t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(n)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(e){var t;(t=this.dependencyTracker)==null||t.endMarkedContent(e),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(e){}endCompat(e){}consumePath(e,t,n){var o,l;const s=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(n);const r=this.ctx;this.pendingClip?(s||(this.pendingClip===RS?r.clip(t,"evenodd"):r.clip(t)),this.pendingClip=null,(o=this.dependencyTracker)==null||o.bboxToClipBoxDropOperation(e).recordFutureForcedDependency("clipPath",e)):(l=this.dependencyTracker)==null||l.recordOperation(e),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=Xe(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),s=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,s)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:n,c:s,d:r}=this.ctx.getTransform();let o,l;if(n===0&&s===0){const c=Math.abs(t),u=Math.abs(r);if(c===u)if(e===0)o=l=1/c;else{const h=c*e;o=l=h<1?1/h:1}else if(e===0)o=1/c,l=1/u;else{const h=c*e,d=u*e;o=h<1?1/h:1,l=d<1?1/d:1}}else{const c=Math.abs(t*r-n*s),u=Math.hypot(t,n),h=Math.hypot(s,r);if(e===0)o=h/c,l=u/c;else{const d=e*c;o=h>d?h/d:1,l=u>d?u/d:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=l}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:n,current:{lineWidth:s}}=this,[r,o]=this.getScaleForStroking();if(r===o){n.lineWidth=(s||1)*r,n.stroke(e);return}const l=n.getLineDash();t&&n.save(),n.scale(r,o),Uv.a=1/r,Uv.d=1/o;const c=new Path2D;if(c.addPath(e,Uv),l.length>0){const u=Math.max(r,o);n.setLineDash(l.map(h=>h/u)),n.lineDashOffset/=u}n.lineWidth=s||1,n.stroke(c),t&&n.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};cs=new WeakSet,Cw=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Tw=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},xw=function(e,t,n){const s=new Path2D;return s.addPath(e,new DOMMatrix(n).invertSelf().multiplySelf(t)),s};let Kc=qb;for(const i in Yd)Kc.prototype[i]!==void 0&&(Kc.prototype[Yd[i]]=Kc.prototype[i]);var Hf,Wf;class ss{static get workerPort(){return a(this,Hf)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");g(this,Hf,e)}static get workerSrc(){return a(this,Wf)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");g(this,Wf,e)}}Hf=new WeakMap,Wf=new WeakMap,y(ss,Hf,null),y(ss,Wf,"");var Ru,Vf;class WL{constructor({parsedData:e,rawData:t}){y(this,Ru);y(this,Vf);g(this,Ru,e),g(this,Vf,t)}getRaw(){return a(this,Vf)}get(e){return a(this,Ru).get(e)??null}[Symbol.iterator](){return a(this,Ru).entries()}}Ru=new WeakMap,Vf=new WeakMap;const wc=Symbol("INTERNAL");var Gf,qf,Kf,Lu;class VL{constructor(e,{name:t,intent:n,usage:s,rbGroups:r}){y(this,Gf,!1);y(this,qf,!1);y(this,Kf,!1);y(this,Lu,!0);g(this,Gf,!!(e&ii.DISPLAY)),g(this,qf,!!(e&ii.PRINT)),this.name=t,this.intent=n,this.usage=s,this.rbGroups=r}get visible(){if(a(this,Kf))return a(this,Lu);if(!a(this,Lu))return!1;const{print:e,view:t}=this.usage;return a(this,Gf)?(t==null?void 0:t.viewState)!=="OFF":a(this,qf)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,n=!1){e!==wc&&Me("Internal method `_setVisible` called."),g(this,Kf,n),g(this,Lu,t)}}Gf=new WeakMap,qf=new WeakMap,Kf=new WeakMap,Lu=new WeakMap;var Eo,Re,Iu,Du,Xf,Pw;class GL{constructor(e,t=ii.DISPLAY){y(this,Xf);y(this,Eo,null);y(this,Re,new Map);y(this,Iu,null);y(this,Du,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,g(this,Du,e.order);for(const n of e.groups)a(this,Re).set(n.id,new VL(t,n));if(e.baseState==="OFF")for(const n of a(this,Re).values())n._setVisible(wc,!1);for(const n of e.on)a(this,Re).get(n)._setVisible(wc,!0);for(const n of e.off)a(this,Re).get(n)._setVisible(wc,!1);g(this,Iu,this.getHash())}}isVisible(e){if(a(this,Re).size===0)return!0;if(!e)return Zy("Optional content group not defined."),!0;if(e.type==="OCG")return a(this,Re).has(e.id)?a(this,Re).get(e.id).visible:(Z(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return A(this,Xf,Pw).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!a(this,Re).has(t))return Z(`Optional content group not found: ${t}`),!0;if(a(this,Re).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!a(this,Re).has(t))return Z(`Optional content group not found: ${t}`),!0;if(!a(this,Re).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!a(this,Re).has(t))return Z(`Optional content group not found: ${t}`),!0;if(!a(this,Re).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!a(this,Re).has(t))return Z(`Optional content group not found: ${t}`),!0;if(a(this,Re).get(t).visible)return!1}return!0}return Z(`Unknown optional content policy ${e.policy}.`),!0}return Z(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,n=!0){var r;const s=a(this,Re).get(e);if(!s){Z(`Optional content group not found: ${e}`);return}if(n&&t&&s.rbGroups.length)for(const o of s.rbGroups)for(const l of o)l!==e&&((r=a(this,Re).get(l))==null||r._setVisible(wc,!1,!0));s._setVisible(wc,!!t,!0),g(this,Eo,null)}setOCGState({state:e,preserveRB:t}){let n;for(const s of e){switch(s){case"ON":case"OFF":case"Toggle":n=s;continue}const r=a(this,Re).get(s);if(r)switch(n){case"ON":this.setVisibility(s,!0,t);break;case"OFF":this.setVisibility(s,!1,t);break;case"Toggle":this.setVisibility(s,!r.visible,t);break}}g(this,Eo,null)}get hasInitialVisibility(){return a(this,Iu)===null||this.getHash()===a(this,Iu)}getOrder(){return a(this,Re).size?a(this,Du)?a(this,Du).slice():[...a(this,Re).keys()]:null}getGroup(e){return a(this,Re).get(e)||null}getHash(){if(a(this,Eo)!==null)return a(this,Eo);const e=new iC;for(const[t,n]of a(this,Re))e.update(`${t}:${n.visible}`);return g(this,Eo,e.hexdigest())}[Symbol.iterator](){return a(this,Re).entries()}}Eo=new WeakMap,Re=new WeakMap,Iu=new WeakMap,Du=new WeakMap,Xf=new WeakSet,Pw=function(e){const t=e.length;if(t<2)return!0;const n=e[0];for(let s=1;s<t;s++){const r=e[s];let o;if(Array.isArray(r))o=A(this,Xf,Pw).call(this,r);else if(a(this,Re).has(r))o=a(this,Re).get(r).visible;else return Z(`Optional content group not found: ${r}`),!0;switch(n){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return n==="And"};class qL{constructor(e,{disableRange:t=!1,disableStream:n=!1}){ge(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:s,initialData:r,progressiveDone:o,contentDispositionFilename:l}=e;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=l,(r==null?void 0:r.length)>0){const c=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(c)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!n,this._isRangeSupported=!t,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((c,u)=>{this._onReceiveData({begin:c,chunk:u})}),e.addProgressListener((c,u)=>{this._onProgress({loaded:c,total:u})}),e.addProgressiveReadListener(c=>{this._onReceiveData({chunk:c})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const n=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{const s=this._rangeReaders.some(function(r){return r._begin!==e?!1:(r._enqueue(n),!0)});ge(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,n,s,r;e.total===void 0?(n=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||n.call(t,{loaded:e.loaded}):(r=(s=this._fullRequestReader)==null?void 0:s.onProgress)==null||r.call(s,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){ge(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new KL(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new XL(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeReaders.slice(0))n.cancel(e);this._pdfDataRangeTransport.abort()}}class KL{constructor(e,t,n=!1,s=null){this._stream=e,this._done=n||!1,this._filename=Pb(s)?s:null,this._queuedChunks=t||[],this._loaded=0;for(const r of this._queuedChunks)this._loaded+=r.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class XL{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function YL(i){let e=!0,t=n("filename\\*","i").exec(i);if(t){t=t[1];let h=l(t);return h=unescape(h),h=c(h),h=u(h),r(h)}if(t=o(i),t){const h=u(t);return r(h)}if(t=n("filename","i").exec(i),t){t=t[1];let h=l(t);return h=u(h),r(h)}function n(h,d){return new RegExp("(?:^|;)\\s*"+h+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',d)}function s(h,d){if(h){if(!/^[\x00-\xFF]+$/.test(d))return d;try{const f=new TextDecoder(h,{fatal:!0}),p=Qp(d);d=f.decode(p),e=!1}catch{}}return d}function r(h){return e&&/[\x80-\xff]/.test(h)&&(h=s("utf-8",h),e&&(h=s("iso-8859-1",h))),h}function o(h){const d=[];let f;const p=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=p.exec(h))!==null;){let[,b,S,m]=f;if(b=parseInt(b,10),b in d){if(b===0)break;continue}d[b]=[S,m]}const v=[];for(let b=0;b<d.length&&b in d;++b){let[S,m]=d[b];m=l(m),S&&(m=unescape(m),b===0&&(m=c(m))),v.push(m)}return v.join("")}function l(h){if(h.startsWith('"')){const d=h.slice(1).split('\\"');for(let f=0;f<d.length;++f){const p=d[f].indexOf('"');p!==-1&&(d[f]=d[f].slice(0,p),d.length=f+1),d[f]=d[f].replaceAll(/\\(.)/g,"$1")}h=d.join('"')}return h}function c(h){const d=h.indexOf("'");if(d===-1)return h;const f=h.slice(0,d),v=h.slice(d+1).replace(/^[^']*'/,"");return s(f,v)}function u(h){return!h.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(h)?h:h.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(d,f,p,v){if(p==="q"||p==="Q")return v=v.replaceAll("_"," "),v=v.replaceAll(/=([0-9a-fA-F]{2})/g,function(b,S){return String.fromCharCode(parseInt(S,16))}),s(f,v);try{v=atob(v)}catch{}return s(f,v)})}return""}function gC(i,e){const t=new Headers;if(!i||!e||typeof e!="object")return t;for(const n in e){const s=e[n];s!==void 0&&t.append(n,s)}return t}function tv(i){var e;return((e=URL.parse(i))==null?void 0:e.origin)??null}function mC({responseHeaders:i,isHttp:e,rangeChunkSize:t,disableRange:n}){const s={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(i.get("Content-Length"),10);return!Number.isInteger(r)||(s.suggestedLength=r,r<=2*t)||n||!e||i.get("Accept-Ranges")!=="bytes"||(i.get("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function yC(i){const e=i.get("Content-Disposition");if(e){let t=YL(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(Pb(t))return t}return null}function ng(i,e){return new ey(`Unexpected server response (${i}) while retrieving PDF "${e}".`,i,i===404||i===0&&e.startsWith("file:"))}function vC(i){return i===200||i===206}function wC(i,e,t){return{method:"GET",headers:i,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function _C(i){return i instanceof Uint8Array?i.buffer:i instanceof ArrayBuffer?i:(Z(`getArrayBuffer - unexpected data format: ${i}`),new Uint8Array(i).buffer)}class QL{constructor(e){F(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=gC(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return ge(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new JL(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new ZL(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class JL{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const n=new Headers(e.headers),s=t.url;fetch(s,wC(n,this._withCredentials,this._abortController)).then(r=>{if(e._responseOrigin=tv(r.url),!vC(r.status))throw ng(r.status,s);this._reader=r.body.getReader(),this._headersCapability.resolve();const o=r.headers,{allowRangeRequests:l,suggestedLength:c}=mC({responseHeaders:o,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=l,this._contentLength=c||this._contentLength,this._filename=yC(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new aa("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:_C(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class ZL{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;const s=e.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController;const r=new Headers(e.headers);r.append("Range",`bytes=${t}-${n-1}`);const o=s.url;fetch(o,wC(r,this._withCredentials,this._abortController)).then(l=>{const c=tv(l.url);if(c!==e._responseOrigin)throw new Error(`Expected range response-origin "${c}" to match "${e._responseOrigin}".`);if(!vC(l.status))throw ng(l.status,o);this._readCapability.resolve(),this._reader=l.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:_C(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const zv=200,Hv=206;function eI(i){const e=i.response;return typeof e!="string"?e:Qp(e).buffer}class tI{constructor({url:e,httpHeaders:t,withCredentials:n}){F(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=gC(this.isHttp,t),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,n=this.currXhrId++,s=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[r,o]of this.headers)t.setRequestHeader(r,o);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),s.expectedStatus=Hv):s.expectedStatus=zv,t.responseType="arraybuffer",ge(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),s.onHeadersReceived=e.onHeadersReceived,s.onDone=e.onDone,s.onError=e.onError,s.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){var s;const n=this.pendingRequests[e];n&&((s=n.onProgress)==null||s.call(n,t))}onStateChange(e,t){const n=this.pendingRequests[e];if(!n)return;const s=n.xhr;if(s.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),s.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],s.status===0&&this.isHttp){n.onError(s.status);return}const r=s.status||zv;if(!(r===zv&&n.expectedStatus===Hv)&&r!==n.expectedStatus){n.onError(s.status);return}const l=eI(s);if(r===Hv){const c=s.getResponseHeader("Content-Range"),u=/bytes (\d+)-(\d+)\/(\d+)/.exec(c);u?n.onDone({begin:parseInt(u[1],10),chunk:l}):(Z('Missing or invalid "Content-Range" header.'),n.onError(0))}else l?n.onDone({begin:0,chunk:l}):n.onError(s.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class nI{constructor(e){this._source=e,this._manager=new tI(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return ge(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new iI(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const n=new sI(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class iI{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=tv(t.responseURL);const n=t.getAllResponseHeaders(),s=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(l=>{const[c,...u]=l.split(": ");return[c,u.join(": ")]}):[]),{allowRangeRequests:r,suggestedLength:o}=mC({responseHeaders:s,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});r&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=yC(s),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=ng(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class sI{constructor(e,t,n){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=tv((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=ng(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const rI=/^[a-z][a-z0-9\-+.]+:/i;function oI(i){if(rI.test(i))return new URL(i);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(i))}class aI{constructor(e){this.source=e,this.url=oI(e.url),ge(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return ge(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new lI(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new cI(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class lI{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(s=>{this._contentLength=s.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=ng(0,this._url.href)),this._storedError=s,this._headersCapability.reject(s)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new aa("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class cI{constructor(e,t,n){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const s=e.source;this._isStreamingSupported=!s.disableStream;const r=process.getBuiltinModule("fs");this._setReadableStream(r.createReadStream(this._url,{start:t,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Wh=Symbol("INITIAL_DATA");var Hn,Yf,Rw;class bC{constructor(){y(this,Yf);y(this,Hn,Object.create(null))}get(e,t=null){if(t){const s=A(this,Yf,Rw).call(this,e);return s.promise.then(()=>t(s.data)),null}const n=a(this,Hn)[e];if(!n||n.data===Wh)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){const t=a(this,Hn)[e];return!!t&&t.data!==Wh}delete(e){const t=a(this,Hn)[e];return!t||t.data===Wh?!1:(delete a(this,Hn)[e],!0)}resolve(e,t=null){const n=A(this,Yf,Rw).call(this,e);n.data=t,n.resolve()}clear(){var e;for(const t in a(this,Hn)){const{data:n}=a(this,Hn)[t];(e=n==null?void 0:n.bitmap)==null||e.close()}g(this,Hn,Object.create(null))}*[Symbol.iterator](){for(const e in a(this,Hn)){const{data:t}=a(this,Hn)[e];t!==Wh&&(yield[e,t])}}}Hn=new WeakMap,Yf=new WeakSet,Rw=function(e){var t;return(t=a(this,Hn))[e]||(t[e]={...Promise.withResolvers(),data:Wh})};const uI=1e5,LS=30;var i1,ko,xn,Qf,Jf,ll,mr,Zf,ep,cl,Ou,Mu,Co,Nu,tp,Fu,ul,np,ip,Bu,hl,sp,To,ju,Vr,AC,SC,Lw,ci,am,Iw,EC,kC;const yt=class yt{constructor({textContentSource:e,container:t,viewport:n}){y(this,Vr);y(this,ko,Promise.withResolvers());y(this,xn,null);y(this,Qf,!1);y(this,Jf,!!((i1=globalThis.FontInspector)!=null&&i1.enabled));y(this,ll,null);y(this,mr,null);y(this,Zf,0);y(this,ep,0);y(this,cl,null);y(this,Ou,null);y(this,Mu,0);y(this,Co,0);y(this,Nu,Object.create(null));y(this,tp,[]);y(this,Fu,null);y(this,ul,[]);y(this,np,new WeakMap);y(this,ip,null);var c;if(e instanceof ReadableStream)g(this,Fu,e);else if(typeof e=="object")g(this,Fu,new ReadableStream({start(u){u.enqueue(e),u.close()}}));else throw new Error('No "textContentSource" parameter specified.');g(this,xn,g(this,Ou,t)),g(this,Co,n.scale*zs.pixelRatio),g(this,Mu,n.rotation),g(this,mr,{div:null,properties:null,ctx:null});const{pageWidth:s,pageHeight:r,pageX:o,pageY:l}=n.rawDims;g(this,ip,[1,0,0,-1,-o,l+r]),g(this,ep,s),g(this,Zf,r),A(c=yt,ci,EC).call(c),Zl(t,n),a(this,ko).promise.finally(()=>{a(yt,ju).delete(this),g(this,mr,null),g(this,Nu,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=Gt.platform;return re(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{a(this,cl).read().then(({value:t,done:n})=>{if(n){a(this,ko).resolve();return}a(this,ll)??g(this,ll,t.lang),Object.assign(a(this,Nu),t.styles),A(this,Vr,AC).call(this,t.items),e()},a(this,ko).reject)};return g(this,cl,a(this,Fu).getReader()),a(yt,ju).add(this),e(),a(this,ko).promise}update({viewport:e,onBefore:t=null}){var r;const n=e.scale*zs.pixelRatio,s=e.rotation;if(s!==a(this,Mu)&&(t==null||t(),g(this,Mu,s),Zl(a(this,Ou),{rotation:s})),n!==a(this,Co)){t==null||t(),g(this,Co,n);const o={div:null,properties:null,ctx:A(r=yt,ci,am).call(r,a(this,ll))};for(const l of a(this,ul))o.properties=a(this,np).get(l),o.div=l,A(this,Vr,Lw).call(this,o)}}cancel(){var t;const e=new aa("TextLayer task cancelled.");(t=a(this,cl))==null||t.cancel(e).catch(()=>{}),g(this,cl,null),a(this,ko).reject(e)}get textDivs(){return a(this,ul)}get textContentItemsStr(){return a(this,tp)}static cleanup(){if(!(a(this,ju).size>0)){a(this,Bu).clear();for(const{canvas:e}of a(this,hl).values())e.remove();a(this,hl).clear()}}};ko=new WeakMap,xn=new WeakMap,Qf=new WeakMap,Jf=new WeakMap,ll=new WeakMap,mr=new WeakMap,Zf=new WeakMap,ep=new WeakMap,cl=new WeakMap,Ou=new WeakMap,Mu=new WeakMap,Co=new WeakMap,Nu=new WeakMap,tp=new WeakMap,Fu=new WeakMap,ul=new WeakMap,np=new WeakMap,ip=new WeakMap,Bu=new WeakMap,hl=new WeakMap,sp=new WeakMap,To=new WeakMap,ju=new WeakMap,Vr=new WeakSet,AC=function(e){var s,r;if(a(this,Qf))return;(r=a(this,mr)).ctx??(r.ctx=A(s=yt,ci,am).call(s,a(this,ll)));const t=a(this,ul),n=a(this,tp);for(const o of e){if(t.length>uI){Z("Ignoring additional textDivs for performance reasons."),g(this,Qf,!0);return}if(o.str===void 0){if(o.type==="beginMarkedContentProps"||o.type==="beginMarkedContent"){const l=a(this,xn);g(this,xn,document.createElement("span")),a(this,xn).classList.add("markedContent"),o.id&&a(this,xn).setAttribute("id",`${o.id}`),l.append(a(this,xn))}else o.type==="endMarkedContent"&&g(this,xn,a(this,xn).parentNode);continue}n.push(o.str),A(this,Vr,SC).call(this,o)}},SC=function(e){var b;const t=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};a(this,ul).push(t);const s=G.transform(a(this,ip),e.transform);let r=Math.atan2(s[1],s[0]);const o=a(this,Nu)[e.fontName];o.vertical&&(r+=Math.PI/2);let l=a(this,Jf)&&o.fontSubstitution||o.fontFamily;l=yt.fontFamilyMap.get(l)||l;const c=Math.hypot(s[2],s[3]),u=c*A(b=yt,ci,kC).call(b,l,o,a(this,ll));let h,d;r===0?(h=s[4],d=s[5]-u):(h=s[4]+u*Math.sin(r),d=s[5]-u*Math.cos(r));const f="calc(var(--total-scale-factor) *",p=t.style;a(this,xn)===a(this,Ou)?(p.left=`${(100*h/a(this,ep)).toFixed(2)}%`,p.top=`${(100*d/a(this,Zf)).toFixed(2)}%`):(p.left=`${f}${h.toFixed(2)}px)`,p.top=`${f}${d.toFixed(2)}px)`),p.fontSize=`${f}${(a(yt,To)*c).toFixed(2)}px)`,p.fontFamily=l,n.fontSize=c,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,a(this,Jf)&&(t.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName),r!==0&&(n.angle=r*(180/Math.PI));let v=!1;if(e.str.length>1)v=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const S=Math.abs(e.transform[0]),m=Math.abs(e.transform[3]);S!==m&&Math.max(S,m)/Math.min(S,m)>1.5&&(v=!0)}if(v&&(n.canvasWidth=o.vertical?e.height:e.width),a(this,np).set(t,n),a(this,mr).div=t,a(this,mr).properties=n,A(this,Vr,Lw).call(this,a(this,mr)),n.hasText&&a(this,xn).append(t),n.hasEOL){const S=document.createElement("br");S.setAttribute("role","presentation"),a(this,xn).append(S)}},Lw=function(e){var l;const{div:t,properties:n,ctx:s}=e,{style:r}=t;let o="";if(a(yt,To)>1&&(o=`scale(${1/a(yt,To)})`),n.canvasWidth!==0&&n.hasText){const{fontFamily:c}=r,{canvasWidth:u,fontSize:h}=n;A(l=yt,ci,Iw).call(l,s,h*a(this,Co),c);const{width:d}=s.measureText(t.textContent);d>0&&(o=`scaleX(${u*a(this,Co)/d}) ${o}`)}n.angle!==0&&(o=`rotate(${n.angle}deg) ${o}`),o.length>0&&(r.transform=o)},ci=new WeakSet,am=function(e=null){let t=a(this,hl).get(e||(e=""));if(!t){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=e,document.body.append(n),t=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),a(this,hl).set(e,t),a(this,sp).set(t,{size:0,family:""})}return t},Iw=function(e,t,n){const s=a(this,sp).get(e);t===s.size&&n===s.family||(e.font=`${t}px ${n}`,s.size=t,s.family=n)},EC=function(){if(a(this,To)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),g(this,To,e.getBoundingClientRect().height),e.remove()},kC=function(e,t,n){const s=a(this,Bu).get(e);if(s)return s;const r=A(this,ci,am).call(this,n);r.canvas.width=r.canvas.height=LS,A(this,ci,Iw).call(this,r,LS,e);const o=r.measureText(""),l=o.fontBoundingBoxAscent,c=Math.abs(o.fontBoundingBoxDescent);r.canvas.width=r.canvas.height=0;let u=.8;return l?u=l/(l+c):(Gt.platform.isFirefox&&Z("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?u=t.ascent:t.descent&&(u=1+t.descent)),a(this,Bu).set(e,u),u},y(yt,ci),y(yt,Bu,new Map),y(yt,hl,new Map),y(yt,sp,new WeakMap),y(yt,To,null),y(yt,ju,new Set);let Jd=yt;const hI=100;function CC(i={}){typeof i=="string"||i instanceof URL?i={url:i}:(i instanceof ArrayBuffer||ArrayBuffer.isView(i))&&(i={data:i});const e=new Dw,{docId:t}=e,n=i.url?vL(i.url):null,s=i.data?wL(i.data):null,r=i.httpHeaders||null,o=i.withCredentials===!0,l=i.password??null,c=i.range instanceof TC?i.range:null,u=Number.isInteger(i.rangeChunkSize)&&i.rangeChunkSize>0?i.rangeChunkSize:2**16;let h=i.worker instanceof Zd?i.worker:null;const d=i.verbosity,f=typeof i.docBaseUrl=="string"&&!ev(i.docBaseUrl)?i.docBaseUrl:null,p=kg(i.cMapUrl),v=i.cMapPacked!==!1,b=i.CMapReaderFactory||(fn?TL:yS),S=kg(i.iccUrl),m=kg(i.standardFontDataUrl),_=i.StandardFontDataFactory||(fn?xL:vS),w=kg(i.wasmUrl),E=i.WasmFactory||(fn?PL:wS),k=i.stopAtErrors!==!0,C=Number.isInteger(i.maxImageSize)&&i.maxImageSize>-1?i.maxImageSize:-1,T=i.isEvalSupported!==!1,R=typeof i.isOffscreenCanvasSupported=="boolean"?i.isOffscreenCanvasSupported:!fn,D=typeof i.isImageDecoderSupported=="boolean"?i.isImageDecoderSupported:!fn&&(Gt.platform.isFirefox||!globalThis.chrome),O=Number.isInteger(i.canvasMaxAreaInBytes)?i.canvasMaxAreaInBytes:-1,B=typeof i.disableFontFace=="boolean"?i.disableFontFace:fn,H=i.fontExtraProperties===!0,Y=i.enableXfa===!0,X=i.ownerDocument||globalThis.document,ee=i.disableRange===!0,q=i.disableStream===!0,M=i.disableAutoFetch===!0,L=i.pdfBug===!0,x=i.CanvasFactory||(fn?CL:SL),P=i.FilterFactory||(fn?kL:EL),I=i.enableHWA===!0,N=i.useWasm!==!1,$=c?c.length:i.length??NaN,Q=typeof i.useSystemFonts=="boolean"?i.useSystemFonts:!fn&&!B,we=typeof i.useWorkerFetch=="boolean"?i.useWorkerFetch:!!(b===yS&&_===vS&&E===wS&&p&&m&&w&&Jh(p,document.baseURI)&&Jh(m,document.baseURI)&&Jh(w,document.baseURI)),_e=null;GR(d);const ce={canvasFactory:new x({ownerDocument:X,enableHWA:I}),filterFactory:new P({docId:t,ownerDocument:X}),cMapReaderFactory:we?null:new b({baseUrl:p,isCompressed:v}),standardFontDataFactory:we?null:new _({baseUrl:m}),wasmFactory:we?null:new E({baseUrl:w})};h||(h=Zd.create({verbosity:d,port:ss.workerPort}),e._worker=h);const kt={docId:t,apiVersion:"5.4.394",data:s,password:l,disableAutoFetch:M,rangeChunkSize:u,length:$,docBaseUrl:f,enableXfa:Y,evaluatorOptions:{maxImageSize:C,disableFontFace:B,ignoreErrors:k,isEvalSupported:T,isOffscreenCanvasSupported:R,isImageDecoderSupported:D,canvasMaxAreaInBytes:O,fontExtraProperties:H,useSystemFonts:Q,useWasm:N,useWorkerFetch:we,cMapUrl:p,iccUrl:S,standardFontDataUrl:m,wasmUrl:w}},pa={ownerDocument:X,pdfBug:L,styleElement:_e,loadingParams:{disableAutoFetch:M,enableXfa:Y}};return h.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const Fi=h.messageHandler.sendWithPromise("GetDocRequest",kt,s?[s.buffer]:null);let on;if(c)on=new qL(c,{disableRange:ee,disableStream:q});else if(!s){if(!n)throw new Error("getDocument - no `url` parameter provided.");const lv=Jh(n)?QL:fn?aI:nI;on=new lv({url:n,length:$,httpHeaders:r,withCredentials:o,rangeChunkSize:u,disableRange:ee,disableStream:q})}return Fi.then(lv=>{if(e.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const Yb=new od(t,lv,h.port),sx=new pI(Yb,e,on,pa,ce,I);e._transport=sx,Yb.send("Ready",null)})}).catch(e._capability.reject),e}var ky;const Cy=class Cy{constructor(){F(this,"_capability",Promise.withResolvers());F(this,"_transport",null);F(this,"_worker",null);F(this,"docId",`d${gt(Cy,ky)._++}`);F(this,"destroyed",!1);F(this,"onPassword",null);F(this,"onProgress",null)}get promise(){return this._capability.promise}async destroy(){var e,t,n,s;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(r){throw(n=this._worker)!=null&&n.port&&delete this._worker._pendingDestroy,r}this._transport=null,(s=this._worker)==null||s.destroy(),this._worker=null}async getData(){return this._transport.getData()}};ky=new WeakMap,y(Cy,ky,0);let Dw=Cy;var dl,rp,op,ap,lp;class TC{constructor(e,t,n=!1,s=null){y(this,dl,Promise.withResolvers());y(this,rp,[]);y(this,op,[]);y(this,ap,[]);y(this,lp,[]);this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=s}addRangeListener(e){a(this,lp).push(e)}addProgressListener(e){a(this,ap).push(e)}addProgressiveReadListener(e){a(this,op).push(e)}addProgressiveDoneListener(e){a(this,rp).push(e)}onDataRange(e,t){for(const n of a(this,lp))n(e,t)}onDataProgress(e,t){a(this,dl).promise.then(()=>{for(const n of a(this,ap))n(e,t)})}onDataProgressiveRead(e){a(this,dl).promise.then(()=>{for(const t of a(this,op))t(e)})}onDataProgressiveDone(){a(this,dl).promise.then(()=>{for(const e of a(this,rp))e()})}transportReady(){a(this,dl).resolve()}requestDataRange(e,t){Me("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}dl=new WeakMap,rp=new WeakMap,op=new WeakMap,ap=new WeakMap,lp=new WeakMap;class dI{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return re(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(e,t){return this._transport.getAnnotationsByType(e,t)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var yr,fl,hd;class fI{constructor(e,t,n,s=!1){y(this,fl);y(this,yr,!1);this._pageIndex=e,this._pageInfo=t,this._transport=n,this._stats=s?new uS:null,this._pdfBug=s,this.commonObjs=n.commonObjs,this.objs=new bC,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:s=0,dontFlip:r=!1}={}){return new Zp({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:s,dontFlip:r})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return re(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,canvas:t=e.canvas,viewport:n,intent:s="display",annotationMode:r=to.ENABLE,transform:o=null,background:l=null,optionalContentConfigPromise:c=null,annotationCanvasMap:u=null,pageColors:h=null,printAnnotationStorage:d=null,isEditing:f=!1,recordOperations:p=!1,operationsFilter:v=null}){var D,O,B;(D=this._stats)==null||D.time("Overall");const b=this._transport.getRenderingIntent(s,r,d,f),{renderingIntent:S,cacheKey:m}=b;g(this,yr,!1),c||(c=this._transport.getOptionalContentConfig(S));let _=this._intentStates.get(m);_||(_=Object.create(null),this._intentStates.set(m,_)),_.streamReaderCancelTimeout&&(clearTimeout(_.streamReaderCancelTimeout),_.streamReaderCancelTimeout=null);const w=!!(S&ii.PRINT);_.displayReadyCapability||(_.displayReadyCapability=Promise.withResolvers(),_.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(O=this._stats)==null||O.time("Page Request"),this._pumpOperatorList(b));const E=!!(this._pdfBug&&((B=globalThis.StepperManager)!=null&&B.enabled)),k=!this.recordedBBoxes&&(p||E),C=H=>{var Y,X;if(_.renderTasks.delete(T),k){const ee=(Y=T.gfx)==null?void 0:Y.dependencyTracker.take();ee&&(T.stepper&&T.stepper.setOperatorBBoxes(ee,T.gfx.dependencyTracker.takeDebugMetadata()),p&&(this.recordedBBoxes=ee))}w&&g(this,yr,!0),A(this,fl,hd).call(this),H?(T.capability.reject(H),this._abortOperatorList({intentState:_,reason:H instanceof Error?H:new Error(H)})):T.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(X=globalThis.Stats)!=null&&X.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},T=new Ow({callback:C,params:{canvas:t,canvasContext:e,dependencyTracker:k?new LL(t,_.operatorList.length,E):null,viewport:n,transform:o,background:l},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:u,operatorList:_.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!w,pdfBug:this._pdfBug,pageColors:h,enableHWA:this._transport.enableHWA,operationsFilter:v});(_.renderTasks||(_.renderTasks=new Set)).add(T);const R=T.task;return Promise.all([_.displayReadyCapability.promise,c]).then(([H,Y])=>{var X;if(this.destroyed){C();return}if((X=this._stats)==null||X.time("Rendering"),!(Y.renderingIntent&S))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");T.initializeGraphics({transparency:H,optionalContentConfig:Y}),T.operatorListChanged()}).catch(C),R}getOperatorList({intent:e="display",annotationMode:t=to.ENABLE,printAnnotationStorage:n=null,isEditing:s=!1}={}){var u;function r(){l.operatorList.lastChunk&&(l.opListReadCapability.resolve(l.operatorList),l.renderTasks.delete(c))}const o=this._transport.getRenderingIntent(e,t,n,s,!0);let l=this._intentStates.get(o.cacheKey);l||(l=Object.create(null),this._intentStates.set(o.cacheKey,l));let c;return l.opListReadCapability||(c=Object.create(null),c.operatorListChanged=r,l.opListReadCapability=Promise.withResolvers(),(l.renderTasks||(l.renderTasks=new Set)).add(c),l.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(u=this._stats)==null||u.time("Page Request"),this._pumpOperatorList(o)),l.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>Qd.textContent(n));const t=this.streamTextContent(e);return new Promise(function(n,s){function r(){o.read().then(function({value:c,done:u}){if(u){n(l);return}l.lang??(l.lang=c.lang),Object.assign(l.styles,c.styles),l.items.push(...c.items),r()},s)}const o=t.getReader(),l={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),g(this,yr,!1),Promise.all(e)}cleanup(e=!1){g(this,yr,!0);const t=A(this,fl,hd).call(this);return e&&t&&this._stats&&(this._stats=new uS),t}_startRenderPage(e,t){var s,r;const n=this._intentStates.get(t);n&&((s=this._stats)==null||s.timeEnd("Page Request"),(r=n.displayReadyCapability)==null||r.resolve(e))}_renderPageChunk(e,t){for(let n=0,s=e.length;n<s;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const n of t.renderTasks)n.operatorListChanged();e.lastChunk&&A(this,fl,hd).call(this)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:n,modifiedIds:s}){const{map:r,transfer:o}=n,c=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:r,modifiedIds:s},o).getReader(),u=this._intentStates.get(t);u.streamReader=c;const h=()=>{c.read().then(({value:d,done:f})=>{if(f){u.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(d,u),h())},d=>{if(u.streamReader=null,!this._transport.destroyed){if(u.operatorList){u.operatorList.lastChunk=!0;for(const f of u.renderTasks)f.operatorListChanged();A(this,fl,hd).call(this)}if(u.displayReadyCapability)u.displayReadyCapability.reject(d);else if(u.opListReadCapability)u.opListReadCapability.reject(d);else throw d}})};h()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!n){if(e.renderTasks.size>0)return;if(t instanceof xb){let s=hI;t.extraDelay>0&&t.extraDelay<1e3&&(s+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},s);return}}if(e.streamReader.cancel(new aa(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[s,r]of this._intentStates)if(r===e){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}}yr=new WeakMap,fl=new WeakSet,hd=function(){if(!a(this,yr)||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),g(this,yr,!1),!0};var xo,Ki,vr,pl,Ty,gl,ml,yn,lm,xC,PC,dd,$u,cm;const We=class We{constructor({name:e=null,port:t=null,verbosity:n=qR()}={}){y(this,yn);y(this,xo,Promise.withResolvers());y(this,Ki,null);y(this,vr,null);y(this,pl,null);if(this.name=e,this.destroyed=!1,this.verbosity=n,t){if(a(We,ml).has(t))throw new Error("Cannot use more than one PDFWorker per port.");a(We,ml).set(t,this),A(this,yn,xC).call(this,t)}else A(this,yn,PC).call(this)}get promise(){return a(this,xo).promise}get port(){return a(this,vr)}get messageHandler(){return a(this,Ki)}destroy(){var e,t;this.destroyed=!0,(e=a(this,pl))==null||e.terminate(),g(this,pl,null),a(We,ml).delete(a(this,vr)),g(this,vr,null),(t=a(this,Ki))==null||t.destroy(),g(this,Ki,null)}static create(e){const t=a(this,ml).get(e==null?void 0:e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new We(e)}static get workerSrc(){if(ss.workerSrc)return ss.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return re(this,"_setupFakeWorkerGlobal",(async()=>a(this,$u,cm)?a(this,$u,cm):(await import(this.workerSrc)).WorkerMessageHandler)())}};xo=new WeakMap,Ki=new WeakMap,vr=new WeakMap,pl=new WeakMap,Ty=new WeakMap,gl=new WeakMap,ml=new WeakMap,yn=new WeakSet,lm=function(){a(this,xo).resolve(),a(this,Ki).send("configure",{verbosity:this.verbosity})},xC=function(e){g(this,vr,e),g(this,Ki,new od("main","worker",e)),a(this,Ki).on("ready",()=>{}),A(this,yn,lm).call(this)},PC=function(){if(a(We,gl)||a(We,$u,cm)){A(this,yn,dd).call(this);return}let{workerSrc:e}=We;try{We._isSameOrigin(window.location,e)||(e=We._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),n=new od("main","worker",t),s=()=>{r.abort(),n.destroy(),t.terminate(),this.destroyed?a(this,xo).reject(new Error("Worker was destroyed")):A(this,yn,dd).call(this)},r=new AbortController;t.addEventListener("error",()=>{a(this,pl)||s()},{signal:r.signal}),n.on("test",l=>{if(r.abort(),this.destroyed||!l){s();return}g(this,Ki,n),g(this,vr,t),g(this,pl,t),A(this,yn,lm).call(this)}),n.on("ready",l=>{if(r.abort(),this.destroyed){s();return}try{o()}catch{A(this,yn,dd).call(this)}});const o=()=>{const l=new Uint8Array;n.send("test",l,[l.buffer])};o();return}catch{Zy("The worker has been disabled.")}A(this,yn,dd).call(this)},dd=function(){a(We,gl)||(Z("Setting up fake worker."),g(We,gl,!0)),We._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){a(this,xo).reject(new Error("Worker was destroyed"));return}const t=new AL;g(this,vr,t);const n=`fake${gt(We,Ty)._++}`,s=new od(n+"_worker",n,t);e.setup(s,t),g(this,Ki,new od(n,n+"_worker",t)),A(this,yn,lm).call(this)}).catch(e=>{a(this,xo).reject(new Error(`Setting up fake worker failed: "${e.message}".`))})},$u=new WeakSet,cm=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},y(We,$u),y(We,Ty,0),y(We,gl,!1),y(We,ml,new WeakMap),fn&&(g(We,gl,!0),ss.workerSrc||(ss.workerSrc="./pdf.worker.mjs")),We._isSameOrigin=(e,t)=>{const n=URL.parse(e);if(!(n!=null&&n.origin)||n.origin==="null")return!1;const s=new URL(t,n);return n.origin===s.origin},We._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},We.fromPort=e=>{if(rL("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return We.create(e)};let Zd=We;var wr,Ps,Uu,zu,_r,yl,fd;class pI{constructor(e,t,n,s,r,o){y(this,yl);y(this,wr,new Map);y(this,Ps,new Map);y(this,Uu,new Map);y(this,zu,new Map);y(this,_r,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new bC,this.fontLoader=new mL({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.wasmFactory=r.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=o,this.setupMessageHandler()}get annotationStorage(){return re(this,"annotationStorage",new Rb)}getRenderingIntent(e,t=to.ENABLE,n=null,s=!1,r=!1){let o=ii.DISPLAY,l=mw;switch(e){case"any":o=ii.ANY;break;case"display":break;case"print":o=ii.PRINT;break;default:Z(`getRenderingIntent - invalid intent: ${e}`)}const c=o&ii.PRINT&&n instanceof rC?n:this.annotationStorage;switch(t){case to.DISABLE:o+=ii.ANNOTATIONS_DISABLE;break;case to.ENABLE:break;case to.ENABLE_FORMS:o+=ii.ANNOTATIONS_FORMS;break;case to.ENABLE_STORAGE:o+=ii.ANNOTATIONS_STORAGE,l=c.serializable;break;default:Z(`getRenderingIntent - invalid annotationMode: ${t}`)}s&&(o+=ii.IS_EDITING),r&&(o+=ii.OPLIST);const{ids:u,hash:h}=c.modifiedIds,d=[o,l.hash,h];return{renderingIntent:o,cacheKey:d.join("_"),annotationStorageSerializable:l,modifiedIds:u}}destroy(){var n;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(n=a(this,_r))==null||n.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const s of a(this,Ps).values())e.push(s._destroy());a(this,Ps).clear(),a(this,Uu).clear(),a(this,zu).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var s,r;this.commonObjs.clear(),this.fontLoader.clear(),a(this,wr).clear(),this.filterFactory.destroy(),Jd.cleanup(),(s=this._networkStream)==null||s.cancelAllRequests(new aa("Worker was terminated.")),(r=this.messageHandler)==null||r.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(n,s)=>{ge(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},s.onPull=()=>{this._fullReader.read().then(function({value:r,done:o}){if(o){s.close();return}ge(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{s.error(r)})},s.onCancel=r=>{this._fullReader.cancel(r),s.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("ReaderHeadersReady",async n=>{var l;await this._fullReader.headersReady;const{isStreamingSupported:s,isRangeSupported:r,contentLength:o}=this._fullReader;return(!s||!r)&&(this._lastProgress&&((l=t.onProgress)==null||l.call(t,this._lastProgress)),this._fullReader.onProgress=c=>{var u;(u=t.onProgress)==null||u.call(t,{loaded:c.loaded,total:c.total})}),{isStreamingSupported:s,isRangeSupported:r,contentLength:o}}),e.on("GetRangeReader",(n,s)=>{ge(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const r=this._networkStream.getRangeReader(n.begin,n.end);if(!r){s.close();return}s.onPull=()=>{r.read().then(function({value:o,done:l}){if(l){s.close();return}ge(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{s.error(o)})},s.onCancel=o=>{r.cancel(o),s.ready.catch(l=>{if(!this.destroyed)throw l})}}),e.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,t._capability.resolve(new dI(n,this))}),e.on("DocException",n=>{t._capability.reject(An(n))}),e.on("PasswordRequest",n=>{g(this,_r,Promise.withResolvers());try{if(!t.onPassword)throw An(n);const s=r=>{r instanceof Error?a(this,_r).reject(r):a(this,_r).resolve({password:r})};t.onPassword(s,n.code)}catch(s){a(this,_r).reject(s)}return a(this,_r).promise}),e.on("DataLoaded",n=>{var s;(s=t.onProgress)==null||s.call(t,{loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),e.on("StartRenderPage",n=>{if(this.destroyed)return;a(this,Ps).get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),e.on("commonobj",([n,s,r])=>{var o;if(this.destroyed||this.commonObjs.has(n))return null;switch(s){case"Font":if("error"in r){const f=r.error;Z(`Error during font loading: ${f}`),this.commonObjs.resolve(n,f);break}const l=new yw(r),c=this._params.pdfBug&&((o=globalThis.FontInspector)!=null&&o.enabled)?(f,p)=>globalThis.FontInspector.fontAdded(f,p):null,u=new yL(l,c,r.extra,r.charProcOperatorList);this.fontLoader.bind(u).catch(()=>e.sendWithPromise("FontFallback",{id:n})).finally(()=>{!u.fontExtraProperties&&u.data&&u.clearData(),this.commonObjs.resolve(n,u)});break;case"CopyLocalImage":const{imageRef:h}=r;ge(h,"The imageRef must be defined.");for(const f of a(this,Ps).values())for(const[,p]of f.objs)if((p==null?void 0:p.ref)===h)return p.dataLen?(this.commonObjs.resolve(n,structuredClone(p)),p.dataLen):null;break;case"FontPath":case"Image":this.commonObjs.resolve(n,r);break;case"Pattern":const d=new vw(r);this.commonObjs.resolve(n,d.getIR());break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),e.on("obj",([n,s,r,o])=>{var c;if(this.destroyed)return;const l=a(this,Ps).get(s);if(!l.objs.has(n)){if(l._intentStates.size===0){(c=o==null?void 0:o.bitmap)==null||c.close();return}switch(r){case"Image":case"Pattern":l.objs.resolve(n,o);break;default:throw new Error(`Got unknown object type ${r}`)}}}),e.on("DocProgress",n=>{var s;this.destroyed||(s=t.onProgress)==null||s.call(t,{loaded:n.loaded,total:n.total})}),e.on("FetchBinaryData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");const s=this[n.type];if(!s)throw new Error(`${n.type} not initialized, see the \`useWorkerFetch\` parameter.`);return s.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var n;this.annotationStorage.size<=0&&Z("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((n=this._fullReader)==null?void 0:n.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,n=a(this,Uu).get(t);if(n)return n;const s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&a(this,zu).set(r.refStr,e);const o=new fI(t,r,this,this._params.pdfBug);return a(this,Ps).set(t,o),o});return a(this,Uu).set(t,s),s}getPageIndex(e){return ww(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return A(this,yl,fd).call(this,"GetFieldObjects")}hasJSActions(){return A(this,yl,fd).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(e,t){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:e,pageIndexesToSkip:t})}getDocJSActions(){return A(this,yl,fd).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return A(this,yl,fd).call(this,"GetOptionalContentConfig").then(t=>new GL(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=a(this,wr).get(e);if(t)return t;const n=this.messageHandler.sendWithPromise(e,null).then(s=>{var r,o;return{info:s[0],metadata:s[1]?new WL(s[1]):null,contentDispositionFilename:((r=this._fullReader)==null?void 0:r.filename)??null,contentLength:((o=this._fullReader)==null?void 0:o.contentLength)??null}});return a(this,wr).set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of a(this,Ps).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),a(this,wr).clear(),this.filterFactory.destroy(!0),Jd.cleanup()}}cachedPageNumber(e){if(!ww(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return a(this,zu).get(t)??null}}wr=new WeakMap,Ps=new WeakMap,Uu=new WeakMap,zu=new WeakMap,_r=new WeakMap,yl=new WeakSet,fd=function(e,t=null){const n=a(this,wr).get(e);if(n)return n;const s=this.messageHandler.sendWithPromise(e,t);return a(this,wr).set(e,s),s};var Po;class gI{constructor(e){y(this,Po,null);F(this,"onContinue",null);F(this,"onError",null);g(this,Po,e)}get promise(){return a(this,Po).capability.promise}cancel(e=0){a(this,Po).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=a(this,Po).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=a(this,Po);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}Po=new WeakMap;var Ro,vl;const Ca=class Ca{constructor({callback:e,params:t,objs:n,commonObjs:s,annotationCanvasMap:r,operatorList:o,pageIndex:l,canvasFactory:c,filterFactory:u,useRequestAnimationFrame:h=!1,pdfBug:d=!1,pageColors:f=null,enableHWA:p=!1,operationsFilter:v=null}){y(this,Ro,null);this.callback=e,this.params=t,this.objs=n,this.commonObjs=s,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=l,this.canvasFactory=c,this.filterFactory=u,this._pdfBug=d,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=h===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new gI(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvas,this._canvasContext=t.canvas?null:t.canvasContext,this._enableHWA=p,this._dependencyTracker=t.dependencyTracker,this._operationsFilter=v}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var c,u;if(this.cancelled)return;if(this._canvas){if(a(Ca,vl).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");a(Ca,vl).add(this._canvas)}this._pdfBug&&((c=globalThis.StepperManager)!=null&&c.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:n,transform:s,background:r,dependencyTracker:o}=this.params,l=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new Kc(l,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors,o),this.gfx.beginDrawing({transform:s,viewport:n,transparency:e,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,(u=this.graphicsReadyCallback)==null||u.call(this)}cancel(e=null,t=0){var n,s,r;this.running=!1,this.cancelled=!0,(n=this.gfx)==null||n.endDrawing(),a(this,Ro)&&(window.cancelAnimationFrame(a(this,Ro)),g(this,Ro,null)),a(Ca,vl).delete(this._canvas),e||(e=new xb(`Rendering cancelled, page ${this._pageIndex+1}`,t)),this.callback(e),(r=(s=this.task).onError)==null||r.call(s,e)}operatorListChanged(){var e,t;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.gfx.dependencyTracker)==null||e.growOperationsCount(this.operatorList.fnArray.length),(t=this.stepper)==null||t.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?g(this,Ro,window.requestAnimationFrame(()=>{g(this,Ro,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),a(Ca,vl).delete(this._canvas),this.callback())))}};Ro=new WeakMap,vl=new WeakMap,y(Ca,vl,new WeakSet);let Ow=Ca;const mI="5.4.394",yI="2cc809ade";var Wn,wl,Hu,_t,cp,Wu,br,up,Lo,Xi,hp,Le,Mw,Nw,Fw,_a,RC,Xr;const Sn=class Sn{constructor({editor:e=null,uiManager:t=null}){y(this,Le);y(this,Wn,null);y(this,wl,null);y(this,Hu);y(this,_t,null);y(this,cp,!1);y(this,Wu,!1);y(this,br,null);y(this,up);y(this,Lo,null);y(this,Xi,null);var n,s;e?(g(this,Wu,!1),g(this,br,e)):g(this,Wu,!0),g(this,Xi,(e==null?void 0:e._uiManager)||t),g(this,up,a(this,Xi)._eventBus),g(this,Hu,((n=e==null?void 0:e.color)==null?void 0:n.toUpperCase())||((s=a(this,Xi))==null?void 0:s.highlightColors.values().next().value)||"#FFFF98"),a(Sn,hp)||g(Sn,hp,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return re(this,"_keyboardManager",new tg([[["Escape","mac+Escape"],Sn.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Sn.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Sn.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Sn.prototype._moveToPrevious],[["Home","mac+Home"],Sn.prototype._moveToBeginning],[["End","mac+End"],Sn.prototype._moveToEnd]]))}renderButton(){const e=g(this,Wn,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",a(this,br)&&(e.ariaControls=`${a(this,br).id}_colorpicker_dropdown`);const t=a(this,Xi)._signal;e.addEventListener("click",A(this,Le,_a).bind(this),{signal:t}),e.addEventListener("keydown",A(this,Le,Fw).bind(this),{signal:t});const n=g(this,wl,document.createElement("span"));return n.className="swatch",n.ariaHidden="true",n.style.backgroundColor=a(this,Hu),e.append(n),e}renderMainDropdown(){const e=g(this,_t,A(this,Le,Mw).call(this));return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}_colorSelectFromKeyboard(e){if(e.target===a(this,Wn)){A(this,Le,_a).call(this,e);return}const t=e.target.getAttribute("data-color");t&&A(this,Le,Nw).call(this,t,e)}_moveToNext(e){var t,n;if(!a(this,Le,Xr)){A(this,Le,_a).call(this,e);return}if(e.target===a(this,Wn)){(t=a(this,_t).firstChild)==null||t.focus();return}(n=e.target.nextSibling)==null||n.focus()}_moveToPrevious(e){var t,n;if(e.target===((t=a(this,_t))==null?void 0:t.firstChild)||e.target===a(this,Wn)){a(this,Le,Xr)&&this._hideDropdownFromKeyboard();return}a(this,Le,Xr)||A(this,Le,_a).call(this,e),(n=e.target.previousSibling)==null||n.focus()}_moveToBeginning(e){var t;if(!a(this,Le,Xr)){A(this,Le,_a).call(this,e);return}(t=a(this,_t).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!a(this,Le,Xr)){A(this,Le,_a).call(this,e);return}(t=a(this,_t).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=a(this,_t))==null||e.classList.add("hidden"),a(this,Wn).ariaExpanded="false",(t=a(this,Lo))==null||t.abort(),g(this,Lo,null)}_hideDropdownFromKeyboard(){var e;if(!a(this,Wu)){if(!a(this,Le,Xr)){(e=a(this,br))==null||e.unselect();return}this.hideDropdown(),a(this,Wn).focus({preventScroll:!0,focusVisible:a(this,cp)})}}updateColor(e){if(a(this,wl)&&(a(this,wl).style.backgroundColor=e),!a(this,_t))return;const t=a(this,Xi).highlightColors.values();for(const n of a(this,_t).children)n.ariaSelected=t.next().value===e.toUpperCase()}destroy(){var e,t;(e=a(this,Wn))==null||e.remove(),g(this,Wn,null),g(this,wl,null),(t=a(this,_t))==null||t.remove(),g(this,_t,null)}};Wn=new WeakMap,wl=new WeakMap,Hu=new WeakMap,_t=new WeakMap,cp=new WeakMap,Wu=new WeakMap,br=new WeakMap,up=new WeakMap,Lo=new WeakMap,Xi=new WeakMap,hp=new WeakMap,Le=new WeakSet,Mw=function(){const e=document.createElement("div"),t=a(this,Xi)._signal;e.addEventListener("contextmenu",Ni,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),a(this,br)&&(e.id=`${a(this,br).id}_colorpicker_dropdown`);for(const[n,s]of a(this,Xi).highlightColors){const r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",s),r.title=n,r.setAttribute("data-l10n-id",a(Sn,hp)[n]);const o=document.createElement("span");r.append(o),o.className="swatch",o.style.backgroundColor=s,r.ariaSelected=s===a(this,Hu),r.addEventListener("click",A(this,Le,Nw).bind(this,s),{signal:t}),e.append(r)}return e.addEventListener("keydown",A(this,Le,Fw).bind(this),{signal:t}),e},Nw=function(e,t){t.stopPropagation(),a(this,up).dispatch("switchannotationeditorparams",{source:this,type:pe.HIGHLIGHT_COLOR,value:e}),this.updateColor(e)},Fw=function(e){Sn._keyboardManager.exec(this,e)},_a=function(e){if(a(this,Le,Xr)){this.hideDropdown();return}if(g(this,cp,e.detail===0),a(this,Lo)||(g(this,Lo,new AbortController),window.addEventListener("pointerdown",A(this,Le,RC).bind(this),{signal:a(this,Xi).combinedSignal(a(this,Lo))})),a(this,Wn).ariaExpanded="true",a(this,_t)){a(this,_t).classList.remove("hidden");return}const t=g(this,_t,A(this,Le,Mw).call(this));a(this,Wn).append(t)},RC=function(e){var t;(t=a(this,_t))!=null&&t.contains(e.target)||this.hideDropdown()},Xr=function(){return a(this,_t)&&!a(this,_t).classList.contains("hidden")},y(Sn,hp,null);let ay=Sn;var Rs,dp,Vu,fp;const Ta=class Ta{constructor(e){y(this,Rs,null);y(this,dp,null);y(this,Vu,null);g(this,dp,e),g(this,Vu,e._uiManager),a(Ta,fp)||g(Ta,fp,Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"}))}renderButton(){if(a(this,Rs))return a(this,Rs);const{editorType:e,colorType:t,color:n}=a(this,dp),s=g(this,Rs,document.createElement("input"));return s.type="color",s.value=n||"#000000",s.className="basicColorPicker",s.tabIndex=0,s.setAttribute("data-l10n-id",a(Ta,fp)[e]),s.addEventListener("input",()=>{a(this,Vu).updateParams(t,s.value)},{signal:a(this,Vu)._signal}),s}update(e){a(this,Rs)&&(a(this,Rs).value=e)}destroy(){var e;(e=a(this,Rs))==null||e.remove(),g(this,Rs,null)}hideDropdown(){}};Rs=new WeakMap,dp=new WeakMap,Vu=new WeakMap,fp=new WeakMap,y(Ta,fp,null);let ly=Ta;function IS(i){return Math.floor(Math.max(0,Math.min(1,i))*255).toString(16).padStart(2,"0")}function Vh(i){return Math.max(0,Math.min(255,255*i))}class DS{static CMYK_G([e,t,n,s]){return["G",1-Math.min(1,.3*e+.59*n+.11*t+s)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=Vh(e),[e,e,e]}static G_HTML([e]){const t=IS(e);return`#${t}${t}${t}`}static RGB_G([e,t,n]){return["G",.3*e+.59*t+.11*n]}static RGB_rgb(e){return e.map(Vh)}static RGB_HTML(e){return`#${e.map(IS).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,n,s]){return["RGB",1-Math.min(1,e+s),1-Math.min(1,n+s),1-Math.min(1,t+s)]}static CMYK_rgb([e,t,n,s]){return[Vh(1-Math.min(1,e+s)),Vh(1-Math.min(1,n+s)),Vh(1-Math.min(1,t+s))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,n]){const s=1-e,r=1-t,o=1-n,l=Math.min(s,r,o);return["CMYK",s,r,o,l]}}class vI{create(e,t,n=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),n||(s.setAttribute("width",`${e}px`),s.setAttribute("height",`${t}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${e} ${t}`),s}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){Me("Abstract method `_createSVG` called.")}}class cy extends vI{_createSVG(e){return document.createElementNS(Ws,e)}}const wI=9,tc=new WeakSet,_I=new Date().getTimezoneOffset()*60*1e3;class Wv{static create(e){switch(e.data.annotationType){case ht.LINK:return new Db(e);case ht.TEXT:return new AI(e);case ht.WIDGET:switch(e.data.fieldType){case"Tx":return new SI(e);case"Btn":return e.data.radioButton?new DC(e):e.data.checkBox?new kI(e):new CI(e);case"Ch":return new TI(e);case"Sig":return new EI(e)}return new rc(e);case ht.POPUP:return new jw(e);case ht.FREETEXT:return new BC(e);case ht.LINE:return new PI(e);case ht.SQUARE:return new RI(e);case ht.CIRCLE:return new LI(e);case ht.POLYLINE:return new jC(e);case ht.CARET:return new DI(e);case ht.INK:return new Ob(e);case ht.POLYGON:return new II(e);case ht.HIGHLIGHT:return new $C(e);case ht.UNDERLINE:return new OI(e);case ht.SQUIGGLY:return new MI(e);case ht.STRIKEOUT:return new NI(e);case ht.STAMP:return new UC(e);case ht.FILEATTACHMENT:return new FI(e);default:return new Je(e)}}}var _l,Gu,Ei,pp,Bw;const Kb=class Kb{constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:s=!1}={}){y(this,pp);y(this,_l,null);y(this,Gu,!1);y(this,Ei,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableComment=e.enableComment,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,this.hasOwnCommentButton=!1,t&&(this.contentElement=this.container=this._createContainer(n)),s&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:t}){return!!(e!=null&&e.str||t!=null&&t.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Kb._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){var n;const{data:e}=this,t=(n=this.annotationStorage)==null?void 0:n.getEditor(e.id);return t?t.getData():e}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){var l;const e=(l=this.annotationStorage)==null?void 0:l.getEditor(this.data.id);if(e)return e.commentButtonPositionInPage;const{quadPoints:t,inkLists:n,rect:s}=this.data;let r=-1/0,o=-1/0;if((t==null?void 0:t.length)>=8){for(let c=0;c<t.length;c+=8)t[c+1]>o?(o=t[c+1],r=t[c+2]):t[c+1]===o&&(r=Math.max(r,t[c+2]));return[r,o]}if((n==null?void 0:n.length)>=1){for(const c of n)for(let u=0,h=c.length;u<h;u+=2)c[u+1]>o?(o=c[u+1],r=c[u]):c[u+1]===o&&(r=Math.max(r,c[u]));if(r!==1/0)return[r,o]}return s?[s[2],s[3]]:null}_normalizePoint(e){const{page:{view:t},viewport:{rawDims:{pageWidth:n,pageHeight:s,pageX:r,pageY:o}}}=this.parent;return e[1]=t[3]-e[1]+t[1],e[0]=100*(e[0]-r)/n,e[1]=100*(e[1]-o)/s,e}get commentText(){var t,n,s;const{data:e}=this;return((n=(t=this.annotationStorage.getRawValue(`${Xd}${e.id}`))==null?void 0:t.popup)==null?void 0:n.contents)||((s=e.contentsObj)==null?void 0:s.str)||""}set commentText(e){const{data:t}=this,n={deleted:!e,contents:e||""};this.annotationStorage.updateEditor(t.id,{popup:n})||this.annotationStorage.setValue(`${Xd}${t.id}`,{id:t.id,annotationType:t.annotationType,pageIndex:this.parent.page._pageIndex,popup:n,popupRef:t.popupRef,modificationDate:new Date}),e||this.removePopup()}removePopup(){var e,t;(t=((e=a(this,Ei))==null?void 0:e.popup)||this.popup)==null||t.remove(),g(this,Ei,this.popup=null)}updateEdited(e){var r;if(!this.container)return;e.rect&&(a(this,_l)||g(this,_l,{rect:this.data.rect.slice(0)}));const{rect:t,popup:n}=e;t&&A(this,pp,Bw).call(this,t);let s=((r=a(this,Ei))==null?void 0:r.popup)||this.popup;!s&&(n!=null&&n.text)&&(this._createPopup(n),s=a(this,Ei).popup),s&&(s.updateEdited(e),n!=null&&n.deleted&&(s.remove(),g(this,Ei,null),this.popup=null))}resetEdited(){var e;a(this,_l)&&(A(this,pp,Bw).call(this,a(this,_l).rect),(e=a(this,Ei))==null||e.popup.resetEdited(),g(this,_l,null))}_createContainer(e){const{data:t,parent:{page:n,viewport:s}}=this,r=document.createElement("section");r.setAttribute("data-annotation-id",t.id),!(this instanceof rc)&&!(this instanceof Db)&&(r.tabIndex=0);const{style:o}=r;if(o.zIndex=this.parent.zIndex,this.parent.zIndex+=2,t.alternativeText&&(r.title=t.alternativeText),t.noRotate&&r.classList.add("norotate"),!t.rect||this instanceof jw){const{rotation:b}=t;return!t.hasOwnCanvas&&b!==0&&this.setRotation(b,r),r}const{width:l,height:c}=this;if(!e&&t.borderStyle.width>0){o.borderWidth=`${t.borderStyle.width}px`;const b=t.borderStyle.horizontalCornerRadius,S=t.borderStyle.verticalCornerRadius;if(b>0||S>0){const _=`calc(${b}px * var(--total-scale-factor)) / calc(${S}px * var(--total-scale-factor))`;o.borderRadius=_}else if(this instanceof DC){const _=`calc(${l}px * var(--total-scale-factor)) / calc(${c}px * var(--total-scale-factor))`;o.borderRadius=_}switch(t.borderStyle.style){case pc.SOLID:o.borderStyle="solid";break;case pc.DASHED:o.borderStyle="dashed";break;case pc.BEVELED:Z("Unimplemented border style: beveled");break;case pc.INSET:Z("Unimplemented border style: inset");break;case pc.UNDERLINE:o.borderBottomStyle="solid";break}const m=t.borderColor||null;m?(g(this,Gu,!0),o.borderColor=G.makeHexColor(m[0]|0,m[1]|0,m[2]|0)):o.borderWidth=0}const u=G.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),{pageWidth:h,pageHeight:d,pageX:f,pageY:p}=s.rawDims;o.left=`${100*(u[0]-f)/h}%`,o.top=`${100*(u[1]-p)/d}%`;const{rotation:v}=t;return t.hasOwnCanvas||v===0?(o.width=`${100*l/h}%`,o.height=`${100*c/d}%`):this.setRotation(v,r),r}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:n,pageHeight:s}=this.parent.viewport.rawDims;let{width:r,height:o}=this;e%180!==0&&([r,o]=[o,r]),t.style.width=`${100*r/n}%`,t.style.height=`${100*o/s}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,n,s)=>{const r=s.detail[t],o=r[0],l=r.slice(1);s.target.style[n]=DS[`${o}_HTML`](l),this.annotationStorage.setValue(this.data.id,{[n]:DS[`${o}_rgb`](l)})};return re(this,"_commonActions",{display:t=>{const{display:n}=t.detail,s=n%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:n===1||n===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:n}=t.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const n=t.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(e,t){const n=this._commonActions;for(const s of Object.keys(t.detail)){const r=e[s]||n[s];r==null||r(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const n=this._commonActions;for(const[s,r]of Object.entries(t)){const o=n[s];if(o){const l={detail:{[s]:r},target:e};o(l),delete t[s]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,n,s,r]=this.data.rect.map(b=>Math.fround(b));if(e.length===8){const[b,S,m,_]=e.subarray(2,6);if(s===b&&r===S&&t===m&&n===_)return}const{style:o}=this.container;let l;if(a(this,Gu)){const{borderColor:b,borderWidth:S}=o;o.borderWidth=0,l=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${b}" stroke-width="${S}">`],this.container.classList.add("hasBorder")}const c=s-t,u=r-n,{svgFactory:h}=this,d=h.createElement("svg");d.classList.add("quadrilateralsContainer"),d.setAttribute("width",0),d.setAttribute("height",0),d.role="none";const f=h.createElement("defs");d.append(f);const p=h.createElement("clipPath"),v=`clippath_${this.data.id}`;p.setAttribute("id",v),p.setAttribute("clipPathUnits","objectBoundingBox"),f.append(p);for(let b=2,S=e.length;b<S;b+=8){const m=e[b],_=e[b+1],w=e[b+2],E=e[b+3],k=h.createElement("rect"),C=(w-t)/c,T=(r-_)/u,R=(m-w)/c,D=(_-E)/u;k.setAttribute("x",C),k.setAttribute("y",T),k.setAttribute("width",R),k.setAttribute("height",D),p.append(k),l==null||l.push(`<rect vector-effect="non-scaling-stroke" x="${C}" y="${T}" width="${R}" height="${D}"/>`)}a(this,Gu)&&(l.push("</g></svg>')"),o.backgroundImage=l.join("")),this.container.append(d),this.container.style.clipPath=`url(#${v})`}_createPopup(e=null){const{data:t}=this;let n,s;e?(n={str:e.text},s=e.date):(n=t.contentsObj,s=t.modificationDate),g(this,Ei,new jw({data:{color:t.color,titleObj:t.titleObj,modificationDate:s,contentsObj:n,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]}))}get hasPopupElement(){return!!(a(this,Ei)||this.popup||this.data.popupRef)}get extraPopupElement(){return a(this,Ei)}render(){Me("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const n=[];if(this._fieldObjects){const s=this._fieldObjects[e];if(s)for(const{page:r,id:o,exportValues:l}of s){if(r===-1||o===t)continue;const c=typeof l=="string"?l:null,u=document.querySelector(`[data-element-id="${o}"]`);if(u&&!tc.has(u)){Z(`_getElementsByName - element not allowed: ${o}`);continue}n.push({id:o,exportValue:c,domElement:u})}return n}for(const s of document.getElementsByName(e)){const{exportValue:r}=s,o=s.getAttribute("data-element-id");o!==t&&tc.has(s)&&n.push({id:o,exportValue:r,domElement:s})}return n}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var n;(n=this.linkService.eventBus)==null||n.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}};_l=new WeakMap,Gu=new WeakMap,Ei=new WeakMap,pp=new WeakSet,Bw=function(e){const{container:{style:t},data:{rect:n,rotation:s},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:o,pageX:l,pageY:c}}}}=this;n==null||n.splice(0,4,...e),t.left=`${100*(e[0]-l)/r}%`,t.top=`${100*(o-e[3]+c)/o}%`,s===0?(t.width=`${100*(e[2]-e[0])/r}%`,t.height=`${100*(e[3]-e[1])/o}%`):this.setRotation(s)};let Je=Kb;class bI extends Je{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.editor=e.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:e}=this;e.hasComment&&this._createPopup(e.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(e){this.editor.comment=e,e||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}}var oi,ba,LC,IC;class Db extends Je{constructor(t,n=null){super(t,{isRenderable:!0,ignoreBorder:!!(n!=null&&n.ignoreBorder),createQuadrilaterals:!0});y(this,oi);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:n}=this,s=document.createElement("a");s.setAttribute("data-element-id",t.id);let r=!1;return t.url?(n.addLinkAttributes(s,t.url,t.newWindow),r=!0):t.action?(this._bindNamedAction(s,t.action,t.overlaidText),r=!0):t.attachment?(A(this,oi,LC).call(this,s,t.attachment,t.overlaidText,t.attachmentDest),r=!0):t.setOCGState?(A(this,oi,IC).call(this,s,t.setOCGState,t.overlaidText),r=!0):t.dest?(this._bindLink(s,t.dest,t.overlaidText),r=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,t),r=!0),t.resetForm?(this._bindResetFormAction(s,t.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(s,""),r=!0)),this.container.classList.add("linkAnnotation"),r&&(this.contentElement=s,this.container.append(s)),this.container}_bindLink(t,n,s=""){t.href=this.linkService.getDestinationHash(n),t.onclick=()=>(n&&this.linkService.goToDestination(n),!1),(n||n==="")&&A(this,oi,ba).call(this),s&&(t.title=s)}_bindNamedAction(t,n,s=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(n),!1),s&&(t.title=s),A(this,oi,ba).call(this)}_bindJSAction(t,n){t.href=this.linkService.getAnchorUrl("");const s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const r of Object.keys(n.actions)){const o=s.get(r);o&&(t[o]=()=>{var l;return(l=this.linkService.eventBus)==null||l.dispatch("dispatcheventinsandbox",{source:this,detail:{id:n.id,name:r}}),!1})}n.overlaidText&&(t.title=n.overlaidText),t.onclick||(t.onclick=()=>!1),A(this,oi,ba).call(this)}_bindResetFormAction(t,n){const s=t.onclick;if(s||(t.href=this.linkService.getAnchorUrl("")),A(this,oi,ba).call(this),!this._fieldObjects){Z('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(t.onclick=()=>!1);return}t.onclick=()=>{var d;s==null||s();const{fields:r,refs:o,include:l}=n,c=[];if(r.length!==0||o.length!==0){const f=new Set(o);for(const p of r){const v=this._fieldObjects[p]||[];for(const{id:b}of v)f.add(b)}for(const p of Object.values(this._fieldObjects))for(const v of p)f.has(v.id)===l&&c.push(v)}else for(const f of Object.values(this._fieldObjects))c.push(...f);const u=this.annotationStorage,h=[];for(const f of c){const{id:p}=f;switch(h.push(p),f.type){case"text":{const b=f.defaultValue||"";u.setValue(p,{value:b});break}case"checkbox":case"radiobutton":{const b=f.defaultValue===f.exportValues;u.setValue(p,{value:b});break}case"combobox":case"listbox":{const b=f.defaultValue||"";u.setValue(p,{value:b});break}default:continue}const v=document.querySelector(`[data-element-id="${p}"]`);if(v){if(!tc.has(v)){Z(`_bindResetFormAction - element not allowed: ${p}`);continue}}else continue;v.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((d=this.linkService.eventBus)==null||d.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:h,name:"ResetForm"}})),!1}}}oi=new WeakSet,ba=function(){this.container.setAttribute("data-internal-link","")},LC=function(t,n,s="",r=null){t.href=this.linkService.getAnchorUrl(""),n.description?t.title=n.description:s&&(t.title=s),t.onclick=()=>{var o;return(o=this.downloadManager)==null||o.openOrDownloadData(n.content,n.filename,r),!1},A(this,oi,ba).call(this)},IC=function(t,n,s=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(n),!1),s&&(t.title=s),A(this,oi,ba).call(this)};class AI extends Je{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(e),this.container}}class rc extends Je{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return Gt.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,n,s,r){n.includes("mouse")?e.addEventListener(n,o=>{var l;(l=this.linkService.eventBus)==null||l.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:r(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):e.addEventListener(n,o=>{var l;if(n==="blur"){if(!t.focused||!o.relatedTarget)return;t.focused=!1}else if(n==="focus"){if(t.focused)return;t.focused=!0}r&&((l=this.linkService.eventBus)==null||l.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:r(o)}}))})}_setEventListeners(e,t,n,s){var r,o,l;for(const[c,u]of n)(u==="Action"||(r=this.data.actions)!=null&&r[u])&&((u==="Focus"||u==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,c,u,s),u==="Focus"&&!((o=this.data.actions)!=null&&o.Blur)?this._setEventListener(e,t,"blur","Blur",null):u==="Blur"&&!((l=this.data.actions)!=null&&l.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":G.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||wI,r=e.style;let o;const l=2,c=u=>Math.round(10*u)/10;if(this.data.multiLine){const u=Math.abs(this.data.rect[3]-this.data.rect[1]-l),h=Math.round(u/(Nv*s))||1,d=u/h;o=Math.min(s,c(d/Nv))}else{const u=Math.abs(this.data.rect[3]-this.data.rect[1]-l);o=Math.min(s,c(u/Nv))}r.fontSize=`calc(${o}px * var(--total-scale-factor))`,r.color=G.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(r.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class SI extends rc{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,n,s){const r=this.annotationStorage;for(const o of this._getElementsByName(e.name,e.id))o.domElement&&(o.domElement[t]=n),r.setValue(o.id,{[s]:n})}render(){var s,r;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){const o=e.getValue(t,{value:this.data.fieldValue});let l=o.value||"";const c=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;c&&l.length>c&&(l=l.slice(0,c));let u=o.formattedValue||((s=this.data.textContent)==null?void 0:s.join(`
`))||null;u&&this.data.comb&&(u=u.replaceAll(/\s+/g,""));const h={userValue:l,formattedValue:u,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=u??l,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type=this.data.password?"password":"text",n.setAttribute("value",u??l),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),tc.add(n),this.contentElement=n,n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=0;const{datetimeFormat:d,datetimeType:f,timeStep:p}=this.data,v=!!f&&this.enableScripting;d&&(n.title=d),this._setRequired(n,this.data.required),c&&(n.maxLength=c),n.addEventListener("input",S=>{e.setValue(t,{value:S.target.value}),this.setPropertyOnSiblings(n,"value",S.target.value,"value"),h.formattedValue=null}),n.addEventListener("resetform",S=>{const m=this.data.defaultFieldValue??"";n.value=h.userValue=m,h.formattedValue=null});let b=S=>{const{formattedValue:m}=h;m!=null&&(S.target.value=m),S.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",m=>{var w;if(h.focused)return;const{target:_}=m;if(v&&(_.type=f,p&&(_.step=p)),h.userValue){const E=h.userValue;if(v)if(f==="time"){const k=new Date(E),C=[k.getHours(),k.getMinutes(),k.getSeconds()];_.value=C.map(T=>T.toString().padStart(2,"0")).join(":")}else _.value=new Date(E-_I).toISOString().split(f==="date"?"T":".",1)[0];else _.value=E}h.lastCommittedValue=_.value,h.commitKey=1,(w=this.data.actions)!=null&&w.Focus||(h.focused=!0)}),n.addEventListener("updatefromsandbox",m=>{this.showElementAndHideCanvas(m.target);const _={value(w){h.userValue=w.detail.value??"",v||e.setValue(t,{value:h.userValue.toString()}),w.target.value=h.userValue},formattedValue(w){const{formattedValue:E}=w.detail;h.formattedValue=E,E!=null&&w.target!==document.activeElement&&(w.target.value=E);const k={formattedValue:E};v&&(k.value=E),e.setValue(t,k)},selRange(w){w.target.setSelectionRange(...w.detail.selRange)},charLimit:w=>{var T;const{charLimit:E}=w.detail,{target:k}=w;if(E===0){k.removeAttribute("maxLength");return}k.setAttribute("maxLength",E);let C=h.userValue;!C||C.length<=E||(C=C.slice(0,E),k.value=h.userValue=C,e.setValue(t,{value:C}),(T=this.linkService.eventBus)==null||T.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:C,willCommit:!0,commitKey:1,selStart:k.selectionStart,selEnd:k.selectionEnd}}))}};this._dispatchEventFromSandbox(_,m)}),n.addEventListener("keydown",m=>{var E;h.commitKey=1;let _=-1;if(m.key==="Escape"?_=0:m.key==="Enter"&&!this.data.multiLine?_=2:m.key==="Tab"&&(h.commitKey=3),_===-1)return;const{value:w}=m.target;h.lastCommittedValue!==w&&(h.lastCommittedValue=w,h.userValue=w,(E=this.linkService.eventBus)==null||E.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:w,willCommit:!0,commitKey:_,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}}))});const S=b;b=null,n.addEventListener("blur",m=>{var E,k;if(!h.focused||!m.relatedTarget)return;(E=this.data.actions)!=null&&E.Blur||(h.focused=!1);const{target:_}=m;let{value:w}=_;if(v){if(w&&f==="time"){const C=w.split(":").map(T=>parseInt(T,10));w=new Date(2e3,0,1,C[0],C[1],C[2]||0).valueOf(),_.step=""}else w.includes("T")||(w=`${w}T00:00`),w=new Date(w).valueOf();_.type="text"}h.userValue=w,h.lastCommittedValue!==w&&((k=this.linkService.eventBus)==null||k.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:w,willCommit:!0,commitKey:h.commitKey,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}})),S(m)}),(r=this.data.actions)!=null&&r.Keystroke&&n.addEventListener("beforeinput",m=>{var D;h.lastCommittedValue=null;const{data:_,target:w}=m,{value:E,selectionStart:k,selectionEnd:C}=w;let T=k,R=C;switch(m.inputType){case"deleteWordBackward":{const O=E.substring(0,k).match(/\w*[^\w]*$/);O&&(T-=O[0].length);break}case"deleteWordForward":{const O=E.substring(k).match(/^[^\w]*\w*/);O&&(R+=O[0].length);break}case"deleteContentBackward":k===C&&(T-=1);break;case"deleteContentForward":k===C&&(R+=1);break}m.preventDefault(),(D=this.linkService.eventBus)==null||D.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:E,change:_||"",willCommit:!1,selStart:T,selEnd:R}})}),this._setEventListeners(n,h,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],m=>m.target.value)}if(b&&n.addEventListener("blur",b),this.data.comb){const m=(this.data.rect[2]-this.data.rect[0])/c;n.classList.add("comb"),n.style.letterSpacing=`calc(${m}px * var(--total-scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class EI extends rc{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class kI extends rc{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,n=t.id;let s=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",e.setValue(n,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const r=document.createElement("input");return tc.add(r),r.setAttribute("data-element-id",n),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=t.fieldName,s&&r.setAttribute("checked",!0),r.setAttribute("exportValue",t.exportValue),r.tabIndex=0,r.addEventListener("change",o=>{const{name:l,checked:c}=o.target;for(const u of this._getElementsByName(l,n)){const h=c&&u.exportValue===t.exportValue;u.domElement&&(u.domElement.checked=h),e.setValue(u.id,{value:h})}e.setValue(n,{value:c})}),r.addEventListener("resetform",o=>{const l=t.defaultFieldValue||"Off";o.target.checked=l===t.exportValue}),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",o=>{const l={value(c){c.target.checked=c.detail.value!=="Off",e.setValue(n,{value:c.target.checked})}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class DC extends rc{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,n=t.id;let s=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;if(typeof s=="string"&&(s=s!==t.buttonValue,e.setValue(n,{value:s})),s)for(const o of this._getElementsByName(t.fieldName,n))e.setValue(o.id,{value:!1});const r=document.createElement("input");if(tc.add(r),r.setAttribute("data-element-id",n),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=t.fieldName,s&&r.setAttribute("checked",!0),r.tabIndex=0,r.addEventListener("change",o=>{const{name:l,checked:c}=o.target;for(const u of this._getElementsByName(l,n))e.setValue(u.id,{value:!1});e.setValue(n,{value:c})}),r.addEventListener("resetform",o=>{const l=t.defaultFieldValue;o.target.checked=l!=null&&l===t.buttonValue}),this.enableScripting&&this.hasJSActions){const o=t.buttonValue;r.addEventListener("updatefromsandbox",l=>{const c={value:u=>{const h=o===u.detail.value;for(const d of this._getElementsByName(u.target.name)){const f=h&&d.id===n;d.domElement&&(d.domElement.checked=f),e.setValue(d.id,{value:f})}}};this._dispatchEventFromSandbox(c,l)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],l=>l.target.checked)}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class CI extends Db{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),e}}class TI extends rc{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),s=document.createElement("select");tc.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=0;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",h=>{const d=this.data.defaultFieldValue;for(const f of s.options)f.selected=f.value===d});for(const h of this.data.options){const d=document.createElement("option");d.textContent=h.displayValue,d.value=h.exportValue,n.value.includes(h.exportValue)&&(d.setAttribute("selected",!0),r=!1),s.append(d)}let o=null;if(r){const h=document.createElement("option");h.value=" ",h.setAttribute("hidden",!0),h.setAttribute("selected",!0),s.prepend(h),o=()=>{h.remove(),s.removeEventListener("input",o),o=null},s.addEventListener("input",o)}const l=h=>{const d=h?"value":"textContent",{options:f,multiple:p}=s;return p?Array.prototype.filter.call(f,v=>v.selected).map(v=>v[d]):f.selectedIndex===-1?null:f[f.selectedIndex][d]};let c=l(!1);const u=h=>{const d=h.target.options;return Array.prototype.map.call(d,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",h=>{const d={value(f){o==null||o();const p=f.detail.value,v=new Set(Array.isArray(p)?p:[p]);for(const b of s.options)b.selected=v.has(b.value);e.setValue(t,{value:l(!0)}),c=l(!1)},multipleSelection(f){s.multiple=!0},remove(f){const p=s.options,v=f.detail.remove;p[v].selected=!1,s.remove(v),p.length>0&&Array.prototype.findIndex.call(p,S=>S.selected)===-1&&(p[0].selected=!0),e.setValue(t,{value:l(!0),items:u(f)}),c=l(!1)},clear(f){for(;s.length!==0;)s.remove(0);e.setValue(t,{value:null,items:[]}),c=l(!1)},insert(f){const{index:p,displayValue:v,exportValue:b}=f.detail.insert,S=s.children[p],m=document.createElement("option");m.textContent=v,m.value=b,S?S.before(m):s.append(m),e.setValue(t,{value:l(!0),items:u(f)}),c=l(!1)},items(f){const{items:p}=f.detail;for(;s.length!==0;)s.remove(0);for(const v of p){const{displayValue:b,exportValue:S}=v,m=document.createElement("option");m.textContent=b,m.value=S,s.append(m)}s.options.length>0&&(s.options[0].selected=!0),e.setValue(t,{value:l(!0),items:u(f)}),c=l(!1)},indices(f){const p=new Set(f.detail.indices);for(const v of f.target.options)v.selected=p.has(v.index);e.setValue(t,{value:l(!0)}),c=l(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(d,h)}),s.addEventListener("input",h=>{var p;const d=l(!0),f=l(!1);e.setValue(t,{value:d}),h.preventDefault(),(p=this.linkService.eventBus)==null||p.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:c,change:f,changeEx:d,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],h=>h.target.value)):s.addEventListener("input",function(h){e.setValue(t,{value:l(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}var gp,$w;class jw extends Je{constructor(t){const{data:n,elements:s,parent:r}=t,o=!!r._commentManager;super(t,{isRenderable:!o&&Je._hasPopupData(n)});y(this,gp);if(this.elements=s,o&&Je._hasPopupData(n)){const l=this.popup=A(this,gp,$w).call(this);for(const c of s)c.popup=l}else this.popup=null}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const n=this.popup=A(this,gp,$w).call(this),s=[];for(const r of this.elements)r.popup=n,r.container.ariaHasPopup="dialog",s.push(r.data.id),r.addHighlightArea();return this.container.setAttribute("aria-controls",s.map(r=>`${Nc}${r}`).join(",")),this.container}}gp=new WeakSet,$w=function(){return new xI({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})};var Vn,Io,xy,Py,qu,Ku,nt,Ls,Do,bl,Xu,Yu,Is,Gn,Ar,Sr,it,Er,Oo,mp,kr,Qu,Al,Mo,Tt,No,ae,um,Uw,zw,Hw,hm,Ww,OC,MC,NC,FC,dm,fm,Vw;class xI{constructor({container:e,color:t,elements:n,titleObj:s,modificationDate:r,contentsObj:o,richText:l,parent:c,rect:u,parentRect:h,open:d,commentManager:f=null}){y(this,ae);y(this,Vn,null);y(this,Io,A(this,ae,NC).bind(this));y(this,xy,A(this,ae,Vw).bind(this));y(this,Py,A(this,ae,fm).bind(this));y(this,qu,A(this,ae,dm).bind(this));y(this,Ku,null);y(this,nt,null);y(this,Ls,null);y(this,Do,null);y(this,bl,null);y(this,Xu,null);y(this,Yu,null);y(this,Is,!1);y(this,Gn,null);y(this,Ar,null);y(this,Sr,null);y(this,it,null);y(this,Er,null);y(this,Oo,null);y(this,mp,null);y(this,kr,null);y(this,Qu,null);y(this,Al,null);y(this,Mo,!1);y(this,Tt,null);y(this,No,null);g(this,nt,e),g(this,Qu,s),g(this,Ls,o),g(this,kr,l),g(this,Xu,c),g(this,Ku,t),g(this,mp,u),g(this,Yu,h),g(this,bl,n),g(this,Vn,f),g(this,Tt,n[0]),g(this,Do,ty.toDateObject(r)),this.trigger=n.flatMap(p=>p.getElementsToTriggerPopup()),f||(A(this,ae,um).call(this),a(this,nt).hidden=!0,d&&A(this,ae,dm).call(this))}renderCommentButton(){if(a(this,it)){a(this,it).parentNode||a(this,Tt).container.after(a(this,it));return}if(a(this,Er)||A(this,ae,Uw).call(this),!a(this,Er))return;const{signal:e}=g(this,Ar,new AbortController),t=a(this,Tt).hasOwnCommentButton,n=()=>{a(this,Vn).toggleCommentPopup(this,!0,void 0,!t)},s=()=>{a(this,Vn).toggleCommentPopup(this,!1,!0,!t)},r=()=>{a(this,Vn).toggleCommentPopup(this,!1,!1)};if(t){g(this,it,a(this,Tt).container);for(const o of this.trigger)o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.addEventListener("keydown",a(this,Io),{signal:e}),o.addEventListener("click",n,{signal:e}),o.addEventListener("pointerenter",s,{signal:e}),o.addEventListener("pointerleave",r,{signal:e}),o.classList.add("popupTriggerArea")}else{const o=g(this,it,document.createElement("button"));o.className="annotationCommentButton";const l=a(this,Tt).container;o.style.zIndex=l.style.zIndex+1,o.tabIndex=0,o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.setAttribute("data-l10n-id","pdfjs-show-comment-button"),A(this,ae,Hw).call(this),A(this,ae,zw).call(this),o.addEventListener("keydown",a(this,Io),{signal:e}),o.addEventListener("click",n,{signal:e}),o.addEventListener("pointerenter",s,{signal:e}),o.addEventListener("pointerleave",r,{signal:e}),l.after(o)}}get commentButtonColor(){const{color:e,opacity:t}=a(this,Tt).commentData;return e?a(this,Xu)._commentManager.makeCommentColor(e,t):null}focusCommentButton(){setTimeout(()=>{var e;(e=a(this,it))==null||e.focus()},0)}getData(){const{richText:e,color:t,opacity:n,creationDate:s,modificationDate:r}=a(this,Tt).commentData;return{contentsObj:{str:this.comment},richText:e,color:t,opacity:n,creationDate:s,modificationDate:r}}get elementBeforePopup(){return a(this,it)}get comment(){return a(this,No)||g(this,No,a(this,Tt).commentText),a(this,No)}set comment(e){e!==this.comment&&(a(this,Tt).commentText=g(this,No,e))}focus(){var e;(e=a(this,Tt).container)==null||e.focus()}get parentBoundingClientRect(){return a(this,Tt).layer.getBoundingClientRect()}setCommentButtonStates({selected:e,hasPopup:t}){a(this,it)&&(a(this,it).classList.toggle("selected",e),a(this,it).ariaExpanded=t)}setSelectedCommentButton(e){a(this,it).classList.toggle("selected",e)}get commentPopupPosition(){if(a(this,Oo))return a(this,Oo);const{x:e,y:t,height:n}=a(this,it).getBoundingClientRect(),{x:s,y:r,width:o,height:l}=a(this,Tt).layer.getBoundingClientRect();return[(e-s)/o,(t+n-r)/l]}set commentPopupPosition(e){g(this,Oo,e)}hasDefaultPopupPosition(){return a(this,Oo)===null}get commentButtonPosition(){return a(this,Er)}get commentButtonWidth(){return a(this,it).getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(e){const[t,n]=a(this,Oo)||this.commentButtonPosition.map(u=>u/100),s=this.parentBoundingClientRect,{x:r,y:o,width:l,height:c}=s;a(this,Vn).showDialog(null,this,r+t*l,o+n*c,{...e,parentDimensions:s})}render(){var n,s;if(a(this,Gn))return;const e=g(this,Gn,document.createElement("div"));if(e.className="popup",a(this,Ku)){const r=e.style.outlineColor=G.makeHexColor(...a(this,Ku));e.style.backgroundColor=`color-mix(in srgb, ${r} 30%, white)`}const t=document.createElement("span");if(t.className="header",(n=a(this,Qu))!=null&&n.str){const r=document.createElement("span");r.className="title",t.append(r),{dir:r.dir,str:r.textContent}=a(this,Qu)}if(e.append(t),a(this,Do)){const r=document.createElement("time");r.className="popupDate",r.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),r.setAttribute("data-l10n-args",JSON.stringify({dateObj:a(this,Do).valueOf()})),r.dateTime=a(this,Do).toISOString(),t.append(r)}Ek({html:a(this,ae,hm)||a(this,Ls).str,dir:(s=a(this,Ls))==null?void 0:s.dir,className:"popupContent"},e),a(this,nt).append(e)}updateEdited({rect:e,popup:t,deleted:n}){var s;if(a(this,Vn)){n?(this.remove(),g(this,No,null)):t&&(t.deleted?this.remove():(A(this,ae,Hw).call(this),g(this,No,t.text))),e&&(g(this,Er,null),A(this,ae,Uw).call(this),A(this,ae,zw).call(this));return}if(n||t!=null&&t.deleted){this.remove();return}A(this,ae,um).call(this),a(this,Al)||g(this,Al,{contentsObj:a(this,Ls),richText:a(this,kr)}),e&&g(this,Sr,null),t&&t.text&&(g(this,kr,A(this,ae,MC).call(this,t.text)),g(this,Do,ty.toDateObject(t.date)),g(this,Ls,null)),(s=a(this,Gn))==null||s.remove(),g(this,Gn,null)}resetEdited(){var e;a(this,Al)&&({contentsObj:gt(this,Ls)._,richText:gt(this,kr)._}=a(this,Al),g(this,Al,null),(e=a(this,Gn))==null||e.remove(),g(this,Gn,null),g(this,Sr,null))}remove(){var e,t,n;if((e=a(this,Ar))==null||e.abort(),g(this,Ar,null),(t=a(this,Gn))==null||t.remove(),g(this,Gn,null),g(this,Mo,!1),g(this,Is,!1),(n=a(this,it))==null||n.remove(),g(this,it,null),this.trigger)for(const s of this.trigger)s.classList.remove("popupTriggerArea")}forceHide(){g(this,Mo,this.isVisible),a(this,Mo)&&(a(this,nt).hidden=!0)}maybeShow(){a(this,Vn)||(A(this,ae,um).call(this),a(this,Mo)&&(a(this,Gn)||A(this,ae,fm).call(this),g(this,Mo,!1),a(this,nt).hidden=!1))}get isVisible(){return a(this,Vn)?!1:a(this,nt).hidden===!1}}Vn=new WeakMap,Io=new WeakMap,xy=new WeakMap,Py=new WeakMap,qu=new WeakMap,Ku=new WeakMap,nt=new WeakMap,Ls=new WeakMap,Do=new WeakMap,bl=new WeakMap,Xu=new WeakMap,Yu=new WeakMap,Is=new WeakMap,Gn=new WeakMap,Ar=new WeakMap,Sr=new WeakMap,it=new WeakMap,Er=new WeakMap,Oo=new WeakMap,mp=new WeakMap,kr=new WeakMap,Qu=new WeakMap,Al=new WeakMap,Mo=new WeakMap,Tt=new WeakMap,No=new WeakMap,ae=new WeakSet,um=function(){var t;if(a(this,Ar))return;g(this,Ar,new AbortController);const{signal:e}=a(this,Ar);for(const n of this.trigger)n.addEventListener("click",a(this,qu),{signal:e}),n.addEventListener("pointerenter",a(this,Py),{signal:e}),n.addEventListener("pointerleave",a(this,xy),{signal:e}),n.classList.add("popupTriggerArea");for(const n of a(this,bl))(t=n.container)==null||t.addEventListener("keydown",a(this,Io),{signal:e})},Uw=function(){const e=a(this,bl).find(t=>t.hasCommentButton);e&&g(this,Er,e._normalizePoint(e.commentButtonPosition))},zw=function(){if(a(this,Tt).extraPopupElement&&!a(this,Tt).editor)return;a(this,it)||this.renderCommentButton();const[e,t]=a(this,Er),{style:n}=a(this,it);n.left=`calc(${e}%)`,n.top=`calc(${t}% - var(--comment-button-dim))`},Hw=function(){a(this,Tt).extraPopupElement||(a(this,it)||this.renderCommentButton(),a(this,it).style.backgroundColor=this.commentButtonColor||"")},hm=function(){const e=a(this,kr),t=a(this,Ls);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&a(this,kr).html||null},Ww=function(){var e,t,n;return((n=(t=(e=a(this,ae,hm))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.fontSize)||0},OC=function(){var e,t,n;return((n=(t=(e=a(this,ae,hm))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.color)||null},MC=function(e){const t=[],n={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},s={style:{color:a(this,ae,OC),fontSize:a(this,ae,Ww)?`calc(${a(this,ae,Ww)}px * var(--total-scale-factor))`:""}};for(const r of e.split(`
`))t.push({name:"span",value:r,attributes:s});return n},NC=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&a(this,Is))&&A(this,ae,dm).call(this)},FC=function(){if(a(this,Sr)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:s,pageY:r}}}=a(this,Xu);let o=!!a(this,Yu),l=o?a(this,Yu):a(this,mp);for(const v of a(this,bl))if(!l||G.intersect(v.data.rect,l)!==null){l=v.data.rect,o=!0;break}const c=G.normalizeRect([l[0],e[3]-l[1]+e[1],l[2],e[3]-l[3]+e[1]]),h=o?l[2]-l[0]+5:0,d=c[0]+h,f=c[1];g(this,Sr,[100*(d-s)/t,100*(f-r)/n]);const{style:p}=a(this,nt);p.left=`${a(this,Sr)[0]}%`,p.top=`${a(this,Sr)[1]}%`},dm=function(){if(a(this,Vn)){a(this,Vn).toggleCommentPopup(this,!1);return}g(this,Is,!a(this,Is)),a(this,Is)?(A(this,ae,fm).call(this),a(this,nt).addEventListener("click",a(this,qu)),a(this,nt).addEventListener("keydown",a(this,Io))):(A(this,ae,Vw).call(this),a(this,nt).removeEventListener("click",a(this,qu)),a(this,nt).removeEventListener("keydown",a(this,Io)))},fm=function(){a(this,Gn)||this.render(),this.isVisible?a(this,Is)&&a(this,nt).classList.add("focused"):(A(this,ae,FC).call(this),a(this,nt).hidden=!1,a(this,nt).style.zIndex=parseInt(a(this,nt).style.zIndex)+1e3)},Vw=function(){a(this,nt).classList.remove("focused"),!(a(this,Is)||!this.isVisible)&&(a(this,nt).hidden=!0,a(this,nt).style.zIndex=parseInt(a(this,nt).style.zIndex)-1e3)};class BC extends Je{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=ne.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=this.contentElement=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const n=document.createElement("span");n.textContent=t,e.append(n)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}var yp;class PI extends Je{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});y(this,yp,null)}render(){this.container.classList.add("lineAnnotation");const{data:t,width:n,height:s}=this,r=this.svgFactory.create(n,s,!0),o=g(this,yp,this.svgFactory.createElement("svg:line"));return o.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),o.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),o.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),o.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),o.setAttribute("stroke-width",t.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return a(this,yp)}addHighlightArea(){this.container.classList.add("highlightArea")}}yp=new WeakMap;var vp;class RI extends Je{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});y(this,vp,null)}render(){this.container.classList.add("squareAnnotation");const{data:t,width:n,height:s}=this,r=this.svgFactory.create(n,s,!0),o=t.borderStyle.width,l=g(this,vp,this.svgFactory.createElement("svg:rect"));return l.setAttribute("x",o/2),l.setAttribute("y",o/2),l.setAttribute("width",n-o),l.setAttribute("height",s-o),l.setAttribute("stroke-width",o||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),r.append(l),this.container.append(r),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return a(this,vp)}addHighlightArea(){this.container.classList.add("highlightArea")}}vp=new WeakMap;var wp;class LI extends Je{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});y(this,wp,null)}render(){this.container.classList.add("circleAnnotation");const{data:t,width:n,height:s}=this,r=this.svgFactory.create(n,s,!0),o=t.borderStyle.width,l=g(this,wp,this.svgFactory.createElement("svg:ellipse"));return l.setAttribute("cx",n/2),l.setAttribute("cy",s/2),l.setAttribute("rx",n/2-o/2),l.setAttribute("ry",s/2-o/2),l.setAttribute("stroke-width",o||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),r.append(l),this.container.append(r),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return a(this,wp)}addHighlightArea(){this.container.classList.add("highlightArea")}}wp=new WeakMap;var _p;class jC extends Je{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});y(this,_p,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:n,borderStyle:s,popupRef:r},width:o,height:l}=this;if(!n)return this.container;const c=this.svgFactory.create(o,l,!0);let u=[];for(let d=0,f=n.length;d<f;d+=2){const p=n[d]-t[0],v=t[3]-n[d+1];u.push(`${p},${v}`)}u=u.join(" ");const h=g(this,_p,this.svgFactory.createElement(this.svgElementName));return h.setAttribute("points",u),h.setAttribute("stroke-width",s.width||1),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),c.append(h),this.container.append(c),!r&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return a(this,_p)}addHighlightArea(){this.container.classList.add("highlightArea")}}_p=new WeakMap;class II extends jC{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class DI extends Je{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}}var bp,Sl,Ap,Gw;class Ob extends Je{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});y(this,Ap);y(this,bp,null);y(this,Sl,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?ne.HIGHLIGHT:ne.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:n,inkLists:s,borderStyle:r,popupRef:o}}=this,{transform:l,width:c,height:u}=A(this,Ap,Gw).call(this,n,t),h=this.svgFactory.create(c,u,!0),d=g(this,bp,this.svgFactory.createElement("svg:g"));h.append(d),d.setAttribute("stroke-width",r.width||1),d.setAttribute("stroke-linecap","round"),d.setAttribute("stroke-linejoin","round"),d.setAttribute("stroke-miterlimit",10),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),d.setAttribute("transform",l);for(let f=0,p=s.length;f<p;f++){const v=this.svgFactory.createElement(this.svgElementName);a(this,Sl).push(v),v.setAttribute("points",s[f].join(",")),d.append(v)}return!o&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(h),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:n,points:s,rect:r}=t,o=a(this,bp);if(n>=0&&o.setAttribute("stroke-width",n||1),s)for(let l=0,c=a(this,Sl).length;l<c;l++)a(this,Sl)[l].setAttribute("points",s[l].join(","));if(r){const{transform:l,width:c,height:u}=A(this,Ap,Gw).call(this,this.data.rotation,r);o.parentElement.setAttribute("viewBox",`0 0 ${c} ${u}`),o.setAttribute("transform",l)}}getElementsToTriggerPopup(){return a(this,Sl)}addHighlightArea(){this.container.classList.add("highlightArea")}}bp=new WeakMap,Sl=new WeakMap,Ap=new WeakSet,Gw=function(t,n){switch(t){case 90:return{transform:`rotate(90) translate(${-n[0]},${n[1]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};case 180:return{transform:`rotate(180) translate(${-n[2]},${n[1]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]};case 270:return{transform:`rotate(270) translate(${-n[2]},${n[3]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};default:return{transform:`translate(${-n[0]},${n[3]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]}}};class $C extends Je{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=ne.HIGHLIGHT}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){const n=document.createElement("mark");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class OI extends Je{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),e){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class MI extends Je{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),e){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class NI extends Je{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),e){const n=document.createElement("s");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class UC extends Je{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=ne.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}var Sp,Ep,qw;class FI extends Je{constructor(t){var s;super(t,{isRenderable:!0});y(this,Ep);y(this,Sp,null);const{file:n}=this.data;this.filename=n.filename,this.content=n.content,(s=this.linkService.eventBus)==null||s.dispatch("fileattachmentannotation",{source:this,...n})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:n}=this;let s;n.hasAppearance||n.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(n.name)?"paperclip":"pushpin"}.svg`,n.fillAlpha&&n.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(n.fillAlpha*100)}%);`)),s.addEventListener("dblclick",A(this,Ep,qw).bind(this)),g(this,Sp,s);const{isMac:r}=Gt.platform;return t.addEventListener("keydown",o=>{o.key==="Enter"&&(r?o.metaKey:o.ctrlKey)&&A(this,Ep,qw).call(this)}),!n.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):s.classList.add("popupTriggerArea"),t.append(s),t}getElementsToTriggerPopup(){return a(this,Sp)}addHighlightArea(){this.container.classList.add("highlightArea")}}Sp=new WeakMap,Ep=new WeakSet,qw=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var El,kl,Ju,Fo,kp,Cl,qn,Cp,Br,pm,Xw;const Xb=class Xb{constructor({div:e,accessibilityManager:t,annotationCanvasMap:n,annotationEditorUIManager:s,page:r,viewport:o,structTreeLayer:l,commentManager:c,linkService:u,annotationStorage:h}){y(this,Br);y(this,El,null);y(this,kl,null);y(this,Ju,null);y(this,Fo,new Map);y(this,kp,null);y(this,Cl,null);y(this,qn,[]);y(this,Cp,!1);this.div=e,g(this,El,t),g(this,kl,n),g(this,kp,l||null),g(this,Cl,u||null),g(this,Ju,h||new Rb),this.page=r,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=s,this._commentManager=c||null}hasEditableAnnotations(){return a(this,Fo).size>0}async render(e){var l;const{annotations:t}=e,n=this.div;Zl(n,this.viewport);const s=new Map,r=[],o={data:null,layer:n,linkService:a(this,Cl),downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new cy,annotationStorage:a(this,Ju),enableComment:e.enableComment===!0,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const c of t){if(c.noHTML)continue;const u=c.annotationType===ht.POPUP;if(u){const f=s.get(c.id);if(!f)continue;if(!this._commentManager){r.push(c);continue}o.elements=f}else if(c.rect[2]===c.rect[0]||c.rect[3]===c.rect[1])continue;o.data=c;const h=Wv.create(o);if(!h.isRenderable)continue;if(!u&&(a(this,qn).push(h),c.popupRef)){const f=s.get(c.popupRef);f?f.push(h):s.set(c.popupRef,[h])}const d=h.render();c.hidden&&(d.style.visibility="hidden"),h._isEditable&&(a(this,Fo).set(h.data.id,h),(l=this._annotationEditorUIManager)==null||l.renderAnnotationElement(h))}await A(this,Br,pm).call(this);for(const c of r){const u=o.elements=s.get(c.id);o.data=c;const h=Wv.create(o);if(!h.isRenderable)continue;const d=h.render();h.contentElement.id=`${Nc}${c.id}`,c.hidden&&(d.style.visibility="hidden"),u.at(-1).container.after(d)}A(this,Br,Xw).call(this)}async addLinkAnnotations(e){const t={data:null,layer:this.div,linkService:a(this,Cl),svgFactory:new cy,parent:this};for(const n of e){n.borderStyle||(n.borderStyle=Xb._defaultBorderStyle),t.data=n;const s=Wv.create(t);s.isRenderable&&(s.render(),s.contentElement.id=`${Nc}${n.id}`,a(this,qn).push(s))}await A(this,Br,pm).call(this)}update({viewport:e}){const t=this.div;this.viewport=e,Zl(t,{rotation:e.rotation}),A(this,Br,Xw).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(a(this,Fo).values())}getEditableAnnotation(e){return a(this,Fo).get(e)}addFakeAnnotation(e){const{div:t}=this,{id:n,rotation:s}=e,r=new bI({data:{id:n,rect:e.getPDFRect(),rotation:s},editor:e,layer:t,parent:this,enableComment:!!this._commentManager,linkService:a(this,Cl),annotationStorage:a(this,Ju)});return r.render(),r.contentElement.id=`${Nc}${n}`,r.createOrUpdatePopup(),a(this,qn).push(r),r}removeAnnotation(e){var s;const t=a(this,qn).findIndex(r=>r.data.id===e);if(t<0)return;const[n]=a(this,qn).splice(t,1);(s=a(this,El))==null||s.removePointerInTextLayer(n.contentElement)}updateFakeAnnotations(e){if(e.length!==0){for(const t of e)t.updateFakeAnnotationElement(this);A(this,Br,pm).call(this)}}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}static get _defaultBorderStyle(){return re(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:pc.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}};El=new WeakMap,kl=new WeakMap,Ju=new WeakMap,Fo=new WeakMap,kp=new WeakMap,Cl=new WeakMap,qn=new WeakMap,Cp=new WeakMap,Br=new WeakSet,pm=async function(){var n,s,r;if(a(this,qn).length===0)return;this.div.replaceChildren();const e=[];if(!a(this,Cp)){g(this,Cp,!0);for(const{contentElement:o,data:{id:l}}of a(this,qn)){const c=o.id=`${Nc}${l}`;e.push((n=a(this,kp))==null?void 0:n.getAriaAttributes(c).then(u=>{if(u)for(const[h,d]of u)o.setAttribute(h,d)}))}}a(this,qn).sort(({data:{rect:[o,l,c,u]}},{data:{rect:[h,d,f,p]}})=>{if(o===c&&l===u)return 1;if(h===f&&d===p)return-1;const v=u,b=l,S=(l+u)/2,m=p,_=d,w=(d+p)/2;if(S>=m&&w<=b)return-1;if(w>=v&&S<=_)return 1;const E=(o+c)/2,k=(h+f)/2;return E-k});const t=document.createDocumentFragment();for(const o of a(this,qn))t.append(o.container),this._commentManager?(r=((s=o.extraPopupElement)==null?void 0:s.popup)||o.popup)==null||r.renderCommentButton():o.extraPopupElement&&t.append(o.extraPopupElement.render());if(this.div.append(t),await Promise.all(e),a(this,El))for(const o of a(this,qn))a(this,El).addPointerInTextLayer(o.contentElement,!1)},Xw=function(){var t;if(!a(this,kl))return;const e=this.div;for(const[n,s]of a(this,kl)){const r=e.querySelector(`[data-annotation-id="${n}"]`);if(!r)continue;s.className="annotationContent";const{firstChild:o}=r;o?o.nodeName==="CANVAS"?o.replaceWith(s):o.classList.contains("annotationContent")?o.after(s):o.before(s):r.append(s);const l=a(this,Fo).get(n);l&&(l._hasNoCanvas?((t=this._annotationEditorUIManager)==null||t.setMissingCanvas(n,r.id,s),l._hasNoCanvas=!1):l.canvas=s)}a(this,kl).clear()};let Kw=Xb;const Lg=/\r\n?|\n/g;var Kn,Tp,Tl,Xn,pt,zC,HC,WC,gm,jr,mm,ym,VC,Qw,GC;const ze=class ze extends $e{constructor(t){super({...t,name:"freeTextEditor"});y(this,pt);y(this,Kn,"");y(this,Tp,`${this.id}-editor`);y(this,Tl,null);y(this,Xn);F(this,"_colorPicker",null);this.color=t.color||ze._defaultColor||$e._defaultLineColor,g(this,Xn,t.fontSize||ze._defaultFontSize),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static get _keyboardManager(){const t=ze.prototype,n=o=>o.isEmpty(),s=ec.TRANSLATE_SMALL,r=ec.TRANSLATE_BIG;return re(this,"_keyboardManager",new tg([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:n}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:n}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[s,0],checker:n}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[r,0],checker:n}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:n}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:n}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,s],checker:n}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,r],checker:n}]]))}static initialize(t,n){$e.initialize(t,n);const s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,n){switch(t){case pe.FREETEXT_SIZE:ze._defaultFontSize=n;break;case pe.FREETEXT_COLOR:ze._defaultColor=n;break}}updateParams(t,n){switch(t){case pe.FREETEXT_SIZE:A(this,pt,zC).call(this,n);break;case pe.FREETEXT_COLOR:A(this,pt,HC).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[pe.FREETEXT_SIZE,ze._defaultFontSize],[pe.FREETEXT_COLOR,ze._defaultColor||$e._defaultLineColor]]}get propertiesToUpdate(){return[[pe.FREETEXT_SIZE,a(this,Xn)],[pe.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new ly(this)),[["colorPicker",this._colorPicker]]}get colorType(){return pe.FREETEXT_COLOR}onUpdatedColor(){var t;this.editorDiv.style.color=this.color,(t=this._colorPicker)==null||t.update(this.color),super.onUpdatedColor()}_translateEmpty(t,n){this._uiManager.translateSelectedEditors(t,n,!0)}getInitialTranslation(){const t=this.parentScale;return[-ze._internalPadding*t,-(ze._internalPadding+a(this,Xn))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),g(this,Tl,new AbortController);const t=this._uiManager.combinedSignal(a(this,Tl));return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){var t;return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",a(this,Tp)),this._isDraggable=!0,(t=a(this,Tl))==null||t.abort(),g(this,Tl,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var n;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(n=this._initialOptions)!=null&&n.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=a(this,Kn),n=g(this,Kn,A(this,pt,WC).call(this).trimEnd());if(t===n)return;const s=r=>{if(g(this,Kn,r),!r){this.remove();return}A(this,pt,ym).call(this),this._uiManager.rebuild(this),A(this,pt,gm).call(this)};this.addCommands({cmd:()=>{s(n)},undo:()=>{s(t)},mustExec:!1}),A(this,pt,gm).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){ze._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,n;(this._isCopy||this.annotationElementId)&&(t=this.x,n=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",a(this,Tp)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:s}=this.editorDiv;if(s.fontSize=`calc(${a(this,Xn)}px * var(--total-scale-factor))`,s.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[r,o]=this.parentDimensions;if(this.annotationElementId){const{position:l}=this._initialData;let[c,u]=this.getInitialTranslation();[c,u]=this.pageTranslationToScreen(c,u);const[h,d]=this.pageDimensions,[f,p]=this.pageTranslation;let v,b;switch(this.rotation){case 0:v=t+(l[0]-f)/h,b=n+this.height-(l[1]-p)/d;break;case 90:v=t+(l[0]-f)/h,b=n-(l[1]-p)/d,[c,u]=[u,-c];break;case 180:v=t-this.width+(l[0]-f)/h,b=n-(l[1]-p)/d,[c,u]=[-c,-u];break;case 270:v=t+(l[0]-f-this.height*d)/h,b=n+(l[1]-p-this.width*h)/d,[c,u]=[-u,c];break}this.setAt(v*r,b*o,c,u)}else this._moveAfterPaste(t,n);A(this,pt,ym).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var v,b,S;const n=t.clipboardData||window.clipboardData,{types:s}=n;if(s.length===1&&s[0]==="text/plain")return;t.preventDefault();const r=A(v=ze,jr,Qw).call(v,n.getData("text")||"").replaceAll(Lg,`
`);if(!r)return;const o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();const l=o.getRangeAt(0);if(!r.includes(`
`)){l.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),o.collapseToStart();return}const{startContainer:c,startOffset:u}=l,h=[],d=[];if(c.nodeType===Node.TEXT_NODE){const m=c.parentElement;if(d.push(c.nodeValue.slice(u).replaceAll(Lg,"")),m!==this.editorDiv){let _=h;for(const w of this.editorDiv.childNodes){if(w===m){_=d;continue}_.push(A(b=ze,jr,mm).call(b,w))}}h.push(c.nodeValue.slice(0,u).replaceAll(Lg,""))}else if(c===this.editorDiv){let m=h,_=0;for(const w of this.editorDiv.childNodes)_++===u&&(m=d),m.push(A(S=ze,jr,mm).call(S,w))}g(this,Kn,`${h.join(`
`)}${r}${d.join(`
`)}`),A(this,pt,ym).call(this);const f=new Range;let p=Math.sumPrecise(h.map(m=>m.length));for(const{firstChild:m}of this.editorDiv.childNodes)if(m.nodeType===Node.TEXT_NODE){const _=m.nodeValue.length;if(p<=_){f.setStart(m,p),f.setEnd(m,p);break}p-=_}o.removeAllRanges(),o.addRange(f)}get contentDiv(){return this.editorDiv}getPDFRect(){const t=ze._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,n,s){var l;let r=null;if(t instanceof BC){const{data:{defaultAppearanceData:{fontSize:c,fontColor:u},rect:h,rotation:d,id:f,popupRef:p,richText:v,contentsObj:b,creationDate:S,modificationDate:m},textContent:_,textPosition:w,parent:{page:{pageNumber:E}}}=t;if(!_||_.length===0)return null;r=t={annotationType:ne.FREETEXT,color:Array.from(u),fontSize:c,value:_.join(`
`),position:w,pageIndex:E-1,rect:h.slice(0),rotation:d,annotationElementId:f,id:f,deleted:!1,popupRef:p,comment:(b==null?void 0:b.str)||null,richText:v,creationDate:S,modificationDate:m}}const o=await super.deserialize(t,n,s);return g(o,Xn,t.fontSize),o.color=G.makeHexColor(...t.color),g(o,Kn,A(l=ze,jr,Qw).call(l,t.value)),o._initialData=r,t.comment&&o.setCommentData(t),o}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n=$e._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),s=Object.assign(super.serialize(t),{color:n,fontSize:a(this,Xn),value:A(this,pt,VC).call(this)});return this.addComment(s),t?(s.isCopy=!0,s):this.annotationElementId&&!A(this,pt,GC).call(this,s)?null:(s.id=this.annotationElementId,s)}renderAnnotationElement(t){const n=super.renderAnnotationElement(t);if(!n)return null;const{style:s}=n;s.fontSize=`calc(${a(this,Xn)}px * var(--total-scale-factor))`,s.color=this.color,n.replaceChildren();for(const r of a(this,Kn).split(`
`)){const o=document.createElement("div");o.append(r?document.createTextNode(r):document.createElement("br")),n.append(o)}return t.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:a(this,Kn)}}),n}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};Kn=new WeakMap,Tp=new WeakMap,Tl=new WeakMap,Xn=new WeakMap,pt=new WeakSet,zC=function(t){const n=r=>{this.editorDiv.style.fontSize=`calc(${r}px * var(--total-scale-factor))`,this.translate(0,-(r-a(this,Xn))*this.parentScale),g(this,Xn,r),A(this,pt,gm).call(this)},s=a(this,Xn);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:pe.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},HC=function(t){const n=r=>{this.color=r,this.onUpdatedColor()},s=this.color;this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:pe.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},WC=function(){var s;const t=[];this.editorDiv.normalize();let n=null;for(const r of this.editorDiv.childNodes)(n==null?void 0:n.nodeType)===Node.TEXT_NODE&&r.nodeName==="BR"||(t.push(A(s=ze,jr,mm).call(s,r)),n=r);return t.join(`
`)},gm=function(){const[t,n]=this.parentDimensions;let s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{const{currentLayer:r,div:o}=this,l=o.style.display,c=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",r.div.append(this.div),s=o.getBoundingClientRect(),o.remove(),o.style.display=l,o.classList.toggle("hidden",c)}this.rotation%180===this.parentRotation%180?(this.width=s.width/t,this.height=s.height/n):(this.width=s.height/t,this.height=s.width/n),this.fixAndSetPosition()},jr=new WeakSet,mm=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Lg,"")},ym=function(){if(this.editorDiv.replaceChildren(),!!a(this,Kn))for(const t of a(this,Kn).split(`
`)){const n=document.createElement("div");n.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(n)}},VC=function(){return a(this,Kn).replaceAll(""," ")},Qw=function(t){return t.replaceAll(" ","")},GC=function(t){const{value:n,fontSize:s,color:r,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==n||t.fontSize!==s||t.color.some((l,c)=>l!==r[c])||t.pageIndex!==o},y(ze,jr),F(ze,"_freeTextDefaultContent",""),F(ze,"_internalPadding",0),F(ze,"_defaultColor",null),F(ze,"_defaultFontSize",10),F(ze,"_type","freetext"),F(ze,"_editorType",ne.FREETEXT);let Yw=ze;class W{toSVGPath(){Me("Abstract method `toSVGPath` must be implemented.")}get box(){Me("Abstract getter `box` must be implemented.")}serialize(e,t){Me("Abstract method `serialize` must be implemented.")}static _rescale(e,t,n,s,r,o){o||(o=new Float32Array(e.length));for(let l=0,c=e.length;l<c;l+=2)o[l]=t+e[l]*s,o[l+1]=n+e[l+1]*r;return o}static _rescaleAndSwap(e,t,n,s,r,o){o||(o=new Float32Array(e.length));for(let l=0,c=e.length;l<c;l+=2)o[l]=t+e[l+1]*s,o[l+1]=n+e[l]*r;return o}static _translate(e,t,n,s){s||(s=new Float32Array(e.length));for(let r=0,o=e.length;r<o;r+=2)s[r]=t+e[r],s[r+1]=n+e[r+1];return s}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,n,s,r){switch(r){case 90:return[1-t/n,e/s];case 180:return[1-e/n,1-t/s];case 270:return[t/n,1-e/s];default:return[e/n,t/s]}}static _normalizePagePoint(e,t,n){switch(n){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,n,s,r,o){return[(e+5*n)/6,(t+5*s)/6,(5*n+r)/6,(5*s+o)/6,(n+r)/2,(s+o)/2]}}F(W,"PRECISION",1e-4);var Yn,Yi,Zu,eh,Ds,ue,xl,Pl,xp,Pp,th,nh,Bo,Rp,Ry,Ly,Et,pd,qC,KC,XC,YC,QC,JC;const Qs=class Qs{constructor({x:e,y:t},n,s,r,o,l=0){y(this,Et);y(this,Yn);y(this,Yi,[]);y(this,Zu);y(this,eh);y(this,Ds,[]);y(this,ue,new Float32Array(18));y(this,xl);y(this,Pl);y(this,xp);y(this,Pp);y(this,th);y(this,nh);y(this,Bo,[]);g(this,Yn,n),g(this,nh,r*s),g(this,eh,o),a(this,ue).set([NaN,NaN,NaN,NaN,e,t],6),g(this,Zu,l),g(this,Pp,a(Qs,Rp)*s),g(this,xp,a(Qs,Ly)*s),g(this,th,s),a(this,Bo).push(e,t)}isEmpty(){return isNaN(a(this,ue)[8])}add({x:e,y:t}){var D;g(this,xl,e),g(this,Pl,t);const[n,s,r,o]=a(this,Yn);let[l,c,u,h]=a(this,ue).subarray(8,12);const d=e-u,f=t-h,p=Math.hypot(d,f);if(p<a(this,xp))return!1;const v=p-a(this,Pp),b=v/p,S=b*d,m=b*f;let _=l,w=c;l=u,c=h,u+=S,h+=m,(D=a(this,Bo))==null||D.push(e,t);const E=-m/v,k=S/v,C=E*a(this,nh),T=k*a(this,nh);return a(this,ue).set(a(this,ue).subarray(2,8),0),a(this,ue).set([u+C,h+T],4),a(this,ue).set(a(this,ue).subarray(14,18),12),a(this,ue).set([u-C,h-T],16),isNaN(a(this,ue)[6])?(a(this,Ds).length===0&&(a(this,ue).set([l+C,c+T],2),a(this,Ds).push(NaN,NaN,NaN,NaN,(l+C-n)/r,(c+T-s)/o),a(this,ue).set([l-C,c-T],14),a(this,Yi).push(NaN,NaN,NaN,NaN,(l-C-n)/r,(c-T-s)/o)),a(this,ue).set([_,w,l,c,u,h],6),!this.isEmpty()):(a(this,ue).set([_,w,l,c,u,h],6),Math.abs(Math.atan2(w-c,_-l)-Math.atan2(m,S))<Math.PI/2?([l,c,u,h]=a(this,ue).subarray(2,6),a(this,Ds).push(NaN,NaN,NaN,NaN,((l+u)/2-n)/r,((c+h)/2-s)/o),[l,c,_,w]=a(this,ue).subarray(14,18),a(this,Yi).push(NaN,NaN,NaN,NaN,((_+l)/2-n)/r,((w+c)/2-s)/o),!0):([_,w,l,c,u,h]=a(this,ue).subarray(0,6),a(this,Ds).push(((_+5*l)/6-n)/r,((w+5*c)/6-s)/o,((5*l+u)/6-n)/r,((5*c+h)/6-s)/o,((l+u)/2-n)/r,((c+h)/2-s)/o),[u,h,l,c,_,w]=a(this,ue).subarray(12,18),a(this,Yi).push(((_+5*l)/6-n)/r,((w+5*c)/6-s)/o,((5*l+u)/6-n)/r,((5*c+h)/6-s)/o,((l+u)/2-n)/r,((c+h)/2-s)/o),!0))}toSVGPath(){if(this.isEmpty())return"";const e=a(this,Ds),t=a(this,Yi);if(isNaN(a(this,ue)[6])&&!this.isEmpty())return A(this,Et,qC).call(this);const n=[];n.push(`M${e[4]} ${e[5]}`);for(let s=6;s<e.length;s+=6)isNaN(e[s])?n.push(`L${e[s+4]} ${e[s+5]}`):n.push(`C${e[s]} ${e[s+1]} ${e[s+2]} ${e[s+3]} ${e[s+4]} ${e[s+5]}`);A(this,Et,XC).call(this,n);for(let s=t.length-6;s>=6;s-=6)isNaN(t[s])?n.push(`L${t[s+4]} ${t[s+5]}`):n.push(`C${t[s]} ${t[s+1]} ${t[s+2]} ${t[s+3]} ${t[s+4]} ${t[s+5]}`);return A(this,Et,KC).call(this,n),n.join(" ")}newFreeDrawOutline(e,t,n,s,r,o){return new ZC(e,t,n,s,r,o)}getOutlines(){var d;const e=a(this,Ds),t=a(this,Yi),n=a(this,ue),[s,r,o,l]=a(this,Yn),c=new Float32Array((((d=a(this,Bo))==null?void 0:d.length)??0)+2);for(let f=0,p=c.length-2;f<p;f+=2)c[f]=(a(this,Bo)[f]-s)/o,c[f+1]=(a(this,Bo)[f+1]-r)/l;if(c[c.length-2]=(a(this,xl)-s)/o,c[c.length-1]=(a(this,Pl)-r)/l,isNaN(n[6])&&!this.isEmpty())return A(this,Et,YC).call(this,c);const u=new Float32Array(a(this,Ds).length+24+a(this,Yi).length);let h=e.length;for(let f=0;f<h;f+=2){if(isNaN(e[f])){u[f]=u[f+1]=NaN;continue}u[f]=e[f],u[f+1]=e[f+1]}h=A(this,Et,JC).call(this,u,h);for(let f=t.length-6;f>=6;f-=6)for(let p=0;p<6;p+=2){if(isNaN(t[f+p])){u[h]=u[h+1]=NaN,h+=2;continue}u[h]=t[f+p],u[h+1]=t[f+p+1],h+=2}return A(this,Et,QC).call(this,u,h),this.newFreeDrawOutline(u,c,a(this,Yn),a(this,th),a(this,Zu),a(this,eh))}};Yn=new WeakMap,Yi=new WeakMap,Zu=new WeakMap,eh=new WeakMap,Ds=new WeakMap,ue=new WeakMap,xl=new WeakMap,Pl=new WeakMap,xp=new WeakMap,Pp=new WeakMap,th=new WeakMap,nh=new WeakMap,Bo=new WeakMap,Rp=new WeakMap,Ry=new WeakMap,Ly=new WeakMap,Et=new WeakSet,pd=function(){const e=a(this,ue).subarray(4,6),t=a(this,ue).subarray(16,18),[n,s,r,o]=a(this,Yn);return[(a(this,xl)+(e[0]-t[0])/2-n)/r,(a(this,Pl)+(e[1]-t[1])/2-s)/o,(a(this,xl)+(t[0]-e[0])/2-n)/r,(a(this,Pl)+(t[1]-e[1])/2-s)/o]},qC=function(){const[e,t,n,s]=a(this,Yn),[r,o,l,c]=A(this,Et,pd).call(this);return`M${(a(this,ue)[2]-e)/n} ${(a(this,ue)[3]-t)/s} L${(a(this,ue)[4]-e)/n} ${(a(this,ue)[5]-t)/s} L${r} ${o} L${l} ${c} L${(a(this,ue)[16]-e)/n} ${(a(this,ue)[17]-t)/s} L${(a(this,ue)[14]-e)/n} ${(a(this,ue)[15]-t)/s} Z`},KC=function(e){const t=a(this,Yi);e.push(`L${t[4]} ${t[5]} Z`)},XC=function(e){const[t,n,s,r]=a(this,Yn),o=a(this,ue).subarray(4,6),l=a(this,ue).subarray(16,18),[c,u,h,d]=A(this,Et,pd).call(this);e.push(`L${(o[0]-t)/s} ${(o[1]-n)/r} L${c} ${u} L${h} ${d} L${(l[0]-t)/s} ${(l[1]-n)/r}`)},YC=function(e){const t=a(this,ue),[n,s,r,o]=a(this,Yn),[l,c,u,h]=A(this,Et,pd).call(this),d=new Float32Array(36);return d.set([NaN,NaN,NaN,NaN,(t[2]-n)/r,(t[3]-s)/o,NaN,NaN,NaN,NaN,(t[4]-n)/r,(t[5]-s)/o,NaN,NaN,NaN,NaN,l,c,NaN,NaN,NaN,NaN,u,h,NaN,NaN,NaN,NaN,(t[16]-n)/r,(t[17]-s)/o,NaN,NaN,NaN,NaN,(t[14]-n)/r,(t[15]-s)/o],0),this.newFreeDrawOutline(d,e,a(this,Yn),a(this,th),a(this,Zu),a(this,eh))},QC=function(e,t){const n=a(this,Yi);return e.set([NaN,NaN,NaN,NaN,n[4],n[5]],t),t+=6},JC=function(e,t){const n=a(this,ue).subarray(4,6),s=a(this,ue).subarray(16,18),[r,o,l,c]=a(this,Yn),[u,h,d,f]=A(this,Et,pd).call(this);return e.set([NaN,NaN,NaN,NaN,(n[0]-r)/l,(n[1]-o)/c,NaN,NaN,NaN,NaN,u,h,NaN,NaN,NaN,NaN,d,f,NaN,NaN,NaN,NaN,(s[0]-r)/l,(s[1]-o)/c],t),t+=24},y(Qs,Rp,8),y(Qs,Ry,2),y(Qs,Ly,a(Qs,Rp)+a(Qs,Ry));let uy=Qs;var ih,Rl,Cr,Lp,Qn,Ip,lt,Iy,eT;class ZC extends W{constructor(t,n,s,r,o,l){super();y(this,Iy);y(this,ih);y(this,Rl,new Float32Array(4));y(this,Cr);y(this,Lp);y(this,Qn);y(this,Ip);y(this,lt);g(this,lt,t),g(this,Qn,n),g(this,ih,s),g(this,Ip,r),g(this,Cr,o),g(this,Lp,l),this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],A(this,Iy,eT).call(this,l);const[c,u,h,d]=a(this,Rl);for(let f=0,p=t.length;f<p;f+=2)t[f]=(t[f]-c)/h,t[f+1]=(t[f+1]-u)/d;for(let f=0,p=n.length;f<p;f+=2)n[f]=(n[f]-c)/h,n[f+1]=(n[f+1]-u)/d}toSVGPath(){const t=[`M${a(this,lt)[4]} ${a(this,lt)[5]}`];for(let n=6,s=a(this,lt).length;n<s;n+=6){if(isNaN(a(this,lt)[n])){t.push(`L${a(this,lt)[n+4]} ${a(this,lt)[n+5]}`);continue}t.push(`C${a(this,lt)[n]} ${a(this,lt)[n+1]} ${a(this,lt)[n+2]} ${a(this,lt)[n+3]} ${a(this,lt)[n+4]} ${a(this,lt)[n+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,n,s,r],o){const l=s-t,c=r-n;let u,h;switch(o){case 0:u=W._rescale(a(this,lt),t,r,l,-c),h=W._rescale(a(this,Qn),t,r,l,-c);break;case 90:u=W._rescaleAndSwap(a(this,lt),t,n,l,c),h=W._rescaleAndSwap(a(this,Qn),t,n,l,c);break;case 180:u=W._rescale(a(this,lt),s,n,-l,c),h=W._rescale(a(this,Qn),s,n,-l,c);break;case 270:u=W._rescaleAndSwap(a(this,lt),s,r,-l,-c),h=W._rescaleAndSwap(a(this,Qn),s,r,-l,-c);break}return{outline:Array.from(u),points:[Array.from(h)]}}get box(){return a(this,Rl)}newOutliner(t,n,s,r,o,l=0){return new uy(t,n,s,r,o,l)}getNewOutline(t,n){const[s,r,o,l]=a(this,Rl),[c,u,h,d]=a(this,ih),f=o*h,p=l*d,v=s*h+c,b=r*d+u,S=this.newOutliner({x:a(this,Qn)[0]*f+v,y:a(this,Qn)[1]*p+b},a(this,ih),a(this,Ip),t,a(this,Lp),n??a(this,Cr));for(let m=2;m<a(this,Qn).length;m+=2)S.add({x:a(this,Qn)[m]*f+v,y:a(this,Qn)[m+1]*p+b});return S.getOutlines()}}ih=new WeakMap,Rl=new WeakMap,Cr=new WeakMap,Lp=new WeakMap,Qn=new WeakMap,Ip=new WeakMap,lt=new WeakMap,Iy=new WeakSet,eT=function(t){const n=a(this,lt);let s=n[4],r=n[5];const o=[s,r,s,r];let l=s,c=r,u=s,h=r;const d=t?Math.max:Math.min,f=new Float32Array(4);for(let v=6,b=n.length;v<b;v+=6){const S=n[v+4],m=n[v+5];isNaN(n[v])?(G.pointBoundingBox(S,m,o),c>m?(l=S,c=m):c===m&&(l=d(l,S)),h<m?(u=S,h=m):h===m&&(u=d(u,S))):(f[0]=f[1]=1/0,f[2]=f[3]=-1/0,G.bezierBoundingBox(s,r,...n.slice(v,v+6),f),G.rectBoundingBox(f[0],f[1],f[2],f[3],o),c>f[1]?(l=f[0],c=f[1]):c===f[1]&&(l=d(l,f[0])),h<f[3]?(u=f[2],h=f[3]):h===f[3]&&(u=d(u,f[2]))),s=S,r=m}const p=a(this,Rl);p[0]=o[0]-a(this,Cr),p[1]=o[1]-a(this,Cr),p[2]=o[2]-o[0]+2*a(this,Cr),p[3]=o[3]-o[1]+2*a(this,Cr),this.firstPoint=[l,c],this.lastPoint=[u,h]};var Dp,Op,Mp,jo,Qi,wn,tT,vm,nT,iT,Zw;class Jw{constructor(e,t=0,n=0,s=!0){y(this,wn);y(this,Dp);y(this,Op);y(this,Mp);y(this,jo,[]);y(this,Qi,[]);const r=[1/0,1/0,-1/0,-1/0],l=10**-4;for(const{x:S,y:m,width:_,height:w}of e){const E=Math.floor((S-t)/l)*l,k=Math.ceil((S+_+t)/l)*l,C=Math.floor((m-t)/l)*l,T=Math.ceil((m+w+t)/l)*l,R=[E,C,T,!0],D=[k,C,T,!1];a(this,jo).push(R,D),G.rectBoundingBox(E,C,k,T,r)}const c=r[2]-r[0]+2*n,u=r[3]-r[1]+2*n,h=r[0]-n,d=r[1]-n;let f=s?-1/0:1/0,p=1/0;const v=a(this,jo).at(s?-1:-2),b=[v[0],v[2]];for(const S of a(this,jo)){const[m,_,w,E]=S;!E&&s?_<p?(p=_,f=m):_===p&&(f=Math.max(f,m)):E&&!s&&(_<p?(p=_,f=m):_===p&&(f=Math.min(f,m))),S[0]=(m-h)/c,S[1]=(_-d)/u,S[2]=(w-d)/u}g(this,Dp,new Float32Array([h,d,c,u])),g(this,Op,[f,p]),g(this,Mp,b)}getOutlines(){a(this,jo).sort((t,n)=>t[0]-n[0]||t[1]-n[1]||t[2]-n[2]);const e=[];for(const t of a(this,jo))t[3]?(e.push(...A(this,wn,Zw).call(this,t)),A(this,wn,nT).call(this,t)):(A(this,wn,iT).call(this,t),e.push(...A(this,wn,Zw).call(this,t)));return A(this,wn,tT).call(this,e)}}Dp=new WeakMap,Op=new WeakMap,Mp=new WeakMap,jo=new WeakMap,Qi=new WeakMap,wn=new WeakSet,tT=function(e){const t=[],n=new Set;for(const o of e){const[l,c,u]=o;t.push([l,c,o],[l,u,o])}t.sort((o,l)=>o[1]-l[1]||o[0]-l[0]);for(let o=0,l=t.length;o<l;o+=2){const c=t[o][2],u=t[o+1][2];c.push(u),u.push(c),n.add(c),n.add(u)}const s=[];let r;for(;n.size>0;){const o=n.values().next().value;let[l,c,u,h,d]=o;n.delete(o);let f=l,p=c;for(r=[l,u],s.push(r);;){let v;if(n.has(h))v=h;else if(n.has(d))v=d;else break;n.delete(v),[l,c,u,h,d]=v,f!==l&&(r.push(f,p,l,p===c?c:u),f=l),p=p===c?u:c}r.push(f,p)}return new BI(s,a(this,Dp),a(this,Op),a(this,Mp))},vm=function(e){const t=a(this,Qi);let n=0,s=t.length-1;for(;n<=s;){const r=n+s>>1,o=t[r][0];if(o===e)return r;o<e?n=r+1:s=r-1}return s+1},nT=function([,e,t]){const n=A(this,wn,vm).call(this,e);a(this,Qi).splice(n,0,[e,t])},iT=function([,e,t]){const n=A(this,wn,vm).call(this,e);for(let s=n;s<a(this,Qi).length;s++){const[r,o]=a(this,Qi)[s];if(r!==e)break;if(r===e&&o===t){a(this,Qi).splice(s,1);return}}for(let s=n-1;s>=0;s--){const[r,o]=a(this,Qi)[s];if(r!==e)break;if(r===e&&o===t){a(this,Qi).splice(s,1);return}}},Zw=function(e){const[t,n,s]=e,r=[[t,n,s]],o=A(this,wn,vm).call(this,s);for(let l=0;l<o;l++){const[c,u]=a(this,Qi)[l];for(let h=0,d=r.length;h<d;h++){const[,f,p]=r[h];if(!(u<=f||p<=c)){if(f>=c){if(p>u)r[h][1]=u;else{if(d===1)return[];r.splice(h,1),h--,d--}continue}r[h][2]=c,p>u&&r.push([t,u,p])}}}return r};var Np,sh;class BI extends W{constructor(t,n,s,r){super();y(this,Np);y(this,sh);g(this,sh,t),g(this,Np,n),this.firstPoint=s,this.lastPoint=r}toSVGPath(){const t=[];for(const n of a(this,sh)){let[s,r]=n;t.push(`M${s} ${r}`);for(let o=2;o<n.length;o+=2){const l=n[o],c=n[o+1];l===s?(t.push(`V${c}`),r=c):c===r&&(t.push(`H${l}`),s=l)}t.push("Z")}return t.join(" ")}serialize([t,n,s,r],o){const l=[],c=s-t,u=r-n;for(const h of a(this,sh)){const d=new Array(h.length);for(let f=0;f<h.length;f+=2)d[f]=t+h[f]*c,d[f+1]=r-h[f+1]*u;l.push(d)}return l}get box(){return a(this,Np)}get classNamesForOutlining(){return["highlightOutline"]}}Np=new WeakMap,sh=new WeakMap;class e_ extends uy{newFreeDrawOutline(e,t,n,s,r,o){return new jI(e,t,n,s,r,o)}}class jI extends ZC{newOutliner(e,t,n,s,r,o=0){return new e_(e,t,n,s,r,o)}}var rh,Fp,Tr,Ll,Bp,Pn,jp,$p,Il,Jn,Zn,jt,oh,ah,nn,lh,ki,Up,oe,t_,wm,sT,rT,oT,n_,Aa,Pi,_c,aT,_m,bm,lT,cT,uT,hT,dT;const be=class be extends $e{constructor(t){super({...t,name:"highlightEditor"});y(this,oe);y(this,rh,null);y(this,Fp,0);y(this,Tr);y(this,Ll,null);y(this,Bp,null);y(this,Pn,null);y(this,jp,null);y(this,$p,0);y(this,Il,null);y(this,Jn,null);y(this,Zn,null);y(this,jt,!1);y(this,oh,null);y(this,ah,null);y(this,nn,null);y(this,lh,"");y(this,ki);y(this,Up,"");this.color=t.color||be._defaultColor,g(this,ki,t.thickness||be._defaultThickness),this.opacity=t.opacity||be._defaultOpacity,g(this,Tr,t.boxes||null),g(this,Up,t.methodOfCreation||""),g(this,lh,t.text||""),this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(g(this,jt,!0),A(this,oe,wm).call(this,t),A(this,oe,Aa).call(this)):a(this,Tr)&&(g(this,rh,t.anchorNode),g(this,Fp,t.anchorOffset),g(this,jp,t.focusNode),g(this,$p,t.focusOffset),A(this,oe,t_).call(this),A(this,oe,Aa).call(this),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}static get _keyboardManager(){const t=be.prototype;return re(this,"_keyboardManager",new tg([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:a(this,jt)?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:a(this,ki),methodOfCreation:a(this,Up)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,n){var s;$e.initialize(t,n),be._defaultColor||(be._defaultColor=((s=n.highlightColors)==null?void 0:s.values().next().value)||"#fff066")}static updateDefaultParams(t,n){switch(t){case pe.HIGHLIGHT_COLOR:be._defaultColor=n;break;case pe.HIGHLIGHT_THICKNESS:be._defaultThickness=n;break}}translateInPage(t,n){}get toolbarPosition(){return a(this,ah)}get commentButtonPosition(){return a(this,oh)}updateParams(t,n){switch(t){case pe.HIGHLIGHT_COLOR:A(this,oe,sT).call(this,n);break;case pe.HIGHLIGHT_THICKNESS:A(this,oe,rT).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[pe.HIGHLIGHT_COLOR,be._defaultColor],[pe.HIGHLIGHT_THICKNESS,be._defaultThickness]]}get propertiesToUpdate(){return[[pe.HIGHLIGHT_COLOR,this.color||be._defaultColor],[pe.HIGHLIGHT_THICKNESS,a(this,ki)||be._defaultThickness],[pe.HIGHLIGHT_FREE,a(this,jt)]]}onUpdatedColor(){var t,n;(t=this.parent)==null||t.drawLayer.updateProperties(a(this,Zn),{root:{fill:this.color,"fill-opacity":this.opacity}}),(n=a(this,Bp))==null||n.updateColor(this.color),super.onUpdatedColor()}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",g(this,Bp,new ay({editor:this}))]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(A(this,oe,bm).call(this))}getBaseTranslation(){return[0,0]}getRect(t,n){return super.getRect(t,n,A(this,oe,bm).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){A(this,oe,n_).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(A(this,oe,Aa).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var s;let n=!1;this.parent&&!t?A(this,oe,n_).call(this):t&&(A(this,oe,Aa).call(this,t),n=!this.parent&&((s=this.div)==null?void 0:s.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),n&&this.select()}rotate(t){var r,o,l;const{drawLayer:n}=this.parent;let s;a(this,jt)?(t=(t-this.rotation+360)%360,s=A(r=be,Pi,_c).call(r,a(this,Jn).box,t)):s=A(o=be,Pi,_c).call(o,[this.x,this.y,this.width,this.height],t),n.updateProperties(a(this,Zn),{bbox:s,root:{"data-main-rotation":t}}),n.updateProperties(a(this,nn),{bbox:A(l=be,Pi,_c).call(l,a(this,Pn).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();a(this,lh)&&(t.setAttribute("aria-label",a(this,lh)),t.setAttribute("role","mark")),a(this,jt)?t.classList.add("free"):this.div.addEventListener("keydown",A(this,oe,aT).bind(this),{signal:this._uiManager._signal});const n=g(this,Il,document.createElement("div"));return t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",n.style.clipPath=a(this,Ll),this.setDims(),Lk(this,a(this,Il),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(a(this,nn),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(a(this,nn),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:A(this,oe,_m).call(this,!0);break;case 1:case 3:A(this,oe,_m).call(this,!1);break}}select(){var t;super.select(),a(this,nn)&&((t=this.parent)==null||t.drawLayer.updateProperties(a(this,nn),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),a(this,nn)&&((t=this.parent)==null||t.drawLayer.updateProperties(a(this,nn),{rootClass:{selected:!1}}),a(this,jt)||A(this,oe,_m).call(this,!1))}get _mustFixPosition(){return!a(this,jt)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(a(this,Zn),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(a(this,nn),{rootClass:{hidden:!t}}))}static startHighlighting(t,n,{target:s,x:r,y:o}){const{x:l,y:c,width:u,height:h}=s.getBoundingClientRect(),d=new AbortController,f=t.combinedSignal(d),p=v=>{d.abort(),A(this,Pi,hT).call(this,t,v)};window.addEventListener("blur",p,{signal:f}),window.addEventListener("pointerup",p,{signal:f}),window.addEventListener("pointerdown",ot,{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",Ni,{signal:f}),s.addEventListener("pointermove",A(this,Pi,uT).bind(this,t),{signal:f}),this._freeHighlight=new e_({x:r,y:o},[l,c,u,h],t.scale,this._defaultThickness/2,n,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,n,s){var b,S,m,_;let r=null;if(t instanceof $C){const{data:{quadPoints:w,rect:E,rotation:k,id:C,color:T,opacity:R,popupRef:D,richText:O,contentsObj:B,creationDate:H,modificationDate:Y},parent:{page:{pageNumber:X}}}=t;r=t={annotationType:ne.HIGHLIGHT,color:Array.from(T),opacity:R,quadPoints:w,boxes:null,pageIndex:X-1,rect:E.slice(0),rotation:k,annotationElementId:C,id:C,deleted:!1,popupRef:D,richText:O,comment:(B==null?void 0:B.str)||null,creationDate:H,modificationDate:Y}}else if(t instanceof Ob){const{data:{inkLists:w,rect:E,rotation:k,id:C,color:T,borderStyle:{rawWidth:R},popupRef:D,richText:O,contentsObj:B,creationDate:H,modificationDate:Y},parent:{page:{pageNumber:X}}}=t;r=t={annotationType:ne.HIGHLIGHT,color:Array.from(T),thickness:R,inkLists:w,boxes:null,pageIndex:X-1,rect:E.slice(0),rotation:k,annotationElementId:C,id:C,deleted:!1,popupRef:D,richText:O,comment:(B==null?void 0:B.str)||null,creationDate:H,modificationDate:Y}}const{color:o,quadPoints:l,inkLists:c,opacity:u}=t,h=await super.deserialize(t,n,s);h.color=G.makeHexColor(...o),h.opacity=u||1,c&&g(h,ki,t.thickness),h._initialData=r,t.comment&&h.setCommentData(t);const[d,f]=h.pageDimensions,[p,v]=h.pageTranslation;if(l){const w=g(h,Tr,[]);for(let E=0;E<l.length;E+=8)w.push({x:(l[E]-p)/d,y:1-(l[E+1]-v)/f,width:(l[E+2]-l[E])/d,height:(l[E+1]-l[E+5])/f});A(b=h,oe,t_).call(b),A(S=h,oe,Aa).call(S),h.rotate(h.rotation)}else if(c){g(h,jt,!0);const w=c[0],E={x:w[0]-p,y:f-(w[1]-v)},k=new e_(E,[0,0,d,f],1,a(h,ki)/2,!0,.001);for(let R=0,D=w.length;R<D;R+=2)E.x=w[R]-p,E.y=f-(w[R+1]-v),k.add(E);const{id:C,clipPathId:T}=n.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:h.color,"fill-opacity":h._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:k.toSVGPath()}},!0,!0);A(m=h,oe,wm).call(m,{highlightOutlines:k.getOutlines(),highlightId:C,clipPathId:T}),A(_=h,oe,Aa).call(_),h.rotate(h.parentRotation)}return h}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const n=$e._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),s=super.serialize(t);return Object.assign(s,{color:n,opacity:this.opacity,thickness:a(this,ki),quadPoints:A(this,oe,lT).call(this),outlines:A(this,oe,cT).call(this,s.rect)}),this.addComment(s),this.annotationElementId&&!A(this,oe,dT).call(this,s)?null:(s.id=this.annotationElementId,s)}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}};rh=new WeakMap,Fp=new WeakMap,Tr=new WeakMap,Ll=new WeakMap,Bp=new WeakMap,Pn=new WeakMap,jp=new WeakMap,$p=new WeakMap,Il=new WeakMap,Jn=new WeakMap,Zn=new WeakMap,jt=new WeakMap,oh=new WeakMap,ah=new WeakMap,nn=new WeakMap,lh=new WeakMap,ki=new WeakMap,Up=new WeakMap,oe=new WeakSet,t_=function(){const t=new Jw(a(this,Tr),.001);g(this,Jn,t.getOutlines()),[this.x,this.y,this.width,this.height]=a(this,Jn).box;const n=new Jw(a(this,Tr),.0025,.001,this._uiManager.direction==="ltr");g(this,Pn,n.getOutlines());const{firstPoint:s}=a(this,Jn);g(this,oh,[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height]);const{lastPoint:r}=a(this,Pn);g(this,ah,[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height])},wm=function({highlightOutlines:t,highlightId:n,clipPathId:s}){var f,p;if(g(this,Jn,t),g(this,Pn,t.getNewOutline(a(this,ki)/2+1.5,.0025)),n>=0)g(this,Zn,n),g(this,Ll,s),this.parent.drawLayer.finalizeDraw(n,{bbox:t.box,path:{d:t.toSVGPath()}}),g(this,nn,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:a(this,Pn).box,path:{d:a(this,Pn).toSVGPath()}},!0));else if(this.parent){const v=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(a(this,Zn),{bbox:A(f=be,Pi,_c).call(f,a(this,Jn).box,(v-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(a(this,nn),{bbox:A(p=be,Pi,_c).call(p,a(this,Pn).box,v),path:{d:a(this,Pn).toSVGPath()}})}const[o,l,c,u]=t.box;switch(this.rotation){case 0:this.x=o,this.y=l,this.width=c,this.height=u;break;case 90:{const[v,b]=this.parentDimensions;this.x=l,this.y=1-o,this.width=c*b/v,this.height=u*v/b;break}case 180:this.x=1-o,this.y=1-l,this.width=c,this.height=u;break;case 270:{const[v,b]=this.parentDimensions;this.x=1-l,this.y=o,this.width=c*b/v,this.height=u*v/b;break}}const{firstPoint:h}=t;g(this,oh,[(h[0]-o)/c,(h[1]-l)/u]);const{lastPoint:d}=a(this,Pn);g(this,ah,[(d[0]-o)/c,(d[1]-l)/u])},sT=function(t){const n=(o,l)=>{this.color=o,this.opacity=l,this.onUpdatedColor()},s=this.color,r=this.opacity;this.addCommands({cmd:n.bind(this,t,be._defaultOpacity),undo:n.bind(this,s,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:pe.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)},rT=function(t){const n=a(this,ki),s=r=>{g(this,ki,r),A(this,oe,oT).call(this,r)};this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:pe.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},oT=function(t){a(this,jt)&&(A(this,oe,wm).call(this,{highlightOutlines:a(this,Jn).getNewOutline(t/2)}),this.fixAndSetPosition(),this.setDims())},n_=function(){a(this,Zn)===null||!this.parent||(this.parent.drawLayer.remove(a(this,Zn)),g(this,Zn,null),this.parent.drawLayer.remove(a(this,nn)),g(this,nn,null))},Aa=function(t=this.parent){a(this,Zn)===null&&({id:gt(this,Zn)._,clipPathId:gt(this,Ll)._}=t.drawLayer.draw({bbox:a(this,Jn).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:a(this,jt)},path:{d:a(this,Jn).toSVGPath()}},!1,!0),g(this,nn,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:a(this,jt)},bbox:a(this,Pn).box,path:{d:a(this,Pn).toSVGPath()}},a(this,jt))),a(this,Il)&&(a(this,Il).style.clipPath=a(this,Ll)))},Pi=new WeakSet,_c=function([t,n,s,r],o){switch(o){case 90:return[1-n-r,t,r,s];case 180:return[1-t-s,1-n-r,s,r];case 270:return[n,1-t-s,r,s]}return[t,n,s,r]},aT=function(t){be._keyboardManager.exec(this,t)},_m=function(t){if(!a(this,rh))return;const n=window.getSelection();t?n.setPosition(a(this,rh),a(this,Fp)):n.setPosition(a(this,jp),a(this,$p))},bm=function(){return a(this,jt)?this.rotation:0},lT=function(){if(a(this,jt))return null;const[t,n]=this.pageDimensions,[s,r]=this.pageTranslation,o=a(this,Tr),l=new Float32Array(o.length*8);let c=0;for(const{x:u,y:h,width:d,height:f}of o){const p=u*t+s,v=(1-h)*n+r;l[c]=l[c+4]=p,l[c+1]=l[c+3]=v,l[c+2]=l[c+6]=p+d*t,l[c+5]=l[c+7]=v-f*n,c+=8}return l},cT=function(t){return a(this,Jn).serialize(t,A(this,oe,bm).call(this))},uT=function(t,n){this._freeHighlight.add(n)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},hT=function(t,n){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(n,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},dT=function(t){const{color:n}=this._initialData;return this.hasEditedComment||t.color.some((s,r)=>s!==n[r])},y(be,Pi),F(be,"_defaultColor",null),F(be,"_defaultOpacity",1),F(be,"_defaultThickness",12),F(be,"_type","highlight"),F(be,"_editorType",ne.HIGHLIGHT),F(be,"_freeHighlightId",-1),F(be,"_freeHighlight",null),F(be,"_freeHighlightClipId","");let hy=be;var Dl;class fT{constructor(){y(this,Dl,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,n]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,n)}updateSVGProperty(e,t){a(this,Dl)[e]=t}toSVGProperties(){const e=a(this,Dl);return g(this,Dl,Object.create(null)),{root:e}}reset(){g(this,Dl,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){Me("Not implemented")}}Dl=new WeakMap;var ei,ch,xt,Ol,Ml,ye,i_,s_,r_,gd,pT,Am,md,bc;const fe=class fe extends $e{constructor(t){super(t);y(this,ye);y(this,ei,null);y(this,ch);F(this,"_colorPicker",null);F(this,"_drawId",null);g(this,ch,t.mustBeCommitted||!1),this._addOutlines(t)}onUpdatedColor(){var t;(t=this._colorPicker)==null||t.update(this.color),super.onUpdatedColor()}_addOutlines(t){t.drawOutlines&&(A(this,ye,i_).call(this,t),A(this,ye,gd).call(this))}static _mergeSVGProperties(t,n){const s=new Set(Object.keys(t));for(const[r,o]of Object.entries(n))s.has(r)?Object.assign(t[r],o):t[r]=o;return t}static getDefaultDrawingOptions(t){Me("Not implemented")}static get typesMap(){Me("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,n){const s=this.typesMap.get(t);s&&this._defaultDrawingOptions.updateProperty(s,n),this._currentParent&&(a(fe,xt).updateProperty(s,n),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,n){const s=this.constructor.typesMap.get(t);s&&this._updateProperty(t,s,n)}static get defaultPropertiesToUpdate(){const t=[],n=this._defaultDrawingOptions;for(const[s,r]of this.typesMap)t.push([s,n[r]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:n}=this;for(const[s,r]of this.constructor.typesMap)t.push([s,n[r]]);return t}_updateProperty(t,n,s){const r=this._drawingOptions,o=r[n],l=c=>{var h;r.updateProperty(n,c);const u=a(this,ei).updateProperty(n,c);u&&A(this,ye,md).call(this,u),(h=this.parent)==null||h.drawLayer.updateProperties(this._drawId,r.toSVGProperties()),t===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:l.bind(this,s),undo:l.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,fe._mergeSVGProperties(a(this,ei).getPathResizingSVGProperties(A(this,ye,Am).call(this)),{bbox:A(this,ye,bc).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,fe._mergeSVGProperties(a(this,ei).getPathResizedSVGProperties(A(this,ye,Am).call(this)),{bbox:A(this,ye,bc).call(this)}))}_onTranslating(t,n){var s;(s=this.parent)==null||s.drawLayer.updateProperties(this._drawId,{bbox:A(this,ye,bc).call(this)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,fe._mergeSVGProperties(a(this,ei).getPathTranslatedSVGProperties(A(this,ye,Am).call(this),this.parentDimensions),{bbox:A(this,ye,bc).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,a(this,ch)&&(g(this,ch,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){A(this,ye,r_).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(A(this,ye,gd).call(this),A(this,ye,md).call(this,a(this,ei).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var s;let n=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),A(this,ye,r_).call(this)):t&&(this._uiManager.addShouldRescale(this),A(this,ye,gd).call(this,t),n=!this.parent&&((s=this.div)==null?void 0:s.classList.contains("selectedEditor"))),super.setParent(t),n&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,fe._mergeSVGProperties({bbox:A(this,ye,bc).call(this)},a(this,ei).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&A(this,ye,md).call(this,a(this,ei).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,n;this._isCopy&&(t=this.x,n=this.y);const s=super.render();s.classList.add("draw");const r=document.createElement("div");return s.append(r),r.setAttribute("aria-hidden","true"),r.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,n),s}static createDrawerInstance(t,n,s,r,o){Me("Not implemented")}static startDrawing(t,n,s,r){var S;const{target:o,offsetX:l,offsetY:c,pointerId:u,pointerType:h}=r;if(Qt.isInitializedAndDifferentPointerType(h))return;const{viewport:{rotation:d}}=t,{width:f,height:p}=o.getBoundingClientRect(),v=g(fe,Ol,new AbortController),b=t.combinedSignal(v);if(Qt.setPointer(h,u),window.addEventListener("pointerup",m=>{Qt.isSamePointerIdOrRemove(m.pointerId)&&this._endDraw(m)},{signal:b}),window.addEventListener("pointercancel",m=>{Qt.isSamePointerIdOrRemove(m.pointerId)&&this._currentParent.endDrawingSession()},{signal:b}),window.addEventListener("pointerdown",m=>{Qt.isSamePointerType(m.pointerType)&&(Qt.initializeAndAddPointerId(m.pointerId),a(fe,xt).isCancellable()&&(a(fe,xt).removeLastElement(),a(fe,xt).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:b}),window.addEventListener("contextmenu",Ni,{signal:b}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:b}),o.addEventListener("touchmove",m=>{Qt.isSameTimeStamp(m.timeStamp)&&ot(m)},{signal:b}),t.toggleDrawing(),(S=n._editorUndoBar)==null||S.hide(),a(fe,xt)){t.drawLayer.updateProperties(this._currentDrawId,a(fe,xt).startNew(l,c,f,p,d));return}n.updateUIForDefaultProperties(this),g(fe,xt,this.createDrawerInstance(l,c,f,p,d)),g(fe,Ml,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(a(fe,Ml).toSVGProperties(),a(fe,xt).defaultSVGProperties),!0,!1)}static _drawMove(t){if(Qt.isSameTimeStamp(t.timeStamp),!a(fe,xt))return;const{offsetX:n,offsetY:s,pointerId:r}=t;if(Qt.isSamePointerId(r)){if(Qt.isUsingMultiplePointers()){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,a(fe,xt).add(n,s)),Qt.setTimeStamp(t.timeStamp),ot(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,g(fe,xt,null),g(fe,Ml,null),Qt.clearPointerType(),Qt.clearTimeStamp()),a(fe,Ol)&&(a(fe,Ol).abort(),g(fe,Ol,null),Qt.clearPointerIds())}static _endDraw(t){const n=this._currentParent;if(n){if(n.toggleDrawing(!0),this._cleanup(!1),(t==null?void 0:t.target)===n.div&&n.drawLayer.updateProperties(this._currentDrawId,a(fe,xt).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const s=a(fe,xt),r=this._currentDrawId,o=s.getLastElement();n.addCommands({cmd:()=>{n.drawLayer.updateProperties(r,s.setLastElement(o))},undo:()=>{n.drawLayer.updateProperties(r,s.removeLastElement())},mustExec:!1,type:pe.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const n=this._currentParent;if(!n)return null;if(n.toggleDrawing(!0),n.cleanUndoStack(pe.DRAW_STEP),!a(fe,xt).isEmpty()){const{pageDimensions:[s,r],scale:o}=n,l=n.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:a(fe,xt).getOutlines(s*o,r*o,o,this._INNER_MARGIN),drawingOptions:a(fe,Ml),mustBeCommitted:!t});return this._cleanup(!0),l}return n.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,n,s,r,o,l){Me("Not implemented")}static async deserialize(t,n,s){var d,f;const{rawDims:{pageWidth:r,pageHeight:o,pageX:l,pageY:c}}=n.viewport,u=this.deserializeDraw(l,c,r,o,this._INNER_MARGIN,t),h=await super.deserialize(t,n,s);return h.createDrawingOptions(t),A(d=h,ye,i_).call(d,{drawOutlines:u}),A(f=h,ye,gd).call(f),h.onScaleChanging(),h.rotate(),h}serializeDraw(t){const[n,s]=this.pageTranslation,[r,o]=this.pageDimensions;return a(this,ei).serialize([n,s,r,o],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}};ei=new WeakMap,ch=new WeakMap,xt=new WeakMap,Ol=new WeakMap,Ml=new WeakMap,ye=new WeakSet,i_=function({drawOutlines:t,drawId:n,drawingOptions:s}){g(this,ei,t),this._drawingOptions||(this._drawingOptions=s),this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),n>=0?(this._drawId=n,this.parent.drawLayer.finalizeDraw(n,t.defaultProperties)):this._drawId=A(this,ye,s_).call(this,t,this.parent),A(this,ye,md).call(this,t.box)},s_=function(t,n){const{id:s}=n.drawLayer.draw(fe._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return s},r_=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},gd=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=A(this,ye,s_).call(this,a(this,ei),t)}},pT=function([t,n,s,r]){const{parentDimensions:[o,l],rotation:c}=this;switch(c){case 90:return[n,1-t,s*(l/o),r*(o/l)];case 180:return[1-t,1-n,s,r];case 270:return[1-n,t,s*(l/o),r*(o/l)];default:return[t,n,s,r]}},Am=function(){const{x:t,y:n,width:s,height:r,parentDimensions:[o,l],rotation:c}=this;switch(c){case 90:return[1-n,t,s*(o/l),r*(l/o)];case 180:return[1-t,1-n,s,r];case 270:return[n,1-t,s*(o/l),r*(l/o)];default:return[t,n,s,r]}},md=function(t){[this.x,this.y,this.width,this.height]=A(this,ye,pT).call(this,t),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()},bc=function(){const{x:t,y:n,width:s,height:r,rotation:o,parentRotation:l,parentDimensions:[c,u]}=this;switch((o*4+l)/90){case 1:return[1-n-r,t,r,s];case 2:return[1-t-s,1-n-r,s,r];case 3:return[n,1-t-s,r,s];case 4:return[t,n-s*(c/u),r*(u/c),s*(c/u)];case 5:return[1-n,t,s*(c/u),r*(u/c)];case 6:return[1-t-r*(u/c),1-n,r*(u/c),s*(c/u)];case 7:return[n-s*(c/u),1-t-r*(u/c),s*(c/u),r*(u/c)];case 8:return[t-s,n-r,s,r];case 9:return[1-n,t-s,r,s];case 10:return[1-t,1-n,s,r];case 11:return[n-r,1-t,r,s];case 12:return[t-r*(u/c),n,r*(u/c),s*(c/u)];case 13:return[1-n-s*(c/u),t-r*(u/c),s*(c/u),r*(u/c)];case 14:return[1-t,1-n-s*(c/u),r*(u/c),s*(c/u)];case 15:return[n,1-t,s*(c/u),r*(u/c)];default:return[t,n,s,r]}},F(fe,"_currentDrawId",-1),F(fe,"_currentParent",null),y(fe,xt,null),y(fe,Ol,null),y(fe,Ml,null),F(fe,"_INNER_MARGIN",3);let dy=fe;var Os,Pt,Rt,Nl,uh,un,$t,Ci,Fl,Bl,jl,hh,Sm;class $I{constructor(e,t,n,s,r,o){y(this,hh);y(this,Os,new Float64Array(6));y(this,Pt);y(this,Rt);y(this,Nl);y(this,uh);y(this,un);y(this,$t,"");y(this,Ci,0);y(this,Fl,new ig);y(this,Bl);y(this,jl);g(this,Bl,n),g(this,jl,s),g(this,Nl,r),g(this,uh,o),[e,t]=A(this,hh,Sm).call(this,e,t);const l=g(this,Pt,[NaN,NaN,NaN,NaN,e,t]);g(this,un,[e,t]),g(this,Rt,[{line:l,points:a(this,un)}]),a(this,Os).set(l,0)}updateProperty(e,t){e==="stroke-width"&&g(this,uh,t)}isEmpty(){return!a(this,Rt)||a(this,Rt).length===0}isCancellable(){return a(this,un).length<=10}add(e,t){[e,t]=A(this,hh,Sm).call(this,e,t);const[n,s,r,o]=a(this,Os).subarray(2,6),l=e-r,c=t-o;return Math.hypot(a(this,Bl)*l,a(this,jl)*c)<=2?null:(a(this,un).push(e,t),isNaN(n)?(a(this,Os).set([r,o,e,t],2),a(this,Pt).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(a(this,Os)[0])&&a(this,Pt).splice(6,6),a(this,Os).set([n,s,r,o,e,t],0),a(this,Pt).push(...W.createBezierPoints(n,s,r,o,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const n=this.add(e,t);return n||(a(this,un).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,n,s,r){g(this,Bl,n),g(this,jl,s),g(this,Nl,r),[e,t]=A(this,hh,Sm).call(this,e,t);const o=g(this,Pt,[NaN,NaN,NaN,NaN,e,t]);g(this,un,[e,t]);const l=a(this,Rt).at(-1);return l&&(l.line=new Float32Array(l.line),l.points=new Float32Array(l.points)),a(this,Rt).push({line:o,points:a(this,un)}),a(this,Os).set(o,0),g(this,Ci,0),this.toSVGPath(),null}getLastElement(){return a(this,Rt).at(-1)}setLastElement(e){return a(this,Rt)?(a(this,Rt).push(e),g(this,Pt,e.line),g(this,un,e.points),g(this,Ci,0),{path:{d:this.toSVGPath()}}):a(this,Fl).setLastElement(e)}removeLastElement(){if(!a(this,Rt))return a(this,Fl).removeLastElement();a(this,Rt).pop(),g(this,$t,"");for(let e=0,t=a(this,Rt).length;e<t;e++){const{line:n,points:s}=a(this,Rt)[e];g(this,Pt,n),g(this,un,s),g(this,Ci,0),this.toSVGPath()}return{path:{d:a(this,$t)}}}toSVGPath(){const e=W.svgRound(a(this,Pt)[4]),t=W.svgRound(a(this,Pt)[5]);if(a(this,un).length===2)return g(this,$t,`${a(this,$t)} M ${e} ${t} Z`),a(this,$t);if(a(this,un).length<=6){const s=a(this,$t).lastIndexOf("M");g(this,$t,`${a(this,$t).slice(0,s)} M ${e} ${t}`),g(this,Ci,6)}if(a(this,un).length===4){const s=W.svgRound(a(this,Pt)[10]),r=W.svgRound(a(this,Pt)[11]);return g(this,$t,`${a(this,$t)} L ${s} ${r}`),g(this,Ci,12),a(this,$t)}const n=[];a(this,Ci)===0&&(n.push(`M ${e} ${t}`),g(this,Ci,6));for(let s=a(this,Ci),r=a(this,Pt).length;s<r;s+=6){const[o,l,c,u,h,d]=a(this,Pt).slice(s,s+6).map(W.svgRound);n.push(`C${o} ${l} ${c} ${u} ${h} ${d}`)}return g(this,$t,a(this,$t)+n.join(" ")),g(this,Ci,a(this,Pt).length),a(this,$t)}getOutlines(e,t,n,s){const r=a(this,Rt).at(-1);return r.line=new Float32Array(r.line),r.points=new Float32Array(r.points),a(this,Fl).build(a(this,Rt),e,t,n,a(this,Nl),a(this,uh),s),g(this,Os,null),g(this,Pt,null),g(this,Rt,null),g(this,$t,null),a(this,Fl)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}Os=new WeakMap,Pt=new WeakMap,Rt=new WeakMap,Nl=new WeakMap,uh=new WeakMap,un=new WeakMap,$t=new WeakMap,Ci=new WeakMap,Fl=new WeakMap,Bl=new WeakMap,jl=new WeakMap,hh=new WeakSet,Sm=function(e,t){return W._normalizePoint(e,t,a(this,Bl),a(this,jl),a(this,Nl))};var hn,zp,Hp,ti,Ms,Ns,dh,fh,$l,Ht,Gs,gT,mT,yT;class ig extends W{constructor(){super(...arguments);y(this,Ht);y(this,hn);y(this,zp,0);y(this,Hp);y(this,ti);y(this,Ms);y(this,Ns);y(this,dh);y(this,fh);y(this,$l)}build(t,n,s,r,o,l,c){g(this,Ms,n),g(this,Ns,s),g(this,dh,r),g(this,fh,o),g(this,$l,l),g(this,Hp,c??0),g(this,ti,t),A(this,Ht,mT).call(this)}get thickness(){return a(this,$l)}setLastElement(t){return a(this,ti).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return a(this,ti).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:n}of a(this,ti)){if(t.push(`M${W.svgRound(n[4])} ${W.svgRound(n[5])}`),n.length===6){t.push("Z");continue}if(n.length===12&&isNaN(n[6])){t.push(`L${W.svgRound(n[10])} ${W.svgRound(n[11])}`);continue}for(let s=6,r=n.length;s<r;s+=6){const[o,l,c,u,h,d]=n.subarray(s,s+6).map(W.svgRound);t.push(`C${o} ${l} ${c} ${u} ${h} ${d}`)}}return t.join("")}serialize([t,n,s,r],o){const l=[],c=[],[u,h,d,f]=A(this,Ht,gT).call(this);let p,v,b,S,m,_,w,E,k;switch(a(this,fh)){case 0:k=W._rescale,p=t,v=n+r,b=s,S=-r,m=t+u*s,_=n+(1-h-f)*r,w=t+(u+d)*s,E=n+(1-h)*r;break;case 90:k=W._rescaleAndSwap,p=t,v=n,b=s,S=r,m=t+h*s,_=n+u*r,w=t+(h+f)*s,E=n+(u+d)*r;break;case 180:k=W._rescale,p=t+s,v=n,b=-s,S=r,m=t+(1-u-d)*s,_=n+h*r,w=t+(1-u)*s,E=n+(h+f)*r;break;case 270:k=W._rescaleAndSwap,p=t+s,v=n+r,b=-s,S=-r,m=t+(1-h-f)*s,_=n+(1-u-d)*r,w=t+(1-h)*s,E=n+(1-u)*r;break}for(const{line:C,points:T}of a(this,ti))l.push(k(C,p,v,b,S,o?new Array(C.length):null)),c.push(k(T,p,v,b,S,o?new Array(T.length):null));return{lines:l,points:c,rect:[m,_,w,E]}}static deserialize(t,n,s,r,o,{paths:{lines:l,points:c},rotation:u,thickness:h}){const d=[];let f,p,v,b,S;switch(u){case 0:S=W._rescale,f=-t/s,p=n/r+1,v=1/s,b=-1/r;break;case 90:S=W._rescaleAndSwap,f=-n/r,p=-t/s,v=1/r,b=1/s;break;case 180:S=W._rescale,f=t/s+1,p=-n/r,v=-1/s,b=1/r;break;case 270:S=W._rescaleAndSwap,f=n/r+1,p=t/s+1,v=-1/r,b=-1/s;break}if(!l){l=[];for(const _ of c){const w=_.length;if(w===2){l.push(new Float32Array([NaN,NaN,NaN,NaN,_[0],_[1]]));continue}if(w===4){l.push(new Float32Array([NaN,NaN,NaN,NaN,_[0],_[1],NaN,NaN,NaN,NaN,_[2],_[3]]));continue}const E=new Float32Array(3*(w-2));l.push(E);let[k,C,T,R]=_.subarray(0,4);E.set([NaN,NaN,NaN,NaN,k,C],0);for(let D=4;D<w;D+=2){const O=_[D],B=_[D+1];E.set(W.createBezierPoints(k,C,T,R,O,B),(D-2)*3),[k,C,T,R]=[T,R,O,B]}}}for(let _=0,w=l.length;_<w;_++)d.push({line:S(l[_].map(E=>E??NaN),f,p,v,b),points:S(c[_].map(E=>E??NaN),f,p,v,b)});const m=new this.prototype.constructor;return m.build(d,s,r,1,u,h,o),m}get box(){return a(this,hn)}updateProperty(t,n){return t==="stroke-width"?A(this,Ht,yT).call(this,n):null}updateParentDimensions([t,n],s){const[r,o]=A(this,Ht,Gs).call(this);g(this,Ms,t),g(this,Ns,n),g(this,dh,s);const[l,c]=A(this,Ht,Gs).call(this),u=l-r,h=c-o,d=a(this,hn);return d[0]-=u,d[1]-=h,d[2]+=2*u,d[3]+=2*h,d}updateRotation(t){return g(this,zp,t),{path:{transform:this.rotationTransform}}}get viewBox(){return a(this,hn).map(W.svgRound).join(" ")}get defaultProperties(){const[t,n]=a(this,hn);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${W.svgRound(t)} ${W.svgRound(n)}`}}}get rotationTransform(){const[,,t,n]=a(this,hn);let s=0,r=0,o=0,l=0,c=0,u=0;switch(a(this,zp)){case 90:r=n/t,o=-t/n,c=t;break;case 180:s=-1,l=-1,c=t,u=n;break;case 270:r=-n/t,o=t/n,u=n;break;default:return""}return`matrix(${s} ${r} ${o} ${l} ${W.svgRound(c)} ${W.svgRound(u)})`}getPathResizingSVGProperties([t,n,s,r]){const[o,l]=A(this,Ht,Gs).call(this),[c,u,h,d]=a(this,hn);if(Math.abs(h-o)<=W.PRECISION||Math.abs(d-l)<=W.PRECISION){const S=t+s/2-(c+h/2),m=n+r/2-(u+d/2);return{path:{"transform-origin":`${W.svgRound(t)} ${W.svgRound(n)}`,transform:`${this.rotationTransform} translate(${S} ${m})`}}}const f=(s-2*o)/(h-2*o),p=(r-2*l)/(d-2*l),v=h/s,b=d/r;return{path:{"transform-origin":`${W.svgRound(c)} ${W.svgRound(u)}`,transform:`${this.rotationTransform} scale(${v} ${b}) translate(${W.svgRound(o)} ${W.svgRound(l)}) scale(${f} ${p}) translate(${W.svgRound(-o)} ${W.svgRound(-l)})`}}}getPathResizedSVGProperties([t,n,s,r]){const[o,l]=A(this,Ht,Gs).call(this),c=a(this,hn),[u,h,d,f]=c;if(c[0]=t,c[1]=n,c[2]=s,c[3]=r,Math.abs(d-o)<=W.PRECISION||Math.abs(f-l)<=W.PRECISION){const m=t+s/2-(u+d/2),_=n+r/2-(h+f/2);for(const{line:w,points:E}of a(this,ti))W._translate(w,m,_,w),W._translate(E,m,_,E);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${W.svgRound(t)} ${W.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const p=(s-2*o)/(d-2*o),v=(r-2*l)/(f-2*l),b=-p*(u+o)+t+o,S=-v*(h+l)+n+l;if(p!==1||v!==1||b!==0||S!==0)for(const{line:m,points:_}of a(this,ti))W._rescale(m,b,S,p,v,m),W._rescale(_,b,S,p,v,_);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${W.svgRound(t)} ${W.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,n],s){const[r,o]=s,l=a(this,hn),c=t-l[0],u=n-l[1];if(a(this,Ms)===r&&a(this,Ns)===o)for(const{line:h,points:d}of a(this,ti))W._translate(h,c,u,h),W._translate(d,c,u,d);else{const h=a(this,Ms)/r,d=a(this,Ns)/o;g(this,Ms,r),g(this,Ns,o);for(const{line:f,points:p}of a(this,ti))W._rescale(f,c,u,h,d,f),W._rescale(p,c,u,h,d,p);l[2]*=h,l[3]*=d}return l[0]=t,l[1]=n,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${W.svgRound(t)} ${W.svgRound(n)}`}}}get defaultSVGProperties(){const t=a(this,hn);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${W.svgRound(t[0])} ${W.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}hn=new WeakMap,zp=new WeakMap,Hp=new WeakMap,ti=new WeakMap,Ms=new WeakMap,Ns=new WeakMap,dh=new WeakMap,fh=new WeakMap,$l=new WeakMap,Ht=new WeakSet,Gs=function(t=a(this,$l)){const n=a(this,Hp)+t/2*a(this,dh);return a(this,fh)%180===0?[n/a(this,Ms),n/a(this,Ns)]:[n/a(this,Ns),n/a(this,Ms)]},gT=function(){const[t,n,s,r]=a(this,hn),[o,l]=A(this,Ht,Gs).call(this,0);return[t+o,n+l,s-2*o,r-2*l]},mT=function(){const t=g(this,hn,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:r}of a(this,ti)){if(r.length<=12){for(let c=4,u=r.length;c<u;c+=6)G.pointBoundingBox(r[c],r[c+1],t);continue}let o=r[4],l=r[5];for(let c=6,u=r.length;c<u;c+=6){const[h,d,f,p,v,b]=r.subarray(c,c+6);G.bezierBoundingBox(o,l,h,d,f,p,v,b,t),o=v,l=b}}const[n,s]=A(this,Ht,Gs).call(this);t[0]=pn(t[0]-n,0,1),t[1]=pn(t[1]-s,0,1),t[2]=pn(t[2]+n,0,1),t[3]=pn(t[3]+s,0,1),t[2]-=t[0],t[3]-=t[1]},yT=function(t){const[n,s]=A(this,Ht,Gs).call(this);g(this,$l,t);const[r,o]=A(this,Ht,Gs).call(this),[l,c]=[r-n,o-s],u=a(this,hn);return u[0]-=l,u[1]-=c,u[2]+=2*l,u[3]+=2*c,u};class nv extends fT{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:$e._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??(t=this["stroke-width"]),t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new nv(this._viewParameters);return e.updateAll(this),e}}var Dy,vT;const Uc=class Uc extends dy{constructor(t){super({...t,name:"inkEditor"});y(this,Dy);this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,n){$e.initialize(t,n),this._defaultDrawingOptions=new nv(n.viewParameters)}static getDefaultDrawingOptions(t){const n=this._defaultDrawingOptions.clone();return n.updateProperties(t),n}static get supportMultipleDrawings(){return!0}static get typesMap(){return re(this,"typesMap",new Map([[pe.INK_THICKNESS,"stroke-width"],[pe.INK_COLOR,"stroke"],[pe.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,n,s,r,o){return new $I(t,n,s,r,o,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,n,s,r,o,l){return ig.deserialize(t,n,s,r,o,l)}static async deserialize(t,n,s){let r=null;if(t instanceof Ob){const{data:{inkLists:l,rect:c,rotation:u,id:h,color:d,opacity:f,borderStyle:{rawWidth:p},popupRef:v,richText:b,contentsObj:S,creationDate:m,modificationDate:_},parent:{page:{pageNumber:w}}}=t;r=t={annotationType:ne.INK,color:Array.from(d),thickness:p,opacity:f,paths:{points:l},boxes:null,pageIndex:w-1,rect:c.slice(0),rotation:u,annotationElementId:h,id:h,deleted:!1,popupRef:v,richText:b,comment:(S==null?void 0:S.str)||null,creationDate:m,modificationDate:_}}const o=await super.deserialize(t,n,s);return o._initialData=r,t.comment&&o.setCommentData(t),o}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new ly(this)),[["colorPicker",this._colorPicker]]}get colorType(){return pe.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:n,parent:s}=this;n.updateSVGProperty("stroke-width"),s.drawLayer.updateProperties(t,n.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:n,opacity:s}){this._drawingOptions=Uc.getDefaultDrawingOptions({stroke:G.makeHexColor(...t),"stroke-width":n,"stroke-opacity":s})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:n,points:s}=this.serializeDraw(t),{_drawingOptions:{stroke:r,"stroke-opacity":o,"stroke-width":l}}=this,c=Object.assign(super.serialize(t),{color:$e._colorManager.convert(r),opacity:o,thickness:l,paths:{lines:n,points:s}});return this.addComment(c),t?(c.isCopy=!0,c):this.annotationElementId&&!A(this,Dy,vT).call(this,c)?null:(c.id=this.annotationElementId,c)}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:n,rect:s}=this.serializeDraw(!1);return t.updateEdited({rect:s,thickness:this._drawingOptions["stroke-width"],points:n,popup:this.comment}),null}};Dy=new WeakSet,vT=function(t){const{color:n,thickness:s,opacity:r,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((l,c)=>l!==n[c])||t.thickness!==s||t.opacity!==r||t.pageIndex!==o},F(Uc,"_type","ink"),F(Uc,"_editorType",ne.INK),F(Uc,"_defaultDrawingOptions",null);let o_=Uc;class a_ extends ig{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const Ig=8,Gh=3;var Ul,Ae,l_,Ji,wT,_T,c_,Em,bT,AT,ST,u_,h_,ET;class Dr{static extractContoursFromText(e,{fontFamily:t,fontStyle:n,fontWeight:s},r,o,l,c){let u=new OffscreenCanvas(1,1),h=u.getContext("2d",{alpha:!1});const d=200,f=h.font=`${n} ${s} ${d}px ${t}`,{actualBoundingBoxLeft:p,actualBoundingBoxRight:v,actualBoundingBoxAscent:b,actualBoundingBoxDescent:S,fontBoundingBoxAscent:m,fontBoundingBoxDescent:_,width:w}=h.measureText(e),E=1.5,k=Math.ceil(Math.max(Math.abs(p)+Math.abs(v)||0,w)*E),C=Math.ceil(Math.max(Math.abs(b)+Math.abs(S)||d,Math.abs(m)+Math.abs(_)||d)*E);u=new OffscreenCanvas(k,C),h=u.getContext("2d",{alpha:!0,willReadFrequently:!0}),h.font=f,h.filter="grayscale(1)",h.fillStyle="white",h.fillRect(0,0,k,C),h.fillStyle="black",h.fillText(e,k*(E-1)/2,C*(3-E)/2);const T=A(this,Ae,u_).call(this,h.getImageData(0,0,k,C).data),R=A(this,Ae,ST).call(this,T),D=A(this,Ae,h_).call(this,R),O=A(this,Ae,c_).call(this,T,k,C,D);return this.processDrawnLines({lines:{curves:O,width:k,height:C},pageWidth:r,pageHeight:o,rotation:l,innerMargin:c,mustSmooth:!0,areContours:!0})}static process(e,t,n,s,r){const[o,l,c]=A(this,Ae,ET).call(this,e),[u,h]=A(this,Ae,AT).call(this,o,l,c,Math.hypot(l,c)*a(this,Ul).sigmaSFactor,a(this,Ul).sigmaR,a(this,Ul).kernelSize),d=A(this,Ae,h_).call(this,h),f=A(this,Ae,c_).call(this,u,l,c,d);return this.processDrawnLines({lines:{curves:f,width:l,height:c},pageWidth:t,pageHeight:n,rotation:s,innerMargin:r,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:n,rotation:s,innerMargin:r,mustSmooth:o,areContours:l}){s%180!==0&&([t,n]=[n,t]);const{curves:c,width:u,height:h}=e,d=e.thickness??0,f=[],p=Math.min(t/u,n/h),v=p/t,b=p/n,S=[];for(const{points:_}of c){const w=o?A(this,Ae,bT).call(this,_):_;if(!w)continue;S.push(w);const E=w.length,k=new Float32Array(E),C=new Float32Array(3*(E===2?2:E-2));if(f.push({line:C,points:k}),E===2){k[0]=w[0]*v,k[1]=w[1]*b,C.set([NaN,NaN,NaN,NaN,k[0],k[1]],0);continue}let[T,R,D,O]=w;T*=v,R*=b,D*=v,O*=b,k.set([T,R,D,O],0),C.set([NaN,NaN,NaN,NaN,T,R],0);for(let B=4;B<E;B+=2){const H=k[B]=w[B]*v,Y=k[B+1]=w[B+1]*b;C.set(W.createBezierPoints(T,R,D,O,H,Y),(B-2)*3),[T,R,D,O]=[D,O,H,Y]}}if(f.length===0)return null;const m=l?new a_:new ig;return m.build(f,t,n,1,s,l?0:d,r),{outline:m,newCurves:S,areContours:l,thickness:d,width:u,height:h}}static async compressSignature({outlines:e,areContours:t,thickness:n,width:s,height:r}){let o=1/0,l=-1/0,c=0;for(const w of e){c+=w.length;for(let E=2,k=w.length;E<k;E++){const C=w[E]-w[E-2];o=Math.min(o,C),l=Math.max(l,C)}}let u;o>=-128&&l<=127?u=Int8Array:o>=-32768&&l<=32767?u=Int16Array:u=Int32Array;const h=e.length,d=Ig+Gh*h,f=new Uint32Array(d);let p=0;f[p++]=d*Uint32Array.BYTES_PER_ELEMENT+(c-2*h)*u.BYTES_PER_ELEMENT,f[p++]=0,f[p++]=s,f[p++]=r,f[p++]=t?0:1,f[p++]=Math.max(0,Math.floor(n??0)),f[p++]=h,f[p++]=u.BYTES_PER_ELEMENT;for(const w of e)f[p++]=w.length-2,f[p++]=w[0],f[p++]=w[1];const v=new CompressionStream("deflate-raw"),b=v.writable.getWriter();await b.ready,b.write(f);const S=u.prototype.constructor;for(const w of e){const E=new S(w.length-2);for(let k=2,C=w.length;k<C;k++)E[k-2]=w[k]-w[k-2];b.write(E)}b.close();const m=await new Response(v.readable).arrayBuffer(),_=new Uint8Array(m);return Ak(_)}static async decompressSignature(e){try{const t=nL(e),{readable:n,writable:s}=new DecompressionStream("deflate-raw"),r=s.getWriter();await r.ready,r.write(t).then(async()=>{await r.ready,await r.close()}).catch(()=>{});let o=null,l=0;for await(const w of n)o||(o=new Uint8Array(new Uint32Array(w.buffer,0,4)[0])),o.set(w,l),l+=w.length;const c=new Uint32Array(o.buffer,0,o.length>>2),u=c[1];if(u!==0)throw new Error(`Invalid version: ${u}`);const h=c[2],d=c[3],f=c[4]===0,p=c[5],v=c[6],b=c[7],S=[],m=(Ig+Gh*v)*Uint32Array.BYTES_PER_ELEMENT;let _;switch(b){case Int8Array.BYTES_PER_ELEMENT:_=new Int8Array(o.buffer,m);break;case Int16Array.BYTES_PER_ELEMENT:_=new Int16Array(o.buffer,m);break;case Int32Array.BYTES_PER_ELEMENT:_=new Int32Array(o.buffer,m);break}l=0;for(let w=0;w<v;w++){const E=c[Gh*w+Ig],k=new Float32Array(E+2);S.push(k);for(let C=0;C<Gh-1;C++)k[C]=c[Gh*w+Ig+C+1];for(let C=0;C<E;C++)k[C+2]=k[C]+_[l++]}return{areContours:f,thickness:p,outlines:S,width:h,height:d}}catch(t){return Z(`decompressSignature: ${t}`),null}}}Ul=new WeakMap,Ae=new WeakSet,l_=function(e,t,n,s){return n-=e,s-=t,n===0?s>0?0:4:n===1?s+6:2-s},Ji=new WeakMap,wT=function(e,t,n,s,r,o,l){const c=A(this,Ae,l_).call(this,n,s,r,o);for(let u=0;u<8;u++){const h=(-u+c-l+16)%8,d=a(this,Ji)[2*h],f=a(this,Ji)[2*h+1];if(e[(n+d)*t+(s+f)]!==0)return h}return-1},_T=function(e,t,n,s,r,o,l){const c=A(this,Ae,l_).call(this,n,s,r,o);for(let u=0;u<8;u++){const h=(u+c+l+16)%8,d=a(this,Ji)[2*h],f=a(this,Ji)[2*h+1];if(e[(n+d)*t+(s+f)]!==0)return h}return-1},c_=function(e,t,n,s){const r=e.length,o=new Int32Array(r);for(let h=0;h<r;h++)o[h]=e[h]<=s?1:0;for(let h=1;h<n-1;h++)o[h*t]=o[h*t+t-1]=0;for(let h=0;h<t;h++)o[h]=o[t*n-1-h]=0;let l=1,c;const u=[];for(let h=1;h<n-1;h++){c=1;for(let d=1;d<t-1;d++){const f=h*t+d,p=o[f];if(p===0)continue;let v=h,b=d;if(p===1&&o[f-1]===0)l+=1,b-=1;else if(p>=1&&o[f+1]===0)l+=1,b+=1,p>1&&(c=p);else{p!==1&&(c=Math.abs(p));continue}const S=[d,h],m=b===d+1,_={isHole:m,points:S,id:l,parent:0};u.push(_);let w;for(const B of u)if(B.id===c){w=B;break}w?w.isHole?_.parent=m?w.parent:c:_.parent=m?c:w.parent:_.parent=m?c:0;const E=A(this,Ae,wT).call(this,o,t,h,d,v,b,0);if(E===-1){o[f]=-l,o[f]!==1&&(c=Math.abs(o[f]));continue}let k=a(this,Ji)[2*E],C=a(this,Ji)[2*E+1];const T=h+k,R=d+C;v=T,b=R;let D=h,O=d;for(;;){const B=A(this,Ae,_T).call(this,o,t,D,O,v,b,1);k=a(this,Ji)[2*B],C=a(this,Ji)[2*B+1];const H=D+k,Y=O+C;S.push(Y,H);const X=D*t+O;if(o[X+1]===0?o[X]=-l:o[X]===1&&(o[X]=l),H===h&&Y===d&&D===T&&O===R){o[f]!==1&&(c=Math.abs(o[f]));break}else v=D,b=O,D=H,O=Y}}}return u},Em=function(e,t,n,s){if(n-t<=4){for(let T=t;T<n-2;T+=2)s.push(e[T],e[T+1]);return}const r=e[t],o=e[t+1],l=e[n-4]-r,c=e[n-3]-o,u=Math.hypot(l,c),h=l/u,d=c/u,f=h*o-d*r,p=c/l,v=1/u,b=Math.atan(p),S=Math.cos(b),m=Math.sin(b),_=v*(Math.abs(S)+Math.abs(m)),w=v*(1-_+_**2),E=Math.max(Math.atan(Math.abs(m+S)*w),Math.atan(Math.abs(m-S)*w));let k=0,C=t;for(let T=t+2;T<n-2;T+=2){const R=Math.abs(f-h*e[T+1]+d*e[T]);R>k&&(C=T,k=R)}k>(u*E)**2?(A(this,Ae,Em).call(this,e,t,C+2,s),A(this,Ae,Em).call(this,e,C,n,s)):s.push(r,o)},bT=function(e){const t=[],n=e.length;return A(this,Ae,Em).call(this,e,0,n,t),t.push(e[n-2],e[n-1]),t.length<=4?null:t},AT=function(e,t,n,s,r,o){const l=new Float32Array(o**2),c=-2*s**2,u=o>>1;for(let b=0;b<o;b++){const S=(b-u)**2;for(let m=0;m<o;m++)l[b*o+m]=Math.exp((S+(m-u)**2)/c)}const h=new Float32Array(256),d=-2*r**2;for(let b=0;b<256;b++)h[b]=Math.exp(b**2/d);const f=e.length,p=new Uint8Array(f),v=new Uint32Array(256);for(let b=0;b<n;b++)for(let S=0;S<t;S++){const m=b*t+S,_=e[m];let w=0,E=0;for(let C=0;C<o;C++){const T=b+C-u;if(!(T<0||T>=n))for(let R=0;R<o;R++){const D=S+R-u;if(D<0||D>=t)continue;const O=e[T*t+D],B=l[C*o+R]*h[Math.abs(O-_)];w+=O*B,E+=B}}const k=p[m]=Math.round(w/E);v[k]++}return[p,v]},ST=function(e){const t=new Uint32Array(256);for(const n of e)t[n]++;return t},u_=function(e){const t=e.length,n=new Uint8ClampedArray(t>>2);let s=-1/0,r=1/0;for(let l=0,c=n.length;l<c;l++){const u=n[l]=e[l<<2];s=Math.max(s,u),r=Math.min(r,u)}const o=255/(s-r);for(let l=0,c=n.length;l<c;l++)n[l]=(n[l]-r)*o;return n},h_=function(e){let t,n=-1/0,s=-1/0;const r=e.findIndex(c=>c!==0);let o=r,l=r;for(t=r;t<256;t++){const c=e[t];c>n&&(t-o>s&&(s=t-o,l=t-1),n=c,o=t)}for(t=l-1;t>=0&&!(e[t]>e[t+1]);t--);return t},ET=function(e){const t=e,{width:n,height:s}=e,{maxDim:r}=a(this,Ul);let o=n,l=s;if(n>r||s>r){let f=n,p=s,v=Math.log2(Math.max(n,s)/r);const b=Math.floor(v);v=v===b?b-1:b;for(let m=0;m<v;m++){o=Math.ceil(f/2),l=Math.ceil(p/2);const _=new OffscreenCanvas(o,l);_.getContext("2d").drawImage(e,0,0,f,p,0,0,o,l),f=o,p=l,e!==t&&e.close(),e=_.transferToImageBitmap()}const S=Math.min(r/o,r/l);o=Math.round(o*S),l=Math.round(l*S)}const u=new OffscreenCanvas(o,l).getContext("2d",{willReadFrequently:!0});u.fillStyle="white",u.fillRect(0,0,o,l),u.filter="grayscale(1)",u.drawImage(e,0,0,e.width,e.height,0,0,o,l);const h=u.getImageData(0,0,o,l).data;return[A(this,Ae,u_).call(this,h),o,l]},y(Dr,Ae),y(Dr,Ul,{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}),y(Dr,Ji,new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]));class Mb extends fT{constructor(){super(),super.updateProperties({fill:$e._defaultLineColor,"stroke-width":0})}clone(){const e=new Mb;return e.updateAll(this),e}}class Nb extends nv{constructor(e){super(e),super.updateProperties({stroke:$e._defaultLineColor,"stroke-width":1})}clone(){const e=new Nb(this._viewParameters);return e.updateAll(this),e}}var $o,Fs,Uo,zl;const Bn=class Bn extends dy{constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"});y(this,$o,!1);y(this,Fs,null);y(this,Uo,null);y(this,zl,null);this._willKeepAspectRatio=!0,g(this,Uo,t.signatureData||null),g(this,Fs,null),this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,n){$e.initialize(t,n),this._defaultDrawingOptions=new Mb,this._defaultDrawnSignatureOptions=new Nb(n.viewParameters)}static getDefaultDrawingOptions(t){const n=this._defaultDrawingOptions.clone();return n.updateProperties(t),n}static get supportMultipleDrawings(){return!1}static get typesMap(){return re(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!a(this,Fs)}}static computeTelemetryFinalData(t){const n=t.get("hasDescription");return{hasAltText:n.get(!0)??0,hasNoAltText:n.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,n;const{_isCopy:s}=this;if(s&&(this._isCopy=!1,t=this.x,n=this.y),super.render(),this._drawId===null)if(a(this,Uo)){const{lines:r,mustSmooth:o,areContours:l,description:c,uuid:u,heightInPage:h}=a(this,Uo),{rawDims:{pageWidth:d,pageHeight:f},rotation:p}=this.parent.viewport,v=Dr.processDrawnLines({lines:r,pageWidth:d,pageHeight:f,rotation:p,innerMargin:Bn._INNER_MARGIN,mustSmooth:o,areContours:l});this.addSignature(v,h,c,u)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:a(this,Fs)||""}));return s&&(this._isCopy=!0,this._moveAfterPaste(t,n)),this.div}setUuid(t){g(this,zl,t),this.addEditToolbar()}getUuid(){return a(this,zl)}get description(){return a(this,Fs)}set description(t){g(this,Fs,t),this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(n=>{n==null||n.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:n,thickness:s,width:r,height:o}=a(this,Uo),l=Math.max(r,o),c=Dr.processDrawnLines({lines:{curves:t.map(u=>({points:u})),thickness:s,width:r,height:o},pageWidth:l,pageHeight:l,rotation:0,innerMargin:0,mustSmooth:!1,areContours:n});return{areContours:n,outline:c.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,n,s,r){const{x:o,y:l}=this,{outline:c}=g(this,Uo,t);g(this,$o,c instanceof a_),this.description=s;let u;a(this,$o)?u=Bn.getDefaultDrawingOptions():(u=Bn._defaultDrawnSignatureOptions.clone(),u.updateProperties({"stroke-width":c.thickness})),this._addOutlines({drawOutlines:c,drawingOptions:u});const[,h]=this.pageDimensions;let d=n/h;d=d>=1?.5:d,this.width*=d/this.height,this.width>=1&&(d*=.9/this.width,this.width=.9),this.height=d,this.setDims(),this.x=o,this.y=l,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(r),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!r,hasDescription:!!s}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:n,pageHeight:s},rotation:r}=this.parent.viewport;return Dr.process(t,n,s,r,Bn._INNER_MARGIN)}getFromText(t,n){const{rawDims:{pageWidth:s,pageHeight:r},rotation:o}=this.parent.viewport;return Dr.extractContoursFromText(t,n,s,r,o,Bn._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:n,pageHeight:s},rotation:r}=this.parent.viewport;return Dr.processDrawnLines({lines:t,pageWidth:n,pageHeight:s,rotation:r,innerMargin:Bn._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:n}){t?this._drawingOptions=Bn.getDefaultDrawingOptions():(this._drawingOptions=Bn._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":n}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:n,points:s}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":r}}=this,o=Object.assign(super.serialize(t),{isSignature:!0,areContours:a(this,$o),color:[0,0,0],thickness:a(this,$o)?0:r});return this.addComment(o),t?(o.paths={lines:n,points:s},o.uuid=a(this,zl),o.isCopy=!0):o.lines=n,a(this,Fs)&&(o.accessibilityData={type:"Figure",alt:a(this,Fs)}),o}static deserializeDraw(t,n,s,r,o,l){return l.areContours?a_.deserialize(t,n,s,r,o,l):ig.deserialize(t,n,s,r,o,l)}static async deserialize(t,n,s){var o;const r=await super.deserialize(t,n,s);return g(r,$o,t.areContours),r.description=((o=t.accessibilityData)==null?void 0:o.alt)||"",g(r,zl,t.uuid),r}};$o=new WeakMap,Fs=new WeakMap,Uo=new WeakMap,zl=new WeakMap,F(Bn,"_type","signature"),F(Bn,"_editorType",ne.SIGNATURE),F(Bn,"_defaultDrawingOptions",null);let d_=Bn;var Ge,Lt,zo,xr,Ho,ph,Pr,Hl,Bs,ni,gh,ve,yd,vd,km,Cm,Tm,p_,xm,kT;class f_ extends $e{constructor(t){super({...t,name:"stampEditor"});y(this,ve);y(this,Ge,null);y(this,Lt,null);y(this,zo,null);y(this,xr,null);y(this,Ho,null);y(this,ph,"");y(this,Pr,null);y(this,Hl,!1);y(this,Bs,null);y(this,ni,!1);y(this,gh,!1);g(this,xr,t.bitmapUrl),g(this,Ho,t.bitmapFile),this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,n){$e.initialize(t,n)}static isHandlingMimeForPasting(t){return J0.includes(t)}static paste(t,n){n.pasteEditor({mode:ne.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const n=t.get("hasAltText");return{hasAltText:n.get(!0)??0,hasNoAltText:n.get(!1)??0}}async mlGuessAltText(t=null,n=!0){if(this.hasAltTextData())return null;const{mlManager:s}=this._uiManager;if(!s)throw new Error("No ML.");if(!await s.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:r,width:o,height:l}=t||this.copyCanvas(null,null,!0).imageData,c=await s.guess({name:"altText",request:{data:r,width:o,height:l,channels:r.length/(o*l)}});if(!c)throw new Error("No response from the AI service.");if(c.error)throw new Error("Error from the AI service.");if(c.cancel)return null;if(!c.output)throw new Error("No valid response from the AI service.");const u=c.output;return await this.setGuessedAltText(u),n&&!this.hasAltTextData()&&(this.altTextData={alt:u,decorative:!1}),u}remove(){var t;a(this,Lt)&&(g(this,Ge,null),this._uiManager.imageManager.deleteId(a(this,Lt)),(t=a(this,Pr))==null||t.remove(),g(this,Pr,null),a(this,Bs)&&(clearTimeout(a(this,Bs)),g(this,Bs,null))),super.remove()}rebuild(){if(!this.parent){a(this,Lt)&&A(this,ve,km).call(this);return}super.rebuild(),this.div!==null&&(a(this,Lt)&&a(this,Pr)===null&&A(this,ve,km).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(a(this,zo)||a(this,Ge)||a(this,xr)||a(this,Ho)||a(this,Lt)||a(this,Hl))}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,n;return this._isCopy&&(t=this.x,n=this.y),super.render(),this.div.hidden=!0,this.createAltText(),a(this,Hl)||(a(this,Ge)?A(this,ve,Cm).call(this):A(this,ve,km).call(this)),this._isCopy&&this._moveAfterPaste(t,n),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,n){const{id:s,bitmap:r}=this._uiManager.imageManager.getFromCanvas(t,n);n.remove(),s&&this._uiManager.imageManager.isValidId(s)&&(g(this,Lt,s),r&&g(this,Ge,r),g(this,Hl,!1),A(this,ve,Cm).call(this))}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;a(this,Bs)!==null&&clearTimeout(a(this,Bs)),g(this,Bs,setTimeout(()=>{g(this,Bs,null),A(this,ve,p_).call(this)},200))}copyCanvas(t,n,s=!1){t||(t=224);const{width:r,height:o}=a(this,Ge),l=new zs;let c=a(this,Ge),u=r,h=o,d=null;if(n){if(r>n||o>n){const T=Math.min(n/r,n/o);u=Math.floor(r*T),h=Math.floor(o*T)}d=document.createElement("canvas");const p=d.width=Math.ceil(u*l.sx),v=d.height=Math.ceil(h*l.sy);a(this,ni)||(c=A(this,ve,Tm).call(this,p,v));const b=d.getContext("2d");b.filter=this._uiManager.hcmFilter;let S="white",m="#cfcfd8";this._uiManager.hcmFilter!=="none"?m="black":lL.isDarkMode&&(S="#8f8f9d",m="#42414d");const _=15,w=_*l.sx,E=_*l.sy,k=new OffscreenCanvas(w*2,E*2),C=k.getContext("2d");C.fillStyle=S,C.fillRect(0,0,w*2,E*2),C.fillStyle=m,C.fillRect(0,0,w,E),C.fillRect(w,E,w,E),b.fillStyle=b.createPattern(k,"repeat"),b.fillRect(0,0,p,v),b.drawImage(c,0,0,c.width,c.height,0,0,p,v)}let f=null;if(s){let p,v;if(l.symmetric&&c.width<t&&c.height<t)p=c.width,v=c.height;else if(c=a(this,Ge),r>t||o>t){const m=Math.min(t/r,t/o);p=Math.floor(r*m),v=Math.floor(o*m),a(this,ni)||(c=A(this,ve,Tm).call(this,p,v))}const S=new OffscreenCanvas(p,v).getContext("2d",{willReadFrequently:!0});S.drawImage(c,0,0,c.width,c.height,0,0,p,v),f={width:p,height:v,data:S.getImageData(0,0,p,v).data}}return{canvas:d,width:u,height:h,imageData:f}}static async deserialize(t,n,s){var S;let r=null,o=!1;if(t instanceof UC){const{data:{rect:m,rotation:_,id:w,structParent:E,popupRef:k,richText:C,contentsObj:T,creationDate:R,modificationDate:D},container:O,parent:{page:{pageNumber:B}},canvas:H}=t;let Y,X;H?(delete t.canvas,{id:Y,bitmap:X}=s.imageManager.getFromCanvas(O.id,H),H.remove()):(o=!0,t._hasNoCanvas=!0);const ee=((S=await n._structTree.getAriaAttributes(`${Nc}${w}`))==null?void 0:S.get("aria-label"))||"";r=t={annotationType:ne.STAMP,bitmapId:Y,bitmap:X,pageIndex:B-1,rect:m.slice(0),rotation:_,annotationElementId:w,id:w,deleted:!1,accessibilityData:{decorative:!1,altText:ee},isSvg:!1,structParent:E,popupRef:k,richText:C,comment:(T==null?void 0:T.str)||null,creationDate:R,modificationDate:D}}const l=await super.deserialize(t,n,s),{rect:c,bitmap:u,bitmapUrl:h,bitmapId:d,isSvg:f,accessibilityData:p}=t;o?(s.addMissingCanvas(t.id,l),g(l,Hl,!0)):d&&s.imageManager.isValidId(d)?(g(l,Lt,d),u&&g(l,Ge,u)):g(l,xr,h),g(l,ni,f);const[v,b]=l.pageDimensions;return l.width=(c[2]-c[0])/v,l.height=(c[3]-c[1])/b,p&&(l.altTextData=p),l._initialData=r,t.comment&&l.setCommentData(t),g(l,gh,!!r),l}serialize(t=!1,n=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=Object.assign(super.serialize(t),{bitmapId:a(this,Lt),isSvg:a(this,ni)});if(this.addComment(s),t)return s.bitmapUrl=A(this,ve,xm).call(this,!0),s.accessibilityData=this.serializeAltText(!0),s.isCopy=!0,s;const{decorative:r,altText:o}=this.serializeAltText(!1);if(!r&&o&&(s.accessibilityData={type:"Figure",alt:o}),this.annotationElementId){const c=A(this,ve,kT).call(this,s);return c.isSame?null:(c.isSameAltText?delete s.accessibilityData:s.accessibilityData.structParent=this._initialData.structParent??-1,s.id=this.annotationElementId,delete s.bitmapId,s)}if(n===null)return s;n.stamps||(n.stamps=new Map);const l=a(this,ni)?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!n.stamps.has(a(this,Lt)))n.stamps.set(a(this,Lt),{area:l,serialized:s}),s.bitmap=A(this,ve,xm).call(this,!1);else if(a(this,ni)){const c=n.stamps.get(a(this,Lt));l>c.area&&(c.area=l,c.serialized.bitmap.close(),c.serialized.bitmap=A(this,ve,xm).call(this,!1))}return s}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}Ge=new WeakMap,Lt=new WeakMap,zo=new WeakMap,xr=new WeakMap,Ho=new WeakMap,ph=new WeakMap,Pr=new WeakMap,Hl=new WeakMap,Bs=new WeakMap,ni=new WeakMap,gh=new WeakMap,ve=new WeakSet,yd=function(t,n=!1){if(!t){this.remove();return}g(this,Ge,t.bitmap),n||(g(this,Lt,t.id),g(this,ni,t.isSvg)),t.file&&g(this,ph,t.file.name),A(this,ve,Cm).call(this)},vd=function(){if(g(this,zo,null),this._uiManager.enableWaiting(!1),!!a(this,Pr)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&a(this,Ge)){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&a(this,Ge)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},km=function(){if(a(this,Lt)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(a(this,Lt)).then(s=>A(this,ve,yd).call(this,s,!0)).finally(()=>A(this,ve,vd).call(this));return}if(a(this,xr)){const s=a(this,xr);g(this,xr,null),this._uiManager.enableWaiting(!0),g(this,zo,this._uiManager.imageManager.getFromUrl(s).then(r=>A(this,ve,yd).call(this,r)).finally(()=>A(this,ve,vd).call(this)));return}if(a(this,Ho)){const s=a(this,Ho);g(this,Ho,null),this._uiManager.enableWaiting(!0),g(this,zo,this._uiManager.imageManager.getFromFile(s).then(r=>A(this,ve,yd).call(this,r)).finally(()=>A(this,ve,vd).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=J0.join(",");const n=this._uiManager._signal;g(this,zo,new Promise(s=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const r=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),A(this,ve,yd).call(this,r)}s()},{signal:n}),t.addEventListener("cancel",()=>{this.remove(),s()},{signal:n})}).finally(()=>A(this,ve,vd).call(this))),t.click()},Cm=function(){var u;const{div:t}=this;let{width:n,height:s}=a(this,Ge);const[r,o]=this.pageDimensions,l=.75;if(this.width)n=this.width*r,s=this.height*o;else if(n>l*r||s>l*o){const h=Math.min(l*r/n,l*o/s);n*=h,s*=h}this._uiManager.enableWaiting(!1);const c=g(this,Pr,document.createElement("canvas"));c.setAttribute("role","img"),this.addContainer(c),this.width=n/r,this.height=s/o,this.setDims(),(u=this._initialOptions)!=null&&u.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),A(this,ve,p_).call(this),a(this,gh)||(this.parent.addUndoableEditor(this),g(this,gh,!0)),this._reportTelemetry({action:"inserted_image"}),a(this,ph)&&this.div.setAttribute("aria-description",a(this,ph)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")},Tm=function(t,n){const{width:s,height:r}=a(this,Ge);let o=s,l=r,c=a(this,Ge);for(;o>2*t||l>2*n;){const u=o,h=l;o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),l>2*n&&(l=l>=16384?Math.floor(l/2)-1:Math.ceil(l/2));const d=new OffscreenCanvas(o,l);d.getContext("2d").drawImage(c,0,0,u,h,0,0,o,l),c=d.transferToImageBitmap()}return c},p_=function(){const[t,n]=this.parentDimensions,{width:s,height:r}=this,o=new zs,l=Math.ceil(s*t*o.sx),c=Math.ceil(r*n*o.sy),u=a(this,Pr);if(!u||u.width===l&&u.height===c)return;u.width=l,u.height=c;const h=a(this,ni)?a(this,Ge):A(this,ve,Tm).call(this,l,c),d=u.getContext("2d");d.filter=this._uiManager.hcmFilter,d.drawImage(h,0,0,h.width,h.height,0,0,l,c)},xm=function(t){if(t){if(a(this,ni)){const r=this._uiManager.imageManager.getSvgUrl(a(this,Lt));if(r)return r}const n=document.createElement("canvas");return{width:n.width,height:n.height}=a(this,Ge),n.getContext("2d").drawImage(a(this,Ge),0,0),n.toDataURL()}if(a(this,ni)){const[n,s]=this.pageDimensions,r=Math.round(this.width*n*la.PDF_TO_CSS_UNITS),o=Math.round(this.height*s*la.PDF_TO_CSS_UNITS),l=new OffscreenCanvas(r,o);return l.getContext("2d").drawImage(a(this,Ge),0,0,a(this,Ge).width,a(this,Ge).height,0,0,r,o),l.transferToImageBitmap()}return structuredClone(a(this,Ge))},kT=function(t){var l;const{pageIndex:n,accessibilityData:{altText:s}}=this._initialData,r=t.pageIndex===n,o=(((l=t.accessibilityData)==null?void 0:l.alt)||"")===s;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&r&&o,isSameAltText:o}},F(f_,"_type","stamp"),F(f_,"_editorType",ne.STAMP);var Wl,mh,Wo,Vo,Rr,Rn,Go,yh,vh,Zi,Lr,It,Ir,qo,wh,K,Ko,Oe,m_,CT,ps,y_,v_,Pm;const Ui=class Ui{constructor({uiManager:e,pageIndex:t,div:n,structTreeLayer:s,accessibilityManager:r,annotationLayer:o,drawLayer:l,textLayer:c,viewport:u,l10n:h}){y(this,Oe);y(this,Wl);y(this,mh,!1);y(this,Wo,null);y(this,Vo,null);y(this,Rr,null);y(this,Rn,new Map);y(this,Go,!1);y(this,yh,!1);y(this,vh,!1);y(this,Zi,null);y(this,Lr,null);y(this,It,null);y(this,Ir,null);y(this,qo,null);y(this,wh,-1);y(this,K);const d=[...a(Ui,Ko).values()];if(!Ui._initialized){Ui._initialized=!0;for(const f of d)f.initialize(h,e)}e.registerEditorTypes(d),g(this,K,e),this.pageIndex=t,this.div=n,g(this,Wl,r),g(this,Wo,o),this.viewport=u,g(this,It,c),this.drawLayer=l,this._structTree=s,a(this,K).addLayer(this)}get isEmpty(){return a(this,Rn).size===0}get isInvisible(){return this.isEmpty&&a(this,K).getMode()===ne.NONE}updateToolbar(e){a(this,K).updateToolbar(e)}updateMode(e=a(this,K).getMode()){switch(A(this,Oe,Pm).call(this),e){case ne.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case ne.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case ne.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;if(t.toggle("nonEditing",!1),e===ne.POPUP)t.toggle("commentEditing",!0);else{t.toggle("commentEditing",!1);for(const n of a(Ui,Ko).values())t.toggle(`${n._type}Editing`,e===n._editorType)}this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=a(this,It))==null?void 0:t.div)}setEditingState(e){a(this,K).setEditingState(e)}addCommands(e){a(this,K).addCommands(e)}cleanUndoStack(e){a(this,K).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=a(this,Wo))==null||t.togglePointerEvents(e)}async enable(){var n;g(this,vh,!0),this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),(n=a(this,qo))==null||n.abort(),g(this,qo,null);const e=new Set;for(const s of a(this,Oe,m_))s.enableEditing(),s.show(!0),s.annotationElementId&&(a(this,K).removeChangedExistingAnnotation(s),e.add(s.annotationElementId));const t=a(this,Wo);if(t)for(const s of t.getEditableAnnotations()){if(s.hide(),a(this,K).isDeletedAnnotationElement(s.data.id)||e.has(s.data.id))continue;const r=await this.deserialize(s);r&&(this.addOrRebuild(r),r.enableEditing())}g(this,vh,!1),a(this,K)._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){var s;if(g(this,yh,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),a(this,It)&&!a(this,qo)){g(this,qo,new AbortController);const r=a(this,K).combinedSignal(a(this,qo));a(this,It).div.addEventListener("pointerdown",o=>{const{clientX:c,clientY:u,timeStamp:h}=o,d=a(this,wh);if(h-d>500){g(this,wh,h);return}g(this,wh,-1);const{classList:f}=this.div;f.toggle("getElements",!0);const p=document.elementsFromPoint(c,u);if(f.toggle("getElements",!1),!this.div.contains(p[0]))return;let v;const b=new RegExp(`^${Xd}[0-9]+$`);for(const m of p)if(b.test(m.id)){v=m.id;break}if(!v)return;const S=a(this,Rn).get(v);(S==null?void 0:S.annotationElementId)===null&&(o.stopPropagation(),o.preventDefault(),S.dblclick(o))},{signal:r,capture:!0})}const e=a(this,Wo),t=[];if(e){const r=new Map,o=new Map;for(const c of a(this,Oe,m_)){if(c.disableEditing(),!c.annotationElementId){t.push(c);continue}if(c.serialize()!==null){r.set(c.annotationElementId,c);continue}else o.set(c.annotationElementId,c);(s=this.getEditableAnnotation(c.annotationElementId))==null||s.show(),c.remove()}const l=e.getEditableAnnotations();for(const c of l){const{id:u}=c.data;if(a(this,K).isDeletedAnnotationElement(u)){c.updateEdited({deleted:!0});continue}let h=o.get(u);if(h){h.resetAnnotationElement(c),h.show(!1),c.show();continue}h=r.get(u),h&&(a(this,K).addChangedExistingAnnotation(h),h.renderAnnotationElement(c)&&h.show(!1)),c.show()}}A(this,Oe,Pm).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:n}=this.div;for(const r of a(Ui,Ko).values())n.remove(`${r._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),e==null||e.updateFakeAnnotations(t),g(this,yh,!1)}getEditableAnnotation(e){var t;return((t=a(this,Wo))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){a(this,K).getActive()!==e&&a(this,K).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=a(this,It))!=null&&e.div&&!a(this,Ir)){g(this,Ir,new AbortController);const t=a(this,K).combinedSignal(a(this,Ir));a(this,It).div.addEventListener("pointerdown",A(this,Oe,CT).bind(this),{signal:t}),a(this,It).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=a(this,It))!=null&&e.div&&a(this,Ir)&&(a(this,Ir).abort(),g(this,Ir,null),a(this,It).div.classList.remove("highlighting"))}enableClick(){if(a(this,Vo))return;g(this,Vo,new AbortController);const e=a(this,K).combinedSignal(a(this,Vo));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=a(this,Vo))==null||e.abort(),g(this,Vo,null)}attach(e){a(this,Rn).set(e.id,e);const{annotationElementId:t}=e;t&&a(this,K).isDeletedAnnotationElement(t)&&a(this,K).removeDeletedAnnotationElement(e)}detach(e){var t;a(this,Rn).delete(e.id),(t=a(this,Wl))==null||t.removePointerInTextLayer(e.contentDiv),!a(this,yh)&&e.annotationElementId&&a(this,K).addDeletedAnnotationElement(e)}remove(e){this.detach(e),a(this,K).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(a(this,K).addDeletedAnnotationElement(e.annotationElementId),$e.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),a(this,K).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!a(this,vh)),a(this,K).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var n;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!a(this,Rr)&&(e._focusEventsAllowed=!1,g(this,Rr,setTimeout(()=>{g(this,Rr,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:a(this,K)._signal}),t.focus())},0))),e._structTreeParentId=(n=a(this,Wl))==null?void 0:n.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),n=()=>{e.remove()};this.addCommands({cmd:t,undo:n,mustExec:!1})}getEditorByUID(e){for(const t of a(this,Rn).values())if(t.uid===e)return t;return null}getNextId(){return a(this,K).getId()}combinedSignal(e){return a(this,K).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=a(this,Oe,ps))==null?void 0:e.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await a(this,K).updateMode(e.mode);const{offsetX:n,offsetY:s}=A(this,Oe,v_).call(this),r=this.getNextId(),o=A(this,Oe,y_).call(this,{parent:this,id:r,x:n,y:s,uiManager:a(this,K),isCentered:!0,...t});o&&this.add(o)}async deserialize(e){var t;return await((t=a(Ui,Ko).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,a(this,K)))||null}createAndAddNewEditor(e,t,n={}){const s=this.getNextId(),r=A(this,Oe,y_).call(this,{parent:this,id:s,x:e.offsetX,y:e.offsetY,uiManager:a(this,K),isCentered:t,...n});return r&&this.add(r),r}get boundingClientRect(){return this.div.getBoundingClientRect()}addNewEditor(e={}){this.createAndAddNewEditor(A(this,Oe,v_).call(this),!0,e)}setSelected(e){a(this,K).setSelected(e)}toggleSelected(e){a(this,K).toggleSelected(e)}unselect(e){a(this,K).unselect(e)}pointerup(e){var s;const{isMac:t}=Gt.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!a(this,Go)||(g(this,Go,!1),(s=a(this,Oe,ps))!=null&&s.isDrawer&&a(this,Oe,ps).supportMultipleDrawings))return;if(!a(this,mh)){g(this,mh,!0);return}const n=a(this,K).getMode();if(n===ne.STAMP||n===ne.SIGNATURE){a(this,K).unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){var s;if(a(this,K).getMode()===ne.HIGHLIGHT&&this.enableTextSelection(),a(this,Go)){g(this,Go,!1);return}const{isMac:t}=Gt.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(g(this,Go,!0),(s=a(this,Oe,ps))!=null&&s.isDrawer){this.startDrawingSession(e);return}const n=a(this,K).getActive();g(this,mh,!n||n.isEmpty())}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),a(this,Zi)){a(this,Oe,ps).startDrawing(this,a(this,K),!1,e);return}a(this,K).setCurrentDrawingSession(this),g(this,Zi,new AbortController);const t=a(this,K).combinedSignal(a(this,Zi));this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(g(this,Lr,null),this.commitOrRemove())},{signal:t}),a(this,Oe,ps).startDrawing(this,a(this,K),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&g(this,Lr,t);return}a(this,Lr)&&setTimeout(()=>{var t;(t=a(this,Lr))==null||t.focus(),g(this,Lr,null)},0)}endDrawingSession(e=!1){return a(this,Zi)?(a(this,K).setCurrentDrawingSession(null),a(this,Zi).abort(),g(this,Zi,null),g(this,Lr,null),a(this,Oe,ps).endDrawing(e)):null}findNewParent(e,t,n){const s=a(this,K).findParent(t,n);return s===null||s===this?!1:(s.changeParent(e),!0)}commitOrRemove(){return a(this,Zi)?(this.endDrawingSession(),!0):!1}onScaleChanging(){a(this,Zi)&&a(this,Oe,ps).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=a(this,K).getActive())==null?void 0:e.parent)===this&&(a(this,K).commitOrRemove(),a(this,K).setActiveEditor(null)),a(this,Rr)&&(clearTimeout(a(this,Rr)),g(this,Rr,null));for(const n of a(this,Rn).values())(t=a(this,Wl))==null||t.removePointerInTextLayer(n.contentDiv),n.setParent(null),n.isAttachedToDOM=!1,n.div.remove();this.div=null,a(this,Rn).clear(),a(this,K).removeLayer(this)}render({viewport:e}){this.viewport=e,Zl(this.div,e);for(const t of a(this,K).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){a(this,K).commitOrRemove(),A(this,Oe,Pm).call(this);const t=this.viewport.rotation,n=e.rotation;if(this.viewport=e,Zl(this.div,{rotation:n}),t!==n)for(const s of a(this,Rn).values())s.rotate(n)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return a(this,K).viewParameters.realScale}};Wl=new WeakMap,mh=new WeakMap,Wo=new WeakMap,Vo=new WeakMap,Rr=new WeakMap,Rn=new WeakMap,Go=new WeakMap,yh=new WeakMap,vh=new WeakMap,Zi=new WeakMap,Lr=new WeakMap,It=new WeakMap,Ir=new WeakMap,qo=new WeakMap,wh=new WeakMap,K=new WeakMap,Ko=new WeakMap,Oe=new WeakSet,m_=function(){return a(this,Rn).size!==0?a(this,Rn).values():a(this,K).getEditors(this.pageIndex)},CT=function(e){a(this,K).unselectAll();const{target:t}=e;if(t===a(this,It).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&a(this,It).div.contains(t)){const{isMac:n}=Gt.platform;if(e.button!==0||e.ctrlKey&&n)return;a(this,K).showAllEditors("highlight",!0,!0),a(this,It).div.classList.add("free"),this.toggleDrawing(),hy.startHighlighting(this,a(this,K).direction==="ltr",{target:a(this,It).div,x:e.x,y:e.y}),a(this,It).div.addEventListener("pointerup",()=>{a(this,It).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:a(this,K)._signal}),e.preventDefault()}},ps=function(){return a(Ui,Ko).get(a(this,K).getMode())},y_=function(e){const t=a(this,Oe,ps);return t?new t.prototype.constructor(e):null},v_=function(){const{x:e,y:t,width:n,height:s}=this.boundingClientRect,r=Math.max(0,e),o=Math.max(0,t),l=Math.min(window.innerWidth,e+n),c=Math.min(window.innerHeight,t+s),u=(r+l)/2-e,h=(o+c)/2-t,[d,f]=this.viewport.rotation%180===0?[u,h]:[h,u];return{offsetX:d,offsetY:f}},Pm=function(){for(const e of a(this,Rn).values())e.isEmpty()&&e.remove()},F(Ui,"_initialized",!1),y(Ui,Ko,new Map([Yw,o_,f_,hy,d_].map(e=>[e._editorType,e])));let g_=Ui;var es,dn,Vl,Wp,Oy,TT,Hs,__,xT,b_;const vt=class vt{constructor({pageIndex:e}){y(this,Hs);y(this,es,null);y(this,dn,new Map);y(this,Vl,new Map);this.pageIndex=e}setParent(e){if(!a(this,es)){g(this,es,e);return}if(a(this,es)!==e){if(a(this,dn).size>0)for(const t of a(this,dn).values())t.remove(),e.append(t);g(this,es,e)}}static get _svgFactory(){return re(this,"_svgFactory",new cy)}draw(e,t=!1,n=!1){const s=gt(vt,Wp)._++,r=A(this,Hs,__).call(this),o=vt._svgFactory.createElement("defs");r.append(o);const l=vt._svgFactory.createElement("path");o.append(l);const c=`path_p${this.pageIndex}_${s}`;l.setAttribute("id",c),l.setAttribute("vector-effect","non-scaling-stroke"),t&&a(this,Vl).set(s,l);const u=n?A(this,Hs,xT).call(this,o,c):null,h=vt._svgFactory.createElement("use");return r.append(h),h.setAttribute("href",`#${c}`),this.updateProperties(r,e),a(this,dn).set(s,r),{id:s,clipPathId:`url(#${u})`}}drawOutline(e,t){const n=gt(vt,Wp)._++,s=A(this,Hs,__).call(this),r=vt._svgFactory.createElement("defs");s.append(r);const o=vt._svgFactory.createElement("path");r.append(o);const l=`path_p${this.pageIndex}_${n}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke");let c;if(t){const d=vt._svgFactory.createElement("mask");r.append(d),c=`mask_p${this.pageIndex}_${n}`,d.setAttribute("id",c),d.setAttribute("maskUnits","objectBoundingBox");const f=vt._svgFactory.createElement("rect");d.append(f),f.setAttribute("width","1"),f.setAttribute("height","1"),f.setAttribute("fill","white");const p=vt._svgFactory.createElement("use");d.append(p),p.setAttribute("href",`#${l}`),p.setAttribute("stroke","none"),p.setAttribute("fill","black"),p.setAttribute("fill-rule","nonzero"),p.classList.add("mask")}const u=vt._svgFactory.createElement("use");s.append(u),u.setAttribute("href",`#${l}`),c&&u.setAttribute("mask",`url(#${c})`);const h=u.cloneNode();return s.append(h),u.classList.add("mainOutline"),h.classList.add("secondaryOutline"),this.updateProperties(s,e),a(this,dn).set(n,s),n}finalizeDraw(e,t){a(this,Vl).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var c;if(!t)return;const{root:n,bbox:s,rootClass:r,path:o}=t,l=typeof e=="number"?a(this,dn).get(e):e;if(l){if(n&&A(this,Hs,b_).call(this,l,n),s&&A(c=vt,Oy,TT).call(c,l,s),r){const{classList:u}=l;for(const[h,d]of Object.entries(r))u.toggle(h,d)}if(o){const h=l.firstChild.firstChild;A(this,Hs,b_).call(this,h,o)}}}updateParent(e,t){if(t===this)return;const n=a(this,dn).get(e);n&&(a(t,es).append(n),a(this,dn).delete(e),a(t,dn).set(e,n))}remove(e){a(this,Vl).delete(e),a(this,es)!==null&&(a(this,dn).get(e).remove(),a(this,dn).delete(e))}destroy(){g(this,es,null);for(const e of a(this,dn).values())e.remove();a(this,dn).clear(),a(this,Vl).clear()}};es=new WeakMap,dn=new WeakMap,Vl=new WeakMap,Wp=new WeakMap,Oy=new WeakSet,TT=function(e,[t,n,s,r]){const{style:o}=e;o.top=`${100*n}%`,o.left=`${100*t}%`,o.width=`${100*s}%`,o.height=`${100*r}%`},Hs=new WeakSet,__=function(){const e=vt._svgFactory.create(1,1,!0);return a(this,es).append(e),e.setAttribute("aria-hidden",!0),e},xT=function(e,t){const n=vt._svgFactory.createElement("clipPath");e.append(n);const s=`clip_${t}`;n.setAttribute("id",s),n.setAttribute("clipPathUnits","objectBoundingBox");const r=vt._svgFactory.createElement("use");return n.append(r),r.setAttribute("href",`#${t}`),r.classList.add("clip"),s},b_=function(e,t){for(const[n,s]of Object.entries(t))s===null?e.removeAttribute(n):e.setAttribute(n,s)},y(vt,Oy),y(vt,Wp,0);let w_=vt;globalThis._pdfjsTestingUtils={HighlightOutliner:Jw};globalThis.pdfjsLib={AbortException:aa,AnnotationEditorLayer:g_,AnnotationEditorParamsType:pe,AnnotationEditorType:ne,AnnotationEditorUIManager:ec,AnnotationLayer:Kw,AnnotationMode:to,AnnotationType:ht,applyOpacity:uL,build:yI,ColorPicker:ay,createValidAbsoluteUrl:vk,CSSConstants:cL,DOMSVGFactory:cy,DrawLayer:w_,FeatureTest:Gt,fetchData:Jp,findContrastColor:hL,getDocument:CC,getFilenameFromUrl:iL,getPdfFilenameFromUrl:sL,getRGB:eg,getUuid:bk,getXfaPageViewport:oL,GlobalWorkerOptions:ss,ImageKind:Yg,InvalidPDFException:Y0,isDataScheme:ev,isPdfFile:Pb,isValidExplicitDest:bL,MathClamp:pn,noContextMenu:Ni,normalizeUnicode:eL,OPS:Yd,OutputScale:zs,PasswordResponses:VR,PDFDataRangeTransport:TC,PDFDateString:ty,PDFWorker:Zd,PermissionFlag:WR,PixelsPerInch:la,RenderingCancelledException:xb,renderRichText:Ek,ResponseException:ey,setLayerDimensions:Zl,shadow:re,SignatureExtractor:Dr,stopEvent:ot,SupportedImageMimeTypes:J0,TextLayer:Jd,TouchManager:iy,updateUrlHash:wk,Util:G,VerbosityLevel:Qy,version:mI,XfaLayer:Sk};const PT="/assets/pdf.worker-zxMdjS_u.mjs";var UI={exports:{}};(function(i){var e=function(t){var n=Object.prototype,s=n.hasOwnProperty,r=Object.defineProperty||function(x,P,I){x[P]=I.value},o,l=typeof Symbol=="function"?Symbol:{},c=l.iterator||"@@iterator",u=l.asyncIterator||"@@asyncIterator",h=l.toStringTag||"@@toStringTag";function d(x,P,I){return Object.defineProperty(x,P,{value:I,enumerable:!0,configurable:!0,writable:!0}),x[P]}try{d({},"")}catch{d=function(P,I,N){return P[I]=N}}function f(x,P,I,N){var $=P&&P.prototype instanceof w?P:w,Q=Object.create($.prototype),we=new q(N||[]);return r(Q,"_invoke",{value:H(x,I,we)}),Q}t.wrap=f;function p(x,P,I){try{return{type:"normal",arg:x.call(P,I)}}catch(N){return{type:"throw",arg:N}}}var v="suspendedStart",b="suspendedYield",S="executing",m="completed",_={};function w(){}function E(){}function k(){}var C={};d(C,c,function(){return this});var T=Object.getPrototypeOf,R=T&&T(T(M([])));R&&R!==n&&s.call(R,c)&&(C=R);var D=k.prototype=w.prototype=Object.create(C);E.prototype=k,r(D,"constructor",{value:k,configurable:!0}),r(k,"constructor",{value:E,configurable:!0}),E.displayName=d(k,h,"GeneratorFunction");function O(x){["next","throw","return"].forEach(function(P){d(x,P,function(I){return this._invoke(P,I)})})}t.isGeneratorFunction=function(x){var P=typeof x=="function"&&x.constructor;return P?P===E||(P.displayName||P.name)==="GeneratorFunction":!1},t.mark=function(x){return Object.setPrototypeOf?Object.setPrototypeOf(x,k):(x.__proto__=k,d(x,h,"GeneratorFunction")),x.prototype=Object.create(D),x},t.awrap=function(x){return{__await:x}};function B(x,P){function I(Q,we,_e,ce){var kt=p(x[Q],x,we);if(kt.type==="throw")ce(kt.arg);else{var pa=kt.arg,Fi=pa.value;return Fi&&typeof Fi=="object"&&s.call(Fi,"__await")?P.resolve(Fi.__await).then(function(on){I("next",on,_e,ce)},function(on){I("throw",on,_e,ce)}):P.resolve(Fi).then(function(on){pa.value=on,_e(pa)},function(on){return I("throw",on,_e,ce)})}}var N;function $(Q,we){function _e(){return new P(function(ce,kt){I(Q,we,ce,kt)})}return N=N?N.then(_e,_e):_e()}r(this,"_invoke",{value:$})}O(B.prototype),d(B.prototype,u,function(){return this}),t.AsyncIterator=B,t.async=function(x,P,I,N,$){$===void 0&&($=Promise);var Q=new B(f(x,P,I,N),$);return t.isGeneratorFunction(P)?Q:Q.next().then(function(we){return we.done?we.value:Q.next()})};function H(x,P,I){var N=v;return function(Q,we){if(N===S)throw new Error("Generator is already running");if(N===m){if(Q==="throw")throw we;return L()}for(I.method=Q,I.arg=we;;){var _e=I.delegate;if(_e){var ce=Y(_e,I);if(ce){if(ce===_)continue;return ce}}if(I.method==="next")I.sent=I._sent=I.arg;else if(I.method==="throw"){if(N===v)throw N=m,I.arg;I.dispatchException(I.arg)}else I.method==="return"&&I.abrupt("return",I.arg);N=S;var kt=p(x,P,I);if(kt.type==="normal"){if(N=I.done?m:b,kt.arg===_)continue;return{value:kt.arg,done:I.done}}else kt.type==="throw"&&(N=m,I.method="throw",I.arg=kt.arg)}}}function Y(x,P){var I=P.method,N=x.iterator[I];if(N===o)return P.delegate=null,I==="throw"&&x.iterator.return&&(P.method="return",P.arg=o,Y(x,P),P.method==="throw")||I!=="return"&&(P.method="throw",P.arg=new TypeError("The iterator does not provide a '"+I+"' method")),_;var $=p(N,x.iterator,P.arg);if($.type==="throw")return P.method="throw",P.arg=$.arg,P.delegate=null,_;var Q=$.arg;if(!Q)return P.method="throw",P.arg=new TypeError("iterator result is not an object"),P.delegate=null,_;if(Q.done)P[x.resultName]=Q.value,P.next=x.nextLoc,P.method!=="return"&&(P.method="next",P.arg=o);else return Q;return P.delegate=null,_}O(D),d(D,h,"Generator"),d(D,c,function(){return this}),d(D,"toString",function(){return"[object Generator]"});function X(x){var P={tryLoc:x[0]};1 in x&&(P.catchLoc=x[1]),2 in x&&(P.finallyLoc=x[2],P.afterLoc=x[3]),this.tryEntries.push(P)}function ee(x){var P=x.completion||{};P.type="normal",delete P.arg,x.completion=P}function q(x){this.tryEntries=[{tryLoc:"root"}],x.forEach(X,this),this.reset(!0)}t.keys=function(x){var P=Object(x),I=[];for(var N in P)I.push(N);return I.reverse(),function $(){for(;I.length;){var Q=I.pop();if(Q in P)return $.value=Q,$.done=!1,$}return $.done=!0,$}};function M(x){if(x){var P=x[c];if(P)return P.call(x);if(typeof x.next=="function")return x;if(!isNaN(x.length)){var I=-1,N=function $(){for(;++I<x.length;)if(s.call(x,I))return $.value=x[I],$.done=!1,$;return $.value=o,$.done=!0,$};return N.next=N}}return{next:L}}t.values=M;function L(){return{value:o,done:!0}}return q.prototype={constructor:q,reset:function(x){if(this.prev=0,this.next=0,this.sent=this._sent=o,this.done=!1,this.delegate=null,this.method="next",this.arg=o,this.tryEntries.forEach(ee),!x)for(var P in this)P.charAt(0)==="t"&&s.call(this,P)&&!isNaN(+P.slice(1))&&(this[P]=o)},stop:function(){this.done=!0;var x=this.tryEntries[0],P=x.completion;if(P.type==="throw")throw P.arg;return this.rval},dispatchException:function(x){if(this.done)throw x;var P=this;function I(ce,kt){return Q.type="throw",Q.arg=x,P.next=ce,kt&&(P.method="next",P.arg=o),!!kt}for(var N=this.tryEntries.length-1;N>=0;--N){var $=this.tryEntries[N],Q=$.completion;if($.tryLoc==="root")return I("end");if($.tryLoc<=this.prev){var we=s.call($,"catchLoc"),_e=s.call($,"finallyLoc");if(we&&_e){if(this.prev<$.catchLoc)return I($.catchLoc,!0);if(this.prev<$.finallyLoc)return I($.finallyLoc)}else if(we){if(this.prev<$.catchLoc)return I($.catchLoc,!0)}else if(_e){if(this.prev<$.finallyLoc)return I($.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(x,P){for(var I=this.tryEntries.length-1;I>=0;--I){var N=this.tryEntries[I];if(N.tryLoc<=this.prev&&s.call(N,"finallyLoc")&&this.prev<N.finallyLoc){var $=N;break}}$&&(x==="break"||x==="continue")&&$.tryLoc<=P&&P<=$.finallyLoc&&($=null);var Q=$?$.completion:{};return Q.type=x,Q.arg=P,$?(this.method="next",this.next=$.finallyLoc,_):this.complete(Q)},complete:function(x,P){if(x.type==="throw")throw x.arg;return x.type==="break"||x.type==="continue"?this.next=x.arg:x.type==="return"?(this.rval=this.arg=x.arg,this.method="return",this.next="end"):x.type==="normal"&&P&&(this.next=P),_},finish:function(x){for(var P=this.tryEntries.length-1;P>=0;--P){var I=this.tryEntries[P];if(I.finallyLoc===x)return this.complete(I.completion,I.afterLoc),ee(I),_}},catch:function(x){for(var P=this.tryEntries.length-1;P>=0;--P){var I=this.tryEntries[P];if(I.tryLoc===x){var N=I.completion;if(N.type==="throw"){var $=N.arg;ee(I)}return $}}throw new Error("illegal catch attempt")},delegateYield:function(x,P,I){return this.delegate={iterator:M(x),resultName:P,nextLoc:I},this.method==="next"&&(this.arg=o),_}},t}(i.exports);try{regeneratorRuntime=e}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})(UI);var Fb=(i,e)=>`${i}-${e}-${Math.random().toString(16).slice(3,8)}`;const zI=Fb;let OS=0;var RT=({id:i,action:e,payload:t={}})=>{let n=i;return typeof n>"u"&&(n=zI("Job",OS),OS+=1),{id:n,action:e,payload:t}},Lh={};let Bb=!1;Lh.logging=Bb;Lh.setLogging=i=>{Bb=i};Lh.log=(...i)=>Bb?console.log.apply(void 0,i):null;const HI=RT,{log:Dg}=Lh,WI=Fb;let MS=0;var VI=()=>{const i=WI("Scheduler",MS),e={},t={};let n=[];MS+=1;const s=()=>n.length,r=()=>Object.keys(e).length,o=()=>{if(n.length!==0){const d=Object.keys(e);for(let f=0;f<d.length;f+=1)if(typeof t[d[f]]>"u"){n[0](e[d[f]]);break}}},l=(d,f)=>new Promise((p,v)=>{const b=HI({action:d,payload:f});n.push(async S=>{n.shift(),t[S.id]=b;try{p(await S[d].apply(void 0,[...f,b.id]))}catch(m){v(m)}finally{delete t[S.id],o()}}),Dg(`[${i}]: Add ${b.id} to JobQueue`),Dg(`[${i}]: JobQueue length=${n.length}`),o()});return{addWorker:d=>(e[d.id]=d,Dg(`[${i}]: Add ${d.id}`),Dg(`[${i}]: Number of workers=${r()}`),o(),d.id),addJob:async(d,...f)=>{if(r()===0)throw Error(`[${i}]: You need to have at least one worker before adding jobs`);return l(d,f)},terminate:async()=>{Object.keys(e).forEach(async d=>{await e[d].terminate()}),n=[]},getQueueLen:s,getNumWorkers:r}};function GI(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var qI=i=>{const e={};return typeof WorkerGlobalScope<"u"?e.type="webworker":typeof document=="object"?e.type="browser":typeof process=="object"&&typeof GI=="function"&&(e.type="node"),typeof i>"u"?e:e[i]};const KI=qI("type")==="browser",XI=KI?i=>new URL(i,window.location.href).href:i=>i;var YI=i=>{const e={...i};return["corePath","workerPath","langPath"].forEach(t=>{i[t]&&(e[t]=XI(e[t]))}),e},LT={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3};const QI="tesseract.js",JI="6.0.1",ZI="Pure Javascript Multilingual OCR",eD="src/index.js",tD="commonjs",nD="src/index.d.ts",iD="dist/tesseract.min.js",sD="dist/tesseract.min.js",rD={start:"node scripts/server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js && rollup -c scripts/rollup.esm.mjs","profile:tesseract":"webpack-bundle-analyzer dist/tesseract-stats.json","profile:worker":"webpack-bundle-analyzer dist/worker-stats.json",prepublishOnly:"npm run build",wait:"rimraf dist && wait-on http://localhost:3000/dist/tesseract.min.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser test:node:all","test:browser":"karma start karma.conf.js","test:node":"nyc mocha --exit --bail --require ./scripts/test-helper.mjs","test:node:all":"npm run test:node -- ./tests/*.test.mjs",lint:"eslint src","lint:fix":"eslint --fix src",postinstall:"opencollective-postinstall || true"},oD={"./src/worker/node/index.js":"./src/worker/browser/index.js"},aD="",lD=["jeromewu"],cD="Apache-2.0",uD={"@babel/core":"^7.21.4","@babel/eslint-parser":"^7.21.3","@babel/preset-env":"^7.21.4","@rollup/plugin-commonjs":"^24.1.0",acorn:"^8.8.2","babel-loader":"^9.1.2",buffer:"^6.0.3",cors:"^2.8.5",eslint:"^7.32.0","eslint-config-airbnb-base":"^14.2.1","eslint-plugin-import":"^2.27.5","expect.js":"^0.3.1",express:"^4.18.2",mocha:"^10.2.0","npm-run-all":"^4.1.5",karma:"^6.4.2","karma-chrome-launcher":"^3.2.0","karma-firefox-launcher":"^2.1.2","karma-mocha":"^2.0.1","karma-webpack":"^5.0.0",nyc:"^15.1.0",rimraf:"^5.0.0",rollup:"^3.20.7","wait-on":"^7.0.1",webpack:"^5.79.0","webpack-bundle-analyzer":"^4.8.0","webpack-cli":"^5.0.1","webpack-dev-middleware":"^6.0.2","rollup-plugin-sourcemaps":"^0.6.3"},hD={"bmp-js":"^0.1.0","idb-keyval":"^6.2.0","is-url":"^1.2.4","node-fetch":"^2.6.9","opencollective-postinstall":"^2.0.3","regenerator-runtime":"^0.13.3","tesseract.js-core":"^6.0.0","wasm-feature-detect":"^1.2.11",zlibjs:"^0.3.1"},dD={"@rollup/pluginutils":"^5.0.2"},fD={type:"git",url:"https://github.com/naptha/tesseract.js.git"},pD={url:"https://github.com/naptha/tesseract.js/issues"},gD="https://github.com/naptha/tesseract.js",mD={type:"opencollective",url:"https://opencollective.com/tesseractjs"},yD={name:QI,version:JI,description:ZI,main:eD,type:tD,types:nD,unpkg:iD,jsdelivr:sD,scripts:rD,browser:oD,author:aD,contributors:lD,license:cD,devDependencies:uD,dependencies:hD,overrides:dD,repository:fD,bugs:pD,homepage:gD,collective:mD};var vD={workerBlobURL:!0,logger:()=>{}};const wD=yD.version,_D=vD;var bD={..._D,workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${wD}/dist/worker.min.js`},AD=({workerPath:i,workerBlobURL:e})=>{let t;if(Blob&&URL&&e){const n=new Blob([`importScripts("${i}");`],{type:"application/javascript"});t=new Worker(URL.createObjectURL(n))}else t=new Worker(i);return t},SD=i=>{i.terminate()},ED=(i,e)=>{i.onmessage=({data:t})=>{e(t)}},kD=async(i,e)=>{i.postMessage(e)};const Vv=i=>new Promise((e,t)=>{const n=new FileReader;n.onload=()=>{e(n.result)},n.onerror=({target:{error:{code:s}}})=>{t(Error(`File could not be read! Code=${s}`))},n.readAsArrayBuffer(i)}),A_=async i=>{let e=i;if(typeof i>"u")return"undefined";if(typeof i=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(i)?e=atob(i.split(",")[1]).split("").map(t=>t.charCodeAt(0)):e=await(await fetch(i)).arrayBuffer();else if(typeof HTMLElement<"u"&&i instanceof HTMLElement)i.tagName==="IMG"&&(e=await A_(i.src)),i.tagName==="VIDEO"&&(e=await A_(i.poster)),i.tagName==="CANVAS"&&await new Promise(t=>{i.toBlob(async n=>{e=await Vv(n),t()})});else if(typeof OffscreenCanvas<"u"&&i instanceof OffscreenCanvas){const t=await i.convertToBlob();e=await Vv(t)}else(i instanceof File||i instanceof Blob)&&(e=await Vv(i));return new Uint8Array(e)};var CD=A_;const TD=bD,xD=AD,PD=SD,RD=ED,LD=kD,ID=CD;var DD={defaultOptions:TD,spawnWorker:xD,terminateWorker:PD,onMessage:RD,send:LD,loadImage:ID};const OD=YI,fs=RT,{log:NS}=Lh,MD=Fb,ga=LT,{defaultOptions:ND,spawnWorker:FD,terminateWorker:BD,onMessage:jD,loadImage:FS,send:$D}=DD;let BS=0;var IT=async(i="eng",e=ga.LSTM_ONLY,t={},n={})=>{const s=MD("Worker",BS),{logger:r,errorHandler:o,...l}=OD({...ND,...t}),c={},u=typeof i=="string"?i.split("+"):i;let h=e,d=n;const f=[ga.DEFAULT,ga.LSTM_ONLY].includes(e)&&!l.legacyCore;let p,v;const b=new Promise((M,L)=>{v=M,p=L}),S=M=>{p(M.message)};let m=FD(l);m.onerror=S,BS+=1;const _=({id:M,action:L,payload:x})=>new Promise((P,I)=>{NS(`[${s}]: Start ${M}, action=${L}`);const N=`${L}-${M}`;c[N]={resolve:P,reject:I},$D(m,{workerId:s,jobId:M,action:L,payload:x})}),w=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),E=M=>_(fs({id:M,action:"load",payload:{options:{lstmOnly:f,corePath:l.corePath,logging:l.logging}}})),k=(M,L,x)=>_(fs({id:x,action:"FS",payload:{method:"writeFile",args:[M,L]}})),C=(M,L)=>_(fs({id:L,action:"FS",payload:{method:"readFile",args:[M,{encoding:"utf8"}]}})),T=(M,L)=>_(fs({id:L,action:"FS",payload:{method:"unlink",args:[M]}})),R=(M,L,x)=>_(fs({id:x,action:"FS",payload:{method:M,args:L}})),D=(M,L)=>_(fs({id:L,action:"loadLanguage",payload:{langs:M,options:{langPath:l.langPath,dataPath:l.dataPath,cachePath:l.cachePath,cacheMethod:l.cacheMethod,gzip:l.gzip,lstmOnly:[ga.DEFAULT,ga.LSTM_ONLY].includes(h)&&!l.legacyLang}}})),O=(M,L,x,P)=>_(fs({id:P,action:"initialize",payload:{langs:M,oem:L,config:x}})),B=(M="eng",L,x,P)=>{if(f&&[ga.TESSERACT_ONLY,ga.TESSERACT_LSTM_COMBINED].includes(L))throw Error("Legacy model requested but code missing.");const I=L||h;h=I;const N=x||d;d=N;const Q=(typeof M=="string"?M.split("+"):M).filter(we=>!u.includes(we));return u.push(...Q),Q.length>0?D(Q,P).then(()=>O(M,I,N,P)):O(M,I,N,P)},H=(M={},L)=>_(fs({id:L,action:"setParameters",payload:{params:M}})),Y=async(M,L={},x={text:!0},P)=>_(fs({id:P,action:"recognize",payload:{image:await FS(M),options:L,output:x}})),X=async(M,L)=>{if(f)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return _(fs({id:L,action:"detect",payload:{image:await FS(M)}}))},ee=async()=>(m!==null&&(BD(m),m=null),Promise.resolve());jD(m,({workerId:M,jobId:L,status:x,action:P,data:I})=>{const N=`${P}-${L}`;if(x==="resolve")NS(`[${M}]: Complete ${L}`),c[N].resolve({jobId:L,data:I}),delete c[N];else if(x==="reject")if(c[N].reject(I),delete c[N],P==="load"&&p(I),o)o(I);else throw Error(I);else x==="progress"&&r({...I,userJobId:L})});const q={id:s,worker:m,load:w,writeText:k,readText:C,removeFile:T,FS:R,reinitialize:B,setParameters:H,recognize:Y,detect:X,terminate:ee};return E().then(()=>D(i)).then(()=>O(i,e,n)).then(()=>v(q)).catch(()=>{}),b};const DT=IT,UD=async(i,e,t)=>{const n=await DT(e,1,t);return n.recognize(i).finally(async()=>{await n.terminate()})},zD=async(i,e)=>{const t=await DT("osd",0,e);return t.detect(i).finally(async()=>{await t.terminate()})};var HD={recognize:UD,detect:zD},WD={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"},VD={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"};const GD=VI,qD=IT,KD=HD,XD=WD,YD=LT,QD=VD,{setLogging:JD}=Lh;var ZD={languages:XD,OEM:YD,PSM:QD,createScheduler:GD,createWorker:qD,setLogging:JD,...KD};async function e2(i){try{const e=await n2(i),t=jS(e,"proveedor"),n=l2(e),s=u2(e),r=s?HR(s):null,o=h2(e),l=d2(e),c=f2(e),u=jS(e,"receptor"),h=c2(e),d=p2(e),f=g2(e),p=m2({supplierCuit:t,invoiceType:r,pointOfSale:o,invoiceNumber:l,issueDate:c,totalAmount:d.totalAmount});return{supplierCuit:t,supplierName:n,invoiceType:r,pointOfSale:o,invoiceNumber:l,issueDate:c,receiverCuit:u,receiverName:h,...d,taxes:f,confidence:p,rawText:e}}catch(e){throw console.error("Error extracting data from PDF:",e),e}}ss.workerSrc=PT;let Gv=null,qv=null;async function t2(){return Gv||(qv||(qv=(async()=>{const i=await ZD.createWorker({logger:()=>{}});return await i.load(),await i.loadLanguage("spa"),await i.initialize("spa"),Gv=i,i})()),qv)}async function n2(i){if(typeof window>"u")throw new Error("El OCR solo est disponible en el entorno del navegador");return i.type==="application/pdf"?i2(i):OT(i)}async function i2(i){const e=await i.arrayBuffer(),t=await CC({data:new Uint8Array(e)}).promise;let n="";for(let s=1;s<=t.numPages;s++){const r=await t.getPage(s),o=await s2(r);if(o.trim()){n+=`${o}
`;continue}const l=await r2(r);n+=`${l}
`}return n}async function s2(i){return(await i.getTextContent()).items.map(n=>typeof n.str=="string"?n.str:"").filter(Boolean).join(" ")}async function r2(i){const e=i.getViewport({scale:2}),t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("No se pudo inicializar el canvas para OCR");t.width=e.width,t.height=e.height,await i.render({canvasContext:n,viewport:e}).promise;const s=await o2(t);return OT(s)}async function o2(i){return new Promise((e,t)=>{i.toBlob(n=>{n?e(n):t(new Error("No se pudo generar un blob desde el canvas"))},"image/png")})}async function OT(i){const e=await t2(),t=await a2(i),{data:n}=await e.recognize(t);return n.text}async function a2(i){return new Promise((e,t)=>{const n=new FileReader;n.onload=()=>e(n.result),n.onerror=()=>t(new Error("No se pudo leer el blob")),n.readAsDataURL(i)})}function jS(i,e){var n;const t=[/CUIT[:\s]*(\d{2}[-\s]?\d{8}[-\s]?\d{1})/gi,/(\d{2}[-\s]?\d{8}[-\s]?\d{1})/g];for(const s of t){const r=i.match(s);if(r&&r.length>0){const o=((n=r[e==="proveedor"?0:1])==null?void 0:n.replace(/[^0-9]/g,""))||null;if(o&&yk(o))return o}}return null}function l2(i){const e=[/Razn Social[:\s]+([A-Za-z0-9\s,.]+)/i,/Denominacin[:\s]+([A-Za-z0-9\s,.]+)/i];for(const t of e){const n=i.match(t);if(n&&n[1])return n[1].trim()}return null}function c2(i){const e=[/Denominacin del comprador[:\s]+([A-Za-z0-9\s,.]+)/i,/Comprador[:\s]+([A-Za-z0-9\s,.]+)/i];for(const t of e){const n=i.match(t);if(n&&n[1])return n[1].trim()}return null}function u2(i){const e=[/Tipo de Comprobante[:\s]+(\d{3})/i,/Comprobante[:\s]+(\d{3})/i,/Factura\s+([ABC])/i];for(const t of e){const n=i.match(t);if(n&&n[1])return n[1].padStart(3,"0")}return null}function h2(i){const e=[/Punto de Venta[:\s]+(\d{4,5})/i,/P\.?\s*V\.?[:\s]+(\d{4,5})/i];for(const t of e){const n=i.match(t);if(n&&n[1])return n[1].padStart(5,"0")}return null}function d2(i){const e=[/Nmero[:\s]+(\d{8})/i,/Nro[:\s]+(\d{8})/i,/(\d{4,5})[-\s](\d{8})/];for(const t of e){const n=i.match(t);if(n){const s=n[2]||n[1];if(s)return s.padStart(8,"0")}}return null}function f2(i){const e=[/Fecha de Emisin[:\s]+(\d{2})[\/\-](\d{2})[\/\-](\d{4})/i,/Fecha[:\s]+(\d{2})[\/\-](\d{2})[\/\-](\d{4})/i,/(\d{2})[\/\-](\d{2})[\/\-](\d{4})/];for(const t of e){const n=i.match(t);if(n&&n[1]&&n[2]&&n[3]){const s=n[1],r=n[2];return`${n[3]}-${r}-${s}`}}return null}function p2(i){const e=i.match(/Neto Gravado[:\s]+\$?\s*([\d.,]+)/i),t=i.match(/No Gravado[:\s]+\$?\s*([\d.,]+)/i),n=i.match(/Exento[:\s]+\$?\s*([\d.,]+)/i),s=i.match(/IVA[:\s]+\$?\s*([\d.,]+)/i),r=i.match(/Total[:\s]+\$?\s*([\d.,]+)/i),o=l=>!l||!l[1]?0:parseFloat(l[1].replace(/\./g,"").replace(",","."));return{netTaxed:o(e),netUntaxed:o(t),netExempt:o(n),ivaAmount:o(s),otherTaxesAmount:0,totalAmount:o(r)}}function g2(i){const e=[],t=[/IVA\s+(21|10\.5|27|5|2\.5)%[:\s]+Base[:\s]+\$?\s*([\d.,]+)[:\s]+Imp[:\s]+\$?\s*([\d.,]+)/gi];for(const n of t){let s;for(;(s=n.exec(i))!==null;){const r=parseFloat(s[1]),o=parseFloat(s[2].replace(/\./g,"").replace(",",".")),l=parseFloat(s[3].replace(/\./g,"").replace(",","."));e.push({taxType:`IVA_${s[1].replace(".","_")}`,taxBase:o,taxAmount:l,rate:r})}}return e}function m2(i){let e=0;const t={supplierCuit:.25,invoiceType:.15,pointOfSale:.1,invoiceNumber:.15,issueDate:.15,totalAmount:.2};return i.supplierCuit&&yk(i.supplierCuit)&&(e+=t.supplierCuit),i.invoiceType&&(e+=t.invoiceType),i.pointOfSale&&(e+=t.pointOfSale),i.invoiceNumber&&(e+=t.invoiceNumber),i.issueDate&&(e+=t.issueDate),i.totalAmount>0&&(e+=t.totalAmount),Math.round(e*100)/100}async function y2(i){throw new Error("Falta configurar la variable VITE_OPENAI_API_KEY en el archivo .env")}ss.workerSrc=PT;const v2="modulepreload",w2=function(i){return"/"+i},$S={},sg=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));s=Promise.allSettled(t.map(c=>{if(c=w2(c),c in $S)return;$S[c]=!0;const u=c.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":v2,u||(d.as="script"),d.crossOrigin="",d.href=c,l&&d.setAttribute("nonce",l),document.head.appendChild(d),u)return new Promise((f,p)=>{d.addEventListener("load",f),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return s.then(o=>{for(const l of o||[])l.status==="rejected"&&r(l.reason);return e().catch(r)})},_2=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>sg(async()=>{const{default:n}=await Promise.resolve().then(()=>Ih);return{default:n}},[]).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)};class jb extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class b2 extends jb{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class US extends jb{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class zS extends jb{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var S_;(function(i){i.Any="any",i.ApNortheast1="ap-northeast-1",i.ApNortheast2="ap-northeast-2",i.ApSouth1="ap-south-1",i.ApSoutheast1="ap-southeast-1",i.ApSoutheast2="ap-southeast-2",i.CaCentral1="ca-central-1",i.EuCentral1="eu-central-1",i.EuWest1="eu-west-1",i.EuWest2="eu-west-2",i.EuWest3="eu-west-3",i.SaEast1="sa-east-1",i.UsEast1="us-east-1",i.UsWest1="us-west-1",i.UsWest2="us-west-2"})(S_||(S_={}));var A2=function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function l(h){try{u(n.next(h))}catch(d){o(d)}}function c(h){try{u(n.throw(h))}catch(d){o(d)}}function u(h){h.done?r(h.value):s(h.value).then(l,c)}u((n=n.apply(i,e||[])).next())})};class S2{constructor(e,{headers:t={},customFetch:n,region:s=S_.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=_2(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var n;return A2(this,void 0,void 0,function*(){try{const{headers:s,method:r,body:o}=t;let l={},{region:c}=t;c||(c=this.region);const u=new URL(`${this.url}/${e}`);c&&c!=="any"&&(l["x-region"]=c,u.searchParams.set("forceFunctionRegion",c));let h;o&&(s&&!Object.prototype.hasOwnProperty.call(s,"Content-Type")||!s)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",h=o):typeof o=="string"?(l["Content-Type"]="text/plain",h=o):typeof FormData<"u"&&o instanceof FormData?h=o:(l["Content-Type"]="application/json",h=JSON.stringify(o)));const d=yield this.fetch(u.toString(),{method:r||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),s),body:h}).catch(b=>{throw new b2(b)}),f=d.headers.get("x-relay-error");if(f&&f==="true")throw new US(d);if(!d.ok)throw new zS(d);let p=((n=d.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),v;return p==="application/json"?v=yield d.json():p==="application/octet-stream"?v=yield d.blob():p==="text/event-stream"?v=d:p==="multipart/form-data"?v=yield d.formData():v=yield d.text(),{data:v,error:null,response:d}}catch(s){return{data:null,error:s,response:s instanceof zS||s instanceof US?s.context:void 0}}})}}var Dn={},$b={},iv={},rg={},sv={},rv={},E2=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Th=E2();const k2=Th.fetch,MT=Th.fetch.bind(Th),NT=Th.Headers,C2=Th.Request,T2=Th.Response,Ih=Object.freeze(Object.defineProperty({__proto__:null,Headers:NT,Request:C2,Response:T2,default:MT,fetch:k2},Symbol.toStringTag,{value:"Module"})),x2=ax(Ih);var ov={};Object.defineProperty(ov,"__esModule",{value:!0});let P2=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};ov.default=P2;var FT=Di&&Di.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(rv,"__esModule",{value:!0});const R2=FT(x2),L2=FT(ov);let I2=class{constructor(e){var t,n;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(n=e.isMaybeSingle)!==null&&n!==void 0?n:!1,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=R2.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let s=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async r=>{var o,l,c,u;let h=null,d=null,f=null,p=r.status,v=r.statusText;if(r.ok){if(this.method!=="HEAD"){const _=await r.text();_===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((o=this.headers.get("Accept"))===null||o===void 0)&&o.includes("application/vnd.pgrst.plan+text"))?d=_:d=JSON.parse(_))}const S=(l=this.headers.get("Prefer"))===null||l===void 0?void 0:l.match(/count=(exact|planned|estimated)/),m=(c=r.headers.get("content-range"))===null||c===void 0?void 0:c.split("/");S&&m&&m.length>1&&(f=parseInt(m[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(d)&&(d.length>1?(h={code:"PGRST116",details:`Results contain ${d.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},d=null,f=null,p=406,v="Not Acceptable"):d.length===1?d=d[0]:d=null)}else{const S=await r.text();try{h=JSON.parse(S),Array.isArray(h)&&r.status===404&&(d=[],h=null,p=200,v="OK")}catch{r.status===404&&S===""?(p=204,v="No Content"):h={message:S}}if(h&&this.isMaybeSingle&&(!((u=h==null?void 0:h.details)===null||u===void 0)&&u.includes("0 rows"))&&(h=null,p=200,v="OK"),h&&this.shouldThrowOnError)throw new L2.default(h)}return{error:h,data:d,count:f,status:p,statusText:v}});return this.shouldThrowOnError||(s=s.catch(r=>{var o,l,c;return{error:{message:`${(o=r==null?void 0:r.name)!==null&&o!==void 0?o:"FetchError"}: ${r==null?void 0:r.message}`,details:`${(l=r==null?void 0:r.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(c=r==null?void 0:r.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),s.then(e,t)}returns(){return this}overrideTypes(){return this}};rv.default=I2;var D2=Di&&Di.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(sv,"__esModule",{value:!0});const O2=D2(rv);let M2=class extends O2.default{select(e){let t=!1;const n=(e??"*").split("").map(s=>/\s/.test(s)&&!t?"":(s==='"'&&(t=!t),s)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:n,foreignTable:s,referencedTable:r=s}={}){const o=r?`${r}.order`:"order",l=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${l?`${l},`:""}${e}.${t?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:n=t}={}){const s=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(s,`${e}`),this}range(e,t,{foreignTable:n,referencedTable:s=n}={}){const r=typeof s>"u"?"offset":`${s}.offset`,o=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(r,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:n=!1,buffers:s=!1,wal:r=!1,format:o="text"}={}){var l;const c=[e?"analyze":null,t?"verbose":null,n?"settings":null,s?"buffers":null,r?"wal":null].filter(Boolean).join("|"),u=(l=this.headers.get("Accept"))!==null&&l!==void 0?l:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${o}; for="${u}"; options=${c};`),o==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};sv.default=M2;var N2=Di&&Di.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(rg,"__esModule",{value:!0});const F2=N2(sv);let B2=class extends F2.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const n=Array.from(new Set(t)).map(s=>typeof s=="string"&&new RegExp("[,()]").test(s)?`"${s}"`:`${s}`).join(",");return this.url.searchParams.append(e,`in.(${n})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:n,type:s}={}){let r="";s==="plain"?r="pl":s==="phrase"?r="ph":s==="websearch"&&(r="w");const o=n===void 0?"":`(${n})`;return this.url.searchParams.append(e,`${r}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,n])=>{this.url.searchParams.append(t,`eq.${n}`)}),this}not(e,t,n){return this.url.searchParams.append(e,`not.${t}.${n}`),this}or(e,{foreignTable:t,referencedTable:n=t}={}){const s=n?`${n}.or`:"or";return this.url.searchParams.append(s,`(${e})`),this}filter(e,t,n){return this.url.searchParams.append(e,`${t}.${n}`),this}};rg.default=B2;var j2=Di&&Di.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(iv,"__esModule",{value:!0});const qh=j2(rg);let $2=class{constructor(e,{headers:t={},schema:n,fetch:s}){this.url=e,this.headers=new Headers(t),this.schema=n,this.fetch=s}select(e,{head:t=!1,count:n}={}){const s=t?"HEAD":"GET";let r=!1;const o=(e??"*").split("").map(l=>/\s/.test(l)&&!r?"":(l==='"'&&(r=!r),l)).join("");return this.url.searchParams.set("select",o),n&&this.headers.append("Prefer",`count=${n}`),new qh.default({method:s,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:n=!0}={}){var s;const r="POST";if(t&&this.headers.append("Prefer",`count=${t}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const o=e.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(o.length>0){const l=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",l.join(","))}}return new qh.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(s=this.fetch)!==null&&s!==void 0?s:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:n=!1,count:s,defaultToNull:r=!0}={}){var o;const l="POST";if(this.headers.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),s&&this.headers.append("Prefer",`count=${s}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const c=e.reduce((u,h)=>u.concat(Object.keys(h)),[]);if(c.length>0){const u=[...new Set(c)].map(h=>`"${h}"`);this.url.searchParams.set("columns",u.join(","))}}return new qh.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}update(e,{count:t}={}){var n;const s="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new qh.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}delete({count:e}={}){var t;const n="DELETE";return e&&this.headers.append("Prefer",`count=${e}`),new qh.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}};iv.default=$2;var BT=Di&&Di.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty($b,"__esModule",{value:!0});const U2=BT(iv),z2=BT(rg);let H2=class jT{constructor(e,{headers:t={},schema:n,fetch:s}={}){this.url=e,this.headers=new Headers(t),this.schemaName=n,this.fetch=s}from(e){const t=new URL(`${this.url}/${e}`);return new U2.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new jT(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:n=!1,get:s=!1,count:r}={}){var o;let l;const c=new URL(`${this.url}/rpc/${e}`);let u;n||s?(l=n?"HEAD":"GET",Object.entries(t).filter(([d,f])=>f!==void 0).map(([d,f])=>[d,Array.isArray(f)?`{${f.join(",")}}`:`${f}`]).forEach(([d,f])=>{c.searchParams.append(d,f)})):(l="POST",u=t);const h=new Headers(this.headers);return r&&h.set("Prefer",`count=${r}`),new z2.default({method:l,url:c,headers:h,schema:this.schemaName,body:u,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};$b.default=H2;var Dh=Di&&Di.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(Dn,"__esModule",{value:!0});Dn.PostgrestError=Dn.PostgrestBuilder=Dn.PostgrestTransformBuilder=Dn.PostgrestFilterBuilder=Dn.PostgrestQueryBuilder=Dn.PostgrestClient=void 0;const $T=Dh($b);Dn.PostgrestClient=$T.default;const UT=Dh(iv);Dn.PostgrestQueryBuilder=UT.default;const zT=Dh(rg);Dn.PostgrestFilterBuilder=zT.default;const HT=Dh(sv);Dn.PostgrestTransformBuilder=HT.default;const WT=Dh(rv);Dn.PostgrestBuilder=WT.default;const VT=Dh(ov);Dn.PostgrestError=VT.default;var W2=Dn.default={PostgrestClient:$T.default,PostgrestQueryBuilder:UT.default,PostgrestFilterBuilder:zT.default,PostgrestTransformBuilder:HT.default,PostgrestBuilder:WT.default,PostgrestError:VT.default};const{PostgrestClient:V2,PostgrestQueryBuilder:XM,PostgrestFilterBuilder:YM,PostgrestTransformBuilder:QM,PostgrestBuilder:JM,PostgrestError:ZM}=W2;class G2{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const n=t.node,s=parseInt(n.replace(/^v/,"").split(".")[0]);return s>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${s} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${s} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const n=this.getWebSocketConstructor();return new n(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const q2="2.15.5",K2=`realtime-js/${q2}`,X2="1.0.0",E_=1e4,Y2=1e3,Q2=100;var Pd;(function(i){i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed"})(Pd||(Pd={}));var mt;(function(i){i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving"})(mt||(mt={}));var ns;(function(i){i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token"})(ns||(ns={}));var k_;(function(i){i.websocket="websocket"})(k_||(k_={}));var Ea;(function(i){i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed"})(Ea||(Ea={}));class J2{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){const s=t.getUint8(1),r=t.getUint8(2);let o=this.HEADER_LENGTH+2;const l=n.decode(e.slice(o,o+s));o=o+s;const c=n.decode(e.slice(o,o+r));o=o+r;const u=JSON.parse(n.decode(e.slice(o,e.byteLength)));return{ref:null,topic:l,event:c,payload:u}}}class GT{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Ne;(function(i){i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange"})(Ne||(Ne={}));const HS=(i,e,t={})=>{var n;const s=(n=t.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((r,o)=>(r[o]=Z2(o,i,e,s),r),{})},Z2=(i,e,t,n)=>{const s=e.find(l=>l.name===i),r=s==null?void 0:s.type,o=t[i];return r&&!n.includes(r)?qT(r,o):C_(o)},qT=(i,e)=>{if(i.charAt(0)==="_"){const t=i.slice(1,i.length);return iO(e,t)}switch(i){case Ne.bool:return eO(e);case Ne.float4:case Ne.float8:case Ne.int2:case Ne.int4:case Ne.int8:case Ne.numeric:case Ne.oid:return tO(e);case Ne.json:case Ne.jsonb:return nO(e);case Ne.timestamp:return sO(e);case Ne.abstime:case Ne.date:case Ne.daterange:case Ne.int4range:case Ne.int8range:case Ne.money:case Ne.reltime:case Ne.text:case Ne.time:case Ne.timestamptz:case Ne.timetz:case Ne.tsrange:case Ne.tstzrange:return C_(e);default:return C_(e)}},C_=i=>i,eO=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},tO=i=>{if(typeof i=="string"){const e=parseFloat(i);if(!Number.isNaN(e))return e}return i},nO=i=>{if(typeof i=="string")try{return JSON.parse(i)}catch(e){return console.log(`JSON parse error: ${e}`),i}return i},iO=(i,e)=>{if(typeof i!="string")return i;const t=i.length-1,n=i[t];if(i[0]==="{"&&n==="}"){let r;const o=i.slice(1,t);try{r=JSON.parse("["+o+"]")}catch{r=o?o.split(","):[]}return r.map(l=>qT(e,l))}return i},sO=i=>typeof i=="string"?i.replace(" ","T"):i,KT=i=>{let e=i;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class Kv{constructor(e,t,n={},s=E_){this.channel=e,this.event=t,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var WS;(function(i){i.SYNC="sync",i.JOIN="join",i.LEAVE="leave"})(WS||(WS={}));class Rd{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:r,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Rd.syncState(this.state,s,r,o),this.pendingDiffs.forEach(c=>{this.state=Rd.syncDiff(this.state,c,r,o)}),this.pendingDiffs=[],l()}),this.channel._on(n.diff,{},s=>{const{onJoin:r,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=Rd.syncDiff(this.state,s,r,o),l())}),this.onJoin((s,r,o)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:r,newPresences:o})}),this.onLeave((s,r,o)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:r,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,s){const r=this.cloneDeep(e),o=this.transformState(t),l={},c={};return this.map(r,(u,h)=>{o[u]||(c[u]=h)}),this.map(o,(u,h)=>{const d=r[u];if(d){const f=h.map(S=>S.presence_ref),p=d.map(S=>S.presence_ref),v=h.filter(S=>p.indexOf(S.presence_ref)<0),b=d.filter(S=>f.indexOf(S.presence_ref)<0);v.length>0&&(l[u]=v),b.length>0&&(c[u]=b)}else l[u]=h}),this.syncDiff(r,{joins:l,leaves:c},n,s)}static syncDiff(e,t,n,s){const{joins:r,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(r,(l,c)=>{var u;const h=(u=e[l])!==null&&u!==void 0?u:[];if(e[l]=this.cloneDeep(c),h.length>0){const d=e[l].map(p=>p.presence_ref),f=h.filter(p=>d.indexOf(p.presence_ref)<0);e[l].unshift(...f)}n(l,h,c)}),this.map(o,(l,c)=>{let u=e[l];if(!u)return;const h=c.map(d=>d.presence_ref);u=u.filter(d=>h.indexOf(d.presence_ref)<0),e[l]=u,s(l,u,c),u.length===0&&delete e[l]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const s=e[n];return"metas"in s?t[n]=s.metas.map(r=>(r.presence_ref=r.phx_ref,delete r.phx_ref,delete r.phx_ref_prev,r)):t[n]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var VS;(function(i){i.ALL="*",i.INSERT="INSERT",i.UPDATE="UPDATE",i.DELETE="DELETE"})(VS||(VS={}));var Ld;(function(i){i.BROADCAST="broadcast",i.PRESENCE="presence",i.POSTGRES_CHANGES="postgres_changes",i.SYSTEM="system"})(Ld||(Ld={}));var Xs;(function(i){i.SUBSCRIBED="SUBSCRIBED",i.TIMED_OUT="TIMED_OUT",i.CLOSED="CLOSED",i.CHANNEL_ERROR="CHANNEL_ERROR"})(Xs||(Xs={}));class Ub{constructor(e,t={config:{}},n){this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=mt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Kv(this,ns.join,this.params,this.timeout),this.rejoinTimer=new GT(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=mt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(s=>s.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=mt.closed,this.socket._remove(this)}),this._onError(s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=mt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=mt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",s=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,s),this.state=mt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ns.reply,{},(s,r)=>{this._trigger(this._replyEventName(r),s)}),this.presence=new Rd(this),this.broadcastEndpointURL=KT(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var n,s,r;if(this.socket.isConnected()||this.socket.connect(),this.state==mt.closed){const{config:{broadcast:o,presence:l,private:c}}=this.params,u=(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(p=>p.filter))!==null&&s!==void 0?s:[],h=!!this.bindings[Ld.PRESENCE]&&this.bindings[Ld.PRESENCE].length>0||((r=this.params.config.presence)===null||r===void 0?void 0:r.enabled)===!0,d={},f={broadcast:o,presence:Object.assign(Object.assign({},l),{enabled:h}),postgres_changes:u,private:c};this.socket.accessTokenValue&&(d.access_token=this.socket.accessTokenValue),this._onError(p=>e==null?void 0:e(Xs.CHANNEL_ERROR,p)),this._onClose(()=>e==null?void 0:e(Xs.CLOSED)),this.updateJoinPayload(Object.assign({config:f},d)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:p})=>{var v;if(this.socket.setAuth(),p===void 0){e==null||e(Xs.SUBSCRIBED);return}else{const b=this.bindings.postgres_changes,S=(v=b==null?void 0:b.length)!==null&&v!==void 0?v:0,m=[];for(let _=0;_<S;_++){const w=b[_],{filter:{event:E,schema:k,table:C,filter:T}}=w,R=p&&p[_];if(R&&R.event===E&&R.schema===k&&R.table===C&&R.filter===T)m.push(Object.assign(Object.assign({},w),{id:R.id}));else{this.unsubscribe(),this.state=mt.errored,e==null||e(Xs.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=m,e&&e(Xs.SUBSCRIBED);return}}).receive("error",p=>{this.state=mt.errored,e==null||e(Xs.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Xs.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===mt.joined&&e===Ld.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,n)}async send(e,t={}){var n,s;if(!this._canPush()&&e.type==="broadcast"){const{event:r,payload:o}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:r,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=u.body)===null||s===void 0?void 0:s.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(r=>{var o,l,c;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&r("ok"),u.receive("ok",()=>r("ok")),u.receive("error",()=>r("error")),u.receive("timeout",()=>r("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=mt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ns.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new Kv(this,ns.leave,{},e),n.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=mt.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const s=new AbortController,r=setTimeout(()=>s.abort(),n),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(r),o}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Kv(this,e,t,n);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>Q2){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var s,r;const o=e.toLocaleLowerCase(),{close:l,error:c,leave:u,join:h}=ns;if(n&&[l,c,u,h].indexOf(o)>=0&&n!==this._joinRef())return;let f=this._onMessage(o,t,n);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(p=>{var v,b,S;return((v=p.filter)===null||v===void 0?void 0:v.event)==="*"||((S=(b=p.filter)===null||b===void 0?void 0:b.event)===null||S===void 0?void 0:S.toLocaleLowerCase())===o}).map(p=>p.callback(f,n)):(r=this.bindings[o])===null||r===void 0||r.filter(p=>{var v,b,S,m,_,w;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const E=p.id,k=(v=p.filter)===null||v===void 0?void 0:v.event;return E&&((b=t.ids)===null||b===void 0?void 0:b.includes(E))&&(k==="*"||(k==null?void 0:k.toLocaleLowerCase())===((S=t.data)===null||S===void 0?void 0:S.type.toLocaleLowerCase()))}else{const E=(_=(m=p==null?void 0:p.filter)===null||m===void 0?void 0:m.event)===null||_===void 0?void 0:_.toLocaleLowerCase();return E==="*"||E===((w=t==null?void 0:t.event)===null||w===void 0?void 0:w.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof f=="object"&&"ids"in f){const v=f.data,{schema:b,table:S,commit_timestamp:m,type:_,errors:w}=v;f=Object.assign(Object.assign({},{schema:b,table:S,commit_timestamp:m,eventType:_,new:{},old:{},errors:w}),this._getPayloadRecords(v))}p.callback(f,n)})}_isClosed(){return this.state===mt.closed}_isJoined(){return this.state===mt.joined}_isJoining(){return this.state===mt.joining}_isLeaving(){return this.state===mt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const s=e.toLocaleLowerCase(),r={type:s,filter:t,callback:n};return this.bindings[s]?this.bindings[s].push(r):this.bindings[s]=[r],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(s=>{var r;return!(((r=s.type)===null||r===void 0?void 0:r.toLocaleLowerCase())===n&&Ub.isEqual(s.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ns.close,{},e)}_onError(e){this._on(ns.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=mt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=HS(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=HS(e.columns,e.old_record)),t}}const Xv=()=>{},Og={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},rO=[1e3,2e3,5e3,1e4],oO=1e4,aO=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class lO{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=E_,this.transport=null,this.heartbeatIntervalMs=Og.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Xv,this.ref=0,this.reconnectTimer=null,this.logger=Xv,this.conn=null,this.sendBuffer=[],this.serializer=new J2,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=s=>{let r;return s?r=s:typeof fetch>"u"?r=(...o)=>sg(async()=>{const{default:l}=await Promise.resolve().then(()=>Ih);return{default:l}},void 0).then(({default:l})=>l(...o)).catch(l=>{throw new Error(`Failed to load @supabase/node-fetch: ${l.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):r=fetch,(...o)=>r(...o)},!(!((n=t==null?void 0:t.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${k_.websocket}`,this.httpEndpoint=KT(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=G2.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:X2}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Pd.connecting:return Ea.Connecting;case Pd.open:return Ea.Open;case Pd.closing:return Ea.Closing;default:return Ea.Closed}}isConnected(){return this.connectionState()===Ea.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const n=`realtime:${e}`,s=this.getChannels().find(r=>r.topic===n);if(s)return s;{const r=new Ub(`realtime:${e}`,t,this);return this.channels.push(r),r}}push(e){const{topic:t,event:n,payload:s,ref:r}=e,o=()=>{this.encode(e,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${t} ${n} (${r})`,s),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(Y2,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Og.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(u){this.log("error","error in heartbeat callback",u)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:s,payload:r,ref:o}=t,l=o?`(${o})`:"",c=r.status||"";this.log("receive",`${c} ${n} ${s} ${l}`.trim(),r),this.channels.filter(u=>u._isMember(n)).forEach(u=>u._trigger(s,r,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(ns.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${n}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([aO],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(n=>{const s={access_token:t,version:K2};t&&n.updateJoinPayload(s),n.joinedOnce&&n._isJoined()&&n._push(ns.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new GT(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Og.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,s,r,o,l,c,u,h;if(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(n=e==null?void 0:e.timeout)!==null&&n!==void 0?n:E_,this.heartbeatIntervalMs=(s=e==null?void 0:e.heartbeatIntervalMs)!==null&&s!==void 0?s:Og.HEARTBEAT_INTERVAL,this.worker=(r=e==null?void 0:e.worker)!==null&&r!==void 0?r:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(l=e==null?void 0:e.heartbeatCallback)!==null&&l!==void 0?l:Xv,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=e==null?void 0:e.reconnectAfterMs)!==null&&c!==void 0?c:d=>rO[d-1]||oO,this.encode=(u=e==null?void 0:e.encode)!==null&&u!==void 0?u:(d,f)=>f(JSON.stringify(d)),this.decode=(h=e==null?void 0:e.decode)!==null&&h!==void 0?h:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class zb extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function bt(i){return typeof i=="object"&&i!==null&&"__isStorageError"in i}class cO extends zb{constructor(e,t,n){super(e),this.name="StorageApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class T_ extends zb{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var uO=function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function l(h){try{u(n.next(h))}catch(d){o(d)}}function c(h){try{u(n.throw(h))}catch(d){o(d)}}function u(h){h.done?r(h.value):s(h.value).then(l,c)}u((n=n.apply(i,e||[])).next())})};const XT=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>sg(async()=>{const{default:n}=await Promise.resolve().then(()=>Ih);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},hO=()=>uO(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield sg(()=>Promise.resolve().then(()=>Ih),void 0)).Response:Response}),x_=i=>{if(Array.isArray(i))return i.map(t=>x_(t));if(typeof i=="function"||i!==Object(i))return i;const e={};return Object.entries(i).forEach(([t,n])=>{const s=t.replace(/([-_][a-z])/gi,r=>r.toUpperCase().replace(/[-_]/g,""));e[s]=x_(n)}),e},dO=i=>{if(typeof i!="object"||i===null)return!1;const e=Object.getPrototypeOf(i);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)};var oc=function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function l(h){try{u(n.next(h))}catch(d){o(d)}}function c(h){try{u(n.throw(h))}catch(d){o(d)}}function u(h){h.done?r(h.value):s(h.value).then(l,c)}u((n=n.apply(i,e||[])).next())})};const Yv=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),fO=(i,e,t)=>oc(void 0,void 0,void 0,function*(){const n=yield hO();i instanceof n&&!(t!=null&&t.noResolveJson)?i.json().then(s=>{const r=i.status||500,o=(s==null?void 0:s.statusCode)||r+"";e(new cO(Yv(s),r,o))}).catch(s=>{e(new T_(Yv(s),s))}):e(new T_(Yv(i),i))}),pO=(i,e,t,n)=>{const s={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"||!n?s:(dO(n)?(s.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(n)):s.body=n,e!=null&&e.duplex&&(s.duplex=e.duplex),Object.assign(Object.assign({},s),t))};function og(i,e,t,n,s,r){return oc(this,void 0,void 0,function*(){return new Promise((o,l)=>{i(t,pO(e,n,s,r)).then(c=>{if(!c.ok)throw c;return n!=null&&n.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>fO(c,l,n))})})}function fy(i,e,t,n){return oc(this,void 0,void 0,function*(){return og(i,"GET",e,t,n)})}function ms(i,e,t,n,s){return oc(this,void 0,void 0,function*(){return og(i,"POST",e,n,s,t)})}function P_(i,e,t,n,s){return oc(this,void 0,void 0,function*(){return og(i,"PUT",e,n,s,t)})}function gO(i,e,t,n){return oc(this,void 0,void 0,function*(){return og(i,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),n)})}function YT(i,e,t,n,s){return oc(this,void 0,void 0,function*(){return og(i,"DELETE",e,n,s,t)})}var an=function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function l(h){try{u(n.next(h))}catch(d){o(d)}}function c(h){try{u(n.throw(h))}catch(d){o(d)}}function u(h){h.done?r(h.value):s(h.value).then(l,c)}u((n=n.apply(i,e||[])).next())})};const mO={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},GS={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class yO{constructor(e,t={},n,s){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=n,this.fetch=XT(s)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,n,s){return an(this,void 0,void 0,function*(){try{let r;const o=Object.assign(Object.assign({},GS),s);let l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&n instanceof Blob?(r=new FormData,r.append("cacheControl",o.cacheControl),c&&r.append("metadata",this.encodeMetadata(c)),r.append("",n)):typeof FormData<"u"&&n instanceof FormData?(r=n,r.append("cacheControl",o.cacheControl),c&&r.append("metadata",this.encodeMetadata(c))):(r=n,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),s!=null&&s.headers&&(l=Object.assign(Object.assign({},l),s.headers));const u=this._removeEmptyFolders(t),h=this._getFinalPath(u),d=yield(e=="PUT"?P_:ms)(this.fetch,`${this.url}/object/${h}`,r,Object.assign({headers:l},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:u,id:d.Id,fullPath:d.Key},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(bt(r))return{data:null,error:r};throw r}})}upload(e,t,n){return an(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,s){return an(this,void 0,void 0,function*(){const r=this._removeEmptyFolders(e),o=this._getFinalPath(r),l=new URL(this.url+`/object/upload/sign/${o}`);l.searchParams.set("token",t);try{let c;const u=Object.assign({upsert:GS.upsert},s),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&n instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),c.append("",n)):typeof FormData<"u"&&n instanceof FormData?(c=n,c.append("cacheControl",u.cacheControl)):(c=n,h["cache-control"]=`max-age=${u.cacheControl}`,h["content-type"]=u.contentType);const d=yield P_(this.fetch,l.toString(),c,{headers:h});return{data:{path:r,fullPath:d.Key},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(bt(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return an(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const s=Object.assign({},this.headers);t!=null&&t.upsert&&(s["x-upsert"]="true");const r=yield ms(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:s}),o=new URL(this.url+r.url),l=o.searchParams.get("token");if(!l)throw new zb("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:l},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(bt(n))return{data:null,error:n};throw n}})}update(e,t,n){return an(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t,n){return an(this,void 0,void 0,function*(){try{return{data:yield ms(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(bt(s))return{data:null,error:s};throw s}})}copy(e,t,n){return an(this,void 0,void 0,function*(){try{return{data:{path:(yield ms(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(bt(s))return{data:null,error:s};throw s}})}createSignedUrl(e,t,n){return an(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e),r=yield ms(this.fetch,`${this.url}/object/sign/${s}`,Object.assign({expiresIn:t},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return r={signedUrl:encodeURI(`${this.url}${r.signedURL}${o}`)},{data:r,error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(bt(s))return{data:null,error:s};throw s}})}createSignedUrls(e,t,n){return an(this,void 0,void 0,function*(){try{const s=yield ms(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),r=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:s.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${r}`):null})),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(bt(s))return{data:null,error:s};throw s}})}download(e,t){return an(this,void 0,void 0,function*(){const s=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",r=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=r?`?${r}`:"";try{const l=this._getFinalPath(e);return{data:yield(yield fy(this.fetch,`${this.url}/${s}/${l}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(bt(l))return{data:null,error:l};throw l}})}info(e){return an(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const n=yield fy(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:x_(n),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(bt(n))return{data:null,error:n};throw n}})}exists(e){return an(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield gO(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(bt(n)&&n instanceof T_){const s=n.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,t){const n=this._getFinalPath(e),s=[],r=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";r!==""&&s.push(r);const l=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&s.push(c);let u=s.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${n}${u}`)}}}remove(e){return an(this,void 0,void 0,function*(){try{return{data:yield YT(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(bt(t))return{data:null,error:t};throw t}})}list(e,t,n){return an(this,void 0,void 0,function*(){try{const s=Object.assign(Object.assign(Object.assign({},mO),t),{prefix:e||""});return{data:yield ms(this.fetch,`${this.url}/object/list/${this.bucketId}`,s,{headers:this.headers},n),error:null}}catch(s){if(this.shouldThrowOnError)throw s;if(bt(s))return{data:null,error:s};throw s}})}listV2(e,t){return an(this,void 0,void 0,function*(){try{const n=Object.assign({},e);return{data:yield ms(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},t),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(bt(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const vO="2.12.1",wO={"X-Client-Info":`storage-js/${vO}`};var cc=function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function l(h){try{u(n.next(h))}catch(d){o(d)}}function c(h){try{u(n.throw(h))}catch(d){o(d)}}function u(h){h.done?r(h.value):s(h.value).then(l,c)}u((n=n.apply(i,e||[])).next())})};class _O{constructor(e,t={},n,s){this.shouldThrowOnError=!1;const r=new URL(e);s!=null&&s.useNewHostname&&/supabase\.(co|in|red)$/.test(r.hostname)&&!r.hostname.includes("storage.supabase.")&&(r.hostname=r.hostname.replace("supabase.","storage.supabase.")),this.url=r.href,this.headers=Object.assign(Object.assign({},wO),t),this.fetch=XT(n)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return cc(this,void 0,void 0,function*(){try{return{data:yield fy(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(bt(e))return{data:null,error:e};throw e}})}getBucket(e){return cc(this,void 0,void 0,function*(){try{return{data:yield fy(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(bt(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return cc(this,void 0,void 0,function*(){try{return{data:yield ms(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(bt(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return cc(this,void 0,void 0,function*(){try{return{data:yield P_(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(bt(n))return{data:null,error:n};throw n}})}emptyBucket(e){return cc(this,void 0,void 0,function*(){try{return{data:yield ms(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(bt(t))return{data:null,error:t};throw t}})}deleteBucket(e){return cc(this,void 0,void 0,function*(){try{return{data:yield YT(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(bt(t))return{data:null,error:t};throw t}})}}class bO extends _O{constructor(e,t={},n,s){super(e,t,n,s)}from(e){return new yO(this.url,this.headers,e,this.fetch)}}const AO="2.57.4";let wd="";typeof Deno<"u"?wd="deno":typeof document<"u"?wd="web":typeof navigator<"u"&&navigator.product==="ReactNative"?wd="react-native":wd="node";const SO={"X-Client-Info":`supabase-js-${wd}/${AO}`},EO={headers:SO},kO={schema:"public"},CO={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},TO={};var xO=function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function l(h){try{u(n.next(h))}catch(d){o(d)}}function c(h){try{u(n.throw(h))}catch(d){o(d)}}function u(h){h.done?r(h.value):s(h.value).then(l,c)}u((n=n.apply(i,e||[])).next())})};const PO=i=>{let e;return i?e=i:typeof fetch>"u"?e=MT:e=fetch,(...t)=>e(...t)},RO=()=>typeof Headers>"u"?NT:Headers,LO=(i,e,t)=>{const n=PO(t),s=RO();return(r,o)=>xO(void 0,void 0,void 0,function*(){var l;const c=(l=yield e())!==null&&l!==void 0?l:i;let u=new s(o==null?void 0:o.headers);return u.has("apikey")||u.set("apikey",i),u.has("Authorization")||u.set("Authorization",`Bearer ${c}`),n(r,Object.assign(Object.assign({},o),{headers:u}))})};var IO=function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function l(h){try{u(n.next(h))}catch(d){o(d)}}function c(h){try{u(n.throw(h))}catch(d){o(d)}}function u(h){h.done?r(h.value):s(h.value).then(l,c)}u((n=n.apply(i,e||[])).next())})};function DO(i){return i.endsWith("/")?i:i+"/"}function OO(i,e){var t,n;const{db:s,auth:r,realtime:o,global:l}=i,{db:c,auth:u,realtime:h,global:d}=e,f={db:Object.assign(Object.assign({},c),s),auth:Object.assign(Object.assign({},u),r),realtime:Object.assign(Object.assign({},h),o),storage:{},global:Object.assign(Object.assign(Object.assign({},d),l),{headers:Object.assign(Object.assign({},(t=d==null?void 0:d.headers)!==null&&t!==void 0?t:{}),(n=l==null?void 0:l.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>IO(this,void 0,void 0,function*(){return""})};return i.accessToken?f.accessToken=i.accessToken:delete f.accessToken,f}function MO(i){const e=i==null?void 0:i.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(DO(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const QT="2.71.1",Ac=30*1e3,R_=3,Qv=R_*Ac,NO="http://localhost:9999",FO="supabase.auth.token",BO={"X-Client-Info":`gotrue-js/${QT}`},L_="X-Supabase-Api-Version",JT={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},jO=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,$O=10*60*1e3;class Hb extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function se(i){return typeof i=="object"&&i!==null&&"__isAuthError"in i}class UO extends Hb{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}function zO(i){return se(i)&&i.name==="AuthApiError"}class ZT extends Hb{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class fa extends Hb{constructor(e,t,n,s){super(e,n,s),this.name=t,this.status=n}}class Yr extends fa{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function HO(i){return se(i)&&i.name==="AuthSessionMissingError"}class Mg extends fa{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ng extends fa{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Fg extends fa{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function WO(i){return se(i)&&i.name==="AuthImplicitGrantRedirectError"}class qS extends fa{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class I_ extends fa{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Jv(i){return se(i)&&i.name==="AuthRetryableFetchError"}class KS extends fa{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class D_ extends fa{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const py="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),XS=` 	
\r=`.split(""),VO=(()=>{const i=new Array(128);for(let e=0;e<i.length;e+=1)i[e]=-1;for(let e=0;e<XS.length;e+=1)i[XS[e].charCodeAt(0)]=-2;for(let e=0;e<py.length;e+=1)i[py[e].charCodeAt(0)]=e;return i})();function YS(i,e,t){if(i!==null)for(e.queue=e.queue<<8|i,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(py[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(py[n]),e.queuedBits-=6}}function ex(i,e,t){const n=VO[i];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(i)}"`)}}function QS(i){const e=[],t=o=>{e.push(String.fromCodePoint(o))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},r=o=>{KO(o,n,t)};for(let o=0;o<i.length;o+=1)ex(i.charCodeAt(o),s,r);return e.join("")}function GO(i,e){if(i<=127){e(i);return}else if(i<=2047){e(192|i>>6),e(128|i&63);return}else if(i<=65535){e(224|i>>12),e(128|i>>6&63),e(128|i&63);return}else if(i<=1114111){e(240|i>>18),e(128|i>>12&63),e(128|i>>6&63),e(128|i&63);return}throw new Error(`Unrecognized Unicode codepoint: ${i.toString(16)}`)}function qO(i,e){for(let t=0;t<i.length;t+=1){let n=i.charCodeAt(t);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(i.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}GO(n,e)}}function KO(i,e,t){if(e.utf8seq===0){if(i<=127){t(i);return}for(let n=1;n<6;n+=1)if(!(i>>7-n&1)){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=i&31;else if(e.utf8seq===3)e.codepoint=i&15;else if(e.utf8seq===4)e.codepoint=i&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(i<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|i&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function XO(i){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};for(let s=0;s<i.length;s+=1)ex(i.charCodeAt(s),t,n);return new Uint8Array(e)}function YO(i){const e=[];return qO(i,t=>e.push(t)),new Uint8Array(e)}function QO(i){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};return i.forEach(s=>YS(s,t,n)),YS(null,t,n),e.join("")}function JO(i){return Math.round(Date.now()/1e3)+i}function ZO(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(i){const e=Math.random()*16|0;return(i=="x"?e:e&3|8).toString(16)})}const $i=()=>typeof window<"u"&&typeof document<"u",ma={tested:!1,writable:!1},tx=()=>{if(!$i())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(ma.tested)return ma.writable;const i=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(i,i),globalThis.localStorage.removeItem(i),ma.tested=!0,ma.writable=!0}catch{ma.tested=!0,ma.writable=!1}return ma.writable};function eM(i){const e={},t=new URL(i);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,r)=>{e[r]=s})}catch{}return t.searchParams.forEach((n,s)=>{e[s]=n}),e}const nx=i=>{let e;return i?e=i:typeof fetch>"u"?e=(...t)=>sg(async()=>{const{default:n}=await Promise.resolve().then(()=>Ih);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},tM=i=>typeof i=="object"&&i!==null&&"status"in i&&"ok"in i&&"json"in i&&typeof i.json=="function",Sc=async(i,e,t)=>{await i.setItem(e,JSON.stringify(t))},ya=async(i,e)=>{const t=await i.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Kr=async(i,e)=>{await i.removeItem(e)};class av{constructor(){this.promise=new av.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}av.promiseConstructor=Promise;function Zv(i){const e=i.split(".");if(e.length!==3)throw new D_("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!jO.test(e[n]))throw new D_("JWT not in base64url format");return{header:JSON.parse(QS(e[0])),payload:JSON.parse(QS(e[1])),signature:XO(e[2]),raw:{header:e[0],payload:e[1]}}}async function nM(i){return await new Promise(e=>{setTimeout(()=>e(null),i)})}function iM(i,e){return new Promise((n,s)=>{(async()=>{for(let r=0;r<1/0;r++)try{const o=await i(r);if(!e(r,null,o)){n(o);return}}catch(o){if(!e(r,o)){s(o);return}}})()})}function sM(i){return("0"+i.toString(16)).substr(-2)}function rM(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let s="";for(let r=0;r<56;r++)s+=t.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(e),Array.from(e,sM).join("")}async function oM(i){const t=new TextEncoder().encode(i),n=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(n);return Array.from(s).map(r=>String.fromCharCode(r)).join("")}async function aM(i){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),i;const t=await oM(i);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function uc(i,e,t=!1){const n=rM();let s=n;t&&(s+="/PASSWORD_RECOVERY"),await Sc(i,`${e}-code-verifier`,s);const r=await aM(n);return[r,n===r?"plain":"s256"]}const lM=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function cM(i){const e=i.headers.get(L_);if(!e||!e.match(lM))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function uM(i){if(!i)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(i<=e)throw new Error("JWT has expired")}function hM(i){switch(i){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const dM=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function hc(i){if(!dM.test(i))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function e0(){const i={};return new Proxy(i,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const n=t.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function JS(i){return JSON.parse(JSON.stringify(i))}var fM=function(i,e){var t={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(t[n[s]]=i[n[s]]);return t};const Sa=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),pM=[502,503,504];async function ZS(i){var e;if(!tM(i))throw new I_(Sa(i),0);if(pM.includes(i.status))throw new I_(Sa(i),i.status);let t;try{t=await i.json()}catch(r){throw new ZT(Sa(r),r)}let n;const s=cM(i);if(s&&s.getTime()>=JT["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new KS(Sa(t),i.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new Yr}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((r,o)=>r&&typeof o=="string",!0))throw new KS(Sa(t),i.status,t.weak_password.reasons);throw new UO(Sa(t),i.status||500,n)}const gM=(i,e,t,n)=>{const s={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),t))};async function he(i,e,t,n){var s;const r=Object.assign({},n==null?void 0:n.headers);r[L_]||(r[L_]=JT["2024-01-01"].name),n!=null&&n.jwt&&(r.Authorization=`Bearer ${n.jwt}`);const o=(s=n==null?void 0:n.query)!==null&&s!==void 0?s:{};n!=null&&n.redirectTo&&(o.redirect_to=n.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await mM(i,e,t+l,{headers:r,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(c):{data:Object.assign({},c),error:null}}async function mM(i,e,t,n,s,r){const o=gM(e,n,s,r);let l;try{l=await i(t,Object.assign({},o))}catch(c){throw console.error(c),new I_(Sa(c),0)}if(l.ok||await ZS(l),n!=null&&n.noResolveJson)return l;try{return await l.json()}catch(c){await ZS(c)}}function qs(i){var e;let t=null;_M(i)&&(t=Object.assign({},i),i.expires_at||(t.expires_at=JO(i.expires_in)));const n=(e=i.user)!==null&&e!==void 0?e:i;return{data:{session:t,user:n},error:null}}function e1(i){const e=qs(i);return!e.error&&i.weak_password&&typeof i.weak_password=="object"&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.message&&typeof i.weak_password.message=="string"&&i.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=i.weak_password),e}function no(i){var e;return{data:{user:(e=i.user)!==null&&e!==void 0?e:i},error:null}}function yM(i){return{data:i,error:null}}function vM(i){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:r}=i,o=fM(i,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:r},c=Object.assign({},o);return{data:{properties:l,user:c},error:null}}function wM(i){return i}function _M(i){return i.access_token&&i.refresh_token&&i.expires_in}const t0=["global","local","others"];var bM=function(i,e){var t={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(t[n[s]]=i[n[s]]);return t};class AM{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=nx(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=t0[0]){if(t0.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${t0.join(", ")}`);try{return await he(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(se(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await he(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:no})}catch(n){if(se(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=bM(e,["options"]),s=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(s.new_email=n==null?void 0:n.newEmail,delete s.newEmail),await he(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:vM,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(se(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await he(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:no})}catch(t){if(se(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,s,r,o,l,c;try{const u={nextPage:null,lastPage:0,total:0},h=await he(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(r=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&r!==void 0?r:""},xform:wM});if(h.error)throw h.error;const d=await h.json(),f=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(l=h.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(v=>{const b=parseInt(v.split(";")[0].split("=")[1].substring(0,1)),S=JSON.parse(v.split(";")[1].split("=")[1]);u[`${S}Page`]=b}),u.total=parseInt(f)),{data:Object.assign(Object.assign({},d),u),error:null}}catch(u){if(se(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){hc(e);try{return await he(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:no})}catch(t){if(se(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){hc(e);try{return await he(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:no})}catch(n){if(se(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){hc(e);try{return await he(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:no})}catch(n){if(se(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){hc(e.userId);try{const{data:t,error:n}=await he(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:n}}catch(t){if(se(t))return{data:null,error:t};throw t}}async _deleteFactor(e){hc(e.userId),hc(e.id);try{return{data:await he(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(se(t))return{data:null,error:t};throw t}}}function t1(i={}){return{getItem:e=>i[e]||null,setItem:(e,t)=>{i[e]=t},removeItem:e=>{delete i[e]}}}function SM(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const dc={debug:!!(globalThis&&tx()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class ix extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class EM extends ix{}async function kM(i,e,t){dc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",i,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),dc.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",i)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(i,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){dc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",i,s.name);try{return await t()}finally{dc.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",i,s.name)}}else{if(e===0)throw dc.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",i),new EM(`Acquiring an exclusive Navigator LockManager lock "${i}" immediately failed`);if(dc.debug)try{const r=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(r,null,"  "))}catch(r){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",r)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}SM();const CM={url:NO,storageKey:FO,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:BO,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function n1(i,e,t){return await t()}const fc={};class ef{constructor(e){var t,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ef.nextInstanceID,ef.nextInstanceID+=1,this.instanceID>0&&$i()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const s=Object.assign(Object.assign({},CM),e);if(this.logDebugMessages=!!s.debug,typeof s.debug=="function"&&(this.logger=s.debug),this.persistSession=s.persistSession,this.storageKey=s.storageKey,this.autoRefreshToken=s.autoRefreshToken,this.admin=new AM({url:s.url,headers:s.headers,fetch:s.fetch}),this.url=s.url,this.headers=s.headers,this.fetch=nx(s.fetch),this.lock=s.lock||n1,this.detectSessionInUrl=s.detectSessionInUrl,this.flowType=s.flowType,this.hasCustomAuthorizationHeader=s.hasCustomAuthorizationHeader,s.lock?this.lock=s.lock:$i()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=kM:this.lock=n1,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(s.storage?this.storage=s.storage:tx()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=t1(this.memoryStorage)),s.userStorage&&(this.userStorage=s.userStorage)):(this.memoryStorage={},this.storage=t1(this.memoryStorage)),$i()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(r){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",r)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async r=>{this._debug("received broadcast notification from other tab or client",r),await this._notifyAllSubscribers(r.data.event,r.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=fc[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){fc[this.storageKey]=Object.assign(Object.assign({},fc[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=fc[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){fc[this.storageKey]=Object.assign(Object.assign({},fc[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${QT}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=eM(window.location.href);let n="none";if(this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce"),$i()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:r}=await this._getSessionFromURL(t,n);if(r){if(this._debug("#_initialize()","error detecting session from URL",r),WO(r)){const c=(e=r.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:r}}return await this._removeSession(),{error:r}}const{session:o,redirectType:l}=s;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return se(t)?{error:t}:{error:new ZT("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,s;try{const r=await he(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:qs}),{data:o,error:l}=r;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(r){if(se(r))return{data:{user:null,session:null},error:r};throw r}}async signUp(e){var t,n,s;try{let r;if("email"in e){const{email:h,password:d,options:f}=e;let p=null,v=null;this.flowType==="pkce"&&([p,v]=await uc(this.storage,this.storageKey)),r=await he(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:h,password:d,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:p,code_challenge_method:v},xform:qs})}else if("phone"in e){const{phone:h,password:d,options:f}=e;r=await he(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:d,data:(n=f==null?void 0:f.data)!==null&&n!==void 0?n:{},channel:(s=f==null?void 0:f.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:qs})}else throw new Ng("You must provide either an email or phone number and a password");const{data:o,error:l}=r;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(r){if(se(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithPassword(e){try{let t;if("email"in e){const{email:r,password:o,options:l}=e;t=await he(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:e1})}else if("phone"in e){const{phone:r,password:o,options:l}=e;t=await he(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:e1})}else throw new Ng("You must provide either an email or phone number and a password");const{data:n,error:s}=t;return s?{data:{user:null,session:null},error:s}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new Mg}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(t){if(se(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,n,s,r;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(r=e.options)===null||r===void 0?void 0:r.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,n,s,r,o,l,c,u,h,d,f,p;let v,b;if("message"in e)v=e.message,b=e.signature;else{const{chain:S,wallet:m,statement:_,options:w}=e;let E;if($i())if(typeof m=="object")E=m;else{const C=window;if("solana"in C&&typeof C.solana=="object"&&("signIn"in C.solana&&typeof C.solana.signIn=="function"||"signMessage"in C.solana&&typeof C.solana.signMessage=="function"))E=C.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof m!="object"||!(w!=null&&w.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");E=m}const k=new URL((t=w==null?void 0:w.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in E&&E.signIn){const C=await E.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},w==null?void 0:w.signInWithSolana),{version:"1",domain:k.host,uri:k.href}),_?{statement:_}:null));let T;if(Array.isArray(C)&&C[0]&&typeof C[0]=="object")T=C[0];else if(C&&typeof C=="object"&&"signedMessage"in C&&"signature"in C)T=C;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in T&&"signature"in T&&(typeof T.signedMessage=="string"||T.signedMessage instanceof Uint8Array)&&T.signature instanceof Uint8Array)v=typeof T.signedMessage=="string"?T.signedMessage:new TextDecoder().decode(T.signedMessage),b=T.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in E)||typeof E.signMessage!="function"||!("publicKey"in E)||typeof E!="object"||!E.publicKey||!("toBase58"in E.publicKey)||typeof E.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");v=[`${k.host} wants you to sign in with your Solana account:`,E.publicKey.toBase58(),..._?["",_,""]:[""],"Version: 1",`URI: ${k.href}`,`Issued At: ${(s=(n=w==null?void 0:w.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((r=w==null?void 0:w.signInWithSolana)===null||r===void 0)&&r.notBefore?[`Not Before: ${w.signInWithSolana.notBefore}`]:[],...!((o=w==null?void 0:w.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${w.signInWithSolana.expirationTime}`]:[],...!((l=w==null?void 0:w.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${w.signInWithSolana.chainId}`]:[],...!((c=w==null?void 0:w.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${w.signInWithSolana.nonce}`]:[],...!((u=w==null?void 0:w.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${w.signInWithSolana.requestId}`]:[],...!((d=(h=w==null?void 0:w.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||d===void 0)&&d.length?["Resources",...w.signInWithSolana.resources.map(T=>`- ${T}`)]:[]].join(`
`);const C=await E.signMessage(new TextEncoder().encode(v),"utf8");if(!C||!(C instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");b=C}}try{const{data:S,error:m}=await he(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:v,signature:QO(b)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:qs});if(m)throw m;return!S||!S.session||!S.user?{data:{user:null,session:null},error:new Mg}:(S.session&&(await this._saveSession(S.session),await this._notifyAllSubscribers("SIGNED_IN",S.session)),{data:Object.assign({},S),error:m})}catch(S){if(se(S))return{data:{user:null,session:null},error:S};throw S}}async _exchangeCodeForSession(e){const t=await ya(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(t??"").split("/");try{const{data:r,error:o}=await he(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:qs});if(await Kr(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!r||!r.session||!r.user?{data:{user:null,session:null,redirectType:null},error:new Mg}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign(Object.assign({},r),{redirectType:s??null}),error:o})}catch(r){if(se(r))return{data:{user:null,session:null,redirectType:null},error:r};throw r}}async signInWithIdToken(e){try{const{options:t,provider:n,token:s,access_token:r,nonce:o}=e,l=await he(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:r,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:qs}),{data:c,error:u}=l;return u?{data:{user:null,session:null},error:u}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Mg}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:u})}catch(t){if(se(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,n,s,r,o;try{if("email"in e){const{email:l,options:c}=e;let u=null,h=null;this.flowType==="pkce"&&([u,h]=await uc(this.storage,this.storageKey));const{error:d}=await he(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(n=c==null?void 0:c.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:u,code_challenge_method:h},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:l,options:c}=e,{data:u,error:h}=await he(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(s=c==null?void 0:c.data)!==null&&s!==void 0?s:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:h}}throw new Ng("You must provide either an email or phone number.")}catch(l){if(se(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var t,n;try{let s,r;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,r=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:o,error:l}=await he(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:r}}),redirectTo:s,xform:qs});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,u=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(s){if(se(s))return{data:{user:null,session:null},error:s};throw s}}async signInWithSSO(e){var t,n,s;try{let r=null,o=null;return this.flowType==="pkce"&&([r,o]=await uc(this.storage,this.storageKey)),await he(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:r,code_challenge_method:o}),headers:this.headers,xform:yM})}catch(r){if(se(r))return{data:null,error:r};throw r}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new Yr;const{error:s}=await he(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:s}})}catch(e){if(se(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:s,options:r}=e,{error:o}=await he(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},redirectTo:r==null?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:n,type:s,options:r}=e,{data:o,error:l}=await he(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:l}}throw new Ng("You must provide either an email or phone number and a type")}catch(t){if(se(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await ya(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<Qv:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const o=await ya(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=e0()}if(this.storage.isServer&&e.user){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,u,h)=>(!o&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,u,h))})}return{data:{session:e},error:null}}const{session:s,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{session:null},error:r}:{data:{session:s},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await he(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:no}):await this._useSession(async t=>{var n,s,r;const{data:o,error:l}=t;if(l)throw l;return!(!((n=o.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Yr}:await he(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(r=(s=o.session)===null||s===void 0?void 0:s.access_token)!==null&&r!==void 0?r:void 0,xform:no})})}catch(t){if(se(t))return HO(t)&&(await this._removeSession(),await Kr(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:s,error:r}=n;if(r)throw r;if(!s.session)throw new Yr;const o=s.session;let l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await uc(this.storage,this.storageKey));const{data:u,error:h}=await he(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:o.access_token,xform:no});if(h)throw h;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(n){if(se(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Yr;const t=Date.now()/1e3;let n=t,s=!0,r=null;const{payload:o}=Zv(e.access_token);if(o.exp&&(n=o.exp,s=n<=t),s){const{session:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};r=l}else{const{data:l,error:c}=await this._getUser(e.access_token);if(c)throw c;r={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)}return{data:{user:r.user,session:r},error:null}}catch(t){if(se(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:o,error:l}=t;if(l)throw l;e=(n=o.session)!==null&&n!==void 0?n:void 0}if(!(e!=null&&e.refresh_token))throw new Yr;const{session:s,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{user:null,session:null},error:r}:s?{data:{user:s.user,session:s},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(se(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!$i())throw new Fg("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Fg(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new qS("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Fg("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new qS("No code detected.");const{data:_,error:w}=await this._exchangeCodeForSession(e.code);if(w)throw w;const E=new URL(window.location.href);return E.searchParams.delete("code"),window.history.replaceState(window.history.state,"",E.toString()),{data:{session:_.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:r,refresh_token:o,expires_in:l,expires_at:c,token_type:u}=e;if(!r||!l||!o||!u)throw new Fg("No session defined in URL");const h=Math.round(Date.now()/1e3),d=parseInt(l);let f=h+d;c&&(f=parseInt(c));const p=f-h;p*1e3<=Ac&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${d}s`);const v=f-d;h-v>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",v,f,h):h-v<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",v,f,h);const{data:b,error:S}=await this._getUser(r);if(S)throw S;const m={provider_token:n,provider_refresh_token:s,access_token:r,expires_in:d,expires_at:f,refresh_token:o,token_type:u,user:b.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:m,redirectType:e.type},error:null}}catch(n){if(se(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await ya(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:s,error:r}=t;if(r)return{error:r};const o=(n=s.session)===null||n===void 0?void 0:n.access_token;if(o){const{error:l}=await this.admin.signOut(o,e);if(l&&!(zO(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await Kr(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=ZO(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,s;try{const{data:{session:r},error:o}=t;if(o)throw o;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(r){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",r),console.error(r)}})}async resetPasswordForEmail(e,t={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await uc(this.storage,this.storageKey,!0));try{return await he(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(r){if(se(r))return{data:null,error:r};throw r}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(se(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:n,error:s}=await this._useSession(async r=>{var o,l,c,u,h;const{data:d,error:f}=r;if(f)throw f;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await he(this.fetch,"GET",p,{headers:this.headers,jwt:(h=(u=d.session)===null||u===void 0?void 0:u.access_token)!==null&&h!==void 0?h:void 0})});if(s)throw s;return $i()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),{data:{provider:e.provider,url:n==null?void 0:n.url},error:null}}catch(n){if(se(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,s;const{data:r,error:o}=t;if(o)throw o;return await he(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(se(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await iM(async s=>(s>0&&await nM(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await he(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:qs})),(s,r)=>{const o=200*Math.pow(2,s);return r&&Jv(r)&&Date.now()+o-n<Ac})}catch(n){if(this._debug(t,"error",n),se(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),$i()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await ya(this.storage,this.storageKey);if(s&&this.userStorage){let o=await ya(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:s.user},await Sc(this.userStorage,this.storageKey+"-user",o)),s.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:e0()}else if(s&&!s.user&&!s.user){const o=await ya(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(s.user=o.user,await Kr(this.storage,this.storageKey+"-user"),await Sc(this.storage,this.storageKey,s)):s.user=e0()}if(this._debug(n,"session from storage",s),!this._isValidSession(s)){this._debug(n,"session is not valid"),s!==null&&await this._removeSession();return}const r=((t=s.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Qv;if(this._debug(n,`session has${r?"":" not"} expired with margin of ${Qv}s`),r){if(this.autoRefreshToken&&s.refresh_token){const{error:o}=await this._callRefreshToken(s.refresh_token);o&&(console.error(o),Jv(o)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:l}=await this._getUser(s.access_token);!l&&(o!=null&&o.user)?(s.user=o.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(n,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(n,"error",s),console.error(s);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new Yr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new av;const{data:r,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!r.session)throw new Yr;await this._saveSession(r.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",r.session);const l={session:r.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(r){if(this._debug(s,"error",r),se(r)){const o={session:null,error:r};return Jv(r)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(r),r}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,n=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,t)}catch(c){r.push(c)}});if(await Promise.all(o),r.length>0){for(let l=0;l<r.length;l+=1)console.error(r[l]);throw r[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),n=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&t.user&&await Sc(this.userStorage,this.storageKey+"-user",{user:t.user});const s=Object.assign({},t);delete s.user;const r=JS(s);await Sc(this.storage,this.storageKey,r)}else{const s=JS(t);await Sc(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),await Kr(this.storage,this.storageKey),await Kr(this.storage,this.storageKey+"-code-verifier"),await Kr(this.storage,this.storageKey+"-user"),this.userStorage&&await Kr(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&$i()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),Ac);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-e)/Ac);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${Ac}ms, refresh threshold is ${R_} ticks`),s<=R_&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof ix)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!$i()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const s=[`provider=${encodeURIComponent(t)}`];if(n!=null&&n.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[r,o]=await uc(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(r)}`,code_challenge_method:`${encodeURIComponent(o)}`});s.push(l.toString())}if(n!=null&&n.queryParams){const r=new URLSearchParams(n.queryParams);s.push(r.toString())}return n!=null&&n.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:s,error:r}=t;return r?{data:null,error:r}:await he(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(se(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,s;const{data:r,error:o}=t;if(o)return{data:null,error:o};const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:u}=await he(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(n=r==null?void 0:r.session)===null||n===void 0?void 0:n.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((s=c==null?void 0:c.totp)===null||s===void 0)&&s.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(se(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:r}=t;if(r)return{data:null,error:r};const{data:o,error:l}=await he(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:l})})}catch(t){if(se(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:r}=t;return r?{data:null,error:r}:await he(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(se(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const n=(e==null?void 0:e.factors)||[],s=n.filter(o=>o.factor_type==="totp"&&o.status==="verified"),r=n.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:n,totp:s,phone:r},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,n;const{data:{session:s},error:r}=e;if(r)return{data:null,error:r};if(!s)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=Zv(s.access_token);let l=null;o.aal&&(l=o.aal);let c=l;((n=(t=s.user.factors)===null||t===void 0?void 0:t.filter(d=>d.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(c="aal2");const h=o.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:h},error:null}}))}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(l=>l.kid===e);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(l=>l.kid===e),n&&this.jwks_cached_at+$O>s)return n;const{data:r,error:o}=await he(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!r.keys||r.keys.length===0||(this.jwks=r,this.jwks_cached_at=s,n=r.keys.find(l=>l.kid===e),!n)?null:n}async getClaims(e,t={}){try{let n=e;if(!n){const{data:p,error:v}=await this.getSession();if(v||!p.session)return{data:null,error:v};n=p.session.access_token}const{header:s,payload:r,signature:o,raw:{header:l,payload:c}}=Zv(n);t!=null&&t.allowExpired||uM(r.exp);const u=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!u){const{error:p}=await this.getUser(n);if(p)throw p;return{data:{claims:r,header:s,signature:o},error:null}}const h=hM(s.alg),d=await crypto.subtle.importKey("jwk",u,h,!0,["verify"]);if(!await crypto.subtle.verify(h,d,o,YO(`${l}.${c}`)))throw new D_("Invalid JWT signature");return{data:{claims:r,header:s,signature:o},error:null}}catch(n){if(se(n))return{data:null,error:n};throw n}}}ef.nextInstanceID=0;const TM=ef;class xM extends TM{constructor(e){super(e)}}var PM=function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function l(h){try{u(n.next(h))}catch(d){o(d)}}function c(h){try{u(n.throw(h))}catch(d){o(d)}}function u(h){h.done?r(h.value):s(h.value).then(l,c)}u((n=n.apply(i,e||[])).next())})};class RM{constructor(e,t,n){var s,r,o;this.supabaseUrl=e,this.supabaseKey=t;const l=MO(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,u={db:kO,realtime:TO,auth:Object.assign(Object.assign({},CO),{storageKey:c}),global:EO},h=OO(n??{},u);this.storageKey=(s=h.auth.storageKey)!==null&&s!==void 0?s:"",this.headers=(r=h.global.headers)!==null&&r!==void 0?r:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(d,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=h.auth)!==null&&o!==void 0?o:{},this.headers,h.global.fetch),this.fetch=LO(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new V2(new URL("rest/v1",l).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),this.storage=new bO(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new S2(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return PM(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(t=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,userStorage:r,storageKey:o,flowType:l,lock:c,debug:u},h,d){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new xM({url:this.authUrl.href,headers:Object.assign(Object.assign({},f),h),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:s,userStorage:r,flowType:l,lock:c,debug:u,fetch:d,hasCustomAuthorizationHeader:Object.keys(this.headers).some(p=>p.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new lO(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,n)=>{this._handleTokenChanged(t,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const LM=(i,e,t)=>new RM(i,e,t);function IM(){if(typeof window<"u"||typeof process>"u")return!1;const i=process.version;if(i==null)return!1;const e=i.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}IM()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const DM="https://xafknhzgmljjsrfiabzb.supabase.co",OM="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhhZmtuaHpnbWxqanNyZmlhYnpiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI2MzEwNDIsImV4cCI6MjA3ODIwNzA0Mn0.oozQPtaKU7AomPutZXy9PaqeUbAxU2PNEEschRDpGT4",gy=LM(DM,OM);async function MM(i){const e=UR({netTaxed:i.net_taxed||0,netUntaxed:i.net_untaxed||0,netExempt:i.net_exempt||0,ivaAmount:i.iva_amount||0,otherTaxesAmount:i.other_taxes_amount||0,totalAmount:i.total_amount}),t=e.valid?null:{errors:e.errors},{data:n,error:s}=await gy.from("invoices").insert({...i,validation_errors:t}).select().single();if(s)throw s;return n}async function NM(i,e,t,n){const{data:s,error:r}=await gy.from("invoices").select("*").eq("supplier_cuit",i).eq("invoice_type",e).eq("point_of_sale",t).eq("invoice_number",n).maybeSingle();if(r)throw r;return s}const FM=mn.createContext({user:null,profile:null,loading:!0}),BM=()=>mn.useContext(FM);function jM(i){return i.type.startsWith("image/")}async function $M(i){return new Promise((e,t)=>{const n=new FileReader;n.onload=async s=>{var r;try{const o=new Image;o.src=(r=s.target)==null?void 0:r.result,o.onload=async()=>{const l=document.createElement("canvas");l.width=o.width,l.height=o.height;const c=l.getContext("2d");if(!c){t(new Error("No se pudo obtener el contexto del canvas"));return}c.fillStyle="white",c.fillRect(0,0,l.width,l.height),c.drawImage(o,0,0),l.toBlob(u=>{if(u){const h=i.name.replace(/\.(jpg|jpeg|png)$/i,".pdf"),d=new File([u],h,{type:"application/pdf"});e(d)}else t(new Error("No se pudo convertir la imagen a blob"))},"image/jpeg",.95)},o.onerror=()=>{t(new Error("Error al cargar la imagen"))}}catch(o){t(o)}},n.onerror=()=>{t(new Error("Error al leer el archivo"))},n.readAsDataURL(i)})}function UM(){const{profile:i}=BM(),[e,t]=mn.useState(!1),[n,s]=mn.useState([]),r=async o=>{if(!i)return;console.log("[Upload] Procesando archivos:",o.map(c=>({name:c.name,type:c.type,size:c.size}))),t(!0);const l=o.map(c=>({filename:c.name,status:"processing",message:"Procesando..."}));s(l);for(let c=0;c<o.length;c++)try{const u=o[c];let h=u;if(jM(u)){l[c]={...l[c],message:"Convirtiendo imagen a PDF..."},s([...l]);const b=await $M(u);h=new File([b],u.name.replace(/\.[^.]+$/,".pdf"),{type:"application/pdf"})}l[c]={...l[c],message:"Extrayendo datos del comprobante..."},s([...l]);let d,f="OpenAI";try{l[c]={...l[c],message:"Analizando comprobante con OpenAI..."},s([...l]),console.log(`[Upload] Iniciando OCR con OpenAI para: ${u.name}`),d=await y2(h),console.log(`[Upload] OpenAI OCR exitoso para: ${u.name}`,{supplierCuit:d.supplierCuit,invoiceType:d.invoiceType,invoiceNumber:d.invoiceNumber,confidence:d.confidence})}catch(b){console.error("[Upload] OpenAI OCR fall, usando OCR local como respaldo",b),f="Local (Tesseract)",l[c]={...l[c],message:"OpenAI fall, usando OCR local..."},s([...l]),console.log(`[Upload] Iniciando OCR local para: ${u.name}`),d=await e2(h),console.log(`[Upload] OCR local exitoso para: ${u.name}`,{supplierCuit:d.supplierCuit,invoiceType:d.invoiceType,invoiceNumber:d.invoiceNumber,confidence:d.confidence})}if(!d.supplierCuit||!d.invoiceType||!d.invoiceNumber)throw console.error("[Upload] Datos insuficientes extrados:",{supplierCuit:d.supplierCuit,invoiceType:d.invoiceType,invoiceNumber:d.invoiceNumber,ocrMethod:f}),new Error(`No se pudo extraer informacin suficiente del comprobante (mtodo: ${f})`);if(await NM(d.supplierCuit,d.invoiceType,d.pointOfSale||"00000",d.invoiceNumber)){l[c]={...l[c],status:"duplicate",message:"Comprobante duplicado - Ya existe en el sistema"},s([...l]);continue}l[c]={...l[c],message:"Guardando en base de datos..."},s([...l]);const v=await MM({supplier_cuit:d.supplierCuit,supplier_name:d.supplierName||"Sin nombre",invoice_type:d.invoiceType,point_of_sale:d.pointOfSale||"00000",invoice_number:d.invoiceNumber,issue_date:d.issueDate||new Date().toISOString().split("T")[0],net_taxed:d.netTaxed,net_untaxed:d.netUntaxed,net_exempt:d.netExempt,iva_amount:d.ivaAmount,other_taxes_amount:d.otherTaxesAmount,total_amount:d.totalAmount,status:d.confidence>=.7?"PROCESSED":"PENDING_REVIEW",ocr_confidence:d.confidence,created_by:i.id});if(d.taxes&&d.taxes.length>0)for(const b of d.taxes){const{data:S}=await gy.from("tax_codes").select("id").eq("code",b.taxType).maybeSingle();S&&await gy.from("invoice_taxes").insert({invoice_id:v.id,tax_code_id:S.id,tax_base:b.taxBase,tax_amount:b.taxAmount})}l[c]={...l[c],status:"success",message:`Comprobante procesado exitosamente con ${f}`,invoiceId:v.id},s([...l]),console.log(`[Upload] Archivo procesado completamente: ${u.name}`)}catch(u){console.error(`[Upload] Error procesando ${file.name}:`,u),l[c]={...l[c],status:"error",message:u.message||"Error al procesar el archivo"},s([...l])}t(!1)};return le.jsxs("div",{className:"space-y-6",children:[le.jsxs("div",{children:[le.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Cargar Comprobantes"}),le.jsx("p",{className:"text-gray-600",children:"Arrastra archivos PDF o imgenes para procesar automticamente"})]}),le.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:le.jsx($R,{onFilesSelected:r,disabled:e})}),n.length>0&&le.jsxs("div",{className:"bg-white rounded-lg shadow",children:[le.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:le.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Resultados del Procesamiento"})}),le.jsx("div",{className:"divide-y divide-gray-200",children:n.map((o,l)=>le.jsxs("div",{className:"px-6 py-4 flex items-start space-x-4",children:[le.jsxs("div",{className:"flex-shrink-0 mt-1",children:[o.status==="processing"&&le.jsx(FR,{className:"h-5 w-5 text-blue-500 animate-spin"}),o.status==="success"&&le.jsx(NR,{className:"h-5 w-5 text-green-500"}),o.status==="duplicate"&&le.jsx(aS,{className:"h-5 w-5 text-yellow-500"}),o.status==="error"&&le.jsx(aS,{className:"h-5 w-5 text-red-500"})]}),le.jsxs("div",{className:"flex-1 min-w-0",children:[le.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:o.filename}),le.jsx("p",{className:`text-sm mt-1 ${o.status==="success"?"text-green-600":o.status==="duplicate"?"text-yellow-600":o.status==="error"?"text-red-600":"text-gray-600"}`,children:o.message})]})]},l))})]})]})}function zM(){return le.jsx("div",{className:"min-h-screen bg-gray-50",children:le.jsx(UM,{})})}mk(document.getElementById("root")).render(le.jsx(mn.StrictMode,{children:le.jsx(zM,{})}));
