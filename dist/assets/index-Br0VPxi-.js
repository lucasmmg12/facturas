var AT=Object.defineProperty;var ux=s=>{throw TypeError(s)};var ST=(s,e,t)=>e in s?AT(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var B=(s,e,t)=>ST(s,typeof e!="symbol"?e+"":e,t),m0=(s,e,t)=>e.has(s)||ux("Cannot "+t);var a=(s,e,t)=>(m0(s,e,"read from private field"),t?t.call(s):e.get(s)),w=(s,e,t)=>e.has(s)?ux("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,t),g=(s,e,t,n)=>(m0(s,e,"write to private field"),n?n.call(s,t):e.set(s,t),t),x=(s,e,t)=>(m0(s,e,"access private method"),t);var yt=(s,e,t,n)=>({set _(i){g(s,e,i,t)},get _(){return a(s,e,n)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function n(i){if(i.ep)return;i.ep=!0;const r=t(i);fetch(i.href,r)}})();var Ls=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ET(s){if(s.__esModule)return s;var e=s.default;if(typeof e=="function"){var t=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(s).forEach(function(n){var i=Object.getOwnPropertyDescriptor(s,n);Object.defineProperty(t,n,i.get?i:{enumerable:!0,get:function(){return s[n]}})}),t}var wS={exports:{}},zy={},bS={exports:{}},fe={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Jp=Symbol.for("react.element"),CT=Symbol.for("react.portal"),kT=Symbol.for("react.fragment"),TT=Symbol.for("react.strict_mode"),PT=Symbol.for("react.profiler"),RT=Symbol.for("react.provider"),NT=Symbol.for("react.context"),IT=Symbol.for("react.forward_ref"),DT=Symbol.for("react.suspense"),OT=Symbol.for("react.memo"),LT=Symbol.for("react.lazy"),hx=Symbol.iterator;function MT(s){return s===null||typeof s!="object"?null:(s=hx&&s[hx]||s["@@iterator"],typeof s=="function"?s:null)}var _S={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},xS=Object.assign,AS={};function Oh(s,e,t){this.props=s,this.context=e,this.refs=AS,this.updater=t||_S}Oh.prototype.isReactComponent={};Oh.prototype.setState=function(s,e){if(typeof s!="object"&&typeof s!="function"&&s!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,s,e,"setState")};Oh.prototype.forceUpdate=function(s){this.updater.enqueueForceUpdate(this,s,"forceUpdate")};function SS(){}SS.prototype=Oh.prototype;function Wb(s,e,t){this.props=s,this.context=e,this.refs=AS,this.updater=t||_S}var Gb=Wb.prototype=new SS;Gb.constructor=Wb;xS(Gb,Oh.prototype);Gb.isPureReactComponent=!0;var dx=Array.isArray,ES=Object.prototype.hasOwnProperty,qb={current:null},CS={key:!0,ref:!0,__self:!0,__source:!0};function kS(s,e,t){var n,i={},r=null,o=null;if(e!=null)for(n in e.ref!==void 0&&(o=e.ref),e.key!==void 0&&(r=""+e.key),e)ES.call(e,n)&&!CS.hasOwnProperty(n)&&(i[n]=e[n]);var l=arguments.length-2;if(l===1)i.children=t;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];i.children=c}if(s&&s.defaultProps)for(n in l=s.defaultProps,l)i[n]===void 0&&(i[n]=l[n]);return{$$typeof:Jp,type:s,key:r,ref:o,props:i,_owner:qb.current}}function FT(s,e){return{$$typeof:Jp,type:s.type,key:e,ref:s.ref,props:s.props,_owner:s._owner}}function Kb(s){return typeof s=="object"&&s!==null&&s.$$typeof===Jp}function jT(s){var e={"=":"=0",":":"=2"};return"$"+s.replace(/[=:]/g,function(t){return e[t]})}var fx=/\/+/g;function y0(s,e){return typeof s=="object"&&s!==null&&s.key!=null?jT(""+s.key):e.toString(36)}function Gg(s,e,t,n,i){var r=typeof s;(r==="undefined"||r==="boolean")&&(s=null);var o=!1;if(s===null)o=!0;else switch(r){case"string":case"number":o=!0;break;case"object":switch(s.$$typeof){case Jp:case CT:o=!0}}if(o)return o=s,i=i(o),s=n===""?"."+y0(o,0):n,dx(i)?(t="",s!=null&&(t=s.replace(fx,"$&/")+"/"),Gg(i,e,t,"",function(u){return u})):i!=null&&(Kb(i)&&(i=FT(i,t+(!i.key||o&&o.key===i.key?"":(""+i.key).replace(fx,"$&/")+"/")+s)),e.push(i)),1;if(o=0,n=n===""?".":n+":",dx(s))for(var l=0;l<s.length;l++){r=s[l];var c=n+y0(r,l);o+=Gg(r,e,t,c,i)}else if(c=MT(s),typeof c=="function")for(s=c.call(s),l=0;!(r=s.next()).done;)r=r.value,c=n+y0(r,l++),o+=Gg(r,e,t,c,i);else if(r==="object")throw e=String(s),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return o}function fg(s,e,t){if(s==null)return s;var n=[],i=0;return Gg(s,n,"","",function(r){return e.call(t,r,i++)}),n}function BT(s){if(s._status===-1){var e=s._result;e=e(),e.then(function(t){(s._status===0||s._status===-1)&&(s._status=1,s._result=t)},function(t){(s._status===0||s._status===-1)&&(s._status=2,s._result=t)}),s._status===-1&&(s._status=0,s._result=e)}if(s._status===1)return s._result.default;throw s._result}var _n={current:null},qg={transition:null},$T={ReactCurrentDispatcher:_n,ReactCurrentBatchConfig:qg,ReactCurrentOwner:qb};function TS(){throw Error("act(...) is not supported in production builds of React.")}fe.Children={map:fg,forEach:function(s,e,t){fg(s,function(){e.apply(this,arguments)},t)},count:function(s){var e=0;return fg(s,function(){e++}),e},toArray:function(s){return fg(s,function(e){return e})||[]},only:function(s){if(!Kb(s))throw Error("React.Children.only expected to receive a single React element child.");return s}};fe.Component=Oh;fe.Fragment=kT;fe.Profiler=PT;fe.PureComponent=Wb;fe.StrictMode=TT;fe.Suspense=DT;fe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$T;fe.act=TS;fe.cloneElement=function(s,e,t){if(s==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+s+".");var n=xS({},s.props),i=s.key,r=s.ref,o=s._owner;if(e!=null){if(e.ref!==void 0&&(r=e.ref,o=qb.current),e.key!==void 0&&(i=""+e.key),s.type&&s.type.defaultProps)var l=s.type.defaultProps;for(c in e)ES.call(e,c)&&!CS.hasOwnProperty(c)&&(n[c]=e[c]===void 0&&l!==void 0?l[c]:e[c])}var c=arguments.length-2;if(c===1)n.children=t;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];n.children=l}return{$$typeof:Jp,type:s.type,key:i,ref:r,props:n,_owner:o}};fe.createContext=function(s){return s={$$typeof:NT,_currentValue:s,_currentValue2:s,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},s.Provider={$$typeof:RT,_context:s},s.Consumer=s};fe.createElement=kS;fe.createFactory=function(s){var e=kS.bind(null,s);return e.type=s,e};fe.createRef=function(){return{current:null}};fe.forwardRef=function(s){return{$$typeof:IT,render:s}};fe.isValidElement=Kb;fe.lazy=function(s){return{$$typeof:LT,_payload:{_status:-1,_result:s},_init:BT}};fe.memo=function(s,e){return{$$typeof:OT,type:s,compare:e===void 0?null:e}};fe.startTransition=function(s){var e=qg.transition;qg.transition={};try{s()}finally{qg.transition=e}};fe.unstable_act=TS;fe.useCallback=function(s,e){return _n.current.useCallback(s,e)};fe.useContext=function(s){return _n.current.useContext(s)};fe.useDebugValue=function(){};fe.useDeferredValue=function(s){return _n.current.useDeferredValue(s)};fe.useEffect=function(s,e){return _n.current.useEffect(s,e)};fe.useId=function(){return _n.current.useId()};fe.useImperativeHandle=function(s,e,t){return _n.current.useImperativeHandle(s,e,t)};fe.useInsertionEffect=function(s,e){return _n.current.useInsertionEffect(s,e)};fe.useLayoutEffect=function(s,e){return _n.current.useLayoutEffect(s,e)};fe.useMemo=function(s,e){return _n.current.useMemo(s,e)};fe.useReducer=function(s,e,t){return _n.current.useReducer(s,e,t)};fe.useRef=function(s){return _n.current.useRef(s)};fe.useState=function(s){return _n.current.useState(s)};fe.useSyncExternalStore=function(s,e,t){return _n.current.useSyncExternalStore(s,e,t)};fe.useTransition=function(){return _n.current.useTransition()};fe.version="18.3.1";bS.exports=fe;var Q=bS.exports;/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var UT=Q,zT=Symbol.for("react.element"),HT=Symbol.for("react.fragment"),VT=Object.prototype.hasOwnProperty,WT=UT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,GT={key:!0,ref:!0,__self:!0,__source:!0};function PS(s,e,t){var n,i={},r=null,o=null;t!==void 0&&(r=""+t),e.key!==void 0&&(r=""+e.key),e.ref!==void 0&&(o=e.ref);for(n in e)VT.call(e,n)&&!GT.hasOwnProperty(n)&&(i[n]=e[n]);if(s&&s.defaultProps)for(n in e=s.defaultProps,e)i[n]===void 0&&(i[n]=e[n]);return{$$typeof:zT,type:s,key:r,ref:o,props:i,_owner:WT.current}}zy.Fragment=HT;zy.jsx=PS;zy.jsxs=PS;wS.exports=zy;var E=wS.exports,RS={exports:{}},fs={},NS={exports:{}},IS={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(s){function e(P,R){var N=P.length;P.push(R);e:for(;0<N;){var D=N-1>>>1,F=P[D];if(0<i(F,R))P[D]=R,P[N]=F,N=D;else break e}}function t(P){return P.length===0?null:P[0]}function n(P){if(P.length===0)return null;var R=P[0],N=P.pop();if(N!==R){P[0]=N;e:for(var D=0,F=P.length,U=F>>>1;D<U;){var Z=2*(D+1)-1,be=P[Z],_e=Z+1,ue=P[_e];if(0>i(be,N))_e<F&&0>i(ue,be)?(P[D]=ue,P[_e]=N,D=_e):(P[D]=be,P[Z]=N,D=Z);else if(_e<F&&0>i(ue,N))P[D]=ue,P[_e]=N,D=_e;else break e}}return R}function i(P,R){var N=P.sortIndex-R.sortIndex;return N!==0?N:P.id-R.id}if(typeof performance=="object"&&typeof performance.now=="function"){var r=performance;s.unstable_now=function(){return r.now()}}else{var o=Date,l=o.now();s.unstable_now=function(){return o.now()-l}}var c=[],u=[],h=1,d=null,f=3,p=!1,y=!1,_=!1,A=typeof setTimeout=="function"?setTimeout:null,m=typeof clearTimeout=="function"?clearTimeout:null,b=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function v(P){for(var R=t(u);R!==null;){if(R.callback===null)n(u);else if(R.startTime<=P)n(u),R.sortIndex=R.expirationTime,e(c,R);else break;R=t(u)}}function S(P){if(_=!1,v(P),!y)if(t(c)!==null)y=!0,G(C);else{var R=t(u);R!==null&&M(S,R.startTime-P)}}function C(P,R){y=!1,_&&(_=!1,m(I),I=-1),p=!0;var N=f;try{for(v(R),d=t(c);d!==null&&(!(d.expirationTime>R)||P&&!j());){var D=d.callback;if(typeof D=="function"){d.callback=null,f=d.priorityLevel;var F=D(d.expirationTime<=R);R=s.unstable_now(),typeof F=="function"?d.callback=F:d===t(c)&&n(c),v(R)}else n(c);d=t(c)}if(d!==null)var U=!0;else{var Z=t(u);Z!==null&&M(S,Z.startTime-R),U=!1}return U}finally{d=null,f=N,p=!1}}var k=!1,T=null,I=-1,O=5,L=-1;function j(){return!(s.unstable_now()-L<O)}function H(){if(T!==null){var P=s.unstable_now();L=P;var R=!0;try{R=T(!0,P)}finally{R?J():(k=!1,T=null)}}else k=!1}var J;if(typeof b=="function")J=function(){b(H)};else if(typeof MessageChannel<"u"){var Y=new MessageChannel,te=Y.port2;Y.port1.onmessage=H,J=function(){te.postMessage(null)}}else J=function(){A(H,0)};function G(P){T=P,k||(k=!0,J())}function M(P,R){I=A(function(){P(s.unstable_now())},R)}s.unstable_IdlePriority=5,s.unstable_ImmediatePriority=1,s.unstable_LowPriority=4,s.unstable_NormalPriority=3,s.unstable_Profiling=null,s.unstable_UserBlockingPriority=2,s.unstable_cancelCallback=function(P){P.callback=null},s.unstable_continueExecution=function(){y||p||(y=!0,G(C))},s.unstable_forceFrameRate=function(P){0>P||125<P?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):O=0<P?Math.floor(1e3/P):5},s.unstable_getCurrentPriorityLevel=function(){return f},s.unstable_getFirstCallbackNode=function(){return t(c)},s.unstable_next=function(P){switch(f){case 1:case 2:case 3:var R=3;break;default:R=f}var N=f;f=R;try{return P()}finally{f=N}},s.unstable_pauseExecution=function(){},s.unstable_requestPaint=function(){},s.unstable_runWithPriority=function(P,R){switch(P){case 1:case 2:case 3:case 4:case 5:break;default:P=3}var N=f;f=P;try{return R()}finally{f=N}},s.unstable_scheduleCallback=function(P,R,N){var D=s.unstable_now();switch(typeof N=="object"&&N!==null?(N=N.delay,N=typeof N=="number"&&0<N?D+N:D):N=D,P){case 1:var F=-1;break;case 2:F=250;break;case 5:F=1073741823;break;case 4:F=1e4;break;default:F=5e3}return F=N+F,P={id:h++,callback:R,priorityLevel:P,startTime:N,expirationTime:F,sortIndex:-1},N>D?(P.sortIndex=N,e(u,P),t(c)===null&&P===t(u)&&(_?(m(I),I=-1):_=!0,M(S,N-D))):(P.sortIndex=F,e(c,P),y||p||(y=!0,G(C))),P},s.unstable_shouldYield=j,s.unstable_wrapCallback=function(P){var R=f;return function(){var N=f;f=R;try{return P.apply(this,arguments)}finally{f=N}}}})(IS);NS.exports=IS;var qT=NS.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var KT=Q,ds=qT;function $(s){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+s,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+s+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var DS=new Set,jd={};function oc(s,e){Ch(s,e),Ch(s+"Capture",e)}function Ch(s,e){for(jd[s]=e,s=0;s<e.length;s++)DS.add(e[s])}var Hr=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),dv=Object.prototype.hasOwnProperty,XT=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,px={},gx={};function YT(s){return dv.call(gx,s)?!0:dv.call(px,s)?!1:XT.test(s)?gx[s]=!0:(px[s]=!0,!1)}function JT(s,e,t,n){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return n?!1:t!==null?!t.acceptsBooleans:(s=s.toLowerCase().slice(0,5),s!=="data-"&&s!=="aria-");default:return!1}}function QT(s,e,t,n){if(e===null||typeof e>"u"||JT(s,e,t,n))return!0;if(n)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function xn(s,e,t,n,i,r,o){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=s,this.type=e,this.sanitizeURL=r,this.removeEmptyString=o}var Xt={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(s){Xt[s]=new xn(s,0,!1,s,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(s){var e=s[0];Xt[e]=new xn(e,1,!1,s[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(s){Xt[s]=new xn(s,2,!1,s.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(s){Xt[s]=new xn(s,2,!1,s,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(s){Xt[s]=new xn(s,3,!1,s.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(s){Xt[s]=new xn(s,3,!0,s,null,!1,!1)});["capture","download"].forEach(function(s){Xt[s]=new xn(s,4,!1,s,null,!1,!1)});["cols","rows","size","span"].forEach(function(s){Xt[s]=new xn(s,6,!1,s,null,!1,!1)});["rowSpan","start"].forEach(function(s){Xt[s]=new xn(s,5,!1,s.toLowerCase(),null,!1,!1)});var Xb=/[\-:]([a-z])/g;function Yb(s){return s[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(s){var e=s.replace(Xb,Yb);Xt[e]=new xn(e,1,!1,s,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(s){var e=s.replace(Xb,Yb);Xt[e]=new xn(e,1,!1,s,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(s){var e=s.replace(Xb,Yb);Xt[e]=new xn(e,1,!1,s,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(s){Xt[s]=new xn(s,1,!1,s.toLowerCase(),null,!1,!1)});Xt.xlinkHref=new xn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(s){Xt[s]=new xn(s,1,!1,s.toLowerCase(),null,!0,!0)});function Jb(s,e,t,n){var i=Xt.hasOwnProperty(e)?Xt[e]:null;(i!==null?i.type!==0:n||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(QT(e,t,i,n)&&(t=null),n||i===null?YT(e)&&(t===null?s.removeAttribute(e):s.setAttribute(e,""+t)):i.mustUseProperty?s[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,n=i.attributeNamespace,t===null?s.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,n?s.setAttributeNS(n,e,t):s.setAttribute(e,t))))}var Xr=KT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,pg=Symbol.for("react.element"),Pc=Symbol.for("react.portal"),Rc=Symbol.for("react.fragment"),Qb=Symbol.for("react.strict_mode"),fv=Symbol.for("react.profiler"),OS=Symbol.for("react.provider"),LS=Symbol.for("react.context"),Zb=Symbol.for("react.forward_ref"),pv=Symbol.for("react.suspense"),gv=Symbol.for("react.suspense_list"),e_=Symbol.for("react.memo"),eo=Symbol.for("react.lazy"),MS=Symbol.for("react.offscreen"),mx=Symbol.iterator;function $h(s){return s===null||typeof s!="object"?null:(s=mx&&s[mx]||s["@@iterator"],typeof s=="function"?s:null)}var tt=Object.assign,v0;function ed(s){if(v0===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);v0=e&&e[1]||""}return`
`+v0+s}var w0=!1;function b0(s,e){if(!s||w0)return"";w0=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(u){var n=u}Reflect.construct(s,[],e)}else{try{e.call()}catch(u){n=u}s.call(e.prototype)}else{try{throw Error()}catch(u){n=u}s()}}catch(u){if(u&&n&&typeof u.stack=="string"){for(var i=u.stack.split(`
`),r=n.stack.split(`
`),o=i.length-1,l=r.length-1;1<=o&&0<=l&&i[o]!==r[l];)l--;for(;1<=o&&0<=l;o--,l--)if(i[o]!==r[l]){if(o!==1||l!==1)do if(o--,l--,0>l||i[o]!==r[l]){var c=`
`+i[o].replace(" at new "," at ");return s.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",s.displayName)),c}while(1<=o&&0<=l);break}}}finally{w0=!1,Error.prepareStackTrace=t}return(s=s?s.displayName||s.name:"")?ed(s):""}function ZT(s){switch(s.tag){case 5:return ed(s.type);case 16:return ed("Lazy");case 13:return ed("Suspense");case 19:return ed("SuspenseList");case 0:case 2:case 15:return s=b0(s.type,!1),s;case 11:return s=b0(s.type.render,!1),s;case 1:return s=b0(s.type,!0),s;default:return""}}function mv(s){if(s==null)return null;if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case Rc:return"Fragment";case Pc:return"Portal";case fv:return"Profiler";case Qb:return"StrictMode";case pv:return"Suspense";case gv:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case LS:return(s.displayName||"Context")+".Consumer";case OS:return(s._context.displayName||"Context")+".Provider";case Zb:var e=s.render;return s=s.displayName,s||(s=e.displayName||e.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case e_:return e=s.displayName||null,e!==null?e:mv(s.type)||"Memo";case eo:e=s._payload,s=s._init;try{return mv(s(e))}catch{}}return null}function eP(s){var e=s.type;switch(s.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return s=e.render,s=s.displayName||s.name||"",e.displayName||(s!==""?"ForwardRef("+s+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return mv(e);case 8:return e===Qb?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ca(s){switch(typeof s){case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function FS(s){var e=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function tP(s){var e=FS(s)?"checked":"value",t=Object.getOwnPropertyDescriptor(s.constructor.prototype,e),n=""+s[e];if(!s.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,r=t.set;return Object.defineProperty(s,e,{configurable:!0,get:function(){return i.call(this)},set:function(o){n=""+o,r.call(this,o)}}),Object.defineProperty(s,e,{enumerable:t.enumerable}),{getValue:function(){return n},setValue:function(o){n=""+o},stopTracking:function(){s._valueTracker=null,delete s[e]}}}}function gg(s){s._valueTracker||(s._valueTracker=tP(s))}function jS(s){if(!s)return!1;var e=s._valueTracker;if(!e)return!0;var t=e.getValue(),n="";return s&&(n=FS(s)?s.checked?"true":"false":s.value),s=n,s!==t?(e.setValue(s),!0):!1}function jm(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}function yv(s,e){var t=e.checked;return tt({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??s._wrapperState.initialChecked})}function yx(s,e){var t=e.defaultValue==null?"":e.defaultValue,n=e.checked!=null?e.checked:e.defaultChecked;t=ca(e.value!=null?e.value:t),s._wrapperState={initialChecked:n,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function BS(s,e){e=e.checked,e!=null&&Jb(s,"checked",e,!1)}function vv(s,e){BS(s,e);var t=ca(e.value),n=e.type;if(t!=null)n==="number"?(t===0&&s.value===""||s.value!=t)&&(s.value=""+t):s.value!==""+t&&(s.value=""+t);else if(n==="submit"||n==="reset"){s.removeAttribute("value");return}e.hasOwnProperty("value")?wv(s,e.type,t):e.hasOwnProperty("defaultValue")&&wv(s,e.type,ca(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(s.defaultChecked=!!e.defaultChecked)}function vx(s,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var n=e.type;if(!(n!=="submit"&&n!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+s._wrapperState.initialValue,t||e===s.value||(s.value=e),s.defaultValue=e}t=s.name,t!==""&&(s.name=""),s.defaultChecked=!!s._wrapperState.initialChecked,t!==""&&(s.name=t)}function wv(s,e,t){(e!=="number"||jm(s.ownerDocument)!==s)&&(t==null?s.defaultValue=""+s._wrapperState.initialValue:s.defaultValue!==""+t&&(s.defaultValue=""+t))}var td=Array.isArray;function qc(s,e,t,n){if(s=s.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<s.length;t++)i=e.hasOwnProperty("$"+s[t].value),s[t].selected!==i&&(s[t].selected=i),i&&n&&(s[t].defaultSelected=!0)}else{for(t=""+ca(t),e=null,i=0;i<s.length;i++){if(s[i].value===t){s[i].selected=!0,n&&(s[i].defaultSelected=!0);return}e!==null||s[i].disabled||(e=s[i])}e!==null&&(e.selected=!0)}}function bv(s,e){if(e.dangerouslySetInnerHTML!=null)throw Error($(91));return tt({},e,{value:void 0,defaultValue:void 0,children:""+s._wrapperState.initialValue})}function wx(s,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error($(92));if(td(t)){if(1<t.length)throw Error($(93));t=t[0]}e=t}e==null&&(e=""),t=e}s._wrapperState={initialValue:ca(t)}}function $S(s,e){var t=ca(e.value),n=ca(e.defaultValue);t!=null&&(t=""+t,t!==s.value&&(s.value=t),e.defaultValue==null&&s.defaultValue!==t&&(s.defaultValue=t)),n!=null&&(s.defaultValue=""+n)}function bx(s){var e=s.textContent;e===s._wrapperState.initialValue&&e!==""&&e!==null&&(s.value=e)}function US(s){switch(s){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function _v(s,e){return s==null||s==="http://www.w3.org/1999/xhtml"?US(e):s==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":s}var mg,zS=function(s){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,n,i){MSApp.execUnsafeLocalFunction(function(){return s(e,t,n,i)})}:s}(function(s,e){if(s.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in s)s.innerHTML=e;else{for(mg=mg||document.createElement("div"),mg.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=mg.firstChild;s.firstChild;)s.removeChild(s.firstChild);for(;e.firstChild;)s.appendChild(e.firstChild)}});function Bd(s,e){if(e){var t=s.firstChild;if(t&&t===s.lastChild&&t.nodeType===3){t.nodeValue=e;return}}s.textContent=e}var Cd={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},nP=["Webkit","ms","Moz","O"];Object.keys(Cd).forEach(function(s){nP.forEach(function(e){e=e+s.charAt(0).toUpperCase()+s.substring(1),Cd[e]=Cd[s]})});function HS(s,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||Cd.hasOwnProperty(s)&&Cd[s]?(""+e).trim():e+"px"}function VS(s,e){s=s.style;for(var t in e)if(e.hasOwnProperty(t)){var n=t.indexOf("--")===0,i=HS(t,e[t],n);t==="float"&&(t="cssFloat"),n?s.setProperty(t,i):s[t]=i}}var sP=tt({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function xv(s,e){if(e){if(sP[s]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error($(137,s));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error($(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error($(61))}if(e.style!=null&&typeof e.style!="object")throw Error($(62))}}function Av(s,e){if(s.indexOf("-")===-1)return typeof e.is=="string";switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Sv=null;function t_(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var Ev=null,Kc=null,Xc=null;function _x(s){if(s=eg(s)){if(typeof Ev!="function")throw Error($(280));var e=s.stateNode;e&&(e=qy(e),Ev(s.stateNode,s.type,e))}}function WS(s){Kc?Xc?Xc.push(s):Xc=[s]:Kc=s}function GS(){if(Kc){var s=Kc,e=Xc;if(Xc=Kc=null,_x(s),e)for(s=0;s<e.length;s++)_x(e[s])}}function qS(s,e){return s(e)}function KS(){}var _0=!1;function XS(s,e,t){if(_0)return s(e,t);_0=!0;try{return qS(s,e,t)}finally{_0=!1,(Kc!==null||Xc!==null)&&(KS(),GS())}}function $d(s,e){var t=s.stateNode;if(t===null)return null;var n=qy(t);if(n===null)return null;t=n[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(s=s.type,n=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!n;break e;default:s=!1}if(s)return null;if(t&&typeof t!="function")throw Error($(231,e,typeof t));return t}var Cv=!1;if(Hr)try{var Uh={};Object.defineProperty(Uh,"passive",{get:function(){Cv=!0}}),window.addEventListener("test",Uh,Uh),window.removeEventListener("test",Uh,Uh)}catch{Cv=!1}function iP(s,e,t,n,i,r,o,l,c){var u=Array.prototype.slice.call(arguments,3);try{e.apply(t,u)}catch(h){this.onError(h)}}var kd=!1,Bm=null,$m=!1,kv=null,rP={onError:function(s){kd=!0,Bm=s}};function oP(s,e,t,n,i,r,o,l,c){kd=!1,Bm=null,iP.apply(rP,arguments)}function aP(s,e,t,n,i,r,o,l,c){if(oP.apply(this,arguments),kd){if(kd){var u=Bm;kd=!1,Bm=null}else throw Error($(198));$m||($m=!0,kv=u)}}function ac(s){var e=s,t=s;if(s.alternate)for(;e.return;)e=e.return;else{s=e;do e=s,e.flags&4098&&(t=e.return),s=e.return;while(s)}return e.tag===3?t:null}function YS(s){if(s.tag===13){var e=s.memoizedState;if(e===null&&(s=s.alternate,s!==null&&(e=s.memoizedState)),e!==null)return e.dehydrated}return null}function xx(s){if(ac(s)!==s)throw Error($(188))}function lP(s){var e=s.alternate;if(!e){if(e=ac(s),e===null)throw Error($(188));return e!==s?null:s}for(var t=s,n=e;;){var i=t.return;if(i===null)break;var r=i.alternate;if(r===null){if(n=i.return,n!==null){t=n;continue}break}if(i.child===r.child){for(r=i.child;r;){if(r===t)return xx(i),s;if(r===n)return xx(i),e;r=r.sibling}throw Error($(188))}if(t.return!==n.return)t=i,n=r;else{for(var o=!1,l=i.child;l;){if(l===t){o=!0,t=i,n=r;break}if(l===n){o=!0,n=i,t=r;break}l=l.sibling}if(!o){for(l=r.child;l;){if(l===t){o=!0,t=r,n=i;break}if(l===n){o=!0,n=r,t=i;break}l=l.sibling}if(!o)throw Error($(189))}}if(t.alternate!==n)throw Error($(190))}if(t.tag!==3)throw Error($(188));return t.stateNode.current===t?s:e}function JS(s){return s=lP(s),s!==null?QS(s):null}function QS(s){if(s.tag===5||s.tag===6)return s;for(s=s.child;s!==null;){var e=QS(s);if(e!==null)return e;s=s.sibling}return null}var ZS=ds.unstable_scheduleCallback,Ax=ds.unstable_cancelCallback,cP=ds.unstable_shouldYield,uP=ds.unstable_requestPaint,ht=ds.unstable_now,hP=ds.unstable_getCurrentPriorityLevel,n_=ds.unstable_ImmediatePriority,e1=ds.unstable_UserBlockingPriority,Um=ds.unstable_NormalPriority,dP=ds.unstable_LowPriority,t1=ds.unstable_IdlePriority,Hy=null,zi=null;function fP(s){if(zi&&typeof zi.onCommitFiberRoot=="function")try{zi.onCommitFiberRoot(Hy,s,void 0,(s.current.flags&128)===128)}catch{}}var li=Math.clz32?Math.clz32:mP,pP=Math.log,gP=Math.LN2;function mP(s){return s>>>=0,s===0?32:31-(pP(s)/gP|0)|0}var yg=64,vg=4194304;function nd(s){switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return s&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return s}}function zm(s,e){var t=s.pendingLanes;if(t===0)return 0;var n=0,i=s.suspendedLanes,r=s.pingedLanes,o=t&268435455;if(o!==0){var l=o&~i;l!==0?n=nd(l):(r&=o,r!==0&&(n=nd(r)))}else o=t&~i,o!==0?n=nd(o):r!==0&&(n=nd(r));if(n===0)return 0;if(e!==0&&e!==n&&!(e&i)&&(i=n&-n,r=e&-e,i>=r||i===16&&(r&4194240)!==0))return e;if(n&4&&(n|=t&16),e=s.entangledLanes,e!==0)for(s=s.entanglements,e&=n;0<e;)t=31-li(e),i=1<<t,n|=s[t],e&=~i;return n}function yP(s,e){switch(s){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function vP(s,e){for(var t=s.suspendedLanes,n=s.pingedLanes,i=s.expirationTimes,r=s.pendingLanes;0<r;){var o=31-li(r),l=1<<o,c=i[o];c===-1?(!(l&t)||l&n)&&(i[o]=yP(l,e)):c<=e&&(s.expiredLanes|=l),r&=~l}}function Tv(s){return s=s.pendingLanes&-1073741825,s!==0?s:s&1073741824?1073741824:0}function n1(){var s=yg;return yg<<=1,!(yg&4194240)&&(yg=64),s}function x0(s){for(var e=[],t=0;31>t;t++)e.push(s);return e}function Qp(s,e,t){s.pendingLanes|=e,e!==536870912&&(s.suspendedLanes=0,s.pingedLanes=0),s=s.eventTimes,e=31-li(e),s[e]=t}function wP(s,e){var t=s.pendingLanes&~e;s.pendingLanes=e,s.suspendedLanes=0,s.pingedLanes=0,s.expiredLanes&=e,s.mutableReadLanes&=e,s.entangledLanes&=e,e=s.entanglements;var n=s.eventTimes;for(s=s.expirationTimes;0<t;){var i=31-li(t),r=1<<i;e[i]=0,n[i]=-1,s[i]=-1,t&=~r}}function s_(s,e){var t=s.entangledLanes|=e;for(s=s.entanglements;t;){var n=31-li(t),i=1<<n;i&e|s[n]&e&&(s[n]|=e),t&=~i}}var Ce=0;function s1(s){return s&=-s,1<s?4<s?s&268435455?16:536870912:4:1}var i1,i_,r1,o1,a1,Pv=!1,wg=[],ta=null,na=null,sa=null,Ud=new Map,zd=new Map,so=[],bP="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Sx(s,e){switch(s){case"focusin":case"focusout":ta=null;break;case"dragenter":case"dragleave":na=null;break;case"mouseover":case"mouseout":sa=null;break;case"pointerover":case"pointerout":Ud.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":zd.delete(e.pointerId)}}function zh(s,e,t,n,i,r){return s===null||s.nativeEvent!==r?(s={blockedOn:e,domEventName:t,eventSystemFlags:n,nativeEvent:r,targetContainers:[i]},e!==null&&(e=eg(e),e!==null&&i_(e)),s):(s.eventSystemFlags|=n,e=s.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),s)}function _P(s,e,t,n,i){switch(e){case"focusin":return ta=zh(ta,s,e,t,n,i),!0;case"dragenter":return na=zh(na,s,e,t,n,i),!0;case"mouseover":return sa=zh(sa,s,e,t,n,i),!0;case"pointerover":var r=i.pointerId;return Ud.set(r,zh(Ud.get(r)||null,s,e,t,n,i)),!0;case"gotpointercapture":return r=i.pointerId,zd.set(r,zh(zd.get(r)||null,s,e,t,n,i)),!0}return!1}function l1(s){var e=Ia(s.target);if(e!==null){var t=ac(e);if(t!==null){if(e=t.tag,e===13){if(e=YS(t),e!==null){s.blockedOn=e,a1(s.priority,function(){r1(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){s.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Kg(s){if(s.blockedOn!==null)return!1;for(var e=s.targetContainers;0<e.length;){var t=Rv(s.domEventName,s.eventSystemFlags,e[0],s.nativeEvent);if(t===null){t=s.nativeEvent;var n=new t.constructor(t.type,t);Sv=n,t.target.dispatchEvent(n),Sv=null}else return e=eg(t),e!==null&&i_(e),s.blockedOn=t,!1;e.shift()}return!0}function Ex(s,e,t){Kg(s)&&t.delete(e)}function xP(){Pv=!1,ta!==null&&Kg(ta)&&(ta=null),na!==null&&Kg(na)&&(na=null),sa!==null&&Kg(sa)&&(sa=null),Ud.forEach(Ex),zd.forEach(Ex)}function Hh(s,e){s.blockedOn===e&&(s.blockedOn=null,Pv||(Pv=!0,ds.unstable_scheduleCallback(ds.unstable_NormalPriority,xP)))}function Hd(s){function e(i){return Hh(i,s)}if(0<wg.length){Hh(wg[0],s);for(var t=1;t<wg.length;t++){var n=wg[t];n.blockedOn===s&&(n.blockedOn=null)}}for(ta!==null&&Hh(ta,s),na!==null&&Hh(na,s),sa!==null&&Hh(sa,s),Ud.forEach(e),zd.forEach(e),t=0;t<so.length;t++)n=so[t],n.blockedOn===s&&(n.blockedOn=null);for(;0<so.length&&(t=so[0],t.blockedOn===null);)l1(t),t.blockedOn===null&&so.shift()}var Yc=Xr.ReactCurrentBatchConfig,Hm=!0;function AP(s,e,t,n){var i=Ce,r=Yc.transition;Yc.transition=null;try{Ce=1,r_(s,e,t,n)}finally{Ce=i,Yc.transition=r}}function SP(s,e,t,n){var i=Ce,r=Yc.transition;Yc.transition=null;try{Ce=4,r_(s,e,t,n)}finally{Ce=i,Yc.transition=r}}function r_(s,e,t,n){if(Hm){var i=Rv(s,e,t,n);if(i===null)I0(s,e,n,Vm,t),Sx(s,n);else if(_P(i,s,e,t,n))n.stopPropagation();else if(Sx(s,n),e&4&&-1<bP.indexOf(s)){for(;i!==null;){var r=eg(i);if(r!==null&&i1(r),r=Rv(s,e,t,n),r===null&&I0(s,e,n,Vm,t),r===i)break;i=r}i!==null&&n.stopPropagation()}else I0(s,e,n,null,t)}}var Vm=null;function Rv(s,e,t,n){if(Vm=null,s=t_(n),s=Ia(s),s!==null)if(e=ac(s),e===null)s=null;else if(t=e.tag,t===13){if(s=YS(e),s!==null)return s;s=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;s=null}else e!==s&&(s=null);return Vm=s,null}function c1(s){switch(s){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(hP()){case n_:return 1;case e1:return 4;case Um:case dP:return 16;case t1:return 536870912;default:return 16}default:return 16}}var Zo=null,o_=null,Xg=null;function u1(){if(Xg)return Xg;var s,e=o_,t=e.length,n,i="value"in Zo?Zo.value:Zo.textContent,r=i.length;for(s=0;s<t&&e[s]===i[s];s++);var o=t-s;for(n=1;n<=o&&e[t-n]===i[r-n];n++);return Xg=i.slice(s,1<n?1-n:void 0)}function Yg(s){var e=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&e===13&&(s=13)):s=e,s===10&&(s=13),32<=s||s===13?s:0}function bg(){return!0}function Cx(){return!1}function ps(s){function e(t,n,i,r,o){this._reactName=t,this._targetInst=i,this.type=n,this.nativeEvent=r,this.target=o,this.currentTarget=null;for(var l in s)s.hasOwnProperty(l)&&(t=s[l],this[l]=t?t(r):r[l]);return this.isDefaultPrevented=(r.defaultPrevented!=null?r.defaultPrevented:r.returnValue===!1)?bg:Cx,this.isPropagationStopped=Cx,this}return tt(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=bg)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=bg)},persist:function(){},isPersistent:bg}),e}var Lh={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},a_=ps(Lh),Zp=tt({},Lh,{view:0,detail:0}),EP=ps(Zp),A0,S0,Vh,Vy=tt({},Zp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:l_,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Vh&&(Vh&&s.type==="mousemove"?(A0=s.screenX-Vh.screenX,S0=s.screenY-Vh.screenY):S0=A0=0,Vh=s),A0)},movementY:function(s){return"movementY"in s?s.movementY:S0}}),kx=ps(Vy),CP=tt({},Vy,{dataTransfer:0}),kP=ps(CP),TP=tt({},Zp,{relatedTarget:0}),E0=ps(TP),PP=tt({},Lh,{animationName:0,elapsedTime:0,pseudoElement:0}),RP=ps(PP),NP=tt({},Lh,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),IP=ps(NP),DP=tt({},Lh,{data:0}),Tx=ps(DP),OP={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},LP={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},MP={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function FP(s){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(s):(s=MP[s])?!!e[s]:!1}function l_(){return FP}var jP=tt({},Zp,{key:function(s){if(s.key){var e=OP[s.key]||s.key;if(e!=="Unidentified")return e}return s.type==="keypress"?(s=Yg(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?LP[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:l_,charCode:function(s){return s.type==="keypress"?Yg(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?Yg(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),BP=ps(jP),$P=tt({},Vy,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Px=ps($P),UP=tt({},Zp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:l_}),zP=ps(UP),HP=tt({},Lh,{propertyName:0,elapsedTime:0,pseudoElement:0}),VP=ps(HP),WP=tt({},Vy,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),GP=ps(WP),qP=[9,13,27,32],c_=Hr&&"CompositionEvent"in window,Td=null;Hr&&"documentMode"in document&&(Td=document.documentMode);var KP=Hr&&"TextEvent"in window&&!Td,h1=Hr&&(!c_||Td&&8<Td&&11>=Td),Rx=" ",Nx=!1;function d1(s,e){switch(s){case"keyup":return qP.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function f1(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Nc=!1;function XP(s,e){switch(s){case"compositionend":return f1(e);case"keypress":return e.which!==32?null:(Nx=!0,Rx);case"textInput":return s=e.data,s===Rx&&Nx?null:s;default:return null}}function YP(s,e){if(Nc)return s==="compositionend"||!c_&&d1(s,e)?(s=u1(),Xg=o_=Zo=null,Nc=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return h1&&e.locale!=="ko"?null:e.data;default:return null}}var JP={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Ix(s){var e=s&&s.nodeName&&s.nodeName.toLowerCase();return e==="input"?!!JP[s.type]:e==="textarea"}function p1(s,e,t,n){WS(n),e=Wm(e,"onChange"),0<e.length&&(t=new a_("onChange","change",null,t,n),s.push({event:t,listeners:e}))}var Pd=null,Vd=null;function QP(s){E1(s,0)}function Wy(s){var e=Oc(s);if(jS(e))return s}function ZP(s,e){if(s==="change")return e}var g1=!1;if(Hr){var C0;if(Hr){var k0="oninput"in document;if(!k0){var Dx=document.createElement("div");Dx.setAttribute("oninput","return;"),k0=typeof Dx.oninput=="function"}C0=k0}else C0=!1;g1=C0&&(!document.documentMode||9<document.documentMode)}function Ox(){Pd&&(Pd.detachEvent("onpropertychange",m1),Vd=Pd=null)}function m1(s){if(s.propertyName==="value"&&Wy(Vd)){var e=[];p1(e,Vd,s,t_(s)),XS(QP,e)}}function eR(s,e,t){s==="focusin"?(Ox(),Pd=e,Vd=t,Pd.attachEvent("onpropertychange",m1)):s==="focusout"&&Ox()}function tR(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return Wy(Vd)}function nR(s,e){if(s==="click")return Wy(e)}function sR(s,e){if(s==="input"||s==="change")return Wy(e)}function iR(s,e){return s===e&&(s!==0||1/s===1/e)||s!==s&&e!==e}var ui=typeof Object.is=="function"?Object.is:iR;function Wd(s,e){if(ui(s,e))return!0;if(typeof s!="object"||s===null||typeof e!="object"||e===null)return!1;var t=Object.keys(s),n=Object.keys(e);if(t.length!==n.length)return!1;for(n=0;n<t.length;n++){var i=t[n];if(!dv.call(e,i)||!ui(s[i],e[i]))return!1}return!0}function Lx(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function Mx(s,e){var t=Lx(s);s=0;for(var n;t;){if(t.nodeType===3){if(n=s+t.textContent.length,s<=e&&n>=e)return{node:t,offset:e-s};s=n}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Lx(t)}}function y1(s,e){return s&&e?s===e?!0:s&&s.nodeType===3?!1:e&&e.nodeType===3?y1(s,e.parentNode):"contains"in s?s.contains(e):s.compareDocumentPosition?!!(s.compareDocumentPosition(e)&16):!1:!1}function v1(){for(var s=window,e=jm();e instanceof s.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)s=e.contentWindow;else break;e=jm(s.document)}return e}function u_(s){var e=s&&s.nodeName&&s.nodeName.toLowerCase();return e&&(e==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||e==="textarea"||s.contentEditable==="true")}function rR(s){var e=v1(),t=s.focusedElem,n=s.selectionRange;if(e!==t&&t&&t.ownerDocument&&y1(t.ownerDocument.documentElement,t)){if(n!==null&&u_(t)){if(e=n.start,s=n.end,s===void 0&&(s=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(s,t.value.length);else if(s=(e=t.ownerDocument||document)&&e.defaultView||window,s.getSelection){s=s.getSelection();var i=t.textContent.length,r=Math.min(n.start,i);n=n.end===void 0?r:Math.min(n.end,i),!s.extend&&r>n&&(i=n,n=r,r=i),i=Mx(t,r);var o=Mx(t,n);i&&o&&(s.rangeCount!==1||s.anchorNode!==i.node||s.anchorOffset!==i.offset||s.focusNode!==o.node||s.focusOffset!==o.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),s.removeAllRanges(),r>n?(s.addRange(e),s.extend(o.node,o.offset)):(e.setEnd(o.node,o.offset),s.addRange(e)))}}for(e=[],s=t;s=s.parentNode;)s.nodeType===1&&e.push({element:s,left:s.scrollLeft,top:s.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)s=e[t],s.element.scrollLeft=s.left,s.element.scrollTop=s.top}}var oR=Hr&&"documentMode"in document&&11>=document.documentMode,Ic=null,Nv=null,Rd=null,Iv=!1;function Fx(s,e,t){var n=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;Iv||Ic==null||Ic!==jm(n)||(n=Ic,"selectionStart"in n&&u_(n)?n={start:n.selectionStart,end:n.selectionEnd}:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection(),n={anchorNode:n.anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset}),Rd&&Wd(Rd,n)||(Rd=n,n=Wm(Nv,"onSelect"),0<n.length&&(e=new a_("onSelect","select",null,e,t),s.push({event:e,listeners:n}),e.target=Ic)))}function _g(s,e){var t={};return t[s.toLowerCase()]=e.toLowerCase(),t["Webkit"+s]="webkit"+e,t["Moz"+s]="moz"+e,t}var Dc={animationend:_g("Animation","AnimationEnd"),animationiteration:_g("Animation","AnimationIteration"),animationstart:_g("Animation","AnimationStart"),transitionend:_g("Transition","TransitionEnd")},T0={},w1={};Hr&&(w1=document.createElement("div").style,"AnimationEvent"in window||(delete Dc.animationend.animation,delete Dc.animationiteration.animation,delete Dc.animationstart.animation),"TransitionEvent"in window||delete Dc.transitionend.transition);function Gy(s){if(T0[s])return T0[s];if(!Dc[s])return s;var e=Dc[s],t;for(t in e)if(e.hasOwnProperty(t)&&t in w1)return T0[s]=e[t];return s}var b1=Gy("animationend"),_1=Gy("animationiteration"),x1=Gy("animationstart"),A1=Gy("transitionend"),S1=new Map,jx="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function pa(s,e){S1.set(s,e),oc(e,[s])}for(var P0=0;P0<jx.length;P0++){var R0=jx[P0],aR=R0.toLowerCase(),lR=R0[0].toUpperCase()+R0.slice(1);pa(aR,"on"+lR)}pa(b1,"onAnimationEnd");pa(_1,"onAnimationIteration");pa(x1,"onAnimationStart");pa("dblclick","onDoubleClick");pa("focusin","onFocus");pa("focusout","onBlur");pa(A1,"onTransitionEnd");Ch("onMouseEnter",["mouseout","mouseover"]);Ch("onMouseLeave",["mouseout","mouseover"]);Ch("onPointerEnter",["pointerout","pointerover"]);Ch("onPointerLeave",["pointerout","pointerover"]);oc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));oc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));oc("onBeforeInput",["compositionend","keypress","textInput","paste"]);oc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));oc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));oc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var sd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),cR=new Set("cancel close invalid load scroll toggle".split(" ").concat(sd));function Bx(s,e,t){var n=s.type||"unknown-event";s.currentTarget=t,aP(n,e,void 0,s),s.currentTarget=null}function E1(s,e){e=(e&4)!==0;for(var t=0;t<s.length;t++){var n=s[t],i=n.event;n=n.listeners;e:{var r=void 0;if(e)for(var o=n.length-1;0<=o;o--){var l=n[o],c=l.instance,u=l.currentTarget;if(l=l.listener,c!==r&&i.isPropagationStopped())break e;Bx(i,l,u),r=c}else for(o=0;o<n.length;o++){if(l=n[o],c=l.instance,u=l.currentTarget,l=l.listener,c!==r&&i.isPropagationStopped())break e;Bx(i,l,u),r=c}}}if($m)throw s=kv,$m=!1,kv=null,s}function ze(s,e){var t=e[Fv];t===void 0&&(t=e[Fv]=new Set);var n=s+"__bubble";t.has(n)||(C1(e,s,2,!1),t.add(n))}function N0(s,e,t){var n=0;e&&(n|=4),C1(t,s,n,e)}var xg="_reactListening"+Math.random().toString(36).slice(2);function Gd(s){if(!s[xg]){s[xg]=!0,DS.forEach(function(t){t!=="selectionchange"&&(cR.has(t)||N0(t,!1,s),N0(t,!0,s))});var e=s.nodeType===9?s:s.ownerDocument;e===null||e[xg]||(e[xg]=!0,N0("selectionchange",!1,e))}}function C1(s,e,t,n){switch(c1(e)){case 1:var i=AP;break;case 4:i=SP;break;default:i=r_}t=i.bind(null,e,t,s),i=void 0,!Cv||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),n?i!==void 0?s.addEventListener(e,t,{capture:!0,passive:i}):s.addEventListener(e,t,!0):i!==void 0?s.addEventListener(e,t,{passive:i}):s.addEventListener(e,t,!1)}function I0(s,e,t,n,i){var r=n;if(!(e&1)&&!(e&2)&&n!==null)e:for(;;){if(n===null)return;var o=n.tag;if(o===3||o===4){var l=n.stateNode.containerInfo;if(l===i||l.nodeType===8&&l.parentNode===i)break;if(o===4)for(o=n.return;o!==null;){var c=o.tag;if((c===3||c===4)&&(c=o.stateNode.containerInfo,c===i||c.nodeType===8&&c.parentNode===i))return;o=o.return}for(;l!==null;){if(o=Ia(l),o===null)return;if(c=o.tag,c===5||c===6){n=r=o;continue e}l=l.parentNode}}n=n.return}XS(function(){var u=r,h=t_(t),d=[];e:{var f=S1.get(s);if(f!==void 0){var p=a_,y=s;switch(s){case"keypress":if(Yg(t)===0)break e;case"keydown":case"keyup":p=BP;break;case"focusin":y="focus",p=E0;break;case"focusout":y="blur",p=E0;break;case"beforeblur":case"afterblur":p=E0;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":p=kx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":p=kP;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":p=zP;break;case b1:case _1:case x1:p=RP;break;case A1:p=VP;break;case"scroll":p=EP;break;case"wheel":p=GP;break;case"copy":case"cut":case"paste":p=IP;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":p=Px}var _=(e&4)!==0,A=!_&&s==="scroll",m=_?f!==null?f+"Capture":null:f;_=[];for(var b=u,v;b!==null;){v=b;var S=v.stateNode;if(v.tag===5&&S!==null&&(v=S,m!==null&&(S=$d(b,m),S!=null&&_.push(qd(b,S,v)))),A)break;b=b.return}0<_.length&&(f=new p(f,y,null,t,h),d.push({event:f,listeners:_}))}}if(!(e&7)){e:{if(f=s==="mouseover"||s==="pointerover",p=s==="mouseout"||s==="pointerout",f&&t!==Sv&&(y=t.relatedTarget||t.fromElement)&&(Ia(y)||y[Vr]))break e;if((p||f)&&(f=h.window===h?h:(f=h.ownerDocument)?f.defaultView||f.parentWindow:window,p?(y=t.relatedTarget||t.toElement,p=u,y=y?Ia(y):null,y!==null&&(A=ac(y),y!==A||y.tag!==5&&y.tag!==6)&&(y=null)):(p=null,y=u),p!==y)){if(_=kx,S="onMouseLeave",m="onMouseEnter",b="mouse",(s==="pointerout"||s==="pointerover")&&(_=Px,S="onPointerLeave",m="onPointerEnter",b="pointer"),A=p==null?f:Oc(p),v=y==null?f:Oc(y),f=new _(S,b+"leave",p,t,h),f.target=A,f.relatedTarget=v,S=null,Ia(h)===u&&(_=new _(m,b+"enter",y,t,h),_.target=v,_.relatedTarget=A,S=_),A=S,p&&y)t:{for(_=p,m=y,b=0,v=_;v;v=hc(v))b++;for(v=0,S=m;S;S=hc(S))v++;for(;0<b-v;)_=hc(_),b--;for(;0<v-b;)m=hc(m),v--;for(;b--;){if(_===m||m!==null&&_===m.alternate)break t;_=hc(_),m=hc(m)}_=null}else _=null;p!==null&&$x(d,f,p,_,!1),y!==null&&A!==null&&$x(d,A,y,_,!0)}}e:{if(f=u?Oc(u):window,p=f.nodeName&&f.nodeName.toLowerCase(),p==="select"||p==="input"&&f.type==="file")var C=ZP;else if(Ix(f))if(g1)C=sR;else{C=tR;var k=eR}else(p=f.nodeName)&&p.toLowerCase()==="input"&&(f.type==="checkbox"||f.type==="radio")&&(C=nR);if(C&&(C=C(s,u))){p1(d,C,t,h);break e}k&&k(s,f,u),s==="focusout"&&(k=f._wrapperState)&&k.controlled&&f.type==="number"&&wv(f,"number",f.value)}switch(k=u?Oc(u):window,s){case"focusin":(Ix(k)||k.contentEditable==="true")&&(Ic=k,Nv=u,Rd=null);break;case"focusout":Rd=Nv=Ic=null;break;case"mousedown":Iv=!0;break;case"contextmenu":case"mouseup":case"dragend":Iv=!1,Fx(d,t,h);break;case"selectionchange":if(oR)break;case"keydown":case"keyup":Fx(d,t,h)}var T;if(c_)e:{switch(s){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else Nc?d1(s,t)&&(I="onCompositionEnd"):s==="keydown"&&t.keyCode===229&&(I="onCompositionStart");I&&(h1&&t.locale!=="ko"&&(Nc||I!=="onCompositionStart"?I==="onCompositionEnd"&&Nc&&(T=u1()):(Zo=h,o_="value"in Zo?Zo.value:Zo.textContent,Nc=!0)),k=Wm(u,I),0<k.length&&(I=new Tx(I,s,null,t,h),d.push({event:I,listeners:k}),T?I.data=T:(T=f1(t),T!==null&&(I.data=T)))),(T=KP?XP(s,t):YP(s,t))&&(u=Wm(u,"onBeforeInput"),0<u.length&&(h=new Tx("onBeforeInput","beforeinput",null,t,h),d.push({event:h,listeners:u}),h.data=T))}E1(d,e)})}function qd(s,e,t){return{instance:s,listener:e,currentTarget:t}}function Wm(s,e){for(var t=e+"Capture",n=[];s!==null;){var i=s,r=i.stateNode;i.tag===5&&r!==null&&(i=r,r=$d(s,t),r!=null&&n.unshift(qd(s,r,i)),r=$d(s,e),r!=null&&n.push(qd(s,r,i))),s=s.return}return n}function hc(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5);return s||null}function $x(s,e,t,n,i){for(var r=e._reactName,o=[];t!==null&&t!==n;){var l=t,c=l.alternate,u=l.stateNode;if(c!==null&&c===n)break;l.tag===5&&u!==null&&(l=u,i?(c=$d(t,r),c!=null&&o.unshift(qd(t,c,l))):i||(c=$d(t,r),c!=null&&o.push(qd(t,c,l)))),t=t.return}o.length!==0&&s.push({event:e,listeners:o})}var uR=/\r\n?/g,hR=/\u0000|\uFFFD/g;function Ux(s){return(typeof s=="string"?s:""+s).replace(uR,`
`).replace(hR,"")}function Ag(s,e,t){if(e=Ux(e),Ux(s)!==e&&t)throw Error($(425))}function Gm(){}var Dv=null,Ov=null;function Lv(s,e){return s==="textarea"||s==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Mv=typeof setTimeout=="function"?setTimeout:void 0,dR=typeof clearTimeout=="function"?clearTimeout:void 0,zx=typeof Promise=="function"?Promise:void 0,fR=typeof queueMicrotask=="function"?queueMicrotask:typeof zx<"u"?function(s){return zx.resolve(null).then(s).catch(pR)}:Mv;function pR(s){setTimeout(function(){throw s})}function D0(s,e){var t=e,n=0;do{var i=t.nextSibling;if(s.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(n===0){s.removeChild(i),Hd(e);return}n--}else t!=="$"&&t!=="$?"&&t!=="$!"||n++;t=i}while(t);Hd(e)}function ia(s){for(;s!=null;s=s.nextSibling){var e=s.nodeType;if(e===1||e===3)break;if(e===8){if(e=s.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return s}function Hx(s){s=s.previousSibling;for(var e=0;s;){if(s.nodeType===8){var t=s.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return s;e--}else t==="/$"&&e++}s=s.previousSibling}return null}var Mh=Math.random().toString(36).slice(2),Ui="__reactFiber$"+Mh,Kd="__reactProps$"+Mh,Vr="__reactContainer$"+Mh,Fv="__reactEvents$"+Mh,gR="__reactListeners$"+Mh,mR="__reactHandles$"+Mh;function Ia(s){var e=s[Ui];if(e)return e;for(var t=s.parentNode;t;){if(e=t[Vr]||t[Ui]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(s=Hx(s);s!==null;){if(t=s[Ui])return t;s=Hx(s)}return e}s=t,t=s.parentNode}return null}function eg(s){return s=s[Ui]||s[Vr],!s||s.tag!==5&&s.tag!==6&&s.tag!==13&&s.tag!==3?null:s}function Oc(s){if(s.tag===5||s.tag===6)return s.stateNode;throw Error($(33))}function qy(s){return s[Kd]||null}var jv=[],Lc=-1;function ga(s){return{current:s}}function Ve(s){0>Lc||(s.current=jv[Lc],jv[Lc]=null,Lc--)}function $e(s,e){Lc++,jv[Lc]=s.current,s.current=e}var ua={},an=ga(ua),Fn=ga(!1),Ql=ua;function kh(s,e){var t=s.type.contextTypes;if(!t)return ua;var n=s.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===e)return n.__reactInternalMemoizedMaskedChildContext;var i={},r;for(r in t)i[r]=e[r];return n&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=e,s.__reactInternalMemoizedMaskedChildContext=i),i}function jn(s){return s=s.childContextTypes,s!=null}function qm(){Ve(Fn),Ve(an)}function Vx(s,e,t){if(an.current!==ua)throw Error($(168));$e(an,e),$e(Fn,t)}function k1(s,e,t){var n=s.stateNode;if(e=e.childContextTypes,typeof n.getChildContext!="function")return t;n=n.getChildContext();for(var i in n)if(!(i in e))throw Error($(108,eP(s)||"Unknown",i));return tt({},t,n)}function Km(s){return s=(s=s.stateNode)&&s.__reactInternalMemoizedMergedChildContext||ua,Ql=an.current,$e(an,s),$e(Fn,Fn.current),!0}function Wx(s,e,t){var n=s.stateNode;if(!n)throw Error($(169));t?(s=k1(s,e,Ql),n.__reactInternalMemoizedMergedChildContext=s,Ve(Fn),Ve(an),$e(an,s)):Ve(Fn),$e(Fn,t)}var tr=null,Ky=!1,O0=!1;function T1(s){tr===null?tr=[s]:tr.push(s)}function yR(s){Ky=!0,T1(s)}function ma(){if(!O0&&tr!==null){O0=!0;var s=0,e=Ce;try{var t=tr;for(Ce=1;s<t.length;s++){var n=t[s];do n=n(!0);while(n!==null)}tr=null,Ky=!1}catch(i){throw tr!==null&&(tr=tr.slice(s+1)),ZS(n_,ma),i}finally{Ce=e,O0=!1}}return null}var Mc=[],Fc=0,Xm=null,Ym=0,Ps=[],Rs=0,Zl=null,Fr=1,jr="";function xa(s,e){Mc[Fc++]=Ym,Mc[Fc++]=Xm,Xm=s,Ym=e}function P1(s,e,t){Ps[Rs++]=Fr,Ps[Rs++]=jr,Ps[Rs++]=Zl,Zl=s;var n=Fr;s=jr;var i=32-li(n)-1;n&=~(1<<i),t+=1;var r=32-li(e)+i;if(30<r){var o=i-i%5;r=(n&(1<<o)-1).toString(32),n>>=o,i-=o,Fr=1<<32-li(e)+i|t<<i|n,jr=r+s}else Fr=1<<r|t<<i|n,jr=s}function h_(s){s.return!==null&&(xa(s,1),P1(s,1,0))}function d_(s){for(;s===Xm;)Xm=Mc[--Fc],Mc[Fc]=null,Ym=Mc[--Fc],Mc[Fc]=null;for(;s===Zl;)Zl=Ps[--Rs],Ps[Rs]=null,jr=Ps[--Rs],Ps[Rs]=null,Fr=Ps[--Rs],Ps[Rs]=null}var us=null,cs=null,Ke=!1,ri=null;function R1(s,e){var t=Is(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=s,e=s.deletions,e===null?(s.deletions=[t],s.flags|=16):e.push(t)}function Gx(s,e){switch(s.tag){case 5:var t=s.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(s.stateNode=e,us=s,cs=ia(e.firstChild),!0):!1;case 6:return e=s.pendingProps===""||e.nodeType!==3?null:e,e!==null?(s.stateNode=e,us=s,cs=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Zl!==null?{id:Fr,overflow:jr}:null,s.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Is(18,null,null,0),t.stateNode=e,t.return=s,s.child=t,us=s,cs=null,!0):!1;default:return!1}}function Bv(s){return(s.mode&1)!==0&&(s.flags&128)===0}function $v(s){if(Ke){var e=cs;if(e){var t=e;if(!Gx(s,e)){if(Bv(s))throw Error($(418));e=ia(t.nextSibling);var n=us;e&&Gx(s,e)?R1(n,t):(s.flags=s.flags&-4097|2,Ke=!1,us=s)}}else{if(Bv(s))throw Error($(418));s.flags=s.flags&-4097|2,Ke=!1,us=s}}}function qx(s){for(s=s.return;s!==null&&s.tag!==5&&s.tag!==3&&s.tag!==13;)s=s.return;us=s}function Sg(s){if(s!==us)return!1;if(!Ke)return qx(s),Ke=!0,!1;var e;if((e=s.tag!==3)&&!(e=s.tag!==5)&&(e=s.type,e=e!=="head"&&e!=="body"&&!Lv(s.type,s.memoizedProps)),e&&(e=cs)){if(Bv(s))throw N1(),Error($(418));for(;e;)R1(s,e),e=ia(e.nextSibling)}if(qx(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error($(317));e:{for(s=s.nextSibling,e=0;s;){if(s.nodeType===8){var t=s.data;if(t==="/$"){if(e===0){cs=ia(s.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}s=s.nextSibling}cs=null}}else cs=us?ia(s.stateNode.nextSibling):null;return!0}function N1(){for(var s=cs;s;)s=ia(s.nextSibling)}function Th(){cs=us=null,Ke=!1}function f_(s){ri===null?ri=[s]:ri.push(s)}var vR=Xr.ReactCurrentBatchConfig;function Wh(s,e,t){if(s=t.ref,s!==null&&typeof s!="function"&&typeof s!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error($(309));var n=t.stateNode}if(!n)throw Error($(147,s));var i=n,r=""+s;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===r?e.ref:(e=function(o){var l=i.refs;o===null?delete l[r]:l[r]=o},e._stringRef=r,e)}if(typeof s!="string")throw Error($(284));if(!t._owner)throw Error($(290,s))}return s}function Eg(s,e){throw s=Object.prototype.toString.call(e),Error($(31,s==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":s))}function Kx(s){var e=s._init;return e(s._payload)}function I1(s){function e(m,b){if(s){var v=m.deletions;v===null?(m.deletions=[b],m.flags|=16):v.push(b)}}function t(m,b){if(!s)return null;for(;b!==null;)e(m,b),b=b.sibling;return null}function n(m,b){for(m=new Map;b!==null;)b.key!==null?m.set(b.key,b):m.set(b.index,b),b=b.sibling;return m}function i(m,b){return m=la(m,b),m.index=0,m.sibling=null,m}function r(m,b,v){return m.index=v,s?(v=m.alternate,v!==null?(v=v.index,v<b?(m.flags|=2,b):v):(m.flags|=2,b)):(m.flags|=1048576,b)}function o(m){return s&&m.alternate===null&&(m.flags|=2),m}function l(m,b,v,S){return b===null||b.tag!==6?(b=U0(v,m.mode,S),b.return=m,b):(b=i(b,v),b.return=m,b)}function c(m,b,v,S){var C=v.type;return C===Rc?h(m,b,v.props.children,S,v.key):b!==null&&(b.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===eo&&Kx(C)===b.type)?(S=i(b,v.props),S.ref=Wh(m,b,v),S.return=m,S):(S=sm(v.type,v.key,v.props,null,m.mode,S),S.ref=Wh(m,b,v),S.return=m,S)}function u(m,b,v,S){return b===null||b.tag!==4||b.stateNode.containerInfo!==v.containerInfo||b.stateNode.implementation!==v.implementation?(b=z0(v,m.mode,S),b.return=m,b):(b=i(b,v.children||[]),b.return=m,b)}function h(m,b,v,S,C){return b===null||b.tag!==7?(b=Jl(v,m.mode,S,C),b.return=m,b):(b=i(b,v),b.return=m,b)}function d(m,b,v){if(typeof b=="string"&&b!==""||typeof b=="number")return b=U0(""+b,m.mode,v),b.return=m,b;if(typeof b=="object"&&b!==null){switch(b.$$typeof){case pg:return v=sm(b.type,b.key,b.props,null,m.mode,v),v.ref=Wh(m,null,b),v.return=m,v;case Pc:return b=z0(b,m.mode,v),b.return=m,b;case eo:var S=b._init;return d(m,S(b._payload),v)}if(td(b)||$h(b))return b=Jl(b,m.mode,v,null),b.return=m,b;Eg(m,b)}return null}function f(m,b,v,S){var C=b!==null?b.key:null;if(typeof v=="string"&&v!==""||typeof v=="number")return C!==null?null:l(m,b,""+v,S);if(typeof v=="object"&&v!==null){switch(v.$$typeof){case pg:return v.key===C?c(m,b,v,S):null;case Pc:return v.key===C?u(m,b,v,S):null;case eo:return C=v._init,f(m,b,C(v._payload),S)}if(td(v)||$h(v))return C!==null?null:h(m,b,v,S,null);Eg(m,v)}return null}function p(m,b,v,S,C){if(typeof S=="string"&&S!==""||typeof S=="number")return m=m.get(v)||null,l(b,m,""+S,C);if(typeof S=="object"&&S!==null){switch(S.$$typeof){case pg:return m=m.get(S.key===null?v:S.key)||null,c(b,m,S,C);case Pc:return m=m.get(S.key===null?v:S.key)||null,u(b,m,S,C);case eo:var k=S._init;return p(m,b,v,k(S._payload),C)}if(td(S)||$h(S))return m=m.get(v)||null,h(b,m,S,C,null);Eg(b,S)}return null}function y(m,b,v,S){for(var C=null,k=null,T=b,I=b=0,O=null;T!==null&&I<v.length;I++){T.index>I?(O=T,T=null):O=T.sibling;var L=f(m,T,v[I],S);if(L===null){T===null&&(T=O);break}s&&T&&L.alternate===null&&e(m,T),b=r(L,b,I),k===null?C=L:k.sibling=L,k=L,T=O}if(I===v.length)return t(m,T),Ke&&xa(m,I),C;if(T===null){for(;I<v.length;I++)T=d(m,v[I],S),T!==null&&(b=r(T,b,I),k===null?C=T:k.sibling=T,k=T);return Ke&&xa(m,I),C}for(T=n(m,T);I<v.length;I++)O=p(T,m,I,v[I],S),O!==null&&(s&&O.alternate!==null&&T.delete(O.key===null?I:O.key),b=r(O,b,I),k===null?C=O:k.sibling=O,k=O);return s&&T.forEach(function(j){return e(m,j)}),Ke&&xa(m,I),C}function _(m,b,v,S){var C=$h(v);if(typeof C!="function")throw Error($(150));if(v=C.call(v),v==null)throw Error($(151));for(var k=C=null,T=b,I=b=0,O=null,L=v.next();T!==null&&!L.done;I++,L=v.next()){T.index>I?(O=T,T=null):O=T.sibling;var j=f(m,T,L.value,S);if(j===null){T===null&&(T=O);break}s&&T&&j.alternate===null&&e(m,T),b=r(j,b,I),k===null?C=j:k.sibling=j,k=j,T=O}if(L.done)return t(m,T),Ke&&xa(m,I),C;if(T===null){for(;!L.done;I++,L=v.next())L=d(m,L.value,S),L!==null&&(b=r(L,b,I),k===null?C=L:k.sibling=L,k=L);return Ke&&xa(m,I),C}for(T=n(m,T);!L.done;I++,L=v.next())L=p(T,m,I,L.value,S),L!==null&&(s&&L.alternate!==null&&T.delete(L.key===null?I:L.key),b=r(L,b,I),k===null?C=L:k.sibling=L,k=L);return s&&T.forEach(function(H){return e(m,H)}),Ke&&xa(m,I),C}function A(m,b,v,S){if(typeof v=="object"&&v!==null&&v.type===Rc&&v.key===null&&(v=v.props.children),typeof v=="object"&&v!==null){switch(v.$$typeof){case pg:e:{for(var C=v.key,k=b;k!==null;){if(k.key===C){if(C=v.type,C===Rc){if(k.tag===7){t(m,k.sibling),b=i(k,v.props.children),b.return=m,m=b;break e}}else if(k.elementType===C||typeof C=="object"&&C!==null&&C.$$typeof===eo&&Kx(C)===k.type){t(m,k.sibling),b=i(k,v.props),b.ref=Wh(m,k,v),b.return=m,m=b;break e}t(m,k);break}else e(m,k);k=k.sibling}v.type===Rc?(b=Jl(v.props.children,m.mode,S,v.key),b.return=m,m=b):(S=sm(v.type,v.key,v.props,null,m.mode,S),S.ref=Wh(m,b,v),S.return=m,m=S)}return o(m);case Pc:e:{for(k=v.key;b!==null;){if(b.key===k)if(b.tag===4&&b.stateNode.containerInfo===v.containerInfo&&b.stateNode.implementation===v.implementation){t(m,b.sibling),b=i(b,v.children||[]),b.return=m,m=b;break e}else{t(m,b);break}else e(m,b);b=b.sibling}b=z0(v,m.mode,S),b.return=m,m=b}return o(m);case eo:return k=v._init,A(m,b,k(v._payload),S)}if(td(v))return y(m,b,v,S);if($h(v))return _(m,b,v,S);Eg(m,v)}return typeof v=="string"&&v!==""||typeof v=="number"?(v=""+v,b!==null&&b.tag===6?(t(m,b.sibling),b=i(b,v),b.return=m,m=b):(t(m,b),b=U0(v,m.mode,S),b.return=m,m=b),o(m)):t(m,b)}return A}var Ph=I1(!0),D1=I1(!1),Jm=ga(null),Qm=null,jc=null,p_=null;function g_(){p_=jc=Qm=null}function m_(s){var e=Jm.current;Ve(Jm),s._currentValue=e}function Uv(s,e,t){for(;s!==null;){var n=s.alternate;if((s.childLanes&e)!==e?(s.childLanes|=e,n!==null&&(n.childLanes|=e)):n!==null&&(n.childLanes&e)!==e&&(n.childLanes|=e),s===t)break;s=s.return}}function Jc(s,e){Qm=s,p_=jc=null,s=s.dependencies,s!==null&&s.firstContext!==null&&(s.lanes&e&&(Mn=!0),s.firstContext=null)}function Ms(s){var e=s._currentValue;if(p_!==s)if(s={context:s,memoizedValue:e,next:null},jc===null){if(Qm===null)throw Error($(308));jc=s,Qm.dependencies={lanes:0,firstContext:s}}else jc=jc.next=s;return e}var Da=null;function y_(s){Da===null?Da=[s]:Da.push(s)}function O1(s,e,t,n){var i=e.interleaved;return i===null?(t.next=t,y_(e)):(t.next=i.next,i.next=t),e.interleaved=t,Wr(s,n)}function Wr(s,e){s.lanes|=e;var t=s.alternate;for(t!==null&&(t.lanes|=e),t=s,s=s.return;s!==null;)s.childLanes|=e,t=s.alternate,t!==null&&(t.childLanes|=e),t=s,s=s.return;return t.tag===3?t.stateNode:null}var to=!1;function v_(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function L1(s,e){s=s.updateQueue,e.updateQueue===s&&(e.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,effects:s.effects})}function Br(s,e){return{eventTime:s,lane:e,tag:0,payload:null,callback:null,next:null}}function ra(s,e,t){var n=s.updateQueue;if(n===null)return null;if(n=n.shared,ye&2){var i=n.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),n.pending=e,Wr(s,t)}return i=n.interleaved,i===null?(e.next=e,y_(n)):(e.next=i.next,i.next=e),n.interleaved=e,Wr(s,t)}function Jg(s,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var n=e.lanes;n&=s.pendingLanes,t|=n,e.lanes=t,s_(s,t)}}function Xx(s,e){var t=s.updateQueue,n=s.alternate;if(n!==null&&(n=n.updateQueue,t===n)){var i=null,r=null;if(t=t.firstBaseUpdate,t!==null){do{var o={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};r===null?i=r=o:r=r.next=o,t=t.next}while(t!==null);r===null?i=r=e:r=r.next=e}else i=r=e;t={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:r,shared:n.shared,effects:n.effects},s.updateQueue=t;return}s=t.lastBaseUpdate,s===null?t.firstBaseUpdate=e:s.next=e,t.lastBaseUpdate=e}function Zm(s,e,t,n){var i=s.updateQueue;to=!1;var r=i.firstBaseUpdate,o=i.lastBaseUpdate,l=i.shared.pending;if(l!==null){i.shared.pending=null;var c=l,u=c.next;c.next=null,o===null?r=u:o.next=u,o=c;var h=s.alternate;h!==null&&(h=h.updateQueue,l=h.lastBaseUpdate,l!==o&&(l===null?h.firstBaseUpdate=u:l.next=u,h.lastBaseUpdate=c))}if(r!==null){var d=i.baseState;o=0,h=u=c=null,l=r;do{var f=l.lane,p=l.eventTime;if((n&f)===f){h!==null&&(h=h.next={eventTime:p,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var y=s,_=l;switch(f=e,p=t,_.tag){case 1:if(y=_.payload,typeof y=="function"){d=y.call(p,d,f);break e}d=y;break e;case 3:y.flags=y.flags&-65537|128;case 0:if(y=_.payload,f=typeof y=="function"?y.call(p,d,f):y,f==null)break e;d=tt({},d,f);break e;case 2:to=!0}}l.callback!==null&&l.lane!==0&&(s.flags|=64,f=i.effects,f===null?i.effects=[l]:f.push(l))}else p={eventTime:p,lane:f,tag:l.tag,payload:l.payload,callback:l.callback,next:null},h===null?(u=h=p,c=d):h=h.next=p,o|=f;if(l=l.next,l===null){if(l=i.shared.pending,l===null)break;f=l,l=f.next,f.next=null,i.lastBaseUpdate=f,i.shared.pending=null}}while(!0);if(h===null&&(c=d),i.baseState=c,i.firstBaseUpdate=u,i.lastBaseUpdate=h,e=i.shared.interleaved,e!==null){i=e;do o|=i.lane,i=i.next;while(i!==e)}else r===null&&(i.shared.lanes=0);tc|=o,s.lanes=o,s.memoizedState=d}}function Yx(s,e,t){if(s=e.effects,e.effects=null,s!==null)for(e=0;e<s.length;e++){var n=s[e],i=n.callback;if(i!==null){if(n.callback=null,n=t,typeof i!="function")throw Error($(191,i));i.call(n)}}}var tg={},Hi=ga(tg),Xd=ga(tg),Yd=ga(tg);function Oa(s){if(s===tg)throw Error($(174));return s}function w_(s,e){switch($e(Yd,e),$e(Xd,s),$e(Hi,tg),s=e.nodeType,s){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:_v(null,"");break;default:s=s===8?e.parentNode:e,e=s.namespaceURI||null,s=s.tagName,e=_v(e,s)}Ve(Hi),$e(Hi,e)}function Rh(){Ve(Hi),Ve(Xd),Ve(Yd)}function M1(s){Oa(Yd.current);var e=Oa(Hi.current),t=_v(e,s.type);e!==t&&($e(Xd,s),$e(Hi,t))}function b_(s){Xd.current===s&&(Ve(Hi),Ve(Xd))}var Qe=ga(0);function ey(s){for(var e=s;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===s)break;for(;e.sibling===null;){if(e.return===null||e.return===s)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var L0=[];function __(){for(var s=0;s<L0.length;s++)L0[s]._workInProgressVersionPrimary=null;L0.length=0}var Qg=Xr.ReactCurrentDispatcher,M0=Xr.ReactCurrentBatchConfig,ec=0,Ze=null,St=null,Lt=null,ty=!1,Nd=!1,Jd=0,wR=0;function Yt(){throw Error($(321))}function x_(s,e){if(e===null)return!1;for(var t=0;t<e.length&&t<s.length;t++)if(!ui(s[t],e[t]))return!1;return!0}function A_(s,e,t,n,i,r){if(ec=r,Ze=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Qg.current=s===null||s.memoizedState===null?AR:SR,s=t(n,i),Nd){r=0;do{if(Nd=!1,Jd=0,25<=r)throw Error($(301));r+=1,Lt=St=null,e.updateQueue=null,Qg.current=ER,s=t(n,i)}while(Nd)}if(Qg.current=ny,e=St!==null&&St.next!==null,ec=0,Lt=St=Ze=null,ty=!1,e)throw Error($(300));return s}function S_(){var s=Jd!==0;return Jd=0,s}function yi(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Lt===null?Ze.memoizedState=Lt=s:Lt=Lt.next=s,Lt}function Fs(){if(St===null){var s=Ze.alternate;s=s!==null?s.memoizedState:null}else s=St.next;var e=Lt===null?Ze.memoizedState:Lt.next;if(e!==null)Lt=e,St=s;else{if(s===null)throw Error($(310));St=s,s={memoizedState:St.memoizedState,baseState:St.baseState,baseQueue:St.baseQueue,queue:St.queue,next:null},Lt===null?Ze.memoizedState=Lt=s:Lt=Lt.next=s}return Lt}function Qd(s,e){return typeof e=="function"?e(s):e}function F0(s){var e=Fs(),t=e.queue;if(t===null)throw Error($(311));t.lastRenderedReducer=s;var n=St,i=n.baseQueue,r=t.pending;if(r!==null){if(i!==null){var o=i.next;i.next=r.next,r.next=o}n.baseQueue=i=r,t.pending=null}if(i!==null){r=i.next,n=n.baseState;var l=o=null,c=null,u=r;do{var h=u.lane;if((ec&h)===h)c!==null&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),n=u.hasEagerState?u.eagerState:s(n,u.action);else{var d={lane:h,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};c===null?(l=c=d,o=n):c=c.next=d,Ze.lanes|=h,tc|=h}u=u.next}while(u!==null&&u!==r);c===null?o=n:c.next=l,ui(n,e.memoizedState)||(Mn=!0),e.memoizedState=n,e.baseState=o,e.baseQueue=c,t.lastRenderedState=n}if(s=t.interleaved,s!==null){i=s;do r=i.lane,Ze.lanes|=r,tc|=r,i=i.next;while(i!==s)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function j0(s){var e=Fs(),t=e.queue;if(t===null)throw Error($(311));t.lastRenderedReducer=s;var n=t.dispatch,i=t.pending,r=e.memoizedState;if(i!==null){t.pending=null;var o=i=i.next;do r=s(r,o.action),o=o.next;while(o!==i);ui(r,e.memoizedState)||(Mn=!0),e.memoizedState=r,e.baseQueue===null&&(e.baseState=r),t.lastRenderedState=r}return[r,n]}function F1(){}function j1(s,e){var t=Ze,n=Fs(),i=e(),r=!ui(n.memoizedState,i);if(r&&(n.memoizedState=i,Mn=!0),n=n.queue,E_(U1.bind(null,t,n,s),[s]),n.getSnapshot!==e||r||Lt!==null&&Lt.memoizedState.tag&1){if(t.flags|=2048,Zd(9,$1.bind(null,t,n,i,e),void 0,null),Mt===null)throw Error($(349));ec&30||B1(t,e,i)}return i}function B1(s,e,t){s.flags|=16384,s={getSnapshot:e,value:t},e=Ze.updateQueue,e===null?(e={lastEffect:null,stores:null},Ze.updateQueue=e,e.stores=[s]):(t=e.stores,t===null?e.stores=[s]:t.push(s))}function $1(s,e,t,n){e.value=t,e.getSnapshot=n,z1(e)&&H1(s)}function U1(s,e,t){return t(function(){z1(e)&&H1(s)})}function z1(s){var e=s.getSnapshot;s=s.value;try{var t=e();return!ui(s,t)}catch{return!0}}function H1(s){var e=Wr(s,1);e!==null&&ci(e,s,1,-1)}function Jx(s){var e=yi();return typeof s=="function"&&(s=s()),e.memoizedState=e.baseState=s,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Qd,lastRenderedState:s},e.queue=s,s=s.dispatch=xR.bind(null,Ze,s),[e.memoizedState,s]}function Zd(s,e,t,n){return s={tag:s,create:e,destroy:t,deps:n,next:null},e=Ze.updateQueue,e===null?(e={lastEffect:null,stores:null},Ze.updateQueue=e,e.lastEffect=s.next=s):(t=e.lastEffect,t===null?e.lastEffect=s.next=s:(n=t.next,t.next=s,s.next=n,e.lastEffect=s)),s}function V1(){return Fs().memoizedState}function Zg(s,e,t,n){var i=yi();Ze.flags|=s,i.memoizedState=Zd(1|e,t,void 0,n===void 0?null:n)}function Xy(s,e,t,n){var i=Fs();n=n===void 0?null:n;var r=void 0;if(St!==null){var o=St.memoizedState;if(r=o.destroy,n!==null&&x_(n,o.deps)){i.memoizedState=Zd(e,t,r,n);return}}Ze.flags|=s,i.memoizedState=Zd(1|e,t,r,n)}function Qx(s,e){return Zg(8390656,8,s,e)}function E_(s,e){return Xy(2048,8,s,e)}function W1(s,e){return Xy(4,2,s,e)}function G1(s,e){return Xy(4,4,s,e)}function q1(s,e){if(typeof e=="function")return s=s(),e(s),function(){e(null)};if(e!=null)return s=s(),e.current=s,function(){e.current=null}}function K1(s,e,t){return t=t!=null?t.concat([s]):null,Xy(4,4,q1.bind(null,e,s),t)}function C_(){}function X1(s,e){var t=Fs();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&x_(e,n[1])?n[0]:(t.memoizedState=[s,e],s)}function Y1(s,e){var t=Fs();e=e===void 0?null:e;var n=t.memoizedState;return n!==null&&e!==null&&x_(e,n[1])?n[0]:(s=s(),t.memoizedState=[s,e],s)}function J1(s,e,t){return ec&21?(ui(t,e)||(t=n1(),Ze.lanes|=t,tc|=t,s.baseState=!0),e):(s.baseState&&(s.baseState=!1,Mn=!0),s.memoizedState=t)}function bR(s,e){var t=Ce;Ce=t!==0&&4>t?t:4,s(!0);var n=M0.transition;M0.transition={};try{s(!1),e()}finally{Ce=t,M0.transition=n}}function Q1(){return Fs().memoizedState}function _R(s,e,t){var n=aa(s);if(t={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null},Z1(s))eE(e,t);else if(t=O1(s,e,t,n),t!==null){var i=wn();ci(t,s,n,i),tE(t,e,n)}}function xR(s,e,t){var n=aa(s),i={lane:n,action:t,hasEagerState:!1,eagerState:null,next:null};if(Z1(s))eE(e,i);else{var r=s.alternate;if(s.lanes===0&&(r===null||r.lanes===0)&&(r=e.lastRenderedReducer,r!==null))try{var o=e.lastRenderedState,l=r(o,t);if(i.hasEagerState=!0,i.eagerState=l,ui(l,o)){var c=e.interleaved;c===null?(i.next=i,y_(e)):(i.next=c.next,c.next=i),e.interleaved=i;return}}catch{}finally{}t=O1(s,e,i,n),t!==null&&(i=wn(),ci(t,s,n,i),tE(t,e,n))}}function Z1(s){var e=s.alternate;return s===Ze||e!==null&&e===Ze}function eE(s,e){Nd=ty=!0;var t=s.pending;t===null?e.next=e:(e.next=t.next,t.next=e),s.pending=e}function tE(s,e,t){if(t&4194240){var n=e.lanes;n&=s.pendingLanes,t|=n,e.lanes=t,s_(s,t)}}var ny={readContext:Ms,useCallback:Yt,useContext:Yt,useEffect:Yt,useImperativeHandle:Yt,useInsertionEffect:Yt,useLayoutEffect:Yt,useMemo:Yt,useReducer:Yt,useRef:Yt,useState:Yt,useDebugValue:Yt,useDeferredValue:Yt,useTransition:Yt,useMutableSource:Yt,useSyncExternalStore:Yt,useId:Yt,unstable_isNewReconciler:!1},AR={readContext:Ms,useCallback:function(s,e){return yi().memoizedState=[s,e===void 0?null:e],s},useContext:Ms,useEffect:Qx,useImperativeHandle:function(s,e,t){return t=t!=null?t.concat([s]):null,Zg(4194308,4,q1.bind(null,e,s),t)},useLayoutEffect:function(s,e){return Zg(4194308,4,s,e)},useInsertionEffect:function(s,e){return Zg(4,2,s,e)},useMemo:function(s,e){var t=yi();return e=e===void 0?null:e,s=s(),t.memoizedState=[s,e],s},useReducer:function(s,e,t){var n=yi();return e=t!==void 0?t(e):e,n.memoizedState=n.baseState=e,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:e},n.queue=s,s=s.dispatch=_R.bind(null,Ze,s),[n.memoizedState,s]},useRef:function(s){var e=yi();return s={current:s},e.memoizedState=s},useState:Jx,useDebugValue:C_,useDeferredValue:function(s){return yi().memoizedState=s},useTransition:function(){var s=Jx(!1),e=s[0];return s=bR.bind(null,s[1]),yi().memoizedState=s,[e,s]},useMutableSource:function(){},useSyncExternalStore:function(s,e,t){var n=Ze,i=yi();if(Ke){if(t===void 0)throw Error($(407));t=t()}else{if(t=e(),Mt===null)throw Error($(349));ec&30||B1(n,e,t)}i.memoizedState=t;var r={value:t,getSnapshot:e};return i.queue=r,Qx(U1.bind(null,n,r,s),[s]),n.flags|=2048,Zd(9,$1.bind(null,n,r,t,e),void 0,null),t},useId:function(){var s=yi(),e=Mt.identifierPrefix;if(Ke){var t=jr,n=Fr;t=(n&~(1<<32-li(n)-1)).toString(32)+t,e=":"+e+"R"+t,t=Jd++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=wR++,e=":"+e+"r"+t.toString(32)+":";return s.memoizedState=e},unstable_isNewReconciler:!1},SR={readContext:Ms,useCallback:X1,useContext:Ms,useEffect:E_,useImperativeHandle:K1,useInsertionEffect:W1,useLayoutEffect:G1,useMemo:Y1,useReducer:F0,useRef:V1,useState:function(){return F0(Qd)},useDebugValue:C_,useDeferredValue:function(s){var e=Fs();return J1(e,St.memoizedState,s)},useTransition:function(){var s=F0(Qd)[0],e=Fs().memoizedState;return[s,e]},useMutableSource:F1,useSyncExternalStore:j1,useId:Q1,unstable_isNewReconciler:!1},ER={readContext:Ms,useCallback:X1,useContext:Ms,useEffect:E_,useImperativeHandle:K1,useInsertionEffect:W1,useLayoutEffect:G1,useMemo:Y1,useReducer:j0,useRef:V1,useState:function(){return j0(Qd)},useDebugValue:C_,useDeferredValue:function(s){var e=Fs();return St===null?e.memoizedState=s:J1(e,St.memoizedState,s)},useTransition:function(){var s=j0(Qd)[0],e=Fs().memoizedState;return[s,e]},useMutableSource:F1,useSyncExternalStore:j1,useId:Q1,unstable_isNewReconciler:!1};function Vs(s,e){if(s&&s.defaultProps){e=tt({},e),s=s.defaultProps;for(var t in s)e[t]===void 0&&(e[t]=s[t]);return e}return e}function zv(s,e,t,n){e=s.memoizedState,t=t(n,e),t=t==null?e:tt({},e,t),s.memoizedState=t,s.lanes===0&&(s.updateQueue.baseState=t)}var Yy={isMounted:function(s){return(s=s._reactInternals)?ac(s)===s:!1},enqueueSetState:function(s,e,t){s=s._reactInternals;var n=wn(),i=aa(s),r=Br(n,i);r.payload=e,t!=null&&(r.callback=t),e=ra(s,r,i),e!==null&&(ci(e,s,i,n),Jg(e,s,i))},enqueueReplaceState:function(s,e,t){s=s._reactInternals;var n=wn(),i=aa(s),r=Br(n,i);r.tag=1,r.payload=e,t!=null&&(r.callback=t),e=ra(s,r,i),e!==null&&(ci(e,s,i,n),Jg(e,s,i))},enqueueForceUpdate:function(s,e){s=s._reactInternals;var t=wn(),n=aa(s),i=Br(t,n);i.tag=2,e!=null&&(i.callback=e),e=ra(s,i,n),e!==null&&(ci(e,s,n,t),Jg(e,s,n))}};function Zx(s,e,t,n,i,r,o){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(n,r,o):e.prototype&&e.prototype.isPureReactComponent?!Wd(t,n)||!Wd(i,r):!0}function nE(s,e,t){var n=!1,i=ua,r=e.contextType;return typeof r=="object"&&r!==null?r=Ms(r):(i=jn(e)?Ql:an.current,n=e.contextTypes,r=(n=n!=null)?kh(s,i):ua),e=new e(t,r),s.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Yy,s.stateNode=e,e._reactInternals=s,n&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=i,s.__reactInternalMemoizedMaskedChildContext=r),e}function eA(s,e,t,n){s=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,n),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,n),e.state!==s&&Yy.enqueueReplaceState(e,e.state,null)}function Hv(s,e,t,n){var i=s.stateNode;i.props=t,i.state=s.memoizedState,i.refs={},v_(s);var r=e.contextType;typeof r=="object"&&r!==null?i.context=Ms(r):(r=jn(e)?Ql:an.current,i.context=kh(s,r)),i.state=s.memoizedState,r=e.getDerivedStateFromProps,typeof r=="function"&&(zv(s,e,r,t),i.state=s.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&Yy.enqueueReplaceState(i,i.state,null),Zm(s,t,i,n),i.state=s.memoizedState),typeof i.componentDidMount=="function"&&(s.flags|=4194308)}function Nh(s,e){try{var t="",n=e;do t+=ZT(n),n=n.return;while(n);var i=t}catch(r){i=`
Error generating stack: `+r.message+`
`+r.stack}return{value:s,source:e,stack:i,digest:null}}function B0(s,e,t){return{value:s,source:null,stack:t??null,digest:e??null}}function Vv(s,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var CR=typeof WeakMap=="function"?WeakMap:Map;function sE(s,e,t){t=Br(-1,t),t.tag=3,t.payload={element:null};var n=e.value;return t.callback=function(){iy||(iy=!0,ew=n),Vv(s,e)},t}function iE(s,e,t){t=Br(-1,t),t.tag=3;var n=s.type.getDerivedStateFromError;if(typeof n=="function"){var i=e.value;t.payload=function(){return n(i)},t.callback=function(){Vv(s,e)}}var r=s.stateNode;return r!==null&&typeof r.componentDidCatch=="function"&&(t.callback=function(){Vv(s,e),typeof n!="function"&&(oa===null?oa=new Set([this]):oa.add(this));var o=e.stack;this.componentDidCatch(e.value,{componentStack:o!==null?o:""})}),t}function tA(s,e,t){var n=s.pingCache;if(n===null){n=s.pingCache=new CR;var i=new Set;n.set(e,i)}else i=n.get(e),i===void 0&&(i=new Set,n.set(e,i));i.has(t)||(i.add(t),s=$R.bind(null,s,e,t),e.then(s,s))}function nA(s){do{var e;if((e=s.tag===13)&&(e=s.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return s;s=s.return}while(s!==null);return null}function sA(s,e,t,n,i){return s.mode&1?(s.flags|=65536,s.lanes=i,s):(s===e?s.flags|=65536:(s.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=Br(-1,1),e.tag=2,ra(t,e,1))),t.lanes|=1),s)}var kR=Xr.ReactCurrentOwner,Mn=!1;function yn(s,e,t,n){e.child=s===null?D1(e,null,t,n):Ph(e,s.child,t,n)}function iA(s,e,t,n,i){t=t.render;var r=e.ref;return Jc(e,i),n=A_(s,e,t,n,r,i),t=S_(),s!==null&&!Mn?(e.updateQueue=s.updateQueue,e.flags&=-2053,s.lanes&=~i,Gr(s,e,i)):(Ke&&t&&h_(e),e.flags|=1,yn(s,e,n,i),e.child)}function rA(s,e,t,n,i){if(s===null){var r=t.type;return typeof r=="function"&&!O_(r)&&r.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=r,rE(s,e,r,n,i)):(s=sm(t.type,null,n,e,e.mode,i),s.ref=e.ref,s.return=e,e.child=s)}if(r=s.child,!(s.lanes&i)){var o=r.memoizedProps;if(t=t.compare,t=t!==null?t:Wd,t(o,n)&&s.ref===e.ref)return Gr(s,e,i)}return e.flags|=1,s=la(r,n),s.ref=e.ref,s.return=e,e.child=s}function rE(s,e,t,n,i){if(s!==null){var r=s.memoizedProps;if(Wd(r,n)&&s.ref===e.ref)if(Mn=!1,e.pendingProps=n=r,(s.lanes&i)!==0)s.flags&131072&&(Mn=!0);else return e.lanes=s.lanes,Gr(s,e,i)}return Wv(s,e,t,n,i)}function oE(s,e,t){var n=e.pendingProps,i=n.children,r=s!==null?s.memoizedState:null;if(n.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},$e($c,os),os|=t;else{if(!(t&1073741824))return s=r!==null?r.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:s,cachePool:null,transitions:null},e.updateQueue=null,$e($c,os),os|=s,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=r!==null?r.baseLanes:t,$e($c,os),os|=n}else r!==null?(n=r.baseLanes|t,e.memoizedState=null):n=t,$e($c,os),os|=n;return yn(s,e,i,t),e.child}function aE(s,e){var t=e.ref;(s===null&&t!==null||s!==null&&s.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Wv(s,e,t,n,i){var r=jn(t)?Ql:an.current;return r=kh(e,r),Jc(e,i),t=A_(s,e,t,n,r,i),n=S_(),s!==null&&!Mn?(e.updateQueue=s.updateQueue,e.flags&=-2053,s.lanes&=~i,Gr(s,e,i)):(Ke&&n&&h_(e),e.flags|=1,yn(s,e,t,i),e.child)}function oA(s,e,t,n,i){if(jn(t)){var r=!0;Km(e)}else r=!1;if(Jc(e,i),e.stateNode===null)em(s,e),nE(e,t,n),Hv(e,t,n,i),n=!0;else if(s===null){var o=e.stateNode,l=e.memoizedProps;o.props=l;var c=o.context,u=t.contextType;typeof u=="object"&&u!==null?u=Ms(u):(u=jn(t)?Ql:an.current,u=kh(e,u));var h=t.getDerivedStateFromProps,d=typeof h=="function"||typeof o.getSnapshotBeforeUpdate=="function";d||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==n||c!==u)&&eA(e,o,n,u),to=!1;var f=e.memoizedState;o.state=f,Zm(e,n,o,i),c=e.memoizedState,l!==n||f!==c||Fn.current||to?(typeof h=="function"&&(zv(e,t,h,n),c=e.memoizedState),(l=to||Zx(e,t,l,n,f,c,u))?(d||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount()),typeof o.componentDidMount=="function"&&(e.flags|=4194308)):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=n,e.memoizedState=c),o.props=n,o.state=c,o.context=u,n=l):(typeof o.componentDidMount=="function"&&(e.flags|=4194308),n=!1)}else{o=e.stateNode,L1(s,e),l=e.memoizedProps,u=e.type===e.elementType?l:Vs(e.type,l),o.props=u,d=e.pendingProps,f=o.context,c=t.contextType,typeof c=="object"&&c!==null?c=Ms(c):(c=jn(t)?Ql:an.current,c=kh(e,c));var p=t.getDerivedStateFromProps;(h=typeof p=="function"||typeof o.getSnapshotBeforeUpdate=="function")||typeof o.UNSAFE_componentWillReceiveProps!="function"&&typeof o.componentWillReceiveProps!="function"||(l!==d||f!==c)&&eA(e,o,n,c),to=!1,f=e.memoizedState,o.state=f,Zm(e,n,o,i);var y=e.memoizedState;l!==d||f!==y||Fn.current||to?(typeof p=="function"&&(zv(e,t,p,n),y=e.memoizedState),(u=to||Zx(e,t,u,n,f,y,c)||!1)?(h||typeof o.UNSAFE_componentWillUpdate!="function"&&typeof o.componentWillUpdate!="function"||(typeof o.componentWillUpdate=="function"&&o.componentWillUpdate(n,y,c),typeof o.UNSAFE_componentWillUpdate=="function"&&o.UNSAFE_componentWillUpdate(n,y,c)),typeof o.componentDidUpdate=="function"&&(e.flags|=4),typeof o.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof o.componentDidUpdate!="function"||l===s.memoizedProps&&f===s.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===s.memoizedProps&&f===s.memoizedState||(e.flags|=1024),e.memoizedProps=n,e.memoizedState=y),o.props=n,o.state=y,o.context=c,n=u):(typeof o.componentDidUpdate!="function"||l===s.memoizedProps&&f===s.memoizedState||(e.flags|=4),typeof o.getSnapshotBeforeUpdate!="function"||l===s.memoizedProps&&f===s.memoizedState||(e.flags|=1024),n=!1)}return Gv(s,e,t,n,r,i)}function Gv(s,e,t,n,i,r){aE(s,e);var o=(e.flags&128)!==0;if(!n&&!o)return i&&Wx(e,t,!1),Gr(s,e,r);n=e.stateNode,kR.current=e;var l=o&&typeof t.getDerivedStateFromError!="function"?null:n.render();return e.flags|=1,s!==null&&o?(e.child=Ph(e,s.child,null,r),e.child=Ph(e,null,l,r)):yn(s,e,l,r),e.memoizedState=n.state,i&&Wx(e,t,!0),e.child}function lE(s){var e=s.stateNode;e.pendingContext?Vx(s,e.pendingContext,e.pendingContext!==e.context):e.context&&Vx(s,e.context,!1),w_(s,e.containerInfo)}function aA(s,e,t,n,i){return Th(),f_(i),e.flags|=256,yn(s,e,t,n),e.child}var qv={dehydrated:null,treeContext:null,retryLane:0};function Kv(s){return{baseLanes:s,cachePool:null,transitions:null}}function cE(s,e,t){var n=e.pendingProps,i=Qe.current,r=!1,o=(e.flags&128)!==0,l;if((l=o)||(l=s!==null&&s.memoizedState===null?!1:(i&2)!==0),l?(r=!0,e.flags&=-129):(s===null||s.memoizedState!==null)&&(i|=1),$e(Qe,i&1),s===null)return $v(e),s=e.memoizedState,s!==null&&(s=s.dehydrated,s!==null)?(e.mode&1?s.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(o=n.children,s=n.fallback,r?(n=e.mode,r=e.child,o={mode:"hidden",children:o},!(n&1)&&r!==null?(r.childLanes=0,r.pendingProps=o):r=Zy(o,n,0,null),s=Jl(s,n,t,null),r.return=e,s.return=e,r.sibling=s,e.child=r,e.child.memoizedState=Kv(t),e.memoizedState=qv,s):k_(e,o));if(i=s.memoizedState,i!==null&&(l=i.dehydrated,l!==null))return TR(s,e,o,n,l,i,t);if(r){r=n.fallback,o=e.mode,i=s.child,l=i.sibling;var c={mode:"hidden",children:n.children};return!(o&1)&&e.child!==i?(n=e.child,n.childLanes=0,n.pendingProps=c,e.deletions=null):(n=la(i,c),n.subtreeFlags=i.subtreeFlags&14680064),l!==null?r=la(l,r):(r=Jl(r,o,t,null),r.flags|=2),r.return=e,n.return=e,n.sibling=r,e.child=n,n=r,r=e.child,o=s.child.memoizedState,o=o===null?Kv(t):{baseLanes:o.baseLanes|t,cachePool:null,transitions:o.transitions},r.memoizedState=o,r.childLanes=s.childLanes&~t,e.memoizedState=qv,n}return r=s.child,s=r.sibling,n=la(r,{mode:"visible",children:n.children}),!(e.mode&1)&&(n.lanes=t),n.return=e,n.sibling=null,s!==null&&(t=e.deletions,t===null?(e.deletions=[s],e.flags|=16):t.push(s)),e.child=n,e.memoizedState=null,n}function k_(s,e){return e=Zy({mode:"visible",children:e},s.mode,0,null),e.return=s,s.child=e}function Cg(s,e,t,n){return n!==null&&f_(n),Ph(e,s.child,null,t),s=k_(e,e.pendingProps.children),s.flags|=2,e.memoizedState=null,s}function TR(s,e,t,n,i,r,o){if(t)return e.flags&256?(e.flags&=-257,n=B0(Error($(422))),Cg(s,e,o,n)):e.memoizedState!==null?(e.child=s.child,e.flags|=128,null):(r=n.fallback,i=e.mode,n=Zy({mode:"visible",children:n.children},i,0,null),r=Jl(r,i,o,null),r.flags|=2,n.return=e,r.return=e,n.sibling=r,e.child=n,e.mode&1&&Ph(e,s.child,null,o),e.child.memoizedState=Kv(o),e.memoizedState=qv,r);if(!(e.mode&1))return Cg(s,e,o,null);if(i.data==="$!"){if(n=i.nextSibling&&i.nextSibling.dataset,n)var l=n.dgst;return n=l,r=Error($(419)),n=B0(r,n,void 0),Cg(s,e,o,n)}if(l=(o&s.childLanes)!==0,Mn||l){if(n=Mt,n!==null){switch(o&-o){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(n.suspendedLanes|o)?0:i,i!==0&&i!==r.retryLane&&(r.retryLane=i,Wr(s,i),ci(n,s,i,-1))}return D_(),n=B0(Error($(421))),Cg(s,e,o,n)}return i.data==="$?"?(e.flags|=128,e.child=s.child,e=UR.bind(null,s),i._reactRetry=e,null):(s=r.treeContext,cs=ia(i.nextSibling),us=e,Ke=!0,ri=null,s!==null&&(Ps[Rs++]=Fr,Ps[Rs++]=jr,Ps[Rs++]=Zl,Fr=s.id,jr=s.overflow,Zl=e),e=k_(e,n.children),e.flags|=4096,e)}function lA(s,e,t){s.lanes|=e;var n=s.alternate;n!==null&&(n.lanes|=e),Uv(s.return,e,t)}function $0(s,e,t,n,i){var r=s.memoizedState;r===null?s.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:n,tail:t,tailMode:i}:(r.isBackwards=e,r.rendering=null,r.renderingStartTime=0,r.last=n,r.tail=t,r.tailMode=i)}function uE(s,e,t){var n=e.pendingProps,i=n.revealOrder,r=n.tail;if(yn(s,e,n.children,t),n=Qe.current,n&2)n=n&1|2,e.flags|=128;else{if(s!==null&&s.flags&128)e:for(s=e.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&lA(s,t,e);else if(s.tag===19)lA(s,t,e);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break e;for(;s.sibling===null;){if(s.return===null||s.return===e)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}n&=1}if($e(Qe,n),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)s=t.alternate,s!==null&&ey(s)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),$0(e,!1,i,t,r);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(s=i.alternate,s!==null&&ey(s)===null){e.child=i;break}s=i.sibling,i.sibling=t,t=i,i=s}$0(e,!0,t,null,r);break;case"together":$0(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function em(s,e){!(e.mode&1)&&s!==null&&(s.alternate=null,e.alternate=null,e.flags|=2)}function Gr(s,e,t){if(s!==null&&(e.dependencies=s.dependencies),tc|=e.lanes,!(t&e.childLanes))return null;if(s!==null&&e.child!==s.child)throw Error($(153));if(e.child!==null){for(s=e.child,t=la(s,s.pendingProps),e.child=t,t.return=e;s.sibling!==null;)s=s.sibling,t=t.sibling=la(s,s.pendingProps),t.return=e;t.sibling=null}return e.child}function PR(s,e,t){switch(e.tag){case 3:lE(e),Th();break;case 5:M1(e);break;case 1:jn(e.type)&&Km(e);break;case 4:w_(e,e.stateNode.containerInfo);break;case 10:var n=e.type._context,i=e.memoizedProps.value;$e(Jm,n._currentValue),n._currentValue=i;break;case 13:if(n=e.memoizedState,n!==null)return n.dehydrated!==null?($e(Qe,Qe.current&1),e.flags|=128,null):t&e.child.childLanes?cE(s,e,t):($e(Qe,Qe.current&1),s=Gr(s,e,t),s!==null?s.sibling:null);$e(Qe,Qe.current&1);break;case 19:if(n=(t&e.childLanes)!==0,s.flags&128){if(n)return uE(s,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),$e(Qe,Qe.current),n)break;return null;case 22:case 23:return e.lanes=0,oE(s,e,t)}return Gr(s,e,t)}var hE,Xv,dE,fE;hE=function(s,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)s.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};Xv=function(){};dE=function(s,e,t,n){var i=s.memoizedProps;if(i!==n){s=e.stateNode,Oa(Hi.current);var r=null;switch(t){case"input":i=yv(s,i),n=yv(s,n),r=[];break;case"select":i=tt({},i,{value:void 0}),n=tt({},n,{value:void 0}),r=[];break;case"textarea":i=bv(s,i),n=bv(s,n),r=[];break;default:typeof i.onClick!="function"&&typeof n.onClick=="function"&&(s.onclick=Gm)}xv(t,n);var o;t=null;for(u in i)if(!n.hasOwnProperty(u)&&i.hasOwnProperty(u)&&i[u]!=null)if(u==="style"){var l=i[u];for(o in l)l.hasOwnProperty(o)&&(t||(t={}),t[o]="")}else u!=="dangerouslySetInnerHTML"&&u!=="children"&&u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&u!=="autoFocus"&&(jd.hasOwnProperty(u)?r||(r=[]):(r=r||[]).push(u,null));for(u in n){var c=n[u];if(l=i!=null?i[u]:void 0,n.hasOwnProperty(u)&&c!==l&&(c!=null||l!=null))if(u==="style")if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(t||(t={}),t[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(t||(t={}),t[o]=c[o])}else t||(r||(r=[]),r.push(u,t)),t=c;else u==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,l=l?l.__html:void 0,c!=null&&l!==c&&(r=r||[]).push(u,c)):u==="children"?typeof c!="string"&&typeof c!="number"||(r=r||[]).push(u,""+c):u!=="suppressContentEditableWarning"&&u!=="suppressHydrationWarning"&&(jd.hasOwnProperty(u)?(c!=null&&u==="onScroll"&&ze("scroll",s),r||l===c||(r=[])):(r=r||[]).push(u,c))}t&&(r=r||[]).push("style",t);var u=r;(e.updateQueue=u)&&(e.flags|=4)}};fE=function(s,e,t,n){t!==n&&(e.flags|=4)};function Gh(s,e){if(!Ke)switch(s.tailMode){case"hidden":e=s.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?s.tail=null:t.sibling=null;break;case"collapsed":t=s.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e||s.tail===null?s.tail=null:s.tail.sibling=null:n.sibling=null}}function Jt(s){var e=s.alternate!==null&&s.alternate.child===s.child,t=0,n=0;if(e)for(var i=s.child;i!==null;)t|=i.lanes|i.childLanes,n|=i.subtreeFlags&14680064,n|=i.flags&14680064,i.return=s,i=i.sibling;else for(i=s.child;i!==null;)t|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=s,i=i.sibling;return s.subtreeFlags|=n,s.childLanes=t,e}function RR(s,e,t){var n=e.pendingProps;switch(d_(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Jt(e),null;case 1:return jn(e.type)&&qm(),Jt(e),null;case 3:return n=e.stateNode,Rh(),Ve(Fn),Ve(an),__(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),(s===null||s.child===null)&&(Sg(e)?e.flags|=4:s===null||s.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,ri!==null&&(sw(ri),ri=null))),Xv(s,e),Jt(e),null;case 5:b_(e);var i=Oa(Yd.current);if(t=e.type,s!==null&&e.stateNode!=null)dE(s,e,t,n,i),s.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!n){if(e.stateNode===null)throw Error($(166));return Jt(e),null}if(s=Oa(Hi.current),Sg(e)){n=e.stateNode,t=e.type;var r=e.memoizedProps;switch(n[Ui]=e,n[Kd]=r,s=(e.mode&1)!==0,t){case"dialog":ze("cancel",n),ze("close",n);break;case"iframe":case"object":case"embed":ze("load",n);break;case"video":case"audio":for(i=0;i<sd.length;i++)ze(sd[i],n);break;case"source":ze("error",n);break;case"img":case"image":case"link":ze("error",n),ze("load",n);break;case"details":ze("toggle",n);break;case"input":yx(n,r),ze("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!r.multiple},ze("invalid",n);break;case"textarea":wx(n,r),ze("invalid",n)}xv(t,r),i=null;for(var o in r)if(r.hasOwnProperty(o)){var l=r[o];o==="children"?typeof l=="string"?n.textContent!==l&&(r.suppressHydrationWarning!==!0&&Ag(n.textContent,l,s),i=["children",l]):typeof l=="number"&&n.textContent!==""+l&&(r.suppressHydrationWarning!==!0&&Ag(n.textContent,l,s),i=["children",""+l]):jd.hasOwnProperty(o)&&l!=null&&o==="onScroll"&&ze("scroll",n)}switch(t){case"input":gg(n),vx(n,r,!0);break;case"textarea":gg(n),bx(n);break;case"select":case"option":break;default:typeof r.onClick=="function"&&(n.onclick=Gm)}n=i,e.updateQueue=n,n!==null&&(e.flags|=4)}else{o=i.nodeType===9?i:i.ownerDocument,s==="http://www.w3.org/1999/xhtml"&&(s=US(t)),s==="http://www.w3.org/1999/xhtml"?t==="script"?(s=o.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild)):typeof n.is=="string"?s=o.createElement(t,{is:n.is}):(s=o.createElement(t),t==="select"&&(o=s,n.multiple?o.multiple=!0:n.size&&(o.size=n.size))):s=o.createElementNS(s,t),s[Ui]=e,s[Kd]=n,hE(s,e,!1,!1),e.stateNode=s;e:{switch(o=Av(t,n),t){case"dialog":ze("cancel",s),ze("close",s),i=n;break;case"iframe":case"object":case"embed":ze("load",s),i=n;break;case"video":case"audio":for(i=0;i<sd.length;i++)ze(sd[i],s);i=n;break;case"source":ze("error",s),i=n;break;case"img":case"image":case"link":ze("error",s),ze("load",s),i=n;break;case"details":ze("toggle",s),i=n;break;case"input":yx(s,n),i=yv(s,n),ze("invalid",s);break;case"option":i=n;break;case"select":s._wrapperState={wasMultiple:!!n.multiple},i=tt({},n,{value:void 0}),ze("invalid",s);break;case"textarea":wx(s,n),i=bv(s,n),ze("invalid",s);break;default:i=n}xv(t,i),l=i;for(r in l)if(l.hasOwnProperty(r)){var c=l[r];r==="style"?VS(s,c):r==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&zS(s,c)):r==="children"?typeof c=="string"?(t!=="textarea"||c!=="")&&Bd(s,c):typeof c=="number"&&Bd(s,""+c):r!=="suppressContentEditableWarning"&&r!=="suppressHydrationWarning"&&r!=="autoFocus"&&(jd.hasOwnProperty(r)?c!=null&&r==="onScroll"&&ze("scroll",s):c!=null&&Jb(s,r,c,o))}switch(t){case"input":gg(s),vx(s,n,!1);break;case"textarea":gg(s),bx(s);break;case"option":n.value!=null&&s.setAttribute("value",""+ca(n.value));break;case"select":s.multiple=!!n.multiple,r=n.value,r!=null?qc(s,!!n.multiple,r,!1):n.defaultValue!=null&&qc(s,!!n.multiple,n.defaultValue,!0);break;default:typeof i.onClick=="function"&&(s.onclick=Gm)}switch(t){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Jt(e),null;case 6:if(s&&e.stateNode!=null)fE(s,e,s.memoizedProps,n);else{if(typeof n!="string"&&e.stateNode===null)throw Error($(166));if(t=Oa(Yd.current),Oa(Hi.current),Sg(e)){if(n=e.stateNode,t=e.memoizedProps,n[Ui]=e,(r=n.nodeValue!==t)&&(s=us,s!==null))switch(s.tag){case 3:Ag(n.nodeValue,t,(s.mode&1)!==0);break;case 5:s.memoizedProps.suppressHydrationWarning!==!0&&Ag(n.nodeValue,t,(s.mode&1)!==0)}r&&(e.flags|=4)}else n=(t.nodeType===9?t:t.ownerDocument).createTextNode(n),n[Ui]=e,e.stateNode=n}return Jt(e),null;case 13:if(Ve(Qe),n=e.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(Ke&&cs!==null&&e.mode&1&&!(e.flags&128))N1(),Th(),e.flags|=98560,r=!1;else if(r=Sg(e),n!==null&&n.dehydrated!==null){if(s===null){if(!r)throw Error($(318));if(r=e.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error($(317));r[Ui]=e}else Th(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Jt(e),r=!1}else ri!==null&&(sw(ri),ri=null),r=!0;if(!r)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(n=n!==null,n!==(s!==null&&s.memoizedState!==null)&&n&&(e.child.flags|=8192,e.mode&1&&(s===null||Qe.current&1?Et===0&&(Et=3):D_())),e.updateQueue!==null&&(e.flags|=4),Jt(e),null);case 4:return Rh(),Xv(s,e),s===null&&Gd(e.stateNode.containerInfo),Jt(e),null;case 10:return m_(e.type._context),Jt(e),null;case 17:return jn(e.type)&&qm(),Jt(e),null;case 19:if(Ve(Qe),r=e.memoizedState,r===null)return Jt(e),null;if(n=(e.flags&128)!==0,o=r.rendering,o===null)if(n)Gh(r,!1);else{if(Et!==0||s!==null&&s.flags&128)for(s=e.child;s!==null;){if(o=ey(s),o!==null){for(e.flags|=128,Gh(r,!1),n=o.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),e.subtreeFlags=0,n=t,t=e.child;t!==null;)r=t,s=n,r.flags&=14680066,o=r.alternate,o===null?(r.childLanes=0,r.lanes=s,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=o.childLanes,r.lanes=o.lanes,r.child=o.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=o.memoizedProps,r.memoizedState=o.memoizedState,r.updateQueue=o.updateQueue,r.type=o.type,s=o.dependencies,r.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),t=t.sibling;return $e(Qe,Qe.current&1|2),e.child}s=s.sibling}r.tail!==null&&ht()>Ih&&(e.flags|=128,n=!0,Gh(r,!1),e.lanes=4194304)}else{if(!n)if(s=ey(o),s!==null){if(e.flags|=128,n=!0,t=s.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),Gh(r,!0),r.tail===null&&r.tailMode==="hidden"&&!o.alternate&&!Ke)return Jt(e),null}else 2*ht()-r.renderingStartTime>Ih&&t!==1073741824&&(e.flags|=128,n=!0,Gh(r,!1),e.lanes=4194304);r.isBackwards?(o.sibling=e.child,e.child=o):(t=r.last,t!==null?t.sibling=o:e.child=o,r.last=o)}return r.tail!==null?(e=r.tail,r.rendering=e,r.tail=e.sibling,r.renderingStartTime=ht(),e.sibling=null,t=Qe.current,$e(Qe,n?t&1|2:t&1),e):(Jt(e),null);case 22:case 23:return I_(),n=e.memoizedState!==null,s!==null&&s.memoizedState!==null!==n&&(e.flags|=8192),n&&e.mode&1?os&1073741824&&(Jt(e),e.subtreeFlags&6&&(e.flags|=8192)):Jt(e),null;case 24:return null;case 25:return null}throw Error($(156,e.tag))}function NR(s,e){switch(d_(e),e.tag){case 1:return jn(e.type)&&qm(),s=e.flags,s&65536?(e.flags=s&-65537|128,e):null;case 3:return Rh(),Ve(Fn),Ve(an),__(),s=e.flags,s&65536&&!(s&128)?(e.flags=s&-65537|128,e):null;case 5:return b_(e),null;case 13:if(Ve(Qe),s=e.memoizedState,s!==null&&s.dehydrated!==null){if(e.alternate===null)throw Error($(340));Th()}return s=e.flags,s&65536?(e.flags=s&-65537|128,e):null;case 19:return Ve(Qe),null;case 4:return Rh(),null;case 10:return m_(e.type._context),null;case 22:case 23:return I_(),null;case 24:return null;default:return null}}var kg=!1,on=!1,IR=typeof WeakSet=="function"?WeakSet:Set,q=null;function Bc(s,e){var t=s.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(n){at(s,e,n)}else t.current=null}function Yv(s,e,t){try{t()}catch(n){at(s,e,n)}}var cA=!1;function DR(s,e){if(Dv=Hm,s=v1(),u_(s)){if("selectionStart"in s)var t={start:s.selectionStart,end:s.selectionEnd};else e:{t=(t=s.ownerDocument)&&t.defaultView||window;var n=t.getSelection&&t.getSelection();if(n&&n.rangeCount!==0){t=n.anchorNode;var i=n.anchorOffset,r=n.focusNode;n=n.focusOffset;try{t.nodeType,r.nodeType}catch{t=null;break e}var o=0,l=-1,c=-1,u=0,h=0,d=s,f=null;t:for(;;){for(var p;d!==t||i!==0&&d.nodeType!==3||(l=o+i),d!==r||n!==0&&d.nodeType!==3||(c=o+n),d.nodeType===3&&(o+=d.nodeValue.length),(p=d.firstChild)!==null;)f=d,d=p;for(;;){if(d===s)break t;if(f===t&&++u===i&&(l=o),f===r&&++h===n&&(c=o),(p=d.nextSibling)!==null)break;d=f,f=d.parentNode}d=p}t=l===-1||c===-1?null:{start:l,end:c}}else t=null}t=t||{start:0,end:0}}else t=null;for(Ov={focusedElem:s,selectionRange:t},Hm=!1,q=e;q!==null;)if(e=q,s=e.child,(e.subtreeFlags&1028)!==0&&s!==null)s.return=e,q=s;else for(;q!==null;){e=q;try{var y=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(y!==null){var _=y.memoizedProps,A=y.memoizedState,m=e.stateNode,b=m.getSnapshotBeforeUpdate(e.elementType===e.type?_:Vs(e.type,_),A);m.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var v=e.stateNode.containerInfo;v.nodeType===1?v.textContent="":v.nodeType===9&&v.documentElement&&v.removeChild(v.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error($(163))}}catch(S){at(e,e.return,S)}if(s=e.sibling,s!==null){s.return=e.return,q=s;break}q=e.return}return y=cA,cA=!1,y}function Id(s,e,t){var n=e.updateQueue;if(n=n!==null?n.lastEffect:null,n!==null){var i=n=n.next;do{if((i.tag&s)===s){var r=i.destroy;i.destroy=void 0,r!==void 0&&Yv(e,t,r)}i=i.next}while(i!==n)}}function Jy(s,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&s)===s){var n=t.create;t.destroy=n()}t=t.next}while(t!==e)}}function Jv(s){var e=s.ref;if(e!==null){var t=s.stateNode;switch(s.tag){case 5:s=t;break;default:s=t}typeof e=="function"?e(s):e.current=s}}function pE(s){var e=s.alternate;e!==null&&(s.alternate=null,pE(e)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(e=s.stateNode,e!==null&&(delete e[Ui],delete e[Kd],delete e[Fv],delete e[gR],delete e[mR])),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}function gE(s){return s.tag===5||s.tag===3||s.tag===4}function uA(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||gE(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Qv(s,e,t){var n=s.tag;if(n===5||n===6)s=s.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(s,e):t.insertBefore(s,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(s,t)):(e=t,e.appendChild(s)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=Gm));else if(n!==4&&(s=s.child,s!==null))for(Qv(s,e,t),s=s.sibling;s!==null;)Qv(s,e,t),s=s.sibling}function Zv(s,e,t){var n=s.tag;if(n===5||n===6)s=s.stateNode,e?t.insertBefore(s,e):t.appendChild(s);else if(n!==4&&(s=s.child,s!==null))for(Zv(s,e,t),s=s.sibling;s!==null;)Zv(s,e,t),s=s.sibling}var Ht=null,si=!1;function Yr(s,e,t){for(t=t.child;t!==null;)mE(s,e,t),t=t.sibling}function mE(s,e,t){if(zi&&typeof zi.onCommitFiberUnmount=="function")try{zi.onCommitFiberUnmount(Hy,t)}catch{}switch(t.tag){case 5:on||Bc(t,e);case 6:var n=Ht,i=si;Ht=null,Yr(s,e,t),Ht=n,si=i,Ht!==null&&(si?(s=Ht,t=t.stateNode,s.nodeType===8?s.parentNode.removeChild(t):s.removeChild(t)):Ht.removeChild(t.stateNode));break;case 18:Ht!==null&&(si?(s=Ht,t=t.stateNode,s.nodeType===8?D0(s.parentNode,t):s.nodeType===1&&D0(s,t),Hd(s)):D0(Ht,t.stateNode));break;case 4:n=Ht,i=si,Ht=t.stateNode.containerInfo,si=!0,Yr(s,e,t),Ht=n,si=i;break;case 0:case 11:case 14:case 15:if(!on&&(n=t.updateQueue,n!==null&&(n=n.lastEffect,n!==null))){i=n=n.next;do{var r=i,o=r.destroy;r=r.tag,o!==void 0&&(r&2||r&4)&&Yv(t,e,o),i=i.next}while(i!==n)}Yr(s,e,t);break;case 1:if(!on&&(Bc(t,e),n=t.stateNode,typeof n.componentWillUnmount=="function"))try{n.props=t.memoizedProps,n.state=t.memoizedState,n.componentWillUnmount()}catch(l){at(t,e,l)}Yr(s,e,t);break;case 21:Yr(s,e,t);break;case 22:t.mode&1?(on=(n=on)||t.memoizedState!==null,Yr(s,e,t),on=n):Yr(s,e,t);break;default:Yr(s,e,t)}}function hA(s){var e=s.updateQueue;if(e!==null){s.updateQueue=null;var t=s.stateNode;t===null&&(t=s.stateNode=new IR),e.forEach(function(n){var i=zR.bind(null,s,n);t.has(n)||(t.add(n),n.then(i,i))})}}function $s(s,e){var t=e.deletions;if(t!==null)for(var n=0;n<t.length;n++){var i=t[n];try{var r=s,o=e,l=o;e:for(;l!==null;){switch(l.tag){case 5:Ht=l.stateNode,si=!1;break e;case 3:Ht=l.stateNode.containerInfo,si=!0;break e;case 4:Ht=l.stateNode.containerInfo,si=!0;break e}l=l.return}if(Ht===null)throw Error($(160));mE(r,o,i),Ht=null,si=!1;var c=i.alternate;c!==null&&(c.return=null),i.return=null}catch(u){at(i,e,u)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)yE(e,s),e=e.sibling}function yE(s,e){var t=s.alternate,n=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:if($s(e,s),di(s),n&4){try{Id(3,s,s.return),Jy(3,s)}catch(_){at(s,s.return,_)}try{Id(5,s,s.return)}catch(_){at(s,s.return,_)}}break;case 1:$s(e,s),di(s),n&512&&t!==null&&Bc(t,t.return);break;case 5:if($s(e,s),di(s),n&512&&t!==null&&Bc(t,t.return),s.flags&32){var i=s.stateNode;try{Bd(i,"")}catch(_){at(s,s.return,_)}}if(n&4&&(i=s.stateNode,i!=null)){var r=s.memoizedProps,o=t!==null?t.memoizedProps:r,l=s.type,c=s.updateQueue;if(s.updateQueue=null,c!==null)try{l==="input"&&r.type==="radio"&&r.name!=null&&BS(i,r),Av(l,o);var u=Av(l,r);for(o=0;o<c.length;o+=2){var h=c[o],d=c[o+1];h==="style"?VS(i,d):h==="dangerouslySetInnerHTML"?zS(i,d):h==="children"?Bd(i,d):Jb(i,h,d,u)}switch(l){case"input":vv(i,r);break;case"textarea":$S(i,r);break;case"select":var f=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!r.multiple;var p=r.value;p!=null?qc(i,!!r.multiple,p,!1):f!==!!r.multiple&&(r.defaultValue!=null?qc(i,!!r.multiple,r.defaultValue,!0):qc(i,!!r.multiple,r.multiple?[]:"",!1))}i[Kd]=r}catch(_){at(s,s.return,_)}}break;case 6:if($s(e,s),di(s),n&4){if(s.stateNode===null)throw Error($(162));i=s.stateNode,r=s.memoizedProps;try{i.nodeValue=r}catch(_){at(s,s.return,_)}}break;case 3:if($s(e,s),di(s),n&4&&t!==null&&t.memoizedState.isDehydrated)try{Hd(e.containerInfo)}catch(_){at(s,s.return,_)}break;case 4:$s(e,s),di(s);break;case 13:$s(e,s),di(s),i=s.child,i.flags&8192&&(r=i.memoizedState!==null,i.stateNode.isHidden=r,!r||i.alternate!==null&&i.alternate.memoizedState!==null||(R_=ht())),n&4&&hA(s);break;case 22:if(h=t!==null&&t.memoizedState!==null,s.mode&1?(on=(u=on)||h,$s(e,s),on=u):$s(e,s),di(s),n&8192){if(u=s.memoizedState!==null,(s.stateNode.isHidden=u)&&!h&&s.mode&1)for(q=s,h=s.child;h!==null;){for(d=q=h;q!==null;){switch(f=q,p=f.child,f.tag){case 0:case 11:case 14:case 15:Id(4,f,f.return);break;case 1:Bc(f,f.return);var y=f.stateNode;if(typeof y.componentWillUnmount=="function"){n=f,t=f.return;try{e=n,y.props=e.memoizedProps,y.state=e.memoizedState,y.componentWillUnmount()}catch(_){at(n,t,_)}}break;case 5:Bc(f,f.return);break;case 22:if(f.memoizedState!==null){fA(d);continue}}p!==null?(p.return=f,q=p):fA(d)}h=h.sibling}e:for(h=null,d=s;;){if(d.tag===5){if(h===null){h=d;try{i=d.stateNode,u?(r=i.style,typeof r.setProperty=="function"?r.setProperty("display","none","important"):r.display="none"):(l=d.stateNode,c=d.memoizedProps.style,o=c!=null&&c.hasOwnProperty("display")?c.display:null,l.style.display=HS("display",o))}catch(_){at(s,s.return,_)}}}else if(d.tag===6){if(h===null)try{d.stateNode.nodeValue=u?"":d.memoizedProps}catch(_){at(s,s.return,_)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===s)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===s)break e;for(;d.sibling===null;){if(d.return===null||d.return===s)break e;h===d&&(h=null),d=d.return}h===d&&(h=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:$s(e,s),di(s),n&4&&hA(s);break;case 21:break;default:$s(e,s),di(s)}}function di(s){var e=s.flags;if(e&2){try{e:{for(var t=s.return;t!==null;){if(gE(t)){var n=t;break e}t=t.return}throw Error($(160))}switch(n.tag){case 5:var i=n.stateNode;n.flags&32&&(Bd(i,""),n.flags&=-33);var r=uA(s);Zv(s,r,i);break;case 3:case 4:var o=n.stateNode.containerInfo,l=uA(s);Qv(s,l,o);break;default:throw Error($(161))}}catch(c){at(s,s.return,c)}s.flags&=-3}e&4096&&(s.flags&=-4097)}function OR(s,e,t){q=s,vE(s)}function vE(s,e,t){for(var n=(s.mode&1)!==0;q!==null;){var i=q,r=i.child;if(i.tag===22&&n){var o=i.memoizedState!==null||kg;if(!o){var l=i.alternate,c=l!==null&&l.memoizedState!==null||on;l=kg;var u=on;if(kg=o,(on=c)&&!u)for(q=i;q!==null;)o=q,c=o.child,o.tag===22&&o.memoizedState!==null?pA(i):c!==null?(c.return=o,q=c):pA(i);for(;r!==null;)q=r,vE(r),r=r.sibling;q=i,kg=l,on=u}dA(s)}else i.subtreeFlags&8772&&r!==null?(r.return=i,q=r):dA(s)}}function dA(s){for(;q!==null;){var e=q;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:on||Jy(5,e);break;case 1:var n=e.stateNode;if(e.flags&4&&!on)if(t===null)n.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:Vs(e.type,t.memoizedProps);n.componentDidUpdate(i,t.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var r=e.updateQueue;r!==null&&Yx(e,r,n);break;case 3:var o=e.updateQueue;if(o!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}Yx(e,o,t)}break;case 5:var l=e.stateNode;if(t===null&&e.flags&4){t=l;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&t.focus();break;case"img":c.src&&(t.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var u=e.alternate;if(u!==null){var h=u.memoizedState;if(h!==null){var d=h.dehydrated;d!==null&&Hd(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error($(163))}on||e.flags&512&&Jv(e)}catch(f){at(e,e.return,f)}}if(e===s){q=null;break}if(t=e.sibling,t!==null){t.return=e.return,q=t;break}q=e.return}}function fA(s){for(;q!==null;){var e=q;if(e===s){q=null;break}var t=e.sibling;if(t!==null){t.return=e.return,q=t;break}q=e.return}}function pA(s){for(;q!==null;){var e=q;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Jy(4,e)}catch(c){at(e,t,c)}break;case 1:var n=e.stateNode;if(typeof n.componentDidMount=="function"){var i=e.return;try{n.componentDidMount()}catch(c){at(e,i,c)}}var r=e.return;try{Jv(e)}catch(c){at(e,r,c)}break;case 5:var o=e.return;try{Jv(e)}catch(c){at(e,o,c)}}}catch(c){at(e,e.return,c)}if(e===s){q=null;break}var l=e.sibling;if(l!==null){l.return=e.return,q=l;break}q=e.return}}var LR=Math.ceil,sy=Xr.ReactCurrentDispatcher,T_=Xr.ReactCurrentOwner,Ds=Xr.ReactCurrentBatchConfig,ye=0,Mt=null,gt=null,qt=0,os=0,$c=ga(0),Et=0,ef=null,tc=0,Qy=0,P_=0,Dd=null,On=null,R_=0,Ih=1/0,Ji=null,iy=!1,ew=null,oa=null,Tg=!1,ea=null,ry=0,Od=0,tw=null,tm=-1,nm=0;function wn(){return ye&6?ht():tm!==-1?tm:tm=ht()}function aa(s){return s.mode&1?ye&2&&qt!==0?qt&-qt:vR.transition!==null?(nm===0&&(nm=n1()),nm):(s=Ce,s!==0||(s=window.event,s=s===void 0?16:c1(s.type)),s):1}function ci(s,e,t,n){if(50<Od)throw Od=0,tw=null,Error($(185));Qp(s,t,n),(!(ye&2)||s!==Mt)&&(s===Mt&&(!(ye&2)&&(Qy|=t),Et===4&&io(s,qt)),Bn(s,n),t===1&&ye===0&&!(e.mode&1)&&(Ih=ht()+500,Ky&&ma()))}function Bn(s,e){var t=s.callbackNode;vP(s,e);var n=zm(s,s===Mt?qt:0);if(n===0)t!==null&&Ax(t),s.callbackNode=null,s.callbackPriority=0;else if(e=n&-n,s.callbackPriority!==e){if(t!=null&&Ax(t),e===1)s.tag===0?yR(gA.bind(null,s)):T1(gA.bind(null,s)),fR(function(){!(ye&6)&&ma()}),t=null;else{switch(s1(n)){case 1:t=n_;break;case 4:t=e1;break;case 16:t=Um;break;case 536870912:t=t1;break;default:t=Um}t=CE(t,wE.bind(null,s))}s.callbackPriority=e,s.callbackNode=t}}function wE(s,e){if(tm=-1,nm=0,ye&6)throw Error($(327));var t=s.callbackNode;if(Qc()&&s.callbackNode!==t)return null;var n=zm(s,s===Mt?qt:0);if(n===0)return null;if(n&30||n&s.expiredLanes||e)e=oy(s,n);else{e=n;var i=ye;ye|=2;var r=_E();(Mt!==s||qt!==e)&&(Ji=null,Ih=ht()+500,Yl(s,e));do try{jR();break}catch(l){bE(s,l)}while(!0);g_(),sy.current=r,ye=i,gt!==null?e=0:(Mt=null,qt=0,e=Et)}if(e!==0){if(e===2&&(i=Tv(s),i!==0&&(n=i,e=nw(s,i))),e===1)throw t=ef,Yl(s,0),io(s,n),Bn(s,ht()),t;if(e===6)io(s,n);else{if(i=s.current.alternate,!(n&30)&&!MR(i)&&(e=oy(s,n),e===2&&(r=Tv(s),r!==0&&(n=r,e=nw(s,r))),e===1))throw t=ef,Yl(s,0),io(s,n),Bn(s,ht()),t;switch(s.finishedWork=i,s.finishedLanes=n,e){case 0:case 1:throw Error($(345));case 2:Aa(s,On,Ji);break;case 3:if(io(s,n),(n&130023424)===n&&(e=R_+500-ht(),10<e)){if(zm(s,0)!==0)break;if(i=s.suspendedLanes,(i&n)!==n){wn(),s.pingedLanes|=s.suspendedLanes&i;break}s.timeoutHandle=Mv(Aa.bind(null,s,On,Ji),e);break}Aa(s,On,Ji);break;case 4:if(io(s,n),(n&4194240)===n)break;for(e=s.eventTimes,i=-1;0<n;){var o=31-li(n);r=1<<o,o=e[o],o>i&&(i=o),n&=~r}if(n=i,n=ht()-n,n=(120>n?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*LR(n/1960))-n,10<n){s.timeoutHandle=Mv(Aa.bind(null,s,On,Ji),n);break}Aa(s,On,Ji);break;case 5:Aa(s,On,Ji);break;default:throw Error($(329))}}}return Bn(s,ht()),s.callbackNode===t?wE.bind(null,s):null}function nw(s,e){var t=Dd;return s.current.memoizedState.isDehydrated&&(Yl(s,e).flags|=256),s=oy(s,e),s!==2&&(e=On,On=t,e!==null&&sw(e)),s}function sw(s){On===null?On=s:On.push.apply(On,s)}function MR(s){for(var e=s;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var n=0;n<t.length;n++){var i=t[n],r=i.getSnapshot;i=i.value;try{if(!ui(r(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===s)break;for(;e.sibling===null;){if(e.return===null||e.return===s)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function io(s,e){for(e&=~P_,e&=~Qy,s.suspendedLanes|=e,s.pingedLanes&=~e,s=s.expirationTimes;0<e;){var t=31-li(e),n=1<<t;s[t]=-1,e&=~n}}function gA(s){if(ye&6)throw Error($(327));Qc();var e=zm(s,0);if(!(e&1))return Bn(s,ht()),null;var t=oy(s,e);if(s.tag!==0&&t===2){var n=Tv(s);n!==0&&(e=n,t=nw(s,n))}if(t===1)throw t=ef,Yl(s,0),io(s,e),Bn(s,ht()),t;if(t===6)throw Error($(345));return s.finishedWork=s.current.alternate,s.finishedLanes=e,Aa(s,On,Ji),Bn(s,ht()),null}function N_(s,e){var t=ye;ye|=1;try{return s(e)}finally{ye=t,ye===0&&(Ih=ht()+500,Ky&&ma())}}function nc(s){ea!==null&&ea.tag===0&&!(ye&6)&&Qc();var e=ye;ye|=1;var t=Ds.transition,n=Ce;try{if(Ds.transition=null,Ce=1,s)return s()}finally{Ce=n,Ds.transition=t,ye=e,!(ye&6)&&ma()}}function I_(){os=$c.current,Ve($c)}function Yl(s,e){s.finishedWork=null,s.finishedLanes=0;var t=s.timeoutHandle;if(t!==-1&&(s.timeoutHandle=-1,dR(t)),gt!==null)for(t=gt.return;t!==null;){var n=t;switch(d_(n),n.tag){case 1:n=n.type.childContextTypes,n!=null&&qm();break;case 3:Rh(),Ve(Fn),Ve(an),__();break;case 5:b_(n);break;case 4:Rh();break;case 13:Ve(Qe);break;case 19:Ve(Qe);break;case 10:m_(n.type._context);break;case 22:case 23:I_()}t=t.return}if(Mt=s,gt=s=la(s.current,null),qt=os=e,Et=0,ef=null,P_=Qy=tc=0,On=Dd=null,Da!==null){for(e=0;e<Da.length;e++)if(t=Da[e],n=t.interleaved,n!==null){t.interleaved=null;var i=n.next,r=t.pending;if(r!==null){var o=r.next;r.next=i,n.next=o}t.pending=n}Da=null}return s}function bE(s,e){do{var t=gt;try{if(g_(),Qg.current=ny,ty){for(var n=Ze.memoizedState;n!==null;){var i=n.queue;i!==null&&(i.pending=null),n=n.next}ty=!1}if(ec=0,Lt=St=Ze=null,Nd=!1,Jd=0,T_.current=null,t===null||t.return===null){Et=1,ef=e,gt=null;break}e:{var r=s,o=t.return,l=t,c=e;if(e=qt,l.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var u=c,h=l,d=h.tag;if(!(h.mode&1)&&(d===0||d===11||d===15)){var f=h.alternate;f?(h.updateQueue=f.updateQueue,h.memoizedState=f.memoizedState,h.lanes=f.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=nA(o);if(p!==null){p.flags&=-257,sA(p,o,l,r,e),p.mode&1&&tA(r,u,e),e=p,c=u;var y=e.updateQueue;if(y===null){var _=new Set;_.add(c),e.updateQueue=_}else y.add(c);break e}else{if(!(e&1)){tA(r,u,e),D_();break e}c=Error($(426))}}else if(Ke&&l.mode&1){var A=nA(o);if(A!==null){!(A.flags&65536)&&(A.flags|=256),sA(A,o,l,r,e),f_(Nh(c,l));break e}}r=c=Nh(c,l),Et!==4&&(Et=2),Dd===null?Dd=[r]:Dd.push(r),r=o;do{switch(r.tag){case 3:r.flags|=65536,e&=-e,r.lanes|=e;var m=sE(r,c,e);Xx(r,m);break e;case 1:l=c;var b=r.type,v=r.stateNode;if(!(r.flags&128)&&(typeof b.getDerivedStateFromError=="function"||v!==null&&typeof v.componentDidCatch=="function"&&(oa===null||!oa.has(v)))){r.flags|=65536,e&=-e,r.lanes|=e;var S=iE(r,l,e);Xx(r,S);break e}}r=r.return}while(r!==null)}AE(t)}catch(C){e=C,gt===t&&t!==null&&(gt=t=t.return);continue}break}while(!0)}function _E(){var s=sy.current;return sy.current=ny,s===null?ny:s}function D_(){(Et===0||Et===3||Et===2)&&(Et=4),Mt===null||!(tc&268435455)&&!(Qy&268435455)||io(Mt,qt)}function oy(s,e){var t=ye;ye|=2;var n=_E();(Mt!==s||qt!==e)&&(Ji=null,Yl(s,e));do try{FR();break}catch(i){bE(s,i)}while(!0);if(g_(),ye=t,sy.current=n,gt!==null)throw Error($(261));return Mt=null,qt=0,Et}function FR(){for(;gt!==null;)xE(gt)}function jR(){for(;gt!==null&&!cP();)xE(gt)}function xE(s){var e=EE(s.alternate,s,os);s.memoizedProps=s.pendingProps,e===null?AE(s):gt=e,T_.current=null}function AE(s){var e=s;do{var t=e.alternate;if(s=e.return,e.flags&32768){if(t=NR(t,e),t!==null){t.flags&=32767,gt=t;return}if(s!==null)s.flags|=32768,s.subtreeFlags=0,s.deletions=null;else{Et=6,gt=null;return}}else if(t=RR(t,e,os),t!==null){gt=t;return}if(e=e.sibling,e!==null){gt=e;return}gt=e=s}while(e!==null);Et===0&&(Et=5)}function Aa(s,e,t){var n=Ce,i=Ds.transition;try{Ds.transition=null,Ce=1,BR(s,e,t,n)}finally{Ds.transition=i,Ce=n}return null}function BR(s,e,t,n){do Qc();while(ea!==null);if(ye&6)throw Error($(327));t=s.finishedWork;var i=s.finishedLanes;if(t===null)return null;if(s.finishedWork=null,s.finishedLanes=0,t===s.current)throw Error($(177));s.callbackNode=null,s.callbackPriority=0;var r=t.lanes|t.childLanes;if(wP(s,r),s===Mt&&(gt=Mt=null,qt=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Tg||(Tg=!0,CE(Um,function(){return Qc(),null})),r=(t.flags&15990)!==0,t.subtreeFlags&15990||r){r=Ds.transition,Ds.transition=null;var o=Ce;Ce=1;var l=ye;ye|=4,T_.current=null,DR(s,t),yE(t,s),rR(Ov),Hm=!!Dv,Ov=Dv=null,s.current=t,OR(t),uP(),ye=l,Ce=o,Ds.transition=r}else s.current=t;if(Tg&&(Tg=!1,ea=s,ry=i),r=s.pendingLanes,r===0&&(oa=null),fP(t.stateNode),Bn(s,ht()),e!==null)for(n=s.onRecoverableError,t=0;t<e.length;t++)i=e[t],n(i.value,{componentStack:i.stack,digest:i.digest});if(iy)throw iy=!1,s=ew,ew=null,s;return ry&1&&s.tag!==0&&Qc(),r=s.pendingLanes,r&1?s===tw?Od++:(Od=0,tw=s):Od=0,ma(),null}function Qc(){if(ea!==null){var s=s1(ry),e=Ds.transition,t=Ce;try{if(Ds.transition=null,Ce=16>s?16:s,ea===null)var n=!1;else{if(s=ea,ea=null,ry=0,ye&6)throw Error($(331));var i=ye;for(ye|=4,q=s.current;q!==null;){var r=q,o=r.child;if(q.flags&16){var l=r.deletions;if(l!==null){for(var c=0;c<l.length;c++){var u=l[c];for(q=u;q!==null;){var h=q;switch(h.tag){case 0:case 11:case 15:Id(8,h,r)}var d=h.child;if(d!==null)d.return=h,q=d;else for(;q!==null;){h=q;var f=h.sibling,p=h.return;if(pE(h),h===u){q=null;break}if(f!==null){f.return=p,q=f;break}q=p}}}var y=r.alternate;if(y!==null){var _=y.child;if(_!==null){y.child=null;do{var A=_.sibling;_.sibling=null,_=A}while(_!==null)}}q=r}}if(r.subtreeFlags&2064&&o!==null)o.return=r,q=o;else e:for(;q!==null;){if(r=q,r.flags&2048)switch(r.tag){case 0:case 11:case 15:Id(9,r,r.return)}var m=r.sibling;if(m!==null){m.return=r.return,q=m;break e}q=r.return}}var b=s.current;for(q=b;q!==null;){o=q;var v=o.child;if(o.subtreeFlags&2064&&v!==null)v.return=o,q=v;else e:for(o=b;q!==null;){if(l=q,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:Jy(9,l)}}catch(C){at(l,l.return,C)}if(l===o){q=null;break e}var S=l.sibling;if(S!==null){S.return=l.return,q=S;break e}q=l.return}}if(ye=i,ma(),zi&&typeof zi.onPostCommitFiberRoot=="function")try{zi.onPostCommitFiberRoot(Hy,s)}catch{}n=!0}return n}finally{Ce=t,Ds.transition=e}}return!1}function mA(s,e,t){e=Nh(t,e),e=sE(s,e,1),s=ra(s,e,1),e=wn(),s!==null&&(Qp(s,1,e),Bn(s,e))}function at(s,e,t){if(s.tag===3)mA(s,s,t);else for(;e!==null;){if(e.tag===3){mA(e,s,t);break}else if(e.tag===1){var n=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof n.componentDidCatch=="function"&&(oa===null||!oa.has(n))){s=Nh(t,s),s=iE(e,s,1),e=ra(e,s,1),s=wn(),e!==null&&(Qp(e,1,s),Bn(e,s));break}}e=e.return}}function $R(s,e,t){var n=s.pingCache;n!==null&&n.delete(e),e=wn(),s.pingedLanes|=s.suspendedLanes&t,Mt===s&&(qt&t)===t&&(Et===4||Et===3&&(qt&130023424)===qt&&500>ht()-R_?Yl(s,0):P_|=t),Bn(s,e)}function SE(s,e){e===0&&(s.mode&1?(e=vg,vg<<=1,!(vg&130023424)&&(vg=4194304)):e=1);var t=wn();s=Wr(s,e),s!==null&&(Qp(s,e,t),Bn(s,t))}function UR(s){var e=s.memoizedState,t=0;e!==null&&(t=e.retryLane),SE(s,t)}function zR(s,e){var t=0;switch(s.tag){case 13:var n=s.stateNode,i=s.memoizedState;i!==null&&(t=i.retryLane);break;case 19:n=s.stateNode;break;default:throw Error($(314))}n!==null&&n.delete(e),SE(s,t)}var EE;EE=function(s,e,t){if(s!==null)if(s.memoizedProps!==e.pendingProps||Fn.current)Mn=!0;else{if(!(s.lanes&t)&&!(e.flags&128))return Mn=!1,PR(s,e,t);Mn=!!(s.flags&131072)}else Mn=!1,Ke&&e.flags&1048576&&P1(e,Ym,e.index);switch(e.lanes=0,e.tag){case 2:var n=e.type;em(s,e),s=e.pendingProps;var i=kh(e,an.current);Jc(e,t),i=A_(null,e,n,s,i,t);var r=S_();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,jn(n)?(r=!0,Km(e)):r=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,v_(e),i.updater=Yy,e.stateNode=i,i._reactInternals=e,Hv(e,n,s,t),e=Gv(null,e,n,!0,r,t)):(e.tag=0,Ke&&r&&h_(e),yn(null,e,i,t),e=e.child),e;case 16:n=e.elementType;e:{switch(em(s,e),s=e.pendingProps,i=n._init,n=i(n._payload),e.type=n,i=e.tag=VR(n),s=Vs(n,s),i){case 0:e=Wv(null,e,n,s,t);break e;case 1:e=oA(null,e,n,s,t);break e;case 11:e=iA(null,e,n,s,t);break e;case 14:e=rA(null,e,n,Vs(n.type,s),t);break e}throw Error($(306,n,""))}return e;case 0:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Vs(n,i),Wv(s,e,n,i,t);case 1:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Vs(n,i),oA(s,e,n,i,t);case 3:e:{if(lE(e),s===null)throw Error($(387));n=e.pendingProps,r=e.memoizedState,i=r.element,L1(s,e),Zm(e,n,null,t);var o=e.memoizedState;if(n=o.element,r.isDehydrated)if(r={element:n,isDehydrated:!1,cache:o.cache,pendingSuspenseBoundaries:o.pendingSuspenseBoundaries,transitions:o.transitions},e.updateQueue.baseState=r,e.memoizedState=r,e.flags&256){i=Nh(Error($(423)),e),e=aA(s,e,n,t,i);break e}else if(n!==i){i=Nh(Error($(424)),e),e=aA(s,e,n,t,i);break e}else for(cs=ia(e.stateNode.containerInfo.firstChild),us=e,Ke=!0,ri=null,t=D1(e,null,n,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Th(),n===i){e=Gr(s,e,t);break e}yn(s,e,n,t)}e=e.child}return e;case 5:return M1(e),s===null&&$v(e),n=e.type,i=e.pendingProps,r=s!==null?s.memoizedProps:null,o=i.children,Lv(n,i)?o=null:r!==null&&Lv(n,r)&&(e.flags|=32),aE(s,e),yn(s,e,o,t),e.child;case 6:return s===null&&$v(e),null;case 13:return cE(s,e,t);case 4:return w_(e,e.stateNode.containerInfo),n=e.pendingProps,s===null?e.child=Ph(e,null,n,t):yn(s,e,n,t),e.child;case 11:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Vs(n,i),iA(s,e,n,i,t);case 7:return yn(s,e,e.pendingProps,t),e.child;case 8:return yn(s,e,e.pendingProps.children,t),e.child;case 12:return yn(s,e,e.pendingProps.children,t),e.child;case 10:e:{if(n=e.type._context,i=e.pendingProps,r=e.memoizedProps,o=i.value,$e(Jm,n._currentValue),n._currentValue=o,r!==null)if(ui(r.value,o)){if(r.children===i.children&&!Fn.current){e=Gr(s,e,t);break e}}else for(r=e.child,r!==null&&(r.return=e);r!==null;){var l=r.dependencies;if(l!==null){o=r.child;for(var c=l.firstContext;c!==null;){if(c.context===n){if(r.tag===1){c=Br(-1,t&-t),c.tag=2;var u=r.updateQueue;if(u!==null){u=u.shared;var h=u.pending;h===null?c.next=c:(c.next=h.next,h.next=c),u.pending=c}}r.lanes|=t,c=r.alternate,c!==null&&(c.lanes|=t),Uv(r.return,t,e),l.lanes|=t;break}c=c.next}}else if(r.tag===10)o=r.type===e.type?null:r.child;else if(r.tag===18){if(o=r.return,o===null)throw Error($(341));o.lanes|=t,l=o.alternate,l!==null&&(l.lanes|=t),Uv(o,t,e),o=r.sibling}else o=r.child;if(o!==null)o.return=r;else for(o=r;o!==null;){if(o===e){o=null;break}if(r=o.sibling,r!==null){r.return=o.return,o=r;break}o=o.return}r=o}yn(s,e,i.children,t),e=e.child}return e;case 9:return i=e.type,n=e.pendingProps.children,Jc(e,t),i=Ms(i),n=n(i),e.flags|=1,yn(s,e,n,t),e.child;case 14:return n=e.type,i=Vs(n,e.pendingProps),i=Vs(n.type,i),rA(s,e,n,i,t);case 15:return rE(s,e,e.type,e.pendingProps,t);case 17:return n=e.type,i=e.pendingProps,i=e.elementType===n?i:Vs(n,i),em(s,e),e.tag=1,jn(n)?(s=!0,Km(e)):s=!1,Jc(e,t),nE(e,n,i),Hv(e,n,i,t),Gv(null,e,n,!0,s,t);case 19:return uE(s,e,t);case 22:return oE(s,e,t)}throw Error($(156,e.tag))};function CE(s,e){return ZS(s,e)}function HR(s,e,t,n){this.tag=s,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Is(s,e,t,n){return new HR(s,e,t,n)}function O_(s){return s=s.prototype,!(!s||!s.isReactComponent)}function VR(s){if(typeof s=="function")return O_(s)?1:0;if(s!=null){if(s=s.$$typeof,s===Zb)return 11;if(s===e_)return 14}return 2}function la(s,e){var t=s.alternate;return t===null?(t=Is(s.tag,e,s.key,s.mode),t.elementType=s.elementType,t.type=s.type,t.stateNode=s.stateNode,t.alternate=s,s.alternate=t):(t.pendingProps=e,t.type=s.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=s.flags&14680064,t.childLanes=s.childLanes,t.lanes=s.lanes,t.child=s.child,t.memoizedProps=s.memoizedProps,t.memoizedState=s.memoizedState,t.updateQueue=s.updateQueue,e=s.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=s.sibling,t.index=s.index,t.ref=s.ref,t}function sm(s,e,t,n,i,r){var o=2;if(n=s,typeof s=="function")O_(s)&&(o=1);else if(typeof s=="string")o=5;else e:switch(s){case Rc:return Jl(t.children,i,r,e);case Qb:o=8,i|=8;break;case fv:return s=Is(12,t,e,i|2),s.elementType=fv,s.lanes=r,s;case pv:return s=Is(13,t,e,i),s.elementType=pv,s.lanes=r,s;case gv:return s=Is(19,t,e,i),s.elementType=gv,s.lanes=r,s;case MS:return Zy(t,i,r,e);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case OS:o=10;break e;case LS:o=9;break e;case Zb:o=11;break e;case e_:o=14;break e;case eo:o=16,n=null;break e}throw Error($(130,s==null?s:typeof s,""))}return e=Is(o,t,e,i),e.elementType=s,e.type=n,e.lanes=r,e}function Jl(s,e,t,n){return s=Is(7,s,n,e),s.lanes=t,s}function Zy(s,e,t,n){return s=Is(22,s,n,e),s.elementType=MS,s.lanes=t,s.stateNode={isHidden:!1},s}function U0(s,e,t){return s=Is(6,s,null,e),s.lanes=t,s}function z0(s,e,t){return e=Is(4,s.children!==null?s.children:[],s.key,e),e.lanes=t,e.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},e}function WR(s,e,t,n,i){this.tag=e,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=x0(0),this.expirationTimes=x0(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=x0(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function L_(s,e,t,n,i,r,o,l,c){return s=new WR(s,e,t,l,c),e===1?(e=1,r===!0&&(e|=8)):e=0,r=Is(3,null,null,e),s.current=r,r.stateNode=s,r.memoizedState={element:n,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},v_(r),s}function GR(s,e,t){var n=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Pc,key:n==null?null:""+n,children:s,containerInfo:e,implementation:t}}function kE(s){if(!s)return ua;s=s._reactInternals;e:{if(ac(s)!==s||s.tag!==1)throw Error($(170));var e=s;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(jn(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error($(171))}if(s.tag===1){var t=s.type;if(jn(t))return k1(s,t,e)}return e}function TE(s,e,t,n,i,r,o,l,c){return s=L_(t,n,!0,s,i,r,o,l,c),s.context=kE(null),t=s.current,n=wn(),i=aa(t),r=Br(n,i),r.callback=e??null,ra(t,r,i),s.current.lanes=i,Qp(s,i,n),Bn(s,n),s}function e0(s,e,t,n){var i=e.current,r=wn(),o=aa(i);return t=kE(t),e.context===null?e.context=t:e.pendingContext=t,e=Br(r,o),e.payload={element:s},n=n===void 0?null:n,n!==null&&(e.callback=n),s=ra(i,e,o),s!==null&&(ci(s,i,o,r),Jg(s,i,o)),o}function ay(s){if(s=s.current,!s.child)return null;switch(s.child.tag){case 5:return s.child.stateNode;default:return s.child.stateNode}}function yA(s,e){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var t=s.retryLane;s.retryLane=t!==0&&t<e?t:e}}function M_(s,e){yA(s,e),(s=s.alternate)&&yA(s,e)}function qR(){return null}var PE=typeof reportError=="function"?reportError:function(s){console.error(s)};function F_(s){this._internalRoot=s}t0.prototype.render=F_.prototype.render=function(s){var e=this._internalRoot;if(e===null)throw Error($(409));e0(s,e,null,null)};t0.prototype.unmount=F_.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var e=s.containerInfo;nc(function(){e0(null,s,null,null)}),e[Vr]=null}};function t0(s){this._internalRoot=s}t0.prototype.unstable_scheduleHydration=function(s){if(s){var e=o1();s={blockedOn:null,target:s,priority:e};for(var t=0;t<so.length&&e!==0&&e<so[t].priority;t++);so.splice(t,0,s),t===0&&l1(s)}};function j_(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function n0(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11&&(s.nodeType!==8||s.nodeValue!==" react-mount-point-unstable "))}function vA(){}function KR(s,e,t,n,i){if(i){if(typeof n=="function"){var r=n;n=function(){var u=ay(o);r.call(u)}}var o=TE(e,n,s,0,null,!1,!1,"",vA);return s._reactRootContainer=o,s[Vr]=o.current,Gd(s.nodeType===8?s.parentNode:s),nc(),o}for(;i=s.lastChild;)s.removeChild(i);if(typeof n=="function"){var l=n;n=function(){var u=ay(c);l.call(u)}}var c=L_(s,0,!1,null,null,!1,!1,"",vA);return s._reactRootContainer=c,s[Vr]=c.current,Gd(s.nodeType===8?s.parentNode:s),nc(function(){e0(e,c,t,n)}),c}function s0(s,e,t,n,i){var r=t._reactRootContainer;if(r){var o=r;if(typeof i=="function"){var l=i;i=function(){var c=ay(o);l.call(c)}}e0(e,o,s,i)}else o=KR(t,e,s,i,n);return ay(o)}i1=function(s){switch(s.tag){case 3:var e=s.stateNode;if(e.current.memoizedState.isDehydrated){var t=nd(e.pendingLanes);t!==0&&(s_(e,t|1),Bn(e,ht()),!(ye&6)&&(Ih=ht()+500,ma()))}break;case 13:nc(function(){var n=Wr(s,1);if(n!==null){var i=wn();ci(n,s,1,i)}}),M_(s,1)}};i_=function(s){if(s.tag===13){var e=Wr(s,134217728);if(e!==null){var t=wn();ci(e,s,134217728,t)}M_(s,134217728)}};r1=function(s){if(s.tag===13){var e=aa(s),t=Wr(s,e);if(t!==null){var n=wn();ci(t,s,e,n)}M_(s,e)}};o1=function(){return Ce};a1=function(s,e){var t=Ce;try{return Ce=s,e()}finally{Ce=t}};Ev=function(s,e,t){switch(e){case"input":if(vv(s,t),e=t.name,t.type==="radio"&&e!=null){for(t=s;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var n=t[e];if(n!==s&&n.form===s.form){var i=qy(n);if(!i)throw Error($(90));jS(n),vv(n,i)}}}break;case"textarea":$S(s,t);break;case"select":e=t.value,e!=null&&qc(s,!!t.multiple,e,!1)}};qS=N_;KS=nc;var XR={usingClientEntryPoint:!1,Events:[eg,Oc,qy,WS,GS,N_]},qh={findFiberByHostInstance:Ia,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},YR={bundleType:qh.bundleType,version:qh.version,rendererPackageName:qh.rendererPackageName,rendererConfig:qh.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Xr.ReactCurrentDispatcher,findHostInstanceByFiber:function(s){return s=JS(s),s===null?null:s.stateNode},findFiberByHostInstance:qh.findFiberByHostInstance||qR,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Pg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Pg.isDisabled&&Pg.supportsFiber)try{Hy=Pg.inject(YR),zi=Pg}catch{}}fs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=XR;fs.createPortal=function(s,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!j_(e))throw Error($(200));return GR(s,e,null,t)};fs.createRoot=function(s,e){if(!j_(s))throw Error($(299));var t=!1,n="",i=PE;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(n=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=L_(s,1,!1,null,null,t,!1,n,i),s[Vr]=e.current,Gd(s.nodeType===8?s.parentNode:s),new F_(e)};fs.findDOMNode=function(s){if(s==null)return null;if(s.nodeType===1)return s;var e=s._reactInternals;if(e===void 0)throw typeof s.render=="function"?Error($(188)):(s=Object.keys(s).join(","),Error($(268,s)));return s=JS(e),s=s===null?null:s.stateNode,s};fs.flushSync=function(s){return nc(s)};fs.hydrate=function(s,e,t){if(!n0(e))throw Error($(200));return s0(null,s,e,!0,t)};fs.hydrateRoot=function(s,e,t){if(!j_(s))throw Error($(405));var n=t!=null&&t.hydratedSources||null,i=!1,r="",o=PE;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(r=t.identifierPrefix),t.onRecoverableError!==void 0&&(o=t.onRecoverableError)),e=TE(e,null,s,1,t??null,i,!1,r,o),s[Vr]=e.current,Gd(s),n)for(s=0;s<n.length;s++)t=n[s],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new t0(e)};fs.render=function(s,e,t){if(!n0(e))throw Error($(200));return s0(null,s,e,!1,t)};fs.unmountComponentAtNode=function(s){if(!n0(s))throw Error($(40));return s._reactRootContainer?(nc(function(){s0(null,null,s,!1,function(){s._reactRootContainer=null,s[Vr]=null})}),!0):!1};fs.unstable_batchedUpdates=N_;fs.unstable_renderSubtreeIntoContainer=function(s,e,t,n){if(!n0(t))throw Error($(200));if(s==null||s._reactInternals===void 0)throw Error($(38));return s0(s,e,t,!1,n)};fs.version="18.3.1-next-f1338f8080-20240426";function RE(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(RE)}catch(s){console.error(s)}}RE(),RS.exports=fs;var JR=RS.exports,NE,wA=JR;NE=wA.createRoot,wA.hydrateRoot;const QR="modulepreload",ZR=function(s){return"/"+s},bA={},ng=function(e,t,n){let i=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));i=Promise.allSettled(t.map(c=>{if(c=ZR(c),c in bA)return;bA[c]=!0;const u=c.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${h}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":QR,u||(d.as="script"),d.crossOrigin="",d.href=c,l&&d.setAttribute("nonce",l),document.head.appendChild(d),u)return new Promise((f,p)=>{d.addEventListener("load",f),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function r(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return i.then(o=>{for(const l of o||[])l.status==="rejected"&&r(l.reason);return e().catch(r)})},e2=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>ng(async()=>{const{default:n}=await Promise.resolve().then(()=>Fh);return{default:n}},[]).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)};class B_ extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class t2 extends B_{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class _A extends B_{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class xA extends B_{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var iw;(function(s){s.Any="any",s.ApNortheast1="ap-northeast-1",s.ApNortheast2="ap-northeast-2",s.ApSouth1="ap-south-1",s.ApSoutheast1="ap-southeast-1",s.ApSoutheast2="ap-southeast-2",s.CaCentral1="ca-central-1",s.EuCentral1="eu-central-1",s.EuWest1="eu-west-1",s.EuWest2="eu-west-2",s.EuWest3="eu-west-3",s.SaEast1="sa-east-1",s.UsEast1="us-east-1",s.UsWest1="us-west-1",s.UsWest2="us-west-2"})(iw||(iw={}));var n2=function(s,e,t,n){function i(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function l(h){try{u(n.next(h))}catch(d){o(d)}}function c(h){try{u(n.throw(h))}catch(d){o(d)}}function u(h){h.done?r(h.value):i(h.value).then(l,c)}u((n=n.apply(s,e||[])).next())})};class s2{constructor(e,{headers:t={},customFetch:n,region:i=iw.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=e2(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var n;return n2(this,void 0,void 0,function*(){try{const{headers:i,method:r,body:o}=t;let l={},{region:c}=t;c||(c=this.region);const u=new URL(`${this.url}/${e}`);c&&c!=="any"&&(l["x-region"]=c,u.searchParams.set("forceFunctionRegion",c));let h;o&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(l["Content-Type"]="application/octet-stream",h=o):typeof o=="string"?(l["Content-Type"]="text/plain",h=o):typeof FormData<"u"&&o instanceof FormData?h=o:(l["Content-Type"]="application/json",h=JSON.stringify(o)));const d=yield this.fetch(u.toString(),{method:r||"POST",headers:Object.assign(Object.assign(Object.assign({},l),this.headers),i),body:h}).catch(_=>{throw new t2(_)}),f=d.headers.get("x-relay-error");if(f&&f==="true")throw new _A(d);if(!d.ok)throw new xA(d);let p=((n=d.headers.get("Content-Type"))!==null&&n!==void 0?n:"text/plain").split(";")[0].trim(),y;return p==="application/json"?y=yield d.json():p==="application/octet-stream"?y=yield d.blob():p==="text/event-stream"?y=d:p==="multipart/form-data"?y=yield d.formData():y=yield d.text(),{data:y,error:null,response:d}}catch(i){return{data:null,error:i,response:i instanceof xA||i instanceof _A?i.context:void 0}}})}}var Ln={},$_={},i0={},sg={},r0={},o0={},i2=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},Dh=i2();const r2=Dh.fetch,IE=Dh.fetch.bind(Dh),DE=Dh.Headers,o2=Dh.Request,a2=Dh.Response,Fh=Object.freeze(Object.defineProperty({__proto__:null,Headers:DE,Request:o2,Response:a2,default:IE,fetch:r2},Symbol.toStringTag,{value:"Module"})),l2=ET(Fh);var a0={};Object.defineProperty(a0,"__esModule",{value:!0});let c2=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};a0.default=c2;var OE=Ls&&Ls.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(o0,"__esModule",{value:!0});const u2=OE(l2),h2=OE(a0);let d2=class{constructor(e){var t,n;this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=new Headers(e.headers),this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=(t=e.shouldThrowOnError)!==null&&t!==void 0?t:!1,this.signal=e.signal,this.isMaybeSingle=(n=e.isMaybeSingle)!==null&&n!==void 0?n:!1,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=u2.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=new Headers(this.headers),this.headers.set(e,t),this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let i=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async r=>{var o,l,c,u;let h=null,d=null,f=null,p=r.status,y=r.statusText;if(r.ok){if(this.method!=="HEAD"){const b=await r.text();b===""||(this.headers.get("Accept")==="text/csv"||this.headers.get("Accept")&&(!((o=this.headers.get("Accept"))===null||o===void 0)&&o.includes("application/vnd.pgrst.plan+text"))?d=b:d=JSON.parse(b))}const A=(l=this.headers.get("Prefer"))===null||l===void 0?void 0:l.match(/count=(exact|planned|estimated)/),m=(c=r.headers.get("content-range"))===null||c===void 0?void 0:c.split("/");A&&m&&m.length>1&&(f=parseInt(m[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(d)&&(d.length>1?(h={code:"PGRST116",details:`Results contain ${d.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},d=null,f=null,p=406,y="Not Acceptable"):d.length===1?d=d[0]:d=null)}else{const A=await r.text();try{h=JSON.parse(A),Array.isArray(h)&&r.status===404&&(d=[],h=null,p=200,y="OK")}catch{r.status===404&&A===""?(p=204,y="No Content"):h={message:A}}if(h&&this.isMaybeSingle&&(!((u=h==null?void 0:h.details)===null||u===void 0)&&u.includes("0 rows"))&&(h=null,p=200,y="OK"),h&&this.shouldThrowOnError)throw new h2.default(h)}return{error:h,data:d,count:f,status:p,statusText:y}});return this.shouldThrowOnError||(i=i.catch(r=>{var o,l,c;return{error:{message:`${(o=r==null?void 0:r.name)!==null&&o!==void 0?o:"FetchError"}: ${r==null?void 0:r.message}`,details:`${(l=r==null?void 0:r.stack)!==null&&l!==void 0?l:""}`,hint:"",code:`${(c=r==null?void 0:r.code)!==null&&c!==void 0?c:""}`},data:null,count:null,status:0,statusText:""}})),i.then(e,t)}returns(){return this}overrideTypes(){return this}};o0.default=d2;var f2=Ls&&Ls.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(r0,"__esModule",{value:!0});const p2=f2(o0);let g2=class extends p2.default{select(e){let t=!1;const n=(e??"*").split("").map(i=>/\s/.test(i)&&!t?"":(i==='"'&&(t=!t),i)).join("");return this.url.searchParams.set("select",n),this.headers.append("Prefer","return=representation"),this}order(e,{ascending:t=!0,nullsFirst:n,foreignTable:i,referencedTable:r=i}={}){const o=r?`${r}.order`:"order",l=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${l?`${l},`:""}${e}.${t?"asc":"desc"}${n===void 0?"":n?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:n=t}={}){const i=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(i,`${e}`),this}range(e,t,{foreignTable:n,referencedTable:i=n}={}){const r=typeof i>"u"?"offset":`${i}.offset`,o=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(r,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:e=!1,verbose:t=!1,settings:n=!1,buffers:i=!1,wal:r=!1,format:o="text"}={}){var l;const c=[e?"analyze":null,t?"verbose":null,n?"settings":null,i?"buffers":null,r?"wal":null].filter(Boolean).join("|"),u=(l=this.headers.get("Accept"))!==null&&l!==void 0?l:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${o}; for="${u}"; options=${c};`),o==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(e){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${e}`),this}};r0.default=g2;var m2=Ls&&Ls.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(sg,"__esModule",{value:!0});const y2=m2(r0);let v2=class extends y2.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const n=Array.from(new Set(t)).map(i=>typeof i=="string"&&new RegExp("[,()]").test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(e,`in.(${n})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:n,type:i}={}){let r="";i==="plain"?r="pl":i==="phrase"?r="ph":i==="websearch"&&(r="w");const o=n===void 0?"":`(${n})`;return this.url.searchParams.append(e,`${r}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,n])=>{this.url.searchParams.append(t,`eq.${n}`)}),this}not(e,t,n){return this.url.searchParams.append(e,`not.${t}.${n}`),this}or(e,{foreignTable:t,referencedTable:n=t}={}){const i=n?`${n}.or`:"or";return this.url.searchParams.append(i,`(${e})`),this}filter(e,t,n){return this.url.searchParams.append(e,`${t}.${n}`),this}};sg.default=v2;var w2=Ls&&Ls.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(i0,"__esModule",{value:!0});const Kh=w2(sg);let b2=class{constructor(e,{headers:t={},schema:n,fetch:i}){this.url=e,this.headers=new Headers(t),this.schema=n,this.fetch=i}select(e,{head:t=!1,count:n}={}){const i=t?"HEAD":"GET";let r=!1;const o=(e??"*").split("").map(l=>/\s/.test(l)&&!r?"":(l==='"'&&(r=!r),l)).join("");return this.url.searchParams.set("select",o),n&&this.headers.append("Prefer",`count=${n}`),new Kh.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch})}insert(e,{count:t,defaultToNull:n=!0}={}){var i;const r="POST";if(t&&this.headers.append("Prefer",`count=${t}`),n||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const o=e.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(o.length>0){const l=[...new Set(o)].map(c=>`"${c}"`);this.url.searchParams.set("columns",l.join(","))}}return new Kh.default({method:r,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(i=this.fetch)!==null&&i!==void 0?i:fetch})}upsert(e,{onConflict:t,ignoreDuplicates:n=!1,count:i,defaultToNull:r=!0}={}){var o;const l="POST";if(this.headers.append("Prefer",`resolution=${n?"ignore":"merge"}-duplicates`),t!==void 0&&this.url.searchParams.set("on_conflict",t),i&&this.headers.append("Prefer",`count=${i}`),r||this.headers.append("Prefer","missing=default"),Array.isArray(e)){const c=e.reduce((u,h)=>u.concat(Object.keys(h)),[]);if(c.length>0){const u=[...new Set(c)].map(h=>`"${h}"`);this.url.searchParams.set("columns",u.join(","))}}return new Kh.default({method:l,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}update(e,{count:t}={}){var n;const i="PATCH";return t&&this.headers.append("Prefer",`count=${t}`),new Kh.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch})}delete({count:e}={}){var t;const n="DELETE";return e&&this.headers.append("Prefer",`count=${e}`),new Kh.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch})}};i0.default=b2;var LE=Ls&&Ls.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty($_,"__esModule",{value:!0});const _2=LE(i0),x2=LE(sg);let A2=class ME{constructor(e,{headers:t={},schema:n,fetch:i}={}){this.url=e,this.headers=new Headers(t),this.schemaName=n,this.fetch=i}from(e){const t=new URL(`${this.url}/${e}`);return new _2.default(t,{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new ME(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:n=!1,get:i=!1,count:r}={}){var o;let l;const c=new URL(`${this.url}/rpc/${e}`);let u;n||i?(l=n?"HEAD":"GET",Object.entries(t).filter(([d,f])=>f!==void 0).map(([d,f])=>[d,Array.isArray(f)?`{${f.join(",")}}`:`${f}`]).forEach(([d,f])=>{c.searchParams.append(d,f)})):(l="POST",u=t);const h=new Headers(this.headers);return r&&h.set("Prefer",`count=${r}`),new x2.default({method:l,url:c,headers:h,schema:this.schemaName,body:u,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch})}};$_.default=A2;var jh=Ls&&Ls.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(Ln,"__esModule",{value:!0});Ln.PostgrestError=Ln.PostgrestBuilder=Ln.PostgrestTransformBuilder=Ln.PostgrestFilterBuilder=Ln.PostgrestQueryBuilder=Ln.PostgrestClient=void 0;const FE=jh($_);Ln.PostgrestClient=FE.default;const jE=jh(i0);Ln.PostgrestQueryBuilder=jE.default;const BE=jh(sg);Ln.PostgrestFilterBuilder=BE.default;const $E=jh(r0);Ln.PostgrestTransformBuilder=$E.default;const UE=jh(o0);Ln.PostgrestBuilder=UE.default;const zE=jh(a0);Ln.PostgrestError=zE.default;var S2=Ln.default={PostgrestClient:FE.default,PostgrestQueryBuilder:jE.default,PostgrestFilterBuilder:BE.default,PostgrestTransformBuilder:$E.default,PostgrestBuilder:UE.default,PostgrestError:zE.default};const{PostgrestClient:E2,PostgrestQueryBuilder:sF,PostgrestFilterBuilder:iF,PostgrestTransformBuilder:rF,PostgrestBuilder:oF,PostgrestError:aF}=S2;class C2{static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};if(typeof process<"u"){const t=process.versions;if(t&&t.node){const n=t.node,i=parseInt(n.replace(/^v/,"").split(".")[0]);return i>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${i} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${i} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const n=this.getWebSocketConstructor();return new n(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const k2="2.15.5",T2=`realtime-js/${k2}`,P2="1.0.0",rw=1e4,R2=1e3,N2=100;var Ld;(function(s){s[s.connecting=0]="connecting",s[s.open=1]="open",s[s.closing=2]="closing",s[s.closed=3]="closed"})(Ld||(Ld={}));var vt;(function(s){s.closed="closed",s.errored="errored",s.joined="joined",s.joining="joining",s.leaving="leaving"})(vt||(vt={}));var ii;(function(s){s.close="phx_close",s.error="phx_error",s.join="phx_join",s.reply="phx_reply",s.leave="phx_leave",s.access_token="access_token"})(ii||(ii={}));var ow;(function(s){s.websocket="websocket"})(ow||(ow={}));var Ta;(function(s){s.Connecting="connecting",s.Open="open",s.Closing="closing",s.Closed="closed"})(Ta||(Ta={}));class I2{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),n=new TextDecoder;return this._decodeBroadcast(e,t,n)}_decodeBroadcast(e,t,n){const i=t.getUint8(1),r=t.getUint8(2);let o=this.HEADER_LENGTH+2;const l=n.decode(e.slice(o,o+i));o=o+i;const c=n.decode(e.slice(o,o+r));o=o+r;const u=JSON.parse(n.decode(e.slice(o,e.byteLength)));return{ref:null,topic:l,event:c,payload:u}}}class HE{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Fe;(function(s){s.abstime="abstime",s.bool="bool",s.date="date",s.daterange="daterange",s.float4="float4",s.float8="float8",s.int2="int2",s.int4="int4",s.int4range="int4range",s.int8="int8",s.int8range="int8range",s.json="json",s.jsonb="jsonb",s.money="money",s.numeric="numeric",s.oid="oid",s.reltime="reltime",s.text="text",s.time="time",s.timestamp="timestamp",s.timestamptz="timestamptz",s.timetz="timetz",s.tsrange="tsrange",s.tstzrange="tstzrange"})(Fe||(Fe={}));const AA=(s,e,t={})=>{var n;const i=(n=t.skipTypes)!==null&&n!==void 0?n:[];return Object.keys(e).reduce((r,o)=>(r[o]=D2(o,s,e,i),r),{})},D2=(s,e,t,n)=>{const i=e.find(l=>l.name===s),r=i==null?void 0:i.type,o=t[s];return r&&!n.includes(r)?VE(r,o):aw(o)},VE=(s,e)=>{if(s.charAt(0)==="_"){const t=s.slice(1,s.length);return F2(e,t)}switch(s){case Fe.bool:return O2(e);case Fe.float4:case Fe.float8:case Fe.int2:case Fe.int4:case Fe.int8:case Fe.numeric:case Fe.oid:return L2(e);case Fe.json:case Fe.jsonb:return M2(e);case Fe.timestamp:return j2(e);case Fe.abstime:case Fe.date:case Fe.daterange:case Fe.int4range:case Fe.int8range:case Fe.money:case Fe.reltime:case Fe.text:case Fe.time:case Fe.timestamptz:case Fe.timetz:case Fe.tsrange:case Fe.tstzrange:return aw(e);default:return aw(e)}},aw=s=>s,O2=s=>{switch(s){case"t":return!0;case"f":return!1;default:return s}},L2=s=>{if(typeof s=="string"){const e=parseFloat(s);if(!Number.isNaN(e))return e}return s},M2=s=>{if(typeof s=="string")try{return JSON.parse(s)}catch(e){return console.log(`JSON parse error: ${e}`),s}return s},F2=(s,e)=>{if(typeof s!="string")return s;const t=s.length-1,n=s[t];if(s[0]==="{"&&n==="}"){let r;const o=s.slice(1,t);try{r=JSON.parse("["+o+"]")}catch{r=o?o.split(","):[]}return r.map(l=>VE(e,l))}return s},j2=s=>typeof s=="string"?s.replace(" ","T"):s,WE=s=>{let e=s;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")+"/api/broadcast"};class H0{constructor(e,t,n={},i=rw){this.channel=e,this.event=t,this.payload=n,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var SA;(function(s){s.SYNC="sync",s.JOIN="join",s.LEAVE="leave"})(SA||(SA={}));class Md{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},i=>{const{onJoin:r,onLeave:o,onSync:l}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Md.syncState(this.state,i,r,o),this.pendingDiffs.forEach(c=>{this.state=Md.syncDiff(this.state,c,r,o)}),this.pendingDiffs=[],l()}),this.channel._on(n.diff,{},i=>{const{onJoin:r,onLeave:o,onSync:l}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=Md.syncDiff(this.state,i,r,o),l())}),this.onJoin((i,r,o)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:r,newPresences:o})}),this.onLeave((i,r,o)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:r,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,i){const r=this.cloneDeep(e),o=this.transformState(t),l={},c={};return this.map(r,(u,h)=>{o[u]||(c[u]=h)}),this.map(o,(u,h)=>{const d=r[u];if(d){const f=h.map(A=>A.presence_ref),p=d.map(A=>A.presence_ref),y=h.filter(A=>p.indexOf(A.presence_ref)<0),_=d.filter(A=>f.indexOf(A.presence_ref)<0);y.length>0&&(l[u]=y),_.length>0&&(c[u]=_)}else l[u]=h}),this.syncDiff(r,{joins:l,leaves:c},n,i)}static syncDiff(e,t,n,i){const{joins:r,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),i||(i=()=>{}),this.map(r,(l,c)=>{var u;const h=(u=e[l])!==null&&u!==void 0?u:[];if(e[l]=this.cloneDeep(c),h.length>0){const d=e[l].map(p=>p.presence_ref),f=h.filter(p=>d.indexOf(p.presence_ref)<0);e[l].unshift(...f)}n(l,h,c)}),this.map(o,(l,c)=>{let u=e[l];if(!u)return;const h=c.map(d=>d.presence_ref);u=u.filter(d=>h.indexOf(d.presence_ref)<0),e[l]=u,i(l,u,c),u.length===0&&delete e[l]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const i=e[n];return"metas"in i?t[n]=i.metas.map(r=>(r.presence_ref=r.phx_ref,delete r.phx_ref,delete r.phx_ref_prev,r)):t[n]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var EA;(function(s){s.ALL="*",s.INSERT="INSERT",s.UPDATE="UPDATE",s.DELETE="DELETE"})(EA||(EA={}));var Fd;(function(s){s.BROADCAST="broadcast",s.PRESENCE="presence",s.POSTGRES_CHANGES="postgres_changes",s.SYSTEM="system"})(Fd||(Fd={}));var Qi;(function(s){s.SUBSCRIBED="SUBSCRIBED",s.TIMED_OUT="TIMED_OUT",s.CLOSED="CLOSED",s.CHANNEL_ERROR="CHANNEL_ERROR"})(Qi||(Qi={}));class U_{constructor(e,t={config:{}},n){this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=vt.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new H0(this,ii.join,this.params,this.timeout),this.rejoinTimer=new HE(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=vt.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=vt.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=vt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=vt.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=vt.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ii.reply,{},(i,r)=>{this._trigger(this._replyEventName(r),i)}),this.presence=new Md(this),this.broadcastEndpointURL=WE(this.socket.endPoint),this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var n,i,r;if(this.socket.isConnected()||this.socket.connect(),this.state==vt.closed){const{config:{broadcast:o,presence:l,private:c}}=this.params,u=(i=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(p=>p.filter))!==null&&i!==void 0?i:[],h=!!this.bindings[Fd.PRESENCE]&&this.bindings[Fd.PRESENCE].length>0||((r=this.params.config.presence)===null||r===void 0?void 0:r.enabled)===!0,d={},f={broadcast:o,presence:Object.assign(Object.assign({},l),{enabled:h}),postgres_changes:u,private:c};this.socket.accessTokenValue&&(d.access_token=this.socket.accessTokenValue),this._onError(p=>e==null?void 0:e(Qi.CHANNEL_ERROR,p)),this._onClose(()=>e==null?void 0:e(Qi.CLOSED)),this.updateJoinPayload(Object.assign({config:f},d)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:p})=>{var y;if(this.socket.setAuth(),p===void 0){e==null||e(Qi.SUBSCRIBED);return}else{const _=this.bindings.postgres_changes,A=(y=_==null?void 0:_.length)!==null&&y!==void 0?y:0,m=[];for(let b=0;b<A;b++){const v=_[b],{filter:{event:S,schema:C,table:k,filter:T}}=v,I=p&&p[b];if(I&&I.event===S&&I.schema===C&&I.table===k&&I.filter===T)m.push(Object.assign(Object.assign({},v),{id:I.id}));else{this.unsubscribe(),this.state=vt.errored,e==null||e(Qi.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=m,e&&e(Qi.SUBSCRIBED);return}}).receive("error",p=>{this.state=vt.errored,e==null||e(Qi.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(p).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(Qi.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===vt.joined&&e===Fd.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(()=>this.subscribe())),this._on(e,t,n)}async send(e,t={}){var n,i;if(!this._canPush()&&e.type==="broadcast"){const{event:r,payload:o}=e,c={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:r,payload:o,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,c,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((i=u.body)===null||i===void 0?void 0:i.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(r=>{var o,l,c;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((c=(l=(o=this.params)===null||o===void 0?void 0:o.config)===null||l===void 0?void 0:l.broadcast)===null||c===void 0)&&c.ack)&&r("ok"),u.receive("ok",()=>r("ok")),u.receive("error",()=>r("error")),u.receive("timeout",()=>r("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=vt.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ii.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(i=>{n=new H0(this,ii.leave,{},e),n.receive("ok",()=>{t(),i("ok")}).receive("timeout",()=>{t(),i("timed out")}).receive("error",()=>{i("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=vt.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const i=new AbortController,r=setTimeout(()=>i.abort(),n),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(r),o}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new H0(this,e,t,n);return this._canPush()?i.send():this._addToPushBuffer(i),i}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>N2){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var i,r;const o=e.toLocaleLowerCase(),{close:l,error:c,leave:u,join:h}=ii;if(n&&[l,c,u,h].indexOf(o)>=0&&n!==this._joinRef())return;let f=this._onMessage(o,t,n);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(p=>{var y,_,A;return((y=p.filter)===null||y===void 0?void 0:y.event)==="*"||((A=(_=p.filter)===null||_===void 0?void 0:_.event)===null||A===void 0?void 0:A.toLocaleLowerCase())===o}).map(p=>p.callback(f,n)):(r=this.bindings[o])===null||r===void 0||r.filter(p=>{var y,_,A,m,b,v;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in p){const S=p.id,C=(y=p.filter)===null||y===void 0?void 0:y.event;return S&&((_=t.ids)===null||_===void 0?void 0:_.includes(S))&&(C==="*"||(C==null?void 0:C.toLocaleLowerCase())===((A=t.data)===null||A===void 0?void 0:A.type.toLocaleLowerCase()))}else{const S=(b=(m=p==null?void 0:p.filter)===null||m===void 0?void 0:m.event)===null||b===void 0?void 0:b.toLocaleLowerCase();return S==="*"||S===((v=t==null?void 0:t.event)===null||v===void 0?void 0:v.toLocaleLowerCase())}else return p.type.toLocaleLowerCase()===o}).map(p=>{if(typeof f=="object"&&"ids"in f){const y=f.data,{schema:_,table:A,commit_timestamp:m,type:b,errors:v}=y;f=Object.assign(Object.assign({},{schema:_,table:A,commit_timestamp:m,eventType:b,new:{},old:{},errors:v}),this._getPayloadRecords(y))}p.callback(f,n)})}_isClosed(){return this.state===vt.closed}_isJoined(){return this.state===vt.joined}_isJoining(){return this.state===vt.joining}_isLeaving(){return this.state===vt.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const i=e.toLocaleLowerCase(),r={type:i,filter:t,callback:n};return this.bindings[i]?this.bindings[i].push(r):this.bindings[i]=[r],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(i=>{var r;return!(((r=i.type)===null||r===void 0?void 0:r.toLocaleLowerCase())===n&&U_.isEqual(i.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ii.close,{},e)}_onError(e){this._on(ii.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=vt.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=AA(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=AA(e.columns,e.old_record)),t}}const V0=()=>{},Rg={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},B2=[1e3,2e3,5e3,1e4],$2=1e4,U2=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class z2{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=rw,this.transport=null,this.heartbeatIntervalMs=Rg.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=V0,this.ref=0,this.reconnectTimer=null,this.logger=V0,this.conn=null,this.sendBuffer=[],this.serializer=new I2,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._resolveFetch=i=>{let r;return i?r=i:typeof fetch>"u"?r=(...o)=>ng(async()=>{const{default:l}=await Promise.resolve().then(()=>Fh);return{default:l}},void 0).then(({default:l})=>l(...o)).catch(l=>{throw new Error(`Failed to load @supabase/node-fetch: ${l.message}. This is required for HTTP requests in Node.js environments without native fetch.`)}):r=fetch,(...o)=>r(...o)},!(!((n=t==null?void 0:t.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${ow.websocket}`,this.httpEndpoint=WE(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=C2.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:P2}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},e?this.conn.close(e,t??""):this.conn.close(),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Ld.connecting:return Ta.Connecting;case Ld.open:return Ta.Open;case Ld.closing:return Ta.Closing;default:return Ta.Closed}}isConnected(){return this.connectionState()===Ta.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const n=`realtime:${e}`,i=this.getChannels().find(r=>r.topic===n);if(i)return i;{const r=new U_(`realtime:${e}`,t,this);return this.channels.push(r),r}}push(e){const{topic:t,event:n,payload:i,ref:r}=e,o=()=>{this.encode(e,l=>{var c;(c=this.conn)===null||c===void 0||c.send(l)})};this.log("push",`${t} ${n} (${r})`,i),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(R2,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Rg.HEARTBEAT_TIMEOUT_FALLBACK);return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply")try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error")}catch(u){this.log("error","error in heartbeat callback",u)}t.ref&&t.ref===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null);const{topic:n,event:i,payload:r,ref:o}=t,l=o?`(${o})`:"",c=r.status||"";this.log("receive",`${c} ${n} ${i} ${l}`.trim(),r),this.channels.filter(u=>u._isMember(n)).forEach(u=>u._trigger(i,r,o)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_teardownConnection(){this.conn&&(this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null),this._clearAllTimers(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e)}_triggerChanError(){this.channels.forEach(e=>e._trigger(ii.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${n}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([U2],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t;e?t=e:this.accessToken?t=await this.accessToken():t=this.accessTokenValue,this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(n=>{const i={access_token:t,version:T2};t&&n.updateJoinPayload(i),n.joinedOnce&&n._isJoined()&&n._push(ii.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this.setAuth().catch(t=>{this.log("error",`error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(i){this.log("error",`error in ${e} callback`,i)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new HE(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Rg.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,i,r,o,l,c,u,h;if(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(n=e==null?void 0:e.timeout)!==null&&n!==void 0?n:rw,this.heartbeatIntervalMs=(i=e==null?void 0:e.heartbeatIntervalMs)!==null&&i!==void 0?i:Rg.HEARTBEAT_INTERVAL,this.worker=(r=e==null?void 0:e.worker)!==null&&r!==void 0?r:!1,this.accessToken=(o=e==null?void 0:e.accessToken)!==null&&o!==void 0?o:null,this.heartbeatCallback=(l=e==null?void 0:e.heartbeatCallback)!==null&&l!==void 0?l:V0,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(c=e==null?void 0:e.reconnectAfterMs)!==null&&c!==void 0?c:d=>B2[d-1]||$2,this.encode=(u=e==null?void 0:e.encode)!==null&&u!==void 0?u:(d,f)=>f(JSON.stringify(d)),this.decode=(h=e==null?void 0:e.decode)!==null&&h!==void 0?h:this.serializer.decode.bind(this.serializer),this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}class z_ extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function At(s){return typeof s=="object"&&s!==null&&"__isStorageError"in s}class H2 extends z_{constructor(e,t,n){super(e),this.name="StorageApiError",this.status=t,this.statusCode=n}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}}class lw extends z_{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var V2=function(s,e,t,n){function i(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function l(h){try{u(n.next(h))}catch(d){o(d)}}function c(h){try{u(n.throw(h))}catch(d){o(d)}}function u(h){h.done?r(h.value):i(h.value).then(l,c)}u((n=n.apply(s,e||[])).next())})};const GE=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>ng(async()=>{const{default:n}=await Promise.resolve().then(()=>Fh);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},W2=()=>V2(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield ng(()=>Promise.resolve().then(()=>Fh),void 0)).Response:Response}),cw=s=>{if(Array.isArray(s))return s.map(t=>cw(t));if(typeof s=="function"||s!==Object(s))return s;const e={};return Object.entries(s).forEach(([t,n])=>{const i=t.replace(/([-_][a-z])/gi,r=>r.toUpperCase().replace(/[-_]/g,""));e[i]=cw(n)}),e},G2=s=>{if(typeof s!="object"||s===null)return!1;const e=Object.getPrototypeOf(s);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in s)&&!(Symbol.iterator in s)};var lc=function(s,e,t,n){function i(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function l(h){try{u(n.next(h))}catch(d){o(d)}}function c(h){try{u(n.throw(h))}catch(d){o(d)}}function u(h){h.done?r(h.value):i(h.value).then(l,c)}u((n=n.apply(s,e||[])).next())})};const W0=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),q2=(s,e,t)=>lc(void 0,void 0,void 0,function*(){const n=yield W2();s instanceof n&&!(t!=null&&t.noResolveJson)?s.json().then(i=>{const r=s.status||500,o=(i==null?void 0:i.statusCode)||r+"";e(new H2(W0(i),r,o))}).catch(i=>{e(new lw(W0(i),i))}):e(new lw(W0(s),s))}),K2=(s,e,t,n)=>{const i={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"||!n?i:(G2(n)?(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),i.body=JSON.stringify(n)):i.body=n,e!=null&&e.duplex&&(i.duplex=e.duplex),Object.assign(Object.assign({},i),t))};function ig(s,e,t,n,i,r){return lc(this,void 0,void 0,function*(){return new Promise((o,l)=>{s(t,K2(e,n,i,r)).then(c=>{if(!c.ok)throw c;return n!=null&&n.noResolveJson?c:c.json()}).then(c=>o(c)).catch(c=>q2(c,l,n))})})}function ly(s,e,t,n){return lc(this,void 0,void 0,function*(){return ig(s,"GET",e,t,n)})}function vi(s,e,t,n,i){return lc(this,void 0,void 0,function*(){return ig(s,"POST",e,n,i,t)})}function uw(s,e,t,n,i){return lc(this,void 0,void 0,function*(){return ig(s,"PUT",e,n,i,t)})}function X2(s,e,t,n){return lc(this,void 0,void 0,function*(){return ig(s,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),n)})}function qE(s,e,t,n,i){return lc(this,void 0,void 0,function*(){return ig(s,"DELETE",e,n,i,t)})}var cn=function(s,e,t,n){function i(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function l(h){try{u(n.next(h))}catch(d){o(d)}}function c(h){try{u(n.throw(h))}catch(d){o(d)}}function u(h){h.done?r(h.value):i(h.value).then(l,c)}u((n=n.apply(s,e||[])).next())})};const Y2={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},CA={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class J2{constructor(e,t={},n,i){this.shouldThrowOnError=!1,this.url=e,this.headers=t,this.bucketId=n,this.fetch=GE(i)}throwOnError(){return this.shouldThrowOnError=!0,this}uploadOrUpdate(e,t,n,i){return cn(this,void 0,void 0,function*(){try{let r;const o=Object.assign(Object.assign({},CA),i);let l=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const c=o.metadata;typeof Blob<"u"&&n instanceof Blob?(r=new FormData,r.append("cacheControl",o.cacheControl),c&&r.append("metadata",this.encodeMetadata(c)),r.append("",n)):typeof FormData<"u"&&n instanceof FormData?(r=n,r.append("cacheControl",o.cacheControl),c&&r.append("metadata",this.encodeMetadata(c))):(r=n,l["cache-control"]=`max-age=${o.cacheControl}`,l["content-type"]=o.contentType,c&&(l["x-metadata"]=this.toBase64(this.encodeMetadata(c)))),i!=null&&i.headers&&(l=Object.assign(Object.assign({},l),i.headers));const u=this._removeEmptyFolders(t),h=this._getFinalPath(u),d=yield(e=="PUT"?uw:vi)(this.fetch,`${this.url}/object/${h}`,r,Object.assign({headers:l},o!=null&&o.duplex?{duplex:o.duplex}:{}));return{data:{path:u,id:d.Id,fullPath:d.Key},error:null}}catch(r){if(this.shouldThrowOnError)throw r;if(At(r))return{data:null,error:r};throw r}})}upload(e,t,n){return cn(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,n)})}uploadToSignedUrl(e,t,n,i){return cn(this,void 0,void 0,function*(){const r=this._removeEmptyFolders(e),o=this._getFinalPath(r),l=new URL(this.url+`/object/upload/sign/${o}`);l.searchParams.set("token",t);try{let c;const u=Object.assign({upsert:CA.upsert},i),h=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&n instanceof Blob?(c=new FormData,c.append("cacheControl",u.cacheControl),c.append("",n)):typeof FormData<"u"&&n instanceof FormData?(c=n,c.append("cacheControl",u.cacheControl)):(c=n,h["cache-control"]=`max-age=${u.cacheControl}`,h["content-type"]=u.contentType);const d=yield uw(this.fetch,l.toString(),c,{headers:h});return{data:{path:r,fullPath:d.Key},error:null}}catch(c){if(this.shouldThrowOnError)throw c;if(At(c))return{data:null,error:c};throw c}})}createSignedUploadUrl(e,t){return cn(this,void 0,void 0,function*(){try{let n=this._getFinalPath(e);const i=Object.assign({},this.headers);t!=null&&t.upsert&&(i["x-upsert"]="true");const r=yield vi(this.fetch,`${this.url}/object/upload/sign/${n}`,{},{headers:i}),o=new URL(this.url+r.url),l=o.searchParams.get("token");if(!l)throw new z_("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:l},error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(At(n))return{data:null,error:n};throw n}})}update(e,t,n){return cn(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,n)})}move(e,t,n){return cn(this,void 0,void 0,function*(){try{return{data:yield vi(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(At(i))return{data:null,error:i};throw i}})}copy(e,t,n){return cn(this,void 0,void 0,function*(){try{return{data:{path:(yield vi(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:n==null?void 0:n.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(At(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,n){return cn(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),r=yield vi(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},n!=null&&n.transform?{transform:n.transform}:{}),{headers:this.headers});const o=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return r={signedUrl:encodeURI(`${this.url}${r.signedURL}${o}`)},{data:r,error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(At(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,n){return cn(this,void 0,void 0,function*(){try{const i=yield vi(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),r=n!=null&&n.download?`&download=${n.download===!0?"":n.download}`:"";return{data:i.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${r}`):null})),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(At(i))return{data:null,error:i};throw i}})}download(e,t){return cn(this,void 0,void 0,function*(){const i=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",r=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=r?`?${r}`:"";try{const l=this._getFinalPath(e);return{data:yield(yield ly(this.fetch,`${this.url}/${i}/${l}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(l){if(this.shouldThrowOnError)throw l;if(At(l))return{data:null,error:l};throw l}})}info(e){return cn(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const n=yield ly(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:cw(n),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(At(n))return{data:null,error:n};throw n}})}exists(e){return cn(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield X2(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(At(n)&&n instanceof lw){const i=n.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:n}}throw n}})}getPublicUrl(e,t){const n=this._getFinalPath(e),i=[],r=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";r!==""&&i.push(r);const l=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",c=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});c!==""&&i.push(c);let u=i.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${l}/public/${n}${u}`)}}}remove(e){return cn(this,void 0,void 0,function*(){try{return{data:yield qE(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(At(t))return{data:null,error:t};throw t}})}list(e,t,n){return cn(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},Y2),t),{prefix:e||""});return{data:yield vi(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},n),error:null}}catch(i){if(this.shouldThrowOnError)throw i;if(At(i))return{data:null,error:i};throw i}})}listV2(e,t){return cn(this,void 0,void 0,function*(){try{const n=Object.assign({},e);return{data:yield vi(this.fetch,`${this.url}/object/list-v2/${this.bucketId}`,n,{headers:this.headers},t),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(At(n))return{data:null,error:n};throw n}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e.replace(/^\/+/,"")}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const Q2="2.12.1",Z2={"X-Client-Info":`storage-js/${Q2}`};var dc=function(s,e,t,n){function i(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function l(h){try{u(n.next(h))}catch(d){o(d)}}function c(h){try{u(n.throw(h))}catch(d){o(d)}}function u(h){h.done?r(h.value):i(h.value).then(l,c)}u((n=n.apply(s,e||[])).next())})};class eN{constructor(e,t={},n,i){this.shouldThrowOnError=!1;const r=new URL(e);i!=null&&i.useNewHostname&&/supabase\.(co|in|red)$/.test(r.hostname)&&!r.hostname.includes("storage.supabase.")&&(r.hostname=r.hostname.replace("supabase.","storage.supabase.")),this.url=r.href,this.headers=Object.assign(Object.assign({},Z2),t),this.fetch=GE(n)}throwOnError(){return this.shouldThrowOnError=!0,this}listBuckets(){return dc(this,void 0,void 0,function*(){try{return{data:yield ly(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(this.shouldThrowOnError)throw e;if(At(e))return{data:null,error:e};throw e}})}getBucket(e){return dc(this,void 0,void 0,function*(){try{return{data:yield ly(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(At(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return dc(this,void 0,void 0,function*(){try{return{data:yield vi(this.fetch,`${this.url}/bucket`,{id:e,name:e,type:t.type,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(At(n))return{data:null,error:n};throw n}})}updateBucket(e,t){return dc(this,void 0,void 0,function*(){try{return{data:yield uw(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(n){if(this.shouldThrowOnError)throw n;if(At(n))return{data:null,error:n};throw n}})}emptyBucket(e){return dc(this,void 0,void 0,function*(){try{return{data:yield vi(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(At(t))return{data:null,error:t};throw t}})}deleteBucket(e){return dc(this,void 0,void 0,function*(){try{return{data:yield qE(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(this.shouldThrowOnError)throw t;if(At(t))return{data:null,error:t};throw t}})}}class tN extends eN{constructor(e,t={},n,i){super(e,t,n,i)}from(e){return new J2(this.url,this.headers,e,this.fetch)}}const nN="2.57.4";let id="";typeof Deno<"u"?id="deno":typeof document<"u"?id="web":typeof navigator<"u"&&navigator.product==="ReactNative"?id="react-native":id="node";const sN={"X-Client-Info":`supabase-js-${id}/${nN}`},iN={headers:sN},rN={schema:"public"},oN={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},aN={};var lN=function(s,e,t,n){function i(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function l(h){try{u(n.next(h))}catch(d){o(d)}}function c(h){try{u(n.throw(h))}catch(d){o(d)}}function u(h){h.done?r(h.value):i(h.value).then(l,c)}u((n=n.apply(s,e||[])).next())})};const cN=s=>{let e;return s?e=s:typeof fetch>"u"?e=IE:e=fetch,(...t)=>e(...t)},uN=()=>typeof Headers>"u"?DE:Headers,hN=(s,e,t)=>{const n=cN(t),i=uN();return(r,o)=>lN(void 0,void 0,void 0,function*(){var l;const c=(l=yield e())!==null&&l!==void 0?l:s;let u=new i(o==null?void 0:o.headers);return u.has("apikey")||u.set("apikey",s),u.has("Authorization")||u.set("Authorization",`Bearer ${c}`),n(r,Object.assign(Object.assign({},o),{headers:u}))})};var dN=function(s,e,t,n){function i(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function l(h){try{u(n.next(h))}catch(d){o(d)}}function c(h){try{u(n.throw(h))}catch(d){o(d)}}function u(h){h.done?r(h.value):i(h.value).then(l,c)}u((n=n.apply(s,e||[])).next())})};function fN(s){return s.endsWith("/")?s:s+"/"}function pN(s,e){var t,n;const{db:i,auth:r,realtime:o,global:l}=s,{db:c,auth:u,realtime:h,global:d}=e,f={db:Object.assign(Object.assign({},c),i),auth:Object.assign(Object.assign({},u),r),realtime:Object.assign(Object.assign({},h),o),storage:{},global:Object.assign(Object.assign(Object.assign({},d),l),{headers:Object.assign(Object.assign({},(t=d==null?void 0:d.headers)!==null&&t!==void 0?t:{}),(n=l==null?void 0:l.headers)!==null&&n!==void 0?n:{})}),accessToken:()=>dN(this,void 0,void 0,function*(){return""})};return s.accessToken?f.accessToken=s.accessToken:delete f.accessToken,f}function gN(s){const e=s==null?void 0:s.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(fN(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}const KE="2.71.1",wc=30*1e3,hw=3,G0=hw*wc,mN="http://localhost:9999",yN="supabase.auth.token",vN={"X-Client-Info":`gotrue-js/${KE}`},dw="X-Supabase-Api-Version",XE={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},wN=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,bN=10*60*1e3;class H_ extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function oe(s){return typeof s=="object"&&s!==null&&"__isAuthError"in s}class _N extends H_{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}function xN(s){return oe(s)&&s.name==="AuthApiError"}class YE extends H_{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class ya extends H_{constructor(e,t,n,i){super(e,n,i),this.name=t,this.status=n}}class Qr extends ya{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function AN(s){return oe(s)&&s.name==="AuthSessionMissingError"}class Ng extends ya{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class Ig extends ya{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class Dg extends ya{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function SN(s){return oe(s)&&s.name==="AuthImplicitGrantRedirectError"}class kA extends ya{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class fw extends ya{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function q0(s){return oe(s)&&s.name==="AuthRetryableFetchError"}class TA extends ya{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class pw extends ya{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const cy="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),PA=` 	
\r=`.split(""),EN=(()=>{const s=new Array(128);for(let e=0;e<s.length;e+=1)s[e]=-1;for(let e=0;e<PA.length;e+=1)s[PA[e].charCodeAt(0)]=-2;for(let e=0;e<cy.length;e+=1)s[cy[e].charCodeAt(0)]=e;return s})();function RA(s,e,t){if(s!==null)for(e.queue=e.queue<<8|s,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(cy[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(cy[n]),e.queuedBits-=6}}function JE(s,e,t){const n=EN[s];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(s)}"`)}}function NA(s){const e=[],t=o=>{e.push(String.fromCodePoint(o))},n={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},r=o=>{TN(o,n,t)};for(let o=0;o<s.length;o+=1)JE(s.charCodeAt(o),i,r);return e.join("")}function CN(s,e){if(s<=127){e(s);return}else if(s<=2047){e(192|s>>6),e(128|s&63);return}else if(s<=65535){e(224|s>>12),e(128|s>>6&63),e(128|s&63);return}else if(s<=1114111){e(240|s>>18),e(128|s>>12&63),e(128|s>>6&63),e(128|s&63);return}throw new Error(`Unrecognized Unicode codepoint: ${s.toString(16)}`)}function kN(s,e){for(let t=0;t<s.length;t+=1){let n=s.charCodeAt(t);if(n>55295&&n<=56319){const i=(n-55296)*1024&65535;n=(s.charCodeAt(t+1)-56320&65535|i)+65536,t+=1}CN(n,e)}}function TN(s,e,t){if(e.utf8seq===0){if(s<=127){t(s);return}for(let n=1;n<6;n+=1)if(!(s>>7-n&1)){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=s&31;else if(e.utf8seq===3)e.codepoint=s&15;else if(e.utf8seq===4)e.codepoint=s&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(s<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|s&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function PN(s){const e=[],t={queue:0,queuedBits:0},n=i=>{e.push(i)};for(let i=0;i<s.length;i+=1)JE(s.charCodeAt(i),t,n);return new Uint8Array(e)}function RN(s){const e=[];return kN(s,t=>e.push(t)),new Uint8Array(e)}function NN(s){const e=[],t={queue:0,queuedBits:0},n=i=>{e.push(i)};return s.forEach(i=>RA(i,t,n)),RA(null,t,n),e.join("")}function IN(s){return Math.round(Date.now()/1e3)+s}function DN(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(s){const e=Math.random()*16|0;return(s=="x"?e:e&3|8).toString(16)})}const Us=()=>typeof window<"u"&&typeof document<"u",wa={tested:!1,writable:!1},QE=()=>{if(!Us())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(wa.tested)return wa.writable;const s=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(s,s),globalThis.localStorage.removeItem(s),wa.tested=!0,wa.writable=!0}catch{wa.tested=!0,wa.writable=!1}return wa.writable};function ON(s){const e={},t=new URL(s);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,r)=>{e[r]=i})}catch{}return t.searchParams.forEach((n,i)=>{e[i]=n}),e}const ZE=s=>{let e;return s?e=s:typeof fetch>"u"?e=(...t)=>ng(async()=>{const{default:n}=await Promise.resolve().then(()=>Fh);return{default:n}},void 0).then(({default:n})=>n(...t)):e=fetch,(...t)=>e(...t)},LN=s=>typeof s=="object"&&s!==null&&"status"in s&&"ok"in s&&"json"in s&&typeof s.json=="function",bc=async(s,e,t)=>{await s.setItem(e,JSON.stringify(t))},ba=async(s,e)=>{const t=await s.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},Jr=async(s,e)=>{await s.removeItem(e)};class l0{constructor(){this.promise=new l0.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}l0.promiseConstructor=Promise;function K0(s){const e=s.split(".");if(e.length!==3)throw new pw("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!wN.test(e[n]))throw new pw("JWT not in base64url format");return{header:JSON.parse(NA(e[0])),payload:JSON.parse(NA(e[1])),signature:PN(e[2]),raw:{header:e[0],payload:e[1]}}}async function MN(s){return await new Promise(e=>{setTimeout(()=>e(null),s)})}function FN(s,e){return new Promise((n,i)=>{(async()=>{for(let r=0;r<1/0;r++)try{const o=await s(r);if(!e(r,null,o)){n(o);return}}catch(o){if(!e(r,o)){i(o);return}}})()})}function jN(s){return("0"+s.toString(16)).substr(-2)}function BN(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let i="";for(let r=0;r<56;r++)i+=t.charAt(Math.floor(Math.random()*n));return i}return crypto.getRandomValues(e),Array.from(e,jN).join("")}async function $N(s){const t=new TextEncoder().encode(s),n=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(n);return Array.from(i).map(r=>String.fromCharCode(r)).join("")}async function UN(s){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),s;const t=await $N(s);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function fc(s,e,t=!1){const n=BN();let i=n;t&&(i+="/PASSWORD_RECOVERY"),await bc(s,`${e}-code-verifier`,i);const r=await UN(n);return[r,n===r?"plain":"s256"]}const zN=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function HN(s){const e=s.headers.get(dw);if(!e||!e.match(zN))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function VN(s){if(!s)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(s<=e)throw new Error("JWT has expired")}function WN(s){switch(s){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const GN=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function pc(s){if(!GN.test(s))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function X0(){const s={};return new Proxy(s,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const n=t.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function IA(s){return JSON.parse(JSON.stringify(s))}var qN=function(s,e){var t={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&e.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(s);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(s,n[i])&&(t[n[i]]=s[n[i]]);return t};const Sa=s=>s.msg||s.message||s.error_description||s.error||JSON.stringify(s),KN=[502,503,504];async function DA(s){var e;if(!LN(s))throw new fw(Sa(s),0);if(KN.includes(s.status))throw new fw(Sa(s),s.status);let t;try{t=await s.json()}catch(r){throw new YE(Sa(r),r)}let n;const i=HN(s);if(i&&i.getTime()>=XE["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new TA(Sa(t),s.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new Qr}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((r,o)=>r&&typeof o=="string",!0))throw new TA(Sa(t),s.status,t.weak_password.reasons);throw new _N(Sa(t),s.status||500,n)}const XN=(s,e,t,n)=>{const i={method:s,headers:(e==null?void 0:e.headers)||{}};return s==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(n),Object.assign(Object.assign({},i),t))};async function de(s,e,t,n){var i;const r=Object.assign({},n==null?void 0:n.headers);r[dw]||(r[dw]=XE["2024-01-01"].name),n!=null&&n.jwt&&(r.Authorization=`Bearer ${n.jwt}`);const o=(i=n==null?void 0:n.query)!==null&&i!==void 0?i:{};n!=null&&n.redirectTo&&(o.redirect_to=n.redirectTo);const l=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",c=await YN(s,e,t+l,{headers:r,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(c):{data:Object.assign({},c),error:null}}async function YN(s,e,t,n,i,r){const o=XN(e,n,i,r);let l;try{l=await s(t,Object.assign({},o))}catch(c){throw console.error(c),new fw(Sa(c),0)}if(l.ok||await DA(l),n!=null&&n.noResolveJson)return l;try{return await l.json()}catch(c){await DA(c)}}function qi(s){var e;let t=null;eI(s)&&(t=Object.assign({},s),s.expires_at||(t.expires_at=IN(s.expires_in)));const n=(e=s.user)!==null&&e!==void 0?e:s;return{data:{session:t,user:n},error:null}}function OA(s){const e=qi(s);return!e.error&&s.weak_password&&typeof s.weak_password=="object"&&Array.isArray(s.weak_password.reasons)&&s.weak_password.reasons.length&&s.weak_password.message&&typeof s.weak_password.message=="string"&&s.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=s.weak_password),e}function ro(s){var e;return{data:{user:(e=s.user)!==null&&e!==void 0?e:s},error:null}}function JN(s){return{data:s,error:null}}function QN(s){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:i,verification_type:r}=s,o=qN(s,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),l={action_link:e,email_otp:t,hashed_token:n,redirect_to:i,verification_type:r},c=Object.assign({},o);return{data:{properties:l,user:c},error:null}}function ZN(s){return s}function eI(s){return s.access_token&&s.refresh_token&&s.expires_in}const Y0=["global","local","others"];var tI=function(s,e){var t={};for(var n in s)Object.prototype.hasOwnProperty.call(s,n)&&e.indexOf(n)<0&&(t[n]=s[n]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,n=Object.getOwnPropertySymbols(s);i<n.length;i++)e.indexOf(n[i])<0&&Object.prototype.propertyIsEnumerable.call(s,n[i])&&(t[n[i]]=s[n[i]]);return t};class nI{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=ZE(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=Y0[0]){if(Y0.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Y0.join(", ")}`);try{return await de(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(oe(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await de(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:ro})}catch(n){if(oe(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=tI(e,["options"]),i=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(i.new_email=n==null?void 0:n.newEmail,delete i.newEmail),await de(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:QN,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(oe(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await de(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:ro})}catch(t){if(oe(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,i,r,o,l,c;try{const u={nextPage:null,lastPage:0,total:0},h=await de(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(r=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&r!==void 0?r:""},xform:ZN});if(h.error)throw h.error;const d=await h.json(),f=(o=h.headers.get("x-total-count"))!==null&&o!==void 0?o:0,p=(c=(l=h.headers.get("link"))===null||l===void 0?void 0:l.split(","))!==null&&c!==void 0?c:[];return p.length>0&&(p.forEach(y=>{const _=parseInt(y.split(";")[0].split("=")[1].substring(0,1)),A=JSON.parse(y.split(";")[1].split("=")[1]);u[`${A}Page`]=_}),u.total=parseInt(f)),{data:Object.assign(Object.assign({},d),u),error:null}}catch(u){if(oe(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){pc(e);try{return await de(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:ro})}catch(t){if(oe(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){pc(e);try{return await de(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:ro})}catch(n){if(oe(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){pc(e);try{return await de(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:ro})}catch(n){if(oe(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){pc(e.userId);try{const{data:t,error:n}=await de(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:n}}catch(t){if(oe(t))return{data:null,error:t};throw t}}async _deleteFactor(e){pc(e.userId),pc(e.id);try{return{data:await de(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(oe(t))return{data:null,error:t};throw t}}}function LA(s={}){return{getItem:e=>s[e]||null,setItem:(e,t)=>{s[e]=t},removeItem:e=>{delete s[e]}}}function sI(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const gc={debug:!!(globalThis&&QE()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class eC extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class iI extends eC{}async function rI(s,e,t){gc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",s,e);const n=new globalThis.AbortController;return e>0&&setTimeout(()=>{n.abort(),gc.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",s)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(s,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async i=>{if(i){gc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",s,i.name);try{return await t()}finally{gc.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",s,i.name)}}else{if(e===0)throw gc.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",s),new iI(`Acquiring an exclusive Navigator LockManager lock "${s}" immediately failed`);if(gc.debug)try{const r=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(r,null,"  "))}catch(r){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",r)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}sI();const oI={url:mN,storageKey:yN,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:vN,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function MA(s,e,t){return await t()}const mc={};class tf{constructor(e){var t,n;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=tf.nextInstanceID,tf.nextInstanceID+=1,this.instanceID>0&&Us()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},oI),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new nI({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=ZE(i.fetch),this.lock=i.lock||MA,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:Us()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=rI:this.lock=MA,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:QE()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=LA(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=LA(this.memoryStorage)),Us()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(r){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",r)}(n=this.broadcastChannel)===null||n===void 0||n.addEventListener("message",async r=>{this._debug("received broadcast notification from other tab or client",r),await this._notifyAllSubscribers(r.data.event,r.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=mc[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){mc[this.storageKey]=Object.assign(Object.assign({},mc[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=mc[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){mc[this.storageKey]=Object.assign(Object.assign({},mc[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${KE}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=ON(window.location.href);let n="none";if(this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce"),Us()&&this.detectSessionInUrl&&n!=="none"){const{data:i,error:r}=await this._getSessionFromURL(t,n);if(r){if(this._debug("#_initialize()","error detecting session from URL",r),SN(r)){const c=(e=r.details)===null||e===void 0?void 0:e.code;if(c==="identity_already_exists"||c==="identity_not_found"||c==="single_identity_not_deletable")return{error:r}}return await this._removeSession(),{error:r}}const{session:o,redirectType:l}=i;return this._debug("#_initialize()","detected session in URL",o,"redirect type",l),await this._saveSession(o),setTimeout(async()=>{l==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return oe(t)?{error:t}:{error:new YE("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,i;try{const r=await de(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:qi}),{data:o,error:l}=r;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(r){if(oe(r))return{data:{user:null,session:null},error:r};throw r}}async signUp(e){var t,n,i;try{let r;if("email"in e){const{email:h,password:d,options:f}=e;let p=null,y=null;this.flowType==="pkce"&&([p,y]=await fc(this.storage,this.storageKey)),r=await de(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:h,password:d,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:p,code_challenge_method:y},xform:qi})}else if("phone"in e){const{phone:h,password:d,options:f}=e;r=await de(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:h,password:d,data:(n=f==null?void 0:f.data)!==null&&n!==void 0?n:{},channel:(i=f==null?void 0:f.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:qi})}else throw new Ig("You must provide either an email or phone number and a password");const{data:o,error:l}=r;if(l||!o)return{data:{user:null,session:null},error:l};const c=o.session,u=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(r){if(oe(r))return{data:{user:null,session:null},error:r};throw r}}async signInWithPassword(e){try{let t;if("email"in e){const{email:r,password:o,options:l}=e;t=await de(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:r,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:OA})}else if("phone"in e){const{phone:r,password:o,options:l}=e;t=await de(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:r,password:o,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:OA})}else throw new Ig("You must provide either an email or phone number and a password");const{data:n,error:i}=t;return i?{data:{user:null,session:null},error:i}:!n||!n.session||!n.user?{data:{user:null,session:null},error:new Ng}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:i})}catch(t){if(oe(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,n,i,r;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(r=e.options)===null||r===void 0?void 0:r.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,n,i,r,o,l,c,u,h,d,f,p;let y,_;if("message"in e)y=e.message,_=e.signature;else{const{chain:A,wallet:m,statement:b,options:v}=e;let S;if(Us())if(typeof m=="object")S=m;else{const k=window;if("solana"in k&&typeof k.solana=="object"&&("signIn"in k.solana&&typeof k.solana.signIn=="function"||"signMessage"in k.solana&&typeof k.solana.signMessage=="function"))S=k.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof m!="object"||!(v!=null&&v.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");S=m}const C=new URL((t=v==null?void 0:v.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in S&&S.signIn){const k=await S.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},v==null?void 0:v.signInWithSolana),{version:"1",domain:C.host,uri:C.href}),b?{statement:b}:null));let T;if(Array.isArray(k)&&k[0]&&typeof k[0]=="object")T=k[0];else if(k&&typeof k=="object"&&"signedMessage"in k&&"signature"in k)T=k;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in T&&"signature"in T&&(typeof T.signedMessage=="string"||T.signedMessage instanceof Uint8Array)&&T.signature instanceof Uint8Array)y=typeof T.signedMessage=="string"?T.signedMessage:new TextDecoder().decode(T.signedMessage),_=T.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in S)||typeof S.signMessage!="function"||!("publicKey"in S)||typeof S!="object"||!S.publicKey||!("toBase58"in S.publicKey)||typeof S.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");y=[`${C.host} wants you to sign in with your Solana account:`,S.publicKey.toBase58(),...b?["",b,""]:[""],"Version: 1",`URI: ${C.href}`,`Issued At: ${(i=(n=v==null?void 0:v.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((r=v==null?void 0:v.signInWithSolana)===null||r===void 0)&&r.notBefore?[`Not Before: ${v.signInWithSolana.notBefore}`]:[],...!((o=v==null?void 0:v.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${v.signInWithSolana.expirationTime}`]:[],...!((l=v==null?void 0:v.signInWithSolana)===null||l===void 0)&&l.chainId?[`Chain ID: ${v.signInWithSolana.chainId}`]:[],...!((c=v==null?void 0:v.signInWithSolana)===null||c===void 0)&&c.nonce?[`Nonce: ${v.signInWithSolana.nonce}`]:[],...!((u=v==null?void 0:v.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${v.signInWithSolana.requestId}`]:[],...!((d=(h=v==null?void 0:v.signInWithSolana)===null||h===void 0?void 0:h.resources)===null||d===void 0)&&d.length?["Resources",...v.signInWithSolana.resources.map(T=>`- ${T}`)]:[]].join(`
`);const k=await S.signMessage(new TextEncoder().encode(y),"utf8");if(!k||!(k instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");_=k}}try{const{data:A,error:m}=await de(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:y,signature:NN(_)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(p=e.options)===null||p===void 0?void 0:p.captchaToken}}:null),xform:qi});if(m)throw m;return!A||!A.session||!A.user?{data:{user:null,session:null},error:new Ng}:(A.session&&(await this._saveSession(A.session),await this._notifyAllSubscribers("SIGNED_IN",A.session)),{data:Object.assign({},A),error:m})}catch(A){if(oe(A))return{data:{user:null,session:null},error:A};throw A}}async _exchangeCodeForSession(e){const t=await ba(this.storage,`${this.storageKey}-code-verifier`),[n,i]=(t??"").split("/");try{const{data:r,error:o}=await de(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:qi});if(await Jr(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!r||!r.session||!r.user?{data:{user:null,session:null,redirectType:null},error:new Ng}:(r.session&&(await this._saveSession(r.session),await this._notifyAllSubscribers("SIGNED_IN",r.session)),{data:Object.assign(Object.assign({},r),{redirectType:i??null}),error:o})}catch(r){if(oe(r))return{data:{user:null,session:null,redirectType:null},error:r};throw r}}async signInWithIdToken(e){try{const{options:t,provider:n,token:i,access_token:r,nonce:o}=e,l=await de(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:i,access_token:r,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:qi}),{data:c,error:u}=l;return u?{data:{user:null,session:null},error:u}:!c||!c.session||!c.user?{data:{user:null,session:null},error:new Ng}:(c.session&&(await this._saveSession(c.session),await this._notifyAllSubscribers("SIGNED_IN",c.session)),{data:c,error:u})}catch(t){if(oe(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,n,i,r,o;try{if("email"in e){const{email:l,options:c}=e;let u=null,h=null;this.flowType==="pkce"&&([u,h]=await fc(this.storage,this.storageKey));const{error:d}=await de(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:l,data:(t=c==null?void 0:c.data)!==null&&t!==void 0?t:{},create_user:(n=c==null?void 0:c.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},code_challenge:u,code_challenge_method:h},redirectTo:c==null?void 0:c.emailRedirectTo});return{data:{user:null,session:null},error:d}}if("phone"in e){const{phone:l,options:c}=e,{data:u,error:h}=await de(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:l,data:(i=c==null?void 0:c.data)!==null&&i!==void 0?i:{},create_user:(r=c==null?void 0:c.shouldCreateUser)!==null&&r!==void 0?r:!0,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken},channel:(o=c==null?void 0:c.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:u==null?void 0:u.message_id},error:h}}throw new Ig("You must provide either an email or phone number.")}catch(l){if(oe(l))return{data:{user:null,session:null},error:l};throw l}}async verifyOtp(e){var t,n;try{let i,r;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,r=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:o,error:l}=await de(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:r}}),redirectTo:i,xform:qi});if(l)throw l;if(!o)throw new Error("An error occurred on token verification.");const c=o.session,u=o.user;return c!=null&&c.access_token&&(await this._saveSession(c),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",c)),{data:{user:u,session:c},error:null}}catch(i){if(oe(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,n,i;try{let r=null,o=null;return this.flowType==="pkce"&&([r,o]=await fc(this.storage,this.storageKey)),await de(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:r,code_challenge_method:o}),headers:this.headers,xform:JN})}catch(r){if(oe(r))return{data:null,error:r};throw r}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new Qr;const{error:i}=await de(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(oe(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:i,options:r}=e,{error:o}=await de(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:i,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}},redirectTo:r==null?void 0:r.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:n,type:i,options:r}=e,{data:o,error:l}=await de(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:i,gotrue_meta_security:{captcha_token:r==null?void 0:r.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:l}}throw new Ig("You must provide either an email or phone number and a type")}catch(t){if(oe(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await ba(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<G0:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const o=await ba(this.userStorage,this.storageKey+"-user");o!=null&&o.user?e.user=o.user:e.user=X0()}if(this.storage.isServer&&e.user){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(c,u,h)=>(!o&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(c,u,h))})}return{data:{session:e},error:null}}const{session:i,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{session:null},error:r}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await de(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:ro}):await this._useSession(async t=>{var n,i,r;const{data:o,error:l}=t;if(l)throw l;return!(!((n=o.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Qr}:await de(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(r=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&r!==void 0?r:void 0,xform:ro})})}catch(t){if(oe(t))return AN(t)&&(await this._removeSession(),await Jr(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:i,error:r}=n;if(r)throw r;if(!i.session)throw new Qr;const o=i.session;let l=null,c=null;this.flowType==="pkce"&&e.email!=null&&([l,c]=await fc(this.storage,this.storageKey));const{data:u,error:h}=await de(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:l,code_challenge_method:c}),jwt:o.access_token,xform:ro});if(h)throw h;return o.user=u.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(n){if(oe(n))return{data:{user:null},error:n};throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new Qr;const t=Date.now()/1e3;let n=t,i=!0,r=null;const{payload:o}=K0(e.access_token);if(o.exp&&(n=o.exp,i=n<=t),i){const{session:l,error:c}=await this._callRefreshToken(e.refresh_token);if(c)return{data:{user:null,session:null},error:c};if(!l)return{data:{user:null,session:null},error:null};r=l}else{const{data:l,error:c}=await this._getUser(e.access_token);if(c)throw c;r={access_token:e.access_token,refresh_token:e.refresh_token,user:l.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(r),await this._notifyAllSubscribers("SIGNED_IN",r)}return{data:{user:r.user,session:r},error:null}}catch(t){if(oe(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:o,error:l}=t;if(l)throw l;e=(n=o.session)!==null&&n!==void 0?n:void 0}if(!(e!=null&&e.refresh_token))throw new Qr;const{session:i,error:r}=await this._callRefreshToken(e.refresh_token);return r?{data:{user:null,session:null},error:r}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(oe(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!Us())throw new Dg("No browser detected.");if(e.error||e.error_description||e.error_code)throw new Dg(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new kA("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new Dg("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new kA("No code detected.");const{data:b,error:v}=await this._exchangeCodeForSession(e.code);if(v)throw v;const S=new URL(window.location.href);return S.searchParams.delete("code"),window.history.replaceState(window.history.state,"",S.toString()),{data:{session:b.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:i,access_token:r,refresh_token:o,expires_in:l,expires_at:c,token_type:u}=e;if(!r||!l||!o||!u)throw new Dg("No session defined in URL");const h=Math.round(Date.now()/1e3),d=parseInt(l);let f=h+d;c&&(f=parseInt(c));const p=f-h;p*1e3<=wc&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${p}s, should have been closer to ${d}s`);const y=f-d;h-y>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",y,f,h):h-y<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",y,f,h);const{data:_,error:A}=await this._getUser(r);if(A)throw A;const m={provider_token:n,provider_refresh_token:i,access_token:r,expires_in:d,expires_at:f,refresh_token:o,token_type:u,user:_.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:m,redirectType:e.type},error:null}}catch(n){if(oe(n))return{data:{session:null,redirectType:null},error:n};throw n}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await ba(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:i,error:r}=t;if(r)return{error:r};const o=(n=i.session)===null||n===void 0?void 0:n.access_token;if(o){const{error:l}=await this.admin.signOut(o,e);if(l&&!(xN(l)&&(l.status===404||l.status===401||l.status===403)))return{error:l}}return e!=="others"&&(await this._removeSession(),await Jr(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=DN(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,i;try{const{data:{session:r},error:o}=t;if(o)throw o;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",r)),this._debug("INITIAL_SESSION","callback id",e,"session",r)}catch(r){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",r),console.error(r)}})}async resetPasswordForEmail(e,t={}){let n=null,i=null;this.flowType==="pkce"&&([n,i]=await fc(this.storage,this.storageKey,!0));try{return await de(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(r){if(oe(r))return{data:null,error:r};throw r}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(oe(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:n,error:i}=await this._useSession(async r=>{var o,l,c,u,h;const{data:d,error:f}=r;if(f)throw f;const p=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(l=e.options)===null||l===void 0?void 0:l.scopes,queryParams:(c=e.options)===null||c===void 0?void 0:c.queryParams,skipBrowserRedirect:!0});return await de(this.fetch,"GET",p,{headers:this.headers,jwt:(h=(u=d.session)===null||u===void 0?void 0:u.access_token)!==null&&h!==void 0?h:void 0})});if(i)throw i;return Us()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),{data:{provider:e.provider,url:n==null?void 0:n.url},error:null}}catch(n){if(oe(n))return{data:{provider:e.provider,url:null},error:n};throw n}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,i;const{data:r,error:o}=t;if(o)throw o;return await de(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(n=r.session)===null||n===void 0?void 0:n.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(oe(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await FN(async i=>(i>0&&await MN(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await de(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:qi})),(i,r)=>{const o=200*Math.pow(2,i);return r&&q0(r)&&Date.now()+o-n<wc})}catch(n){if(this._debug(t,"error",n),oe(n))return{data:{session:null,user:null},error:n};throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),Us()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const i=await ba(this.storage,this.storageKey);if(i&&this.userStorage){let o=await ba(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!o&&(o={user:i.user},await bc(this.userStorage,this.storageKey+"-user",o)),i.user=(e=o==null?void 0:o.user)!==null&&e!==void 0?e:X0()}else if(i&&!i.user&&!i.user){const o=await ba(this.storage,this.storageKey+"-user");o&&(o!=null&&o.user)?(i.user=o.user,await Jr(this.storage,this.storageKey+"-user"),await bc(this.storage,this.storageKey,i)):i.user=X0()}if(this._debug(n,"session from storage",i),!this._isValidSession(i)){this._debug(n,"session is not valid"),i!==null&&await this._removeSession();return}const r=((t=i.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<G0;if(this._debug(n,`session has${r?"":" not"} expired with margin of ${G0}s`),r){if(this.autoRefreshToken&&i.refresh_token){const{error:o}=await this._callRefreshToken(i.refresh_token);o&&(console.error(o),q0(o)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",o),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:o,error:l}=await this._getUser(i.access_token);!l&&(o!=null&&o.user)?(i.user=o.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(o){console.error("Error getting user data:",o),this._debug(n,"error getting user data, skipping SIGNED_IN notification",o)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(n,"error",i),console.error(i);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new Qr;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new l0;const{data:r,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!r.session)throw new Qr;await this._saveSession(r.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",r.session);const l={session:r.session,error:null};return this.refreshingDeferred.resolve(l),l}catch(r){if(this._debug(i,"error",r),oe(r)){const o={session:null,error:r};return q0(r)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(r),r}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,n=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const r=[],o=Array.from(this.stateChangeEmitters.values()).map(async l=>{try{await l.callback(e,t)}catch(c){r.push(c)}});if(await Promise.all(o),r.length>0){for(let l=0;l<r.length;l+=1)console.error(r[l]);throw r[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),n=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&t.user&&await bc(this.userStorage,this.storageKey+"-user",{user:t.user});const i=Object.assign({},t);delete i.user;const r=IA(i);await bc(this.storage,this.storageKey,r)}else{const i=IA(t);await bc(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),await Jr(this.storage,this.storageKey),await Jr(this.storage,this.storageKey+"-code-verifier"),await Jr(this.storage,this.storageKey+"-user"),this.userStorage&&await Jr(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Us()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),wc);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((n.expires_at*1e3-e)/wc);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${wc}ms, refresh threshold is ${hw} ticks`),i<=hw&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof eC)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Us()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const i=[`provider=${encodeURIComponent(t)}`];if(n!=null&&n.redirectTo&&i.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&i.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[r,o]=await fc(this.storage,this.storageKey),l=new URLSearchParams({code_challenge:`${encodeURIComponent(r)}`,code_challenge_method:`${encodeURIComponent(o)}`});i.push(l.toString())}if(n!=null&&n.queryParams){const r=new URLSearchParams(n.queryParams);i.push(r.toString())}return n!=null&&n.skipBrowserRedirect&&i.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:i,error:r}=t;return r?{data:null,error:r}:await de(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=i==null?void 0:i.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(oe(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,i;const{data:r,error:o}=t;if(o)return{data:null,error:o};const l=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:c,error:u}=await de(this.fetch,"POST",`${this.url}/factors`,{body:l,headers:this.headers,jwt:(n=r==null?void 0:r.session)===null||n===void 0?void 0:n.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((i=c==null?void 0:c.totp)===null||i===void 0)&&i.qr_code)&&(c.totp.qr_code=`data:image/svg+xml;utf-8,${c.totp.qr_code}`),{data:c,error:null})})}catch(t){if(oe(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:i,error:r}=t;if(r)return{data:null,error:r};const{data:o,error:l}=await de(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(n=i==null?void 0:i.session)===null||n===void 0?void 0:n.access_token});return l?{data:null,error:l}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:l})})}catch(t){if(oe(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var n;const{data:i,error:r}=t;return r?{data:null,error:r}:await de(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(n=i==null?void 0:i.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(oe(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?{data:null,error:n}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const n=(e==null?void 0:e.factors)||[],i=n.filter(o=>o.factor_type==="totp"&&o.status==="verified"),r=n.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:n,totp:i,phone:r},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,n;const{data:{session:i},error:r}=e;if(r)return{data:null,error:r};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=K0(i.access_token);let l=null;o.aal&&(l=o.aal);let c=l;((n=(t=i.user.factors)===null||t===void 0?void 0:t.filter(d=>d.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(c="aal2");const h=o.amr||[];return{data:{currentLevel:l,nextLevel:c,currentAuthenticationMethods:h},error:null}}))}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(l=>l.kid===e);if(n)return n;const i=Date.now();if(n=this.jwks.keys.find(l=>l.kid===e),n&&this.jwks_cached_at+bN>i)return n;const{data:r,error:o}=await de(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(o)throw o;return!r.keys||r.keys.length===0||(this.jwks=r,this.jwks_cached_at=i,n=r.keys.find(l=>l.kid===e),!n)?null:n}async getClaims(e,t={}){try{let n=e;if(!n){const{data:p,error:y}=await this.getSession();if(y||!p.session)return{data:null,error:y};n=p.session.access_token}const{header:i,payload:r,signature:o,raw:{header:l,payload:c}}=K0(n);t!=null&&t.allowExpired||VN(r.exp);const u=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!u){const{error:p}=await this.getUser(n);if(p)throw p;return{data:{claims:r,header:i,signature:o},error:null}}const h=WN(i.alg),d=await crypto.subtle.importKey("jwk",u,h,!0,["verify"]);if(!await crypto.subtle.verify(h,d,o,RN(`${l}.${c}`)))throw new pw("Invalid JWT signature");return{data:{claims:r,header:i,signature:o},error:null}}catch(n){if(oe(n))return{data:null,error:n};throw n}}}tf.nextInstanceID=0;const aI=tf;class lI extends aI{constructor(e){super(e)}}var cI=function(s,e,t,n){function i(r){return r instanceof t?r:new t(function(o){o(r)})}return new(t||(t=Promise))(function(r,o){function l(h){try{u(n.next(h))}catch(d){o(d)}}function c(h){try{u(n.throw(h))}catch(d){o(d)}}function u(h){h.done?r(h.value):i(h.value).then(l,c)}u((n=n.apply(s,e||[])).next())})};class uI{constructor(e,t,n){var i,r,o;this.supabaseUrl=e,this.supabaseKey=t;const l=gN(e);if(!t)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const c=`sb-${l.hostname.split(".")[0]}-auth-token`,u={db:rN,realtime:aN,auth:Object.assign(Object.assign({},oN),{storageKey:c}),global:iN},h=pN(n??{},u);this.storageKey=(i=h.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(r=h.global.headers)!==null&&r!==void 0?r:{},h.accessToken?(this.accessToken=h.accessToken,this.auth=new Proxy({},{get:(d,f)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(f)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=h.auth)!==null&&o!==void 0?o:{},this.headers,h.global.fetch),this.fetch=hN(t,this._getAccessToken.bind(this),h.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},h.realtime)),this.rest=new E2(new URL("rest/v1",l).href,{headers:this.headers,schema:h.db.schema,fetch:this.fetch}),this.storage=new tN(this.storageUrl.href,this.headers,this.fetch,n==null?void 0:n.storage),h.accessToken||this._listenForAuthEvents()}get functions(){return new s2(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},n={}){return this.rest.rpc(e,t,n)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return cI(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:n}=yield this.auth.getSession();return(t=(e=n.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:this.supabaseKey})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:i,userStorage:r,storageKey:o,flowType:l,lock:c,debug:u},h,d){const f={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new lI({url:this.authUrl.href,headers:Object.assign(Object.assign({},f),h),storageKey:o,autoRefreshToken:e,persistSession:t,detectSessionInUrl:n,storage:i,userStorage:r,flowType:l,lock:c,debug:u,fetch:d,hasCustomAuthorizationHeader:Object.keys(this.headers).some(p=>p.toLowerCase()==="authorization")})}_initRealtimeClient(e){return new z2(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,n)=>{this._handleTokenChanged(t,"CLIENT",n==null?void 0:n.access_token)})}_handleTokenChanged(e,t,n){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==n?this.changedAccessToken=n:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const hI=(s,e,t)=>new uI(s,e,t);function dI(){if(typeof window<"u"||typeof process>"u")return!1;const s=process.version;if(s==null)return!1;const e=s.match(/^v(\d+)\./);return e?parseInt(e[1],10)<=18:!1}dI()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const fI="https://xafknhzgmljjsrfiabzb.supabase.co",pI="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhhZmtuaHpnbWxqanNyZmlhYnpiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI2MzEwNDIsImV4cCI6MjA3ODIwNzA0Mn0.oozQPtaKU7AomPutZXy9PaqeUbAxU2PNEEschRDpGT4",Xe=hI(fI,pI),tC=Q.createContext({user:null,profile:null,loading:!0});function gI({children:s}){const[e,t]=Q.useState(null),[n,i]=Q.useState(null),[r,o]=Q.useState(!0);Q.useEffect(()=>{Xe.auth.getSession().then(({data:{session:u}})=>{t((u==null?void 0:u.user)??null),u!=null&&u.user?l(u.user.id):o(!1)});const{data:{subscription:c}}=Xe.auth.onAuthStateChange((u,h)=>{t((h==null?void 0:h.user)??null),h!=null&&h.user?l(h.user.id):(i(null),o(!1))});return()=>c.unsubscribe()},[]);const l=async c=>{try{const{data:u,error:h}=await Xe.from("users").select("*").eq("auth_user_id",c).maybeSingle();if(h)throw h;i(u)}catch(u){console.error("Error loading profile:",u)}finally{o(!1)}};return E.jsx(tC.Provider,{value:{user:e,profile:n,loading:r},children:s})}const rg=()=>Q.useContext(tC);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var mI={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yI=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),An=(s,e)=>{const t=Q.forwardRef(({color:n="currentColor",size:i=24,strokeWidth:r=2,absoluteStrokeWidth:o,className:l="",children:c,...u},h)=>Q.createElement("svg",{ref:h,...mI,width:i,height:i,stroke:n,strokeWidth:o?Number(r)*24/Number(i):r,className:["lucide",`lucide-${yI(s)}`,l].join(" "),...u},[...e.map(([d,f])=>Q.createElement(d,f)),...Array.isArray(c)?c:[c]]));return t.displayName=`${s}`,t};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FA=An("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vI=An("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wI=An("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bI=An("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _I=An("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xI=An("Instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AI=An("Linkedin",[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SI=An("Loader",[["line",{x1:"12",x2:"12",y1:"2",y2:"6",key:"gza1u7"}],["line",{x1:"12",x2:"12",y1:"18",y2:"22",key:"1qhbu9"}],["line",{x1:"4.93",x2:"7.76",y1:"4.93",y2:"7.76",key:"xae44r"}],["line",{x1:"16.24",x2:"19.07",y1:"16.24",y2:"19.07",key:"bxnmvf"}],["line",{x1:"2",x2:"6",y1:"12",y2:"12",key:"89khin"}],["line",{x1:"18",x2:"22",y1:"12",y2:"12",key:"pb8tfm"}],["line",{x1:"4.93",x2:"7.76",y1:"19.07",y2:"16.24",key:"1uxjnu"}],["line",{x1:"16.24",x2:"19.07",y1:"7.76",y2:"4.93",key:"6duxfx"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EI=An("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CI=An("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kI=An("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TI=An("Stethoscope",[["path",{d:"M4.8 2.3A.3.3 0 1 0 5 2H4a2 2 0 0 0-2 2v5a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6V4a2 2 0 0 0-2-2h-1a.2.2 0 1 0 .3.3",key:"1jd90r"}],["path",{d:"M8 15v1a6 6 0 0 0 6 6v0a6 6 0 0 0 6-6v-4",key:"126ukv"}],["circle",{cx:"20",cy:"10",r:"2",key:"ts1r5v"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PI=An("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RI=An("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nC=An("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function NI(){const[s,e]=Q.useState(!0),[t,n]=Q.useState(""),[i,r]=Q.useState(""),[o,l]=Q.useState(""),[c,u]=Q.useState(""),[h,d]=Q.useState(!1),{signIn:f,signUp:p}=rg(),y=async _=>{_.preventDefault(),u(""),d(!0);try{s?await f(t,i):await p(t,i,o,"EXPORTACION")}catch(A){u(A.message||"Ocurri un error")}finally{d(!1)}};return E.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-slate-100 flex items-center justify-center p-4",children:E.jsxs("div",{className:"max-w-md w-full",children:[E.jsxs("div",{className:"text-center mb-8",children:[E.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-blue-600 rounded-full mb-4",children:E.jsx(bI,{className:"h-8 w-8 text-white"})}),E.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Sistema de Comprobantes"}),E.jsx("p",{className:"text-gray-600",children:"Automatizacin de carga para Tango Gestin"})]}),E.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8",children:[E.jsxs("div",{className:"flex mb-6 bg-gray-100 rounded-lg p-1",children:[E.jsx("button",{onClick:()=>e(!0),className:`flex-1 py-2 px-4 rounded-md font-medium transition-colors ${s?"bg-white text-blue-600 shadow-sm":"text-gray-600 hover:text-gray-900"}`,children:"Iniciar Sesin"}),E.jsx("button",{onClick:()=>e(!1),className:`flex-1 py-2 px-4 rounded-md font-medium transition-colors ${s?"text-gray-600 hover:text-gray-900":"bg-white text-blue-600 shadow-sm"}`,children:"Registrarse"})]}),c&&E.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:c}),E.jsxs("form",{onSubmit:y,className:"space-y-4",children:[!s&&E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nombre Completo"}),E.jsx("input",{type:"text",value:o,onChange:_=>l(_.target.value),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Email"}),E.jsx("input",{type:"email",value:t,onChange:_=>n(_.target.value),required:!0,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Contrasea"}),E.jsx("input",{type:"password",value:i,onChange:_=>r(_.target.value),required:!0,minLength:6,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),E.jsx("button",{type:"submit",disabled:h,className:"w-full py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:h?"Procesando...":s?"Iniciar Sesin":"Registrarse"})]})]})]})})}function II({children:s,requiredRole:e}){const{user:t,profile:n,loading:i}=rg();return i?E.jsx("div",{className:"min-h-screen flex items-center justify-center",children:E.jsxs("div",{className:"text-center",children:[E.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),E.jsx("p",{className:"mt-4 text-gray-600",children:"Cargando..."})]})}):!t||!n?E.jsx(NI,{}):e&&n.role!==e?E.jsx("div",{className:"min-h-screen flex items-center justify-center",children:E.jsxs("div",{className:"text-center",children:[E.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Acceso Denegado"}),E.jsx("p",{className:"text-gray-600",children:"No tienes permisos para acceder a esta seccin."})]})}):E.jsx(E.Fragment,{children:s})}function DI({onFilesSelected:s,disabled:e,accept:t=".pdf,.jpg,.jpeg,.png"}){const[n,i]=Q.useState(!1),[r,o]=Q.useState([]),l=Q.useCallback(f=>{f.preventDefault(),f.stopPropagation(),f.type==="dragenter"||f.type==="dragover"?i(!0):f.type==="dragleave"&&i(!1)},[]),c=Q.useCallback(f=>{if(f.preventDefault(),f.stopPropagation(),i(!1),e)return;const p=Array.from(f.dataTransfer.files);p.length>0&&o(p)},[e]),u=Q.useCallback(f=>{if(e)return;const p=Array.from(f.target.files||[]);p.length>0&&o(p)},[e]),h=()=>{r.length>0&&(s(r),o([]))},d=f=>{o(p=>p.filter((y,_)=>_!==f))};return E.jsxs("div",{className:"w-full",children:[E.jsxs("div",{className:`relative border-2 border-dashed rounded-lg p-8 transition-colors ${n?"border-blue-500 bg-blue-50":e?"border-gray-200 bg-gray-50":"border-gray-300 hover:border-gray-400"}`,onDragEnter:l,onDragLeave:l,onDragOver:l,onDrop:c,children:[E.jsx("input",{type:"file",multiple:!0,accept:t,onChange:u,disabled:e,className:"absolute inset-0 w-full h-full opacity-0 cursor-pointer"}),E.jsxs("div",{className:"flex flex-col items-center justify-center space-y-3",children:[E.jsx(RI,{className:"h-10 w-10 text-gray-400"}),E.jsxs("div",{className:"text-center",children:[E.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Arrastra archivos aqu o haz clic para seleccionar"}),E.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"PDF, JPG, JPEG o PNG"})]})]})]}),r.length>0&&E.jsxs("div",{className:"mt-4 space-y-2",children:[E.jsxs("div",{className:"flex items-center justify-between",children:[E.jsxs("p",{className:"text-sm font-medium text-gray-700",children:["Archivos seleccionados (",r.length,")"]}),E.jsx("button",{onClick:h,disabled:e,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed text-sm font-medium",children:"Procesar Archivos"})]}),E.jsx("div",{className:"space-y-1",children:r.map((f,p)=>E.jsxs("div",{className:"flex items-center justify-between p-2 bg-gray-50 rounded border border-gray-200",children:[E.jsx("span",{className:"text-sm text-gray-700 truncate",children:f.name}),E.jsx("button",{onClick:()=>d(p),disabled:e,className:"text-gray-400 hover:text-red-600 disabled:opacity-50",children:E.jsx(nC,{className:"h-4 w-4"})})]},p))})]})]})}function V_(s){const e=s.replace(/[-\s]/g,"");if(e.length!==11||!/^\d+$/.test(e))return!1;const t=[5,4,3,2,7,6,5,4,3,2],n=e.split("").map(Number),i=n[10];let r=0;for(let c=0;c<10;c++)r+=n[c]*t[c];const o=r%11,l=o===0?0:o===1?9:11-o;return i===l}function OI(s){const e=s.replace(/[-\s]/g,"");return e.length!==11?s:`${e.slice(0,2)}-${e.slice(2,10)}-${e.slice(10)}`}function LI(s){const e=[],t=s.netTaxed+s.netUntaxed+s.netExempt+s.ivaAmount+s.otherTaxesAmount;return Math.abs(t-s.totalAmount)>.01&&e.push(`El total calculado ($${t.toFixed(2)}) no coincide con el total ingresado ($${s.totalAmount.toFixed(2)})`),{valid:e.length===0,errors:e}}const MI={FACTURA_A:"Factura A",FACTURA_B:"Factura B",FACTURA_C:"Factura C",FACTURA_M:"Factura M",NOTA_CREDITO_A:"Nota de Crdito A",NOTA_CREDITO_B:"Nota de Crdito B",NOTA_CREDITO_C:"Nota de Crdito C",NOTA_DEBITO_A:"Nota de Dbito A",NOTA_DEBITO_B:"Nota de Dbito B",NOTA_DEBITO_C:"Nota de Dbito C"},FI={"001":"FACTURA_A","006":"FACTURA_B","011":"FACTURA_C","051":"FACTURA_M","003":"NOTA_CREDITO_A","008":"NOTA_CREDITO_B","013":"NOTA_CREDITO_C","002":"NOTA_DEBITO_A","007":"NOTA_DEBITO_B","012":"NOTA_DEBITO_C"};function sC(s){return FI[s]||null}const jI=Object.entries(MI).map(([s,e])=>({value:s,label:e})),gn=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),gw=[.001,0,0,.001,0,0],J0=1.35,rs={ANY:1,DISPLAY:2,PRINT:4,SAVE:8,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},oo={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},nf="pdfjs_internal_editor_",ie={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},ge={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},BI={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},mw={TRIANGLES:1,LATTICE:2,PATCH:3},Ft={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_ADD_TO_PATH:4,STROKE_ADD_TO_PATH:5,FILL_STROKE_ADD_TO_PATH:6,ADD_TO_PATH:7,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},im={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},ft={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},_c={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},c0={ERRORS:0,WARNINGS:1,INFOS:5},sf={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},Xh={moveTo:0,lineTo:1,curveTo:2,quadraticCurveTo:3,closePath:4},$I={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let u0=c0.WARNINGS;function UI(s){Number.isInteger(s)&&(u0=s)}function zI(){return u0}function h0(s){u0>=c0.INFOS&&console.info(`Info: ${s}`)}function ne(s){u0>=c0.WARNINGS&&console.warn(`Warning: ${s}`)}function Me(s){throw new Error(s)}function me(s,e){s||Me(e)}function HI(s){switch(s==null?void 0:s.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function iC(s,e=null,t=null){if(!s)return null;if(t&&typeof s=="string"){if(t.addDefaultProtocol&&s.startsWith("www.")){const i=s.match(/\./g);(i==null?void 0:i.length)>=2&&(s=`http://${s}`)}if(t.tryConvertEncoding)try{s=KI(s)}catch{}}const n=e?URL.parse(s,e):URL.parse(s);return HI(n)?n:null}function rC(s,e,t=!1){const n=URL.parse(s);return n?(n.hash=e,n.href):t&&iC(s,"http://example.com")?s.split("#",1)[0]+`${e?`#${e}`:""}`:""}function ae(s,e,t,n=!1){return Object.defineProperty(s,e,{value:t,enumerable:!n,configurable:!0,writable:!1}),t}const cc=function(){function e(t,n){this.message=t,this.name=n}return e.prototype=new Error,e.constructor=e,e}();class jA extends cc{constructor(e,t){super(e,"PasswordException"),this.code=t}}class Q0 extends cc{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class yw extends cc{constructor(e){super(e,"InvalidPDFException")}}class uy extends cc{constructor(e,t,n){super(e,"ResponseException"),this.status=t,this.missing=n}}class VI extends cc{constructor(e){super(e,"FormatError")}}class ha extends cc{constructor(e){super(e,"AbortException")}}function oC(s){(typeof s!="object"||(s==null?void 0:s.length)===void 0)&&Me("Invalid argument for bytesToString");const e=s.length,t=8192;if(e<t)return String.fromCharCode.apply(null,s);const n=[];for(let i=0;i<e;i+=t){const r=Math.min(i+t,e),o=s.subarray(i,r);n.push(String.fromCharCode.apply(null,o))}return n.join("")}function og(s){typeof s!="string"&&Me("Invalid argument for stringToBytes");const e=s.length,t=new Uint8Array(e);for(let n=0;n<e;++n)t[n]=s.charCodeAt(n)&255;return t}function WI(s){return String.fromCharCode(s>>24&255,s>>16&255,s>>8&255,s&255)}function GI(){const s=new Uint8Array(4);return s[0]=1,new Uint32Array(s.buffer,0,1)[0]===1}function qI(){try{return new Function(""),!0}catch{return!1}}class Kt{static get isLittleEndian(){return ae(this,"isLittleEndian",GI())}static get isEvalSupported(){return ae(this,"isEvalSupported",qI())}static get isOffscreenCanvasSupported(){return ae(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return ae(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get isFloat16ArraySupported(){return ae(this,"isFloat16ArraySupported",typeof Float16Array<"u")}static get isSanitizerSupported(){return ae(this,"isSanitizerSupported",typeof Sanitizer<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return ae(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){var e,t;return ae(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const Z0=Array.from(Array(256).keys(),s=>s.toString(16).padStart(2,"0"));var $r,rm,vw;class K{static makeHexColor(e,t,n){return`#${Z0[e]}${Z0[t]}${Z0[n]}`}static domMatrixToTransform(e){return[e.a,e.b,e.c,e.d,e.e,e.f]}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[1],t[1]=n,n=t[2],t[2]=t[3],t[3]=n,e[1]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static multiplyByDOMMatrix(e,t){return[e[0]*t.a+e[2]*t.b,e[1]*t.a+e[3]*t.b,e[0]*t.c+e[2]*t.d,e[1]*t.c+e[3]*t.d,e[0]*t.e+e[2]*t.f+e[4],e[1]*t.e+e[3]*t.f+e[5]]}static applyTransform(e,t,n=0){const i=e[n],r=e[n+1];e[n]=i*t[0]+r*t[2]+t[4],e[n+1]=i*t[1]+r*t[3]+t[5]}static applyTransformToBezier(e,t,n=0){const i=t[0],r=t[1],o=t[2],l=t[3],c=t[4],u=t[5];for(let h=0;h<6;h+=2){const d=e[n+h],f=e[n+h+1];e[n+h]=d*i+f*o+c,e[n+h+1]=d*r+f*l+u}}static applyInverseTransform(e,t){const n=e[0],i=e[1],r=t[0]*t[3]-t[1]*t[2];e[0]=(n*t[3]-i*t[2]+t[2]*t[5]-t[4]*t[3])/r,e[1]=(-n*t[1]+i*t[0]+t[4]*t[1]-t[5]*t[0])/r}static axialAlignedBoundingBox(e,t,n){const i=t[0],r=t[1],o=t[2],l=t[3],c=t[4],u=t[5],h=e[0],d=e[1],f=e[2],p=e[3];let y=i*h+c,_=y,A=i*f+c,m=A,b=l*d+u,v=b,S=l*p+u,C=S;if(r!==0||o!==0){const k=r*h,T=r*f,I=o*d,O=o*p;y+=I,m+=I,A+=O,_+=O,b+=k,C+=k,S+=T,v+=T}n[0]=Math.min(n[0],y,A,_,m),n[1]=Math.min(n[1],b,S,v,C),n[2]=Math.max(n[2],y,A,_,m),n[3]=Math.max(n[3],b,S,v,C)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const n=e[0],i=e[1],r=e[2],o=e[3],l=n**2+i**2,c=n*r+i*o,u=r**2+o**2,h=(l+u)/2,d=Math.sqrt(h**2-(l*u-c**2));t[0]=Math.sqrt(h+d||1),t[1]=Math.sqrt(h-d||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),i=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>i)return null;const r=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),o=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return r>o?null:[n,r,i,o]}static pointBoundingBox(e,t,n){n[0]=Math.min(n[0],e),n[1]=Math.min(n[1],t),n[2]=Math.max(n[2],e),n[3]=Math.max(n[3],t)}static rectBoundingBox(e,t,n,i,r){r[0]=Math.min(r[0],e,n),r[1]=Math.min(r[1],t,i),r[2]=Math.max(r[2],e,n),r[3]=Math.max(r[3],t,i)}static bezierBoundingBox(e,t,n,i,r,o,l,c,u){u[0]=Math.min(u[0],e,l),u[1]=Math.min(u[1],t,c),u[2]=Math.max(u[2],e,l),u[3]=Math.max(u[3],t,c),x(this,$r,vw).call(this,e,n,r,l,t,i,o,c,3*(-e+3*(n-r)+l),6*(e-2*n+r),3*(n-e),u),x(this,$r,vw).call(this,e,n,r,l,t,i,o,c,3*(-t+3*(i-o)+c),6*(t-2*i+o),3*(i-t),u)}}$r=new WeakSet,rm=function(e,t,n,i,r,o,l,c,u,h){if(u<=0||u>=1)return;const d=1-u,f=u*u,p=f*u,y=d*(d*(d*e+3*u*t)+3*f*n)+p*i,_=d*(d*(d*r+3*u*o)+3*f*l)+p*c;h[0]=Math.min(h[0],y),h[1]=Math.min(h[1],_),h[2]=Math.max(h[2],y),h[3]=Math.max(h[3],_)},vw=function(e,t,n,i,r,o,l,c,u,h,d,f){if(Math.abs(u)<1e-12){Math.abs(h)>=1e-12&&x(this,$r,rm).call(this,e,t,n,i,r,o,l,c,-d/h,f);return}const p=h**2-4*d*u;if(p<0)return;const y=Math.sqrt(p),_=2*u;x(this,$r,rm).call(this,e,t,n,i,r,o,l,c,(-h+y)/_,f),x(this,$r,rm).call(this,e,t,n,i,r,o,l,c,(-h-y)/_,f)},w(K,$r);function KI(s){return decodeURIComponent(escape(s))}let ev=null,BA=null;function XI(s){return ev||(ev=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,BA=new Map([["","t"]])),s.replaceAll(ev,(e,t,n)=>t?t.normalize("NFKC"):BA.get(n))}function aC(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const s=new Uint8Array(32);return crypto.getRandomValues(s),oC(s)}const Uc="pdfjs_internal_id_";function YI(s,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[n,i,...r]=t;if(!s(n)&&!Number.isInteger(n)||!e(i))return!1;const o=r.length;let l=!0;switch(i.name){case"XYZ":if(o<2||o>3)return!1;break;case"Fit":case"FitB":return o===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(o>1)return!1;break;case"FitR":if(o!==4)return!1;l=!1;break;default:return!1}for(const c of r)if(!(typeof c=="number"||l&&c===null))return!1;return!0}function mn(s,e,t){return Math.min(Math.max(s,e),t)}function lC(s){return Uint8Array.prototype.toBase64?s.toBase64():btoa(oC(s))}function JI(s){return Uint8Array.fromBase64?Uint8Array.fromBase64(s):og(atob(s))}typeof Promise.try!="function"&&(Promise.try=function(s,...e){return new Promise(t=>{t(s(...e))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(s){return s.reduce((e,t)=>e+t,0)});class rf{static textContent(e){const t=[],n={items:t,styles:Object.create(null)};function i(r){var c;if(!r)return;let o=null;const l=r.name;if(l==="#text")o=r.value;else if(rf.shouldBuildText(l))(c=r==null?void 0:r.attributes)!=null&&c.textContent?o=r.attributes.textContent:r.value&&(o=r.value);else return;if(o!==null&&t.push({str:o}),!!r.children)for(const u of r.children)i(u)}return i(e),n}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}class cC{static setupStorage(e,t,n,i,r){const o=i.getValue(t,{value:null});switch(n.name){case"textarea":if(o.value!==null&&(e.textContent=o.value),r==="print")break;e.addEventListener("input",l=>{i.setValue(t,{value:l.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(o.value===n.attributes.xfaOn?e.setAttribute("checked",!0):o.value===n.attributes.xfaOff&&e.removeAttribute("checked"),r==="print")break;e.addEventListener("change",l=>{i.setValue(t,{value:l.target.checked?l.target.getAttribute("xfaOn"):l.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&e.setAttribute("value",o.value),r==="print")break;e.addEventListener("input",l=>{i.setValue(t,{value:l.target.value})})}break;case"select":if(o.value!==null){e.setAttribute("value",o.value);for(const l of n.children)l.attributes.value===o.value?l.attributes.selected=!0:l.attributes.hasOwnProperty("selected")&&delete l.attributes.selected}e.addEventListener("input",l=>{const c=l.target.options,u=c.selectedIndex===-1?"":c[c.selectedIndex].value;i.setValue(t,{value:u})});break}}static setAttributes({html:e,element:t,storage:n=null,intent:i,linkService:r}){const{attributes:o}=t,l=e instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${i}`);for(const[c,u]of Object.entries(o))if(u!=null)switch(c){case"class":u.length&&e.setAttribute(c,u.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",u);break;case"style":Object.assign(e.style,u);break;case"textContent":e.textContent=u;break;default:(!l||c!=="href"&&c!=="newWindow")&&e.setAttribute(c,u)}l&&r.addLinkAttributes(e,o.href,o.newWindow),n&&o.dataId&&this.setupStorage(e,o.dataId,t,n)}static render(e){var d,f;const t=e.annotationStorage,n=e.linkService,i=e.xfaHtml,r=e.intent||"display",o=document.createElement(i.name);i.attributes&&this.setAttributes({html:o,element:i,intent:r,linkService:n});const l=r!=="richText",c=e.div;if(c.append(o),e.viewport){const p=`matrix(${e.viewport.transform.join(",")})`;c.style.transform=p}l&&c.setAttribute("class","xfaLayer xfaFont");const u=[];if(i.children.length===0){if(i.value){const p=document.createTextNode(i.value);o.append(p),l&&rf.shouldBuildText(i.name)&&u.push(p)}return{textDivs:u}}const h=[[i,-1,o]];for(;h.length>0;){const[p,y,_]=h.at(-1);if(y+1===p.children.length){h.pop();continue}const A=p.children[++h.at(-1)[1]];if(A===null)continue;const{name:m}=A;if(m==="#text"){const v=document.createTextNode(A.value);u.push(v),_.append(v);continue}const b=(d=A==null?void 0:A.attributes)!=null&&d.xmlns?document.createElementNS(A.attributes.xmlns,m):document.createElement(m);if(_.append(b),A.attributes&&this.setAttributes({html:b,element:A,storage:t,intent:r,linkService:n}),((f=A.children)==null?void 0:f.length)>0)h.push([A,-1,b]);else if(A.value){const v=document.createTextNode(A.value);l&&rf.shouldBuildText(m)&&u.push(v),b.append(v)}}for(const p of c.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))p.setAttribute("readOnly",!0);return{textDivs:u}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const Ki="http://www.w3.org/2000/svg",Pa=class Pa{};B(Pa,"CSS",96),B(Pa,"PDF",72),B(Pa,"PDF_TO_CSS_UNITS",Pa.CSS/Pa.PDF);let da=Pa;async function ag(s,e="text"){if(rd(s,document.baseURI)){const t=await fetch(s);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,n)=>{const i=new XMLHttpRequest;i.open("GET",s,!0),i.responseType=e,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(i.response);return}t(i.responseText);return}n(new Error(i.statusText))}},i.send(null)})}class lg{constructor({viewBox:e,userUnit:t,scale:n,rotation:i,offsetX:r=0,offsetY:o=0,dontFlip:l=!1}){this.viewBox=e,this.userUnit=t,this.scale=n,this.rotation=i,this.offsetX=r,this.offsetY=o,n*=t;const c=(e[2]+e[0])/2,u=(e[3]+e[1])/2;let h,d,f,p;switch(i%=360,i<0&&(i+=360),i){case 180:h=-1,d=0,f=0,p=1;break;case 90:h=0,d=1,f=1,p=0;break;case 270:h=0,d=-1,f=-1,p=0;break;case 0:h=1,d=0,f=0,p=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}l&&(f=-f,p=-p);let y,_,A,m;h===0?(y=Math.abs(u-e[1])*n+r,_=Math.abs(c-e[0])*n+o,A=(e[3]-e[1])*n,m=(e[2]-e[0])*n):(y=Math.abs(c-e[0])*n+r,_=Math.abs(u-e[1])*n+o,A=(e[2]-e[0])*n,m=(e[3]-e[1])*n),this.transform=[h*n,d*n,f*n,p*n,y-h*n*c-f*n*u,_-d*n*c-p*n*u],this.width=A,this.height=m}get rawDims(){const e=this.viewBox;return ae(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:i=this.offsetY,dontFlip:r=!1}={}){return new lg({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:i,dontFlip:r})}convertToViewportPoint(e,t){const n=[e,t];return K.applyTransform(n,this.transform),n}convertToViewportRectangle(e){const t=[e[0],e[1]];K.applyTransform(t,this.transform);const n=[e[2],e[3]];return K.applyTransform(n,this.transform),[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){const n=[e,t];return K.applyInverseTransform(n,this.transform),n}}class W_ extends cc{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function d0(s){const e=s.length;let t=0;for(;t<e&&s[t].trim()==="";)t++;return s.substring(t,t+5).toLowerCase()==="data:"}function G_(s){return typeof s=="string"&&/\.pdf$/i.test(s)}function QI(s){return[s]=s.split(/[#?]/,1),s.substring(s.lastIndexOf("/")+1)}function ZI(s,e="document.pdf"){if(typeof s!="string")return e;if(d0(s))return ne('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const n=(l=>{try{return new URL(l)}catch{try{return new URL(decodeURIComponent(l))}catch{try{return new URL(l,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(l),"https://foo.bar")}catch{return null}}}}})(s);if(!n)return e;const i=l=>{try{let c=decodeURIComponent(l);return c.includes("/")?(c=c.split("/").at(-1),c.test(/^\.pdf$/i)?c:l):c}catch{return l}},r=/\.pdf$/i,o=n.pathname.split("/").at(-1);if(r.test(o))return i(o);if(n.searchParams.size>0){const l=Array.from(n.searchParams.values()).reverse();for(const u of l)if(r.test(u))return i(u);const c=Array.from(n.searchParams.keys()).reverse();for(const u of c)if(r.test(u))return i(u)}if(n.hash){const c=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(n.hash);if(c)return i(c[0])}return e}class $A{constructor(){B(this,"started",Object.create(null));B(this,"times",[])}time(e){e in this.started&&ne(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||ne(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:n}of this.times)t=Math.max(n.length,t);for(const{name:n,start:i,end:r}of this.times)e.push(`${n.padEnd(t)} ${r-i}ms
`);return e.join("")}}function rd(s,e){const t=e?URL.parse(s,e):URL.parse(s);return(t==null?void 0:t.protocol)==="http:"||(t==null?void 0:t.protocol)==="https:"}function js(s){s.preventDefault()}function lt(s){s.preventDefault(),s.stopPropagation()}function eD(s){console.log("Deprecated API usage: "+s)}var lf;class hy{static toDateObject(e){if(e instanceof Date)return e;if(!e||typeof e!="string")return null;a(this,lf)||g(this,lf,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=a(this,lf).exec(e);if(!t)return null;const n=parseInt(t[1],10);let i=parseInt(t[2],10);i=i>=1&&i<=12?i-1:0;let r=parseInt(t[3],10);r=r>=1&&r<=31?r:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let l=parseInt(t[5],10);l=l>=0&&l<=59?l:0;let c=parseInt(t[6],10);c=c>=0&&c<=59?c:0;const u=t[7]||"Z";let h=parseInt(t[8],10);h=h>=0&&h<=23?h:0;let d=parseInt(t[9],10)||0;return d=d>=0&&d<=59?d:0,u==="-"?(o+=h,l+=d):u==="+"&&(o-=h,l-=d),new Date(Date.UTC(n,i,r,o,l,c))}}lf=new WeakMap,w(hy,lf);function tD(s,{scale:e=1,rotation:t=0}){const{width:n,height:i}=s.attributes.style,r=[0,0,parseInt(n),parseInt(i)];return new lg({viewBox:r,userUnit:1,scale:e,rotation:t})}function cg(s){if(s.startsWith("#")){const e=parseInt(s.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return s.startsWith("rgb(")?s.slice(4,-1).split(",").map(e=>parseInt(e)):s.startsWith("rgba(")?s.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(ne(`Not a valid color format: "${s}"`),[0,0,0])}function nD(s){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of s.keys()){e.style.color=t;const n=window.getComputedStyle(e).color;s.set(t,cg(n))}e.remove()}function Je(s){const{a:e,b:t,c:n,d:i,e:r,f:o}=s.getTransform();return[e,t,n,i,r,o]}function fi(s){const{a:e,b:t,c:n,d:i,e:r,f:o}=s.getTransform().invertSelf();return[e,t,n,i,r,o]}function sc(s,e,t=!1,n=!0){if(e instanceof lg){const{pageWidth:i,pageHeight:r}=e.rawDims,{style:o}=s,l=Kt.isCSSRoundSupported,c=`var(--total-scale-factor) * ${i}px`,u=`var(--total-scale-factor) * ${r}px`,h=l?`round(down, ${c}, var(--scale-round-x))`:`calc(${c})`,d=l?`round(down, ${u}, var(--scale-round-y))`:`calc(${u})`;!t||e.rotation%180===0?(o.width=h,o.height=d):(o.width=d,o.height=h)}n&&s.setAttribute("data-main-rotation",e.rotation)}class Vi{constructor(){const{pixelRatio:e}=Vi;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,n,i,r=-1){let o=1/0,l=1/0,c=1/0;n=Vi.capPixels(n,r),n>0&&(o=Math.sqrt(n/(e*t))),i!==-1&&(l=i/e,c=i/t);const u=Math.min(o,l,c);return this.sx>u||this.sy>u?(this.sx=u,this.sy=u,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const n=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,n):n}return e}}const ww=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class sD{static get isDarkMode(){var e;return ae(this,"isDarkMode",!!((e=window==null?void 0:window.matchMedia)!=null&&e.call(window,"(prefers-color-scheme: dark)").matches))}}class iD{static get commentForegroundColor(){const e=document.createElement("span");e.classList.add("comment","sidebar");const{style:t}=e;t.width=t.height="0",t.display="none",t.color="var(--comment-fg-color)",document.body.append(e);const{color:n}=window.getComputedStyle(e);return e.remove(),ae(this,"commentForegroundColor",cg(n))}}function rD(s,e,t,n){n=Math.min(Math.max(n??1,0),1);const i=255*(1-n);return s=Math.round(s*n+i),e=Math.round(e*n+i),t=Math.round(t*n+i),[s,e,t]}function UA(s,e){const t=s[0]/255,n=s[1]/255,i=s[2]/255,r=Math.max(t,n,i),o=Math.min(t,n,i),l=(r+o)/2;if(r===o)e[0]=e[1]=0;else{const c=r-o;switch(e[1]=l<.5?c/(r+o):c/(2-r-o),r){case t:e[0]=((n-i)/c+(n<i?6:0))*60;break;case n:e[0]=((i-t)/c+2)*60;break;case i:e[0]=((t-n)/c+4)*60;break}}e[2]=l}function bw(s,e){const t=s[0],n=s[1],i=s[2],r=(1-Math.abs(2*i-1))*n,o=r*(1-Math.abs(t/60%2-1)),l=i-r/2;switch(Math.floor(t/60)){case 0:e[0]=r+l,e[1]=o+l,e[2]=l;break;case 1:e[0]=o+l,e[1]=r+l,e[2]=l;break;case 2:e[0]=l,e[1]=r+l,e[2]=o+l;break;case 3:e[0]=l,e[1]=o+l,e[2]=r+l;break;case 4:e[0]=o+l,e[1]=l,e[2]=r+l;break;case 5:case 6:e[0]=r+l,e[1]=l,e[2]=o+l;break}}function zA(s){return s<=.03928?s/12.92:((s+.055)/1.055)**2.4}function HA(s,e,t){bw(s,t),t.map(zA);const n=.2126*t[0]+.7152*t[1]+.0722*t[2];bw(e,t),t.map(zA);const i=.2126*t[0]+.7152*t[1]+.0722*t[2];return n>i?(n+.05)/(i+.05):(i+.05)/(n+.05)}const VA=new Map;function oD(s,e){const t=s[0]+s[1]*256+s[2]*65536+e[0]*16777216+e[1]*4294967296+e[2]*1099511627776;let n=VA.get(t);if(n)return n;const i=new Float32Array(9),r=i.subarray(0,3),o=i.subarray(3,6);UA(s,o);const l=i.subarray(6,9);UA(e,l);const c=l[2]<.5,u=c?12:4.5;if(o[2]=c?Math.sqrt(o[2]):1-Math.sqrt(1-o[2]),HA(o,l,r)<u){let h,d;c?(h=o[2],d=1):(h=0,d=o[2]);const f=.005;for(;d-h>f;){const p=o[2]=(h+d)/2;c===HA(o,l,r)<u?h=p:d=p}o[2]=c?d:h}return bw(o,r),n=K.makeHexColor(Math.round(r[0]*255),Math.round(r[1]*255),Math.round(r[2]*255)),VA.set(t,n),n}function uC({html:s,dir:e,className:t},n){const i=document.createDocumentFragment();if(typeof s=="string"){const r=document.createElement("p");r.dir=e||"auto";const o=s.split(/(?:\r\n?|\n)/);for(let l=0,c=o.length;l<c;++l){const u=o[l];r.append(document.createTextNode(u)),l<c-1&&r.append(document.createElement("br"))}i.append(r)}else cC.render({xfaHtml:s,div:i,intent:"richText"});i.firstChild.classList.add("richText",t),n.append(i)}function hC(s){const e=new Path2D;if(!s)return e;for(let t=0,n=s.length;t<n;)switch(s[t++]){case Xh.moveTo:e.moveTo(s[t++],s[t++]);break;case Xh.lineTo:e.lineTo(s[t++],s[t++]);break;case Xh.curveTo:e.bezierCurveTo(s[t++],s[t++],s[t++],s[t++],s[t++],s[t++]);break;case Xh.quadraticCurveTo:e.quadraticCurveTo(s[t++],s[t++],s[t++],s[t++]);break;case Xh.closePath:e.closePath();break;default:ne(`Unrecognized drawing path operator: ${s[t-1]}`);break}return e}var ao,lo,ys,vs,cf,co,tu,nu,uf,Ay,dC,Gt,fC,pC,xc,od;const Zi=class Zi{constructor(e){w(this,Gt);w(this,ao,null);w(this,lo,null);w(this,ys);w(this,vs,null);w(this,cf,null);w(this,co,null);w(this,tu,null);w(this,nu,null);g(this,ys,e),a(Zi,uf)||g(Zi,uf,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}render(){const e=g(this,ao,document.createElement("div"));e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=a(this,ys)._uiManager._signal;t instanceof AbortSignal&&!t.aborted&&(e.addEventListener("contextmenu",js,{signal:t}),e.addEventListener("pointerdown",x(Zi,Ay,dC),{signal:t}));const n=g(this,vs,document.createElement("div"));n.className="buttons",e.append(n);const i=a(this,ys).toolbarPosition;if(i){const{style:r}=e,o=a(this,ys)._uiManager.direction==="ltr"?1-i[0]:i[0];r.insetInlineEnd=`${100*o}%`,r.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return a(this,ao)}hide(){var e;a(this,ao).classList.add("hidden"),(e=a(this,lo))==null||e.hideDropdown()}show(){var e,t;a(this,ao).classList.remove("hidden"),(e=a(this,cf))==null||e.shown(),(t=a(this,co))==null||t.shown()}addDeleteButton(){const{editorType:e,_uiManager:t}=a(this,ys),n=document.createElement("button");n.classList.add("basic","deleteButton"),n.tabIndex=0,n.setAttribute("data-l10n-id",a(Zi,uf)[e]),x(this,Gt,xc).call(this,n)&&n.addEventListener("click",i=>{t.delete()},{signal:t._signal}),a(this,vs).append(n)}async addAltText(e){const t=await e.render();x(this,Gt,xc).call(this,t),a(this,vs).append(t,a(this,Gt,od)),g(this,cf,e)}addComment(e,t=null){if(a(this,co))return;const n=e.renderForToolbar();if(!n)return;x(this,Gt,xc).call(this,n);const i=g(this,tu,a(this,Gt,od));t?(a(this,vs).insertBefore(n,t),a(this,vs).insertBefore(i,t)):a(this,vs).append(n,i),g(this,co,e),e.toolbar=this}addColorPicker(e){if(a(this,lo))return;g(this,lo,e);const t=e.renderButton();x(this,Gt,xc).call(this,t),a(this,vs).append(t,a(this,Gt,od))}async addEditSignatureButton(e){const t=g(this,nu,await e.renderEditButton(a(this,ys)));x(this,Gt,xc).call(this,t),a(this,vs).append(t,a(this,Gt,od))}removeButton(e){var t,n;switch(e){case"comment":(t=a(this,co))==null||t.removeToolbarCommentButton(),g(this,co,null),(n=a(this,tu))==null||n.remove(),g(this,tu,null);break}}async addButton(e,t){switch(e){case"colorPicker":t&&this.addColorPicker(t);break;case"altText":t&&await this.addAltText(t);break;case"editSignature":t&&await this.addEditSignatureButton(t);break;case"delete":this.addDeleteButton();break;case"comment":t&&this.addComment(t);break}}async addButtonBefore(e,t,n){if(!t&&e==="comment")return;const i=a(this,vs).querySelector(n);i&&e==="comment"&&this.addComment(t,i)}updateEditSignatureButton(e){a(this,nu)&&(a(this,nu).title=e)}remove(){var e;a(this,ao).remove(),(e=a(this,lo))==null||e.destroy(),g(this,lo,null)}};ao=new WeakMap,lo=new WeakMap,ys=new WeakMap,vs=new WeakMap,cf=new WeakMap,co=new WeakMap,tu=new WeakMap,nu=new WeakMap,uf=new WeakMap,Ay=new WeakSet,dC=function(e){e.stopPropagation()},Gt=new WeakSet,fC=function(e){a(this,ys)._focusEventsAllowed=!1,lt(e)},pC=function(e){a(this,ys)._focusEventsAllowed=!0,lt(e)},xc=function(e){const t=a(this,ys)._uiManager._signal;return!(t instanceof AbortSignal)||t.aborted?!1:(e.addEventListener("focusin",x(this,Gt,fC).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",x(this,Gt,pC).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",js,{signal:t}),!0)},od=function(){const e=document.createElement("div");return e.className="divider",e},w(Zi,Ay),w(Zi,uf,null);let _w=Zi;var hf,La,nr,qr,gC,mC,xw;class aD{constructor(e){w(this,qr);w(this,hf,null);w(this,La,null);w(this,nr);g(this,nr,e)}show(e,t,n){const[i,r]=x(this,qr,mC).call(this,t,n),{style:o}=a(this,La)||g(this,La,x(this,qr,gC).call(this));e.append(a(this,La)),o.insetInlineEnd=`${100*i}%`,o.top=`calc(${100*r}% + var(--editor-toolbar-vert-offset))`}hide(){a(this,La).remove()}}hf=new WeakMap,La=new WeakMap,nr=new WeakMap,qr=new WeakSet,gC=function(){const e=g(this,La,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar");const t=a(this,nr)._signal;t instanceof AbortSignal&&!t.aborted&&e.addEventListener("contextmenu",js,{signal:t});const n=g(this,hf,document.createElement("div"));return n.className="buttons",e.append(n),a(this,nr).hasCommentManager()&&x(this,qr,xw).call(this,"commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{a(this,nr).commentSelection("floating_button")}),x(this,qr,xw).call(this,"highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{a(this,nr).highlightSelection("floating_button")}),e},mC=function(e,t){let n=0,i=0;for(const r of e){const o=r.y+r.height;if(o<n)continue;const l=r.x+(t?r.width:0);if(o>n){i=l,n=o;continue}t?l>i&&(i=l):l<i&&(i=l)}return[t?1-i:i,n]},xw=function(e,t,n,i){const r=document.createElement("button");r.classList.add("basic",e),r.tabIndex=0,r.setAttribute("data-l10n-id",t);const o=document.createElement("span");r.append(o),o.className="visuallyHidden",o.setAttribute("data-l10n-id",n);const l=a(this,nr)._signal;l instanceof AbortSignal&&!l.aborted&&(r.addEventListener("contextmenu",js,{signal:l}),r.addEventListener("click",i,{signal:l})),a(this,hf).append(r)};function yC(s,e,t){for(const n of t)e.addEventListener(n,s[n].bind(s))}var Ma,Fa,su,ja;const ke=class ke{static initializeAndAddPointerId(e){(a(ke,Fa)||g(ke,Fa,new Set)).add(e)}static setPointer(e,t){a(ke,Ma)||g(ke,Ma,t),a(ke,ja)??g(ke,ja,e)}static setTimeStamp(e){g(ke,su,e)}static isSamePointerId(e){return a(ke,Ma)===e}static isSamePointerIdOrRemove(e){var t;return a(ke,Ma)===e?!0:((t=a(ke,Fa))==null||t.delete(e),!1)}static isSamePointerType(e){return a(ke,ja)===e}static isInitializedAndDifferentPointerType(e){return a(ke,ja)!==null&&!ke.isSamePointerType(e)}static isSameTimeStamp(e){return a(ke,su)===e}static isUsingMultiplePointers(){var e;return((e=a(ke,Fa))==null?void 0:e.size)>=1}static clearPointerType(){g(ke,ja,null)}static clearPointerIds(){g(ke,Ma,NaN),g(ke,Fa,null)}static clearTimeStamp(){g(ke,su,NaN)}};Ma=new WeakMap,Fa=new WeakMap,su=new WeakMap,ja=new WeakMap,w(ke,Ma,NaN),w(ke,Fa,null),w(ke,su,NaN),w(ke,ja,null);let Zt=ke;var Sy;class lD{constructor(){w(this,Sy,0)}get id(){return`${nf}${yt(this,Sy)._++}`}}Sy=new WeakMap;var iu,df,en,ru,om;const sx=class sx{constructor(){w(this,ru);w(this,iu,aC());w(this,df,0);w(this,en,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=e;const r=i.decode().then(()=>(n.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return ae(this,"_isSVGFittingCanvas",r)}async getFromFile(e){const{lastModified:t,name:n,size:i,type:r}=e;return x(this,ru,om).call(this,`${t}_${n}_${i}_${r}`,e)}async getFromUrl(e){return x(this,ru,om).call(this,e,e)}async getFromBlob(e,t){const n=await t;return x(this,ru,om).call(this,e,n)}async getFromId(e){a(this,en)||g(this,en,new Map);const t=a(this,en).get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:n}=t;return delete t.blobPromise,this.getFromBlob(t.id,n)}return this.getFromUrl(t.url)}getFromCanvas(e,t){a(this,en)||g(this,en,new Map);let n=a(this,en).get(e);if(n!=null&&n.bitmap)return n.refCounter+=1,n;const i=new OffscreenCanvas(t.width,t.height);return i.getContext("2d").drawImage(t,0,0),n={bitmap:i.transferToImageBitmap(),id:`image_${a(this,iu)}_${yt(this,df)._++}`,refCounter:1,isSvg:!1},a(this,en).set(e,n),a(this,en).set(n.id,n),n}getSvgUrl(e){const t=a(this,en).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){var i;a(this,en)||g(this,en,new Map);const t=a(this,en).get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:n}=t;if(!t.url&&!t.file){const r=new OffscreenCanvas(n.width,n.height);r.getContext("bitmaprenderer").transferFromImageBitmap(n),t.blobPromise=r.convertToBlob()}(i=n.close)==null||i.call(n),t.bitmap=null}isValidId(e){return e.startsWith(`image_${a(this,iu)}_`)}};iu=new WeakMap,df=new WeakMap,en=new WeakMap,ru=new WeakSet,om=async function(e,t){a(this,en)||g(this,en,new Map);let n=a(this,en).get(e);if(n===null)return null;if(n!=null&&n.bitmap)return n.refCounter+=1,n;try{n||(n={bitmap:null,id:`image_${a(this,iu)}_${yt(this,df)._++}`,refCounter:0,isSvg:!1});let i;if(typeof t=="string"?(n.url=t,i=await ag(t,"blob")):t instanceof File?i=n.file=t:t instanceof Blob&&(i=t),i.type==="image/svg+xml"){const r=sx._isSVGFittingCanvas,o=new FileReader,l=new Image,c=new Promise((u,h)=>{l.onload=()=>{n.bitmap=l,n.isSvg=!0,u()},o.onload=async()=>{const d=n.svgUrl=o.result;l.src=await r?`${d}#svgView(preserveAspectRatio(none))`:d},l.onerror=o.onerror=h});o.readAsDataURL(i),await c}else n.bitmap=await createImageBitmap(i);n.refCounter=1}catch(i){ne(i),n=null}return a(this,en).set(e,n),n&&a(this,en).set(n.id,n),n};let Aw=sx;var ct,uo,ff,Ye;class cD{constructor(e=128){w(this,ct,[]);w(this,uo,!1);w(this,ff);w(this,Ye,-1);g(this,ff,e)}add({cmd:e,undo:t,post:n,mustExec:i,type:r=NaN,overwriteIfSameType:o=!1,keepUndo:l=!1}){if(i&&e(),a(this,uo))return;const c={cmd:e,undo:t,post:n,type:r};if(a(this,Ye)===-1){a(this,ct).length>0&&(a(this,ct).length=0),g(this,Ye,0),a(this,ct).push(c);return}if(o&&a(this,ct)[a(this,Ye)].type===r){l&&(c.undo=a(this,ct)[a(this,Ye)].undo),a(this,ct)[a(this,Ye)]=c;return}const u=a(this,Ye)+1;u===a(this,ff)?a(this,ct).splice(0,1):(g(this,Ye,u),u<a(this,ct).length&&a(this,ct).splice(u)),a(this,ct).push(c)}undo(){if(a(this,Ye)===-1)return;g(this,uo,!0);const{undo:e,post:t}=a(this,ct)[a(this,Ye)];e(),t==null||t(),g(this,uo,!1),g(this,Ye,a(this,Ye)-1)}redo(){if(a(this,Ye)<a(this,ct).length-1){g(this,Ye,a(this,Ye)+1),g(this,uo,!0);const{cmd:e,post:t}=a(this,ct)[a(this,Ye)];e(),t==null||t(),g(this,uo,!1)}}hasSomethingToUndo(){return a(this,Ye)!==-1}hasSomethingToRedo(){return a(this,Ye)<a(this,ct).length-1}cleanType(e){if(a(this,Ye)!==-1){for(let t=a(this,Ye);t>=0;t--)if(a(this,ct)[t].type!==e){a(this,ct).splice(t+1,a(this,Ye)-t),g(this,Ye,t);return}a(this,ct).length=0,g(this,Ye,-1)}}destroy(){g(this,ct,null)}}ct=new WeakMap,uo=new WeakMap,ff=new WeakMap,Ye=new WeakMap;var Ey,vC;class ug{constructor(e){w(this,Ey);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=Kt.platform;for(const[n,i,r={}]of e)for(const o of n){const l=o.startsWith("mac+");t&&l?(this.callbacks.set(o.slice(4),{callback:i,options:r}),this.allKeys.add(o.split("+").at(-1))):!t&&!l&&(this.callbacks.set(o,{callback:i,options:r}),this.allKeys.add(o.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const n=this.callbacks.get(x(this,Ey,vC).call(this,t));if(!n)return;const{callback:i,options:{bubbles:r=!1,args:o=[],checker:l=null}}=n;l&&!l(e,t)||(i.bind(e,...o,t)(),r||lt(t))}}Ey=new WeakSet,vC=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const Cy=class Cy{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return nD(e),ae(this,"_colors",e)}convert(e){const t=cg(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[n,i]of this._colors)if(i.every((r,o)=>r===t[o]))return Cy._colorsMapping.get(n);return t}getHexCode(e){const t=this._colors.get(e);return t?K.makeHexColor(...t):e}};B(Cy,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let Sw=Cy;var ou,Un,au,nt,_t,lu,ws,cu,bs,tn,ho,fo,uu,po,wi,_s,Ba,pf,gf,hu,mf,bi,go,du,mo,_i,ky,yo,fu,yf,vo,$a,pu,wo,vf,pt,Se,sr,bo,_o,wf,gu,bf,xo,xi,ir,_f,xf,xs,z,am,Ew,wC,bC,ad,_C,xC,AC,Cw,SC,EC,CC,kC,un,Xi,TC,PC,kw,RC,ld,Tw;const Hc=class Hc{constructor(e,t,n,i,r,o,l,c,u,h,d,f,p,y,_,A){w(this,z);w(this,ou,new AbortController);w(this,Un,null);w(this,au,null);w(this,nt,new Map);w(this,_t,new Map);w(this,lu,null);w(this,ws,null);w(this,cu,null);w(this,bs,new cD);w(this,tn,null);w(this,ho,null);w(this,fo,null);w(this,uu,0);w(this,po,new Set);w(this,wi,null);w(this,_s,null);w(this,Ba,new Set);B(this,"_editorUndoBar",null);w(this,pf,!1);w(this,gf,!1);w(this,hu,!1);w(this,mf,null);w(this,bi,null);w(this,go,null);w(this,du,null);w(this,mo,!1);w(this,_i,null);w(this,ky,new lD);w(this,yo,!1);w(this,fu,!1);w(this,yf,!1);w(this,vo,null);w(this,$a,null);w(this,pu,null);w(this,wo,null);w(this,vf,null);w(this,pt,ie.NONE);w(this,Se,new Set);w(this,sr,null);w(this,bo,null);w(this,_o,null);w(this,wf,null);w(this,gu,null);w(this,bf,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});w(this,xo,[0,0]);w(this,xi,null);w(this,ir,null);w(this,_f,null);w(this,xf,null);w(this,xs,null);const m=this._signal=a(this,ou).signal;g(this,ir,e),g(this,_f,t),g(this,xf,n),g(this,lu,i),g(this,tn,r),g(this,bo,o),g(this,gu,c),this._eventBus=l,l._on("editingaction",this.onEditingAction.bind(this),{signal:m}),l._on("pagechanging",this.onPageChanging.bind(this),{signal:m}),l._on("scalechanging",this.onScaleChanging.bind(this),{signal:m}),l._on("rotationchanging",this.onRotationChanging.bind(this),{signal:m}),l._on("setpreference",this.onSetPreference.bind(this),{signal:m}),l._on("switchannotationeditorparams",b=>this.updateParams(b.type,b.value),{signal:m}),window.addEventListener("pointerdown",()=>{g(this,fu,!0)},{capture:!0,signal:m}),window.addEventListener("pointerup",()=>{g(this,fu,!1)},{capture:!0,signal:m}),x(this,z,_C).call(this),x(this,z,kC).call(this),x(this,z,Cw).call(this),g(this,ws,c.annotationStorage),g(this,mf,c.filterFactory),g(this,_o,u),g(this,du,h||null),g(this,pf,d),g(this,gf,f),g(this,hu,p),g(this,vf,y||null),this.viewParameters={realScale:da.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=_||null,this._supportsPinchToZoom=A!==!1,r==null||r.setSidebarUiManager(this)}static get _keyboardManager(){const e=Hc.prototype,t=o=>a(o,ir).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),n=(o,{target:l})=>{if(l instanceof HTMLInputElement){const{type:c}=l;return c!=="text"&&c!=="number"}return!0},i=this.TRANSLATE_SMALL,r=this.TRANSLATE_BIG;return ae(this,"_keyboardManager",new ug([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],e.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:n}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(o,{target:l})=>!(l instanceof HTMLButtonElement)&&a(o,ir).contains(l)&&!o.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(o,{target:l})=>!(l instanceof HTMLButtonElement)&&a(o,ir).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}]]))}destroy(){var e,t,n,i,r,o,l,c,u;(e=a(this,xs))==null||e.resolve(),g(this,xs,null),(t=a(this,ou))==null||t.abort(),g(this,ou,null),this._signal=null;for(const h of a(this,_t).values())h.destroy();a(this,_t).clear(),a(this,nt).clear(),a(this,Ba).clear(),(n=a(this,wo))==null||n.clear(),g(this,Un,null),a(this,Se).clear(),a(this,bs).destroy(),(i=a(this,lu))==null||i.destroy(),(r=a(this,tn))==null||r.destroy(),(o=a(this,bo))==null||o.destroy(),(l=a(this,_i))==null||l.hide(),g(this,_i,null),(c=a(this,pu))==null||c.destroy(),g(this,pu,null),g(this,au,null),a(this,bi)&&(clearTimeout(a(this,bi)),g(this,bi,null)),a(this,xi)&&(clearTimeout(a(this,xi)),g(this,xi,null)),(u=this._editorUndoBar)==null||u.destroy(),g(this,gu,null)}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return a(this,vf)}get useNewAltTextFlow(){return a(this,gf)}get useNewAltTextWhenAddingImage(){return a(this,hu)}get hcmFilter(){return ae(this,"hcmFilter",a(this,_o)?a(this,mf).addHCMFilter(a(this,_o).foreground,a(this,_o).background):"none")}get direction(){return ae(this,"direction",getComputedStyle(a(this,ir)).direction)}get _highlightColors(){return ae(this,"_highlightColors",a(this,du)?new Map(a(this,du).split(",").map(e=>(e=e.split("=").map(t=>t.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColors(){const{_highlightColors:e}=this;if(!e)return ae(this,"highlightColors",null);const t=new Map,n=!!a(this,_o);for(const[i,r]of e){const o=i.endsWith("_HCM");if(n&&o){t.set(i.replace("_HCM",""),r);continue}!n&&!o&&t.set(i,r)}return ae(this,"highlightColors",t)}get highlightColorNames(){return ae(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}getNonHCMColor(e){if(!this._highlightColors)return e;const t=this.highlightColorNames.get(e);return this._highlightColors.get(t)||e}getNonHCMColorName(e){return this.highlightColorNames.get(e)||e}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),g(this,fo,e)}setMainHighlightColorPicker(e){g(this,pu,e)}editAltText(e,t=!1){var n;(n=a(this,lu))==null||n.editAltText(this,e,t)}hasCommentManager(){return!!a(this,tn)}editComment(e,t,n,i){var r;(r=a(this,tn))==null||r.showDialog(this,e,t,n,i)}selectComment(e,t){const n=a(this,_t).get(e),i=n==null?void 0:n.getEditorByUID(t);i==null||i.toggleComment(!0,!0)}updateComment(e){var t;(t=a(this,tn))==null||t.updateComment(e.getData())}updatePopupColor(e){var t;(t=a(this,tn))==null||t.updatePopupColor(e)}removeComment(e){var t;(t=a(this,tn))==null||t.removeComments([e.uid])}toggleComment(e,t,n=void 0){var i;(i=a(this,tn))==null||i.toggleCommentPopup(e,t,n)}makeCommentColor(e,t){var n;return e&&((n=a(this,tn))==null?void 0:n.makeCommentColor(e,t))||null}getCommentDialogElement(){var e;return((e=a(this,tn))==null?void 0:e.dialogElement)||null}async waitForEditorsRendered(e){if(a(this,_t).has(e-1))return;const{resolve:t,promise:n}=Promise.withResolvers(),i=r=>{r.pageNumber===e&&(this._eventBus._off("editorsrendered",i),t())};this._eventBus.on("editorsrendered",i),await n}getSignature(e){var t;(t=a(this,bo))==null||t.getSignature({uiManager:this,editor:e})}get signatureManager(){return a(this,bo)}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":g(this,hu,t);break}}onPageChanging({pageNumber:e}){g(this,uu,e-1)}focusMainContainer(){a(this,ir).focus()}findParent(e,t){for(const n of a(this,_t).values()){const{x:i,y:r,width:o,height:l}=n.div.getBoundingClientRect();if(e>=i&&e<=i+o&&t>=r&&t<=r+l)return n}return null}disableUserSelect(e=!1){a(this,_f).classList.toggle("noUserSelect",e)}addShouldRescale(e){a(this,Ba).add(e)}removeShouldRescale(e){a(this,Ba).delete(e)}onScaleChanging({scale:e}){var t;this.commitOrRemove(),this.viewParameters.realScale=e*da.PDF_TO_CSS_UNITS;for(const n of a(this,Ba))n.onScaleChanging();(t=a(this,fo))==null||t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e="",t=!1){const n=document.getSelection();if(!n||n.isCollapsed)return;const{anchorNode:i,anchorOffset:r,focusNode:o,focusOffset:l}=n,c=n.toString(),h=x(this,z,am).call(this,n).closest(".textLayer"),d=this.getSelectionBoxes(h);if(!d)return;n.empty();const f=x(this,z,Ew).call(this,h),p=a(this,pt)===ie.NONE,y=()=>{const _=f==null?void 0:f.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:d,anchorNode:i,anchorOffset:r,focusNode:o,focusOffset:l,text:c});p&&this.showAllEditors("highlight",!0,!0),t&&(_==null||_.editComment())};if(p){this.switchToMode(ie.HIGHLIGHT,y);return}y()}commentSelection(e=""){this.highlightSelection(e,!0)}getAndRemoveDataFromAnnotationStorage(e){if(!a(this,ws))return null;const t=`${nf}${e}`,n=a(this,ws).getRawValue(t);return n&&a(this,ws).remove(t),n}addToAnnotationStorage(e){!e.isEmpty()&&a(this,ws)&&!a(this,ws).has(e.id)&&a(this,ws).setValue(e.id,e)}a11yAlert(e,t=null){const n=a(this,xf);n&&(n.setAttribute("data-l10n-id",e),t?n.setAttribute("data-l10n-args",JSON.stringify(t)):n.removeAttribute("data-l10n-args"))}blur(){if(this.isShiftKeyDown=!1,a(this,mo)&&(g(this,mo,!1),x(this,z,ad).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of a(this,Se))if(t.div.contains(e)){g(this,$a,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!a(this,$a))return;const[e,t]=a(this,$a);g(this,$a,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){x(this,z,Cw).call(this),this.setEditingState(!0)}removeEditListeners(){x(this,z,SC).call(this),this.setEditingState(!1)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const n of a(this,_s))if(n.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const n of a(this,_s))if(n.isHandlingMimeForPasting(t.type)){n.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var n;if(e.preventDefault(),(n=a(this,Un))==null||n.commitOrRemove(),!this.hasSelection)return;const t=[];for(const i of a(this,Se)){const r=i.serialize(!0);r&&t.push(r)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const r of t.items)for(const o of a(this,_s))if(o.isHandlingMimeForPasting(r.type)){o.paste(r,this.currentLayer);return}let n=t.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(r){ne(`paste: "${r.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();const i=this.currentLayer;try{const r=[];for(const c of n){const u=await i.deserialize(c);if(!u)return;r.push(u)}const o=()=>{for(const c of r)x(this,z,kw).call(this,c);x(this,z,Tw).call(this,r)},l=()=>{for(const c of r)c.remove()};this.addCommands({cmd:o,undo:l,mustExec:!0})}catch(r){ne(`paste: "${r.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),a(this,pt)!==ie.NONE&&!this.isEditorHandlingKeyboard&&Hc._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,a(this,mo)&&(g(this,mo,!1),x(this,z,ad).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}setEditingState(e){e?(x(this,z,xC).call(this),x(this,z,EC).call(this),x(this,z,un).call(this,{isEditing:a(this,pt)!==ie.NONE,isEmpty:x(this,z,ld).call(this),hasSomethingToUndo:a(this,bs).hasSomethingToUndo(),hasSomethingToRedo:a(this,bs).hasSomethingToRedo(),hasSelectedEditor:!1})):(x(this,z,AC).call(this),x(this,z,CC).call(this),x(this,z,un).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!a(this,_s)){g(this,_s,e);for(const t of a(this,_s))x(this,z,Xi).call(this,t.defaultPropertiesToUpdate)}}getId(){return a(this,ky).id}get currentLayer(){return a(this,_t).get(a(this,uu))}getLayer(e){return a(this,_t).get(e)}get currentPageIndex(){return a(this,uu)}addLayer(e){a(this,_t).set(e.pageIndex,e),a(this,yo)?e.enable():e.disable()}removeLayer(e){a(this,_t).delete(e.pageIndex)}async updateMode(e,t=null,n=!1,i=!1,r=!1){var o,l,c,u,h,d;if(a(this,pt)!==e&&!(a(this,xs)&&(await a(this,xs).promise,!a(this,xs)))){if(g(this,xs,Promise.withResolvers()),(o=a(this,fo))==null||o.commitOrRemove(),a(this,pt)===ie.POPUP&&((l=a(this,tn))==null||l.hideSidebar()),(c=a(this,tn))==null||c.destroyPopup(),g(this,pt,e),e===ie.NONE){this.setEditingState(!1),x(this,z,PC).call(this);for(const f of a(this,nt).values())f.hideStandaloneCommentButton();(u=this._editorUndoBar)==null||u.hide(),this.toggleComment(null),a(this,xs).resolve();return}for(const f of a(this,nt).values())f.addStandaloneCommentButton();e===ie.SIGNATURE&&await((h=a(this,bo))==null?void 0:h.loadSignatures()),this.setEditingState(!0),await x(this,z,TC).call(this),this.unselectAll();for(const f of a(this,_t).values())f.updateMode(e);if(e===ie.POPUP){a(this,au)||g(this,au,await a(this,gu).getAnnotationsByType(new Set(a(this,_s).map(y=>y._editorType))));const f=new Set,p=[];for(const y of a(this,nt).values()){const{annotationElementId:_,hasComment:A,deleted:m}=y;_&&f.add(_),A&&!m&&p.push(y.getData())}for(const y of a(this,au)){const{id:_,popupRef:A,contentsObj:m}=y;A&&(m!=null&&m.str)&&!f.has(_)&&!a(this,po).has(_)&&p.push(y)}(d=a(this,tn))==null||d.showSidebar(p)}if(!t){n&&this.addNewEditorFromKeyboard(),a(this,xs).resolve();return}for(const f of a(this,nt).values())f.uid===t?(this.setSelected(f),r?f.editComment():i?f.enterInEditMode():f.focus()):f.unselect();a(this,xs).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==a(this,pt)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){if(a(this,_s)){switch(e){case ge.CREATE:this.currentLayer.addNewEditor(t);return;case ge.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(a(this,wf)||g(this,wf,new Map)).set(e,t),this.showAllEditors("highlight",t);break}if(this.hasSelection)for(const n of a(this,Se))n.updateParams(e,t);else for(const n of a(this,_s))n.updateDefaultParams(e,t)}}showAllEditors(e,t,n=!1){var r;for(const o of a(this,nt).values())o.editorType===e&&o.show(t);(((r=a(this,wf))==null?void 0:r.get(ge.HIGHLIGHT_SHOW_ALL))??!0)!==t&&x(this,z,Xi).call(this,[[ge.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(a(this,yf)!==e){g(this,yf,e);for(const t of a(this,_t).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}*getEditors(e){for(const t of a(this,nt).values())t.pageIndex===e&&(yield t)}getEditor(e){return a(this,nt).get(e)}addEditor(e){a(this,nt).set(e.id,e)}removeEditor(e){var t,n;e.div.contains(document.activeElement)&&(a(this,bi)&&clearTimeout(a(this,bi)),g(this,bi,setTimeout(()=>{this.focusMainContainer(),g(this,bi,null)},0))),a(this,nt).delete(e.id),e.annotationElementId&&((t=a(this,wo))==null||t.delete(e.annotationElementId)),this.unselect(e),(!e.annotationElementId||!a(this,po).has(e.annotationElementId))&&((n=a(this,ws))==null||n.remove(e.id))}addDeletedAnnotationElement(e){a(this,po).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return a(this,po).has(e)}removeDeletedAnnotationElement(e){a(this,po).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){a(this,Un)!==e&&(g(this,Un,e),e&&x(this,z,Xi).call(this,e.propertiesToUpdate))}updateUI(e){a(this,z,RC)===e&&x(this,z,Xi).call(this,e.propertiesToUpdate)}updateUIForDefaultProperties(e){x(this,z,Xi).call(this,e.defaultPropertiesToUpdate)}toggleSelected(e){if(a(this,Se).has(e)){a(this,Se).delete(e),e.unselect(),x(this,z,un).call(this,{hasSelectedEditor:this.hasSelection});return}a(this,Se).add(e),e.select(),x(this,z,Xi).call(this,e.propertiesToUpdate),x(this,z,un).call(this,{hasSelectedEditor:!0})}setSelected(e){var t;this.updateToolbar({mode:e.mode,editId:e.uid}),(t=a(this,fo))==null||t.commitOrRemove();for(const n of a(this,Se))n!==e&&n.unselect();a(this,Se).clear(),a(this,Se).add(e),e.select(),x(this,z,Xi).call(this,e.propertiesToUpdate),x(this,z,un).call(this,{hasSelectedEditor:!0})}isSelected(e){return a(this,Se).has(e)}get firstSelectedEditor(){return a(this,Se).values().next().value}unselect(e){e.unselect(),a(this,Se).delete(e),x(this,z,un).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return a(this,Se).size!==0}get isEnterHandled(){return a(this,Se).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var e;a(this,bs).undo(),x(this,z,un).call(this,{hasSomethingToUndo:a(this,bs).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:x(this,z,ld).call(this)}),(e=this._editorUndoBar)==null||e.hide()}redo(){a(this,bs).redo(),x(this,z,un).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:a(this,bs).hasSomethingToRedo(),isEmpty:x(this,z,ld).call(this)})}addCommands(e){a(this,bs).add(e),x(this,z,un).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:x(this,z,ld).call(this)})}cleanUndoStack(e){a(this,bs).cleanType(e)}delete(){var r;this.commitOrRemove();const e=(r=this.currentLayer)==null?void 0:r.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...a(this,Se)],n=()=>{var o;(o=this._editorUndoBar)==null||o.show(i,t.length===1?t[0].editorType:t.length);for(const l of t)l.remove()},i=()=>{for(const o of t)x(this,z,kw).call(this,o)};this.addCommands({cmd:n,undo:i,mustExec:!0})}commitOrRemove(){var e;(e=a(this,Un))==null||e.commitOrRemove()}hasSomethingToControl(){return a(this,Un)||this.hasSelection}selectAll(){for(const e of a(this,Se))e.commit();x(this,z,Tw).call(this,a(this,nt).values())}unselectAll(){var e;if(!(a(this,Un)&&(a(this,Un).commitOrRemove(),a(this,pt)!==ie.NONE))&&!((e=a(this,fo))!=null&&e.commitOrRemove())&&this.hasSelection){for(const t of a(this,Se))t.unselect();a(this,Se).clear(),x(this,z,un).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;a(this,xo)[0]+=e,a(this,xo)[1]+=t;const[i,r]=a(this,xo),o=[...a(this,Se)],l=1e3;a(this,xi)&&clearTimeout(a(this,xi)),g(this,xi,setTimeout(()=>{g(this,xi,null),a(this,xo)[0]=a(this,xo)[1]=0,this.addCommands({cmd:()=>{for(const c of o)a(this,nt).has(c.id)&&(c.translateInPage(i,r),c.translationDone())},undo:()=>{for(const c of o)a(this,nt).has(c.id)&&(c.translateInPage(-i,-r),c.translationDone())},mustExec:!1})},l));for(const c of o)c.translateInPage(e,t),c.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),g(this,wi,new Map);for(const e of a(this,Se))a(this,wi).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!a(this,wi))return!1;this.disableUserSelect(!1);const e=a(this,wi);g(this,wi,null);let t=!1;for(const[{x:i,y:r,pageIndex:o},l]of e)l.newX=i,l.newY=r,l.newPageIndex=o,t||(t=i!==l.savedX||r!==l.savedY||o!==l.savedPageIndex);if(!t)return!1;const n=(i,r,o,l)=>{if(a(this,nt).has(i.id)){const c=a(this,_t).get(l);c?i._setParentAndPosition(c,r,o):(i.pageIndex=l,i.x=r,i.y=o)}};return this.addCommands({cmd:()=>{for(const[i,{newX:r,newY:o,newPageIndex:l}]of e)n(i,r,o,l)},undo:()=>{for(const[i,{savedX:r,savedY:o,savedPageIndex:l}]of e)n(i,r,o,l)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(a(this,wi))for(const n of a(this,wi).keys())n.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||a(this,Se).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return a(this,Un)===e}getActive(){return a(this,Un)}getMode(){return a(this,pt)}isEditingMode(){return a(this,pt)!==ie.NONE}get imageManager(){return ae(this,"imageManager",new Aw)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let u=0,h=t.rangeCount;u<h;u++)if(!e.contains(t.getRangeAt(u).commonAncestorContainer))return null;const{x:n,y:i,width:r,height:o}=e.getBoundingClientRect();let l;switch(e.getAttribute("data-main-rotation")){case"90":l=(u,h,d,f)=>({x:(h-i)/o,y:1-(u+d-n)/r,width:f/o,height:d/r});break;case"180":l=(u,h,d,f)=>({x:1-(u+d-n)/r,y:1-(h+f-i)/o,width:d/r,height:f/o});break;case"270":l=(u,h,d,f)=>({x:1-(h+f-i)/o,y:(u-n)/r,width:f/o,height:d/r});break;default:l=(u,h,d,f)=>({x:(u-n)/r,y:(h-i)/o,width:d/r,height:f/o});break}const c=[];for(let u=0,h=t.rangeCount;u<h;u++){const d=t.getRangeAt(u);if(!d.collapsed)for(const{x:f,y:p,width:y,height:_}of d.getClientRects())y===0||_===0||c.push(l(f,p,y,_))}return c.length===0?null:c}addChangedExistingAnnotation({annotationElementId:e,id:t}){(a(this,cu)||g(this,cu,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=a(this,cu))==null||t.delete(e)}renderAnnotationElement(e){var i;const t=(i=a(this,cu))==null?void 0:i.get(e.data.id);if(!t)return;const n=a(this,ws).getRawValue(t);n&&(a(this,pt)===ie.NONE&&!n.hasBeenModified||n.renderAnnotationElement(e))}setMissingCanvas(e,t,n){var r;const i=(r=a(this,wo))==null?void 0:r.get(e);i&&(i.setCanvas(t,n),a(this,wo).delete(e))}addMissingCanvas(e,t){(a(this,wo)||g(this,wo,new Map)).set(e,t)}};ou=new WeakMap,Un=new WeakMap,au=new WeakMap,nt=new WeakMap,_t=new WeakMap,lu=new WeakMap,ws=new WeakMap,cu=new WeakMap,bs=new WeakMap,tn=new WeakMap,ho=new WeakMap,fo=new WeakMap,uu=new WeakMap,po=new WeakMap,wi=new WeakMap,_s=new WeakMap,Ba=new WeakMap,pf=new WeakMap,gf=new WeakMap,hu=new WeakMap,mf=new WeakMap,bi=new WeakMap,go=new WeakMap,du=new WeakMap,mo=new WeakMap,_i=new WeakMap,ky=new WeakMap,yo=new WeakMap,fu=new WeakMap,yf=new WeakMap,vo=new WeakMap,$a=new WeakMap,pu=new WeakMap,wo=new WeakMap,vf=new WeakMap,pt=new WeakMap,Se=new WeakMap,sr=new WeakMap,bo=new WeakMap,_o=new WeakMap,wf=new WeakMap,gu=new WeakMap,bf=new WeakMap,xo=new WeakMap,xi=new WeakMap,ir=new WeakMap,_f=new WeakMap,xf=new WeakMap,xs=new WeakMap,z=new WeakSet,am=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},Ew=function(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const n of a(this,_t).values())if(n.hasTextLayer(e))return n;return null},wC=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const n=x(this,z,am).call(this,e).closest(".textLayer"),i=this.getSelectionBoxes(n);i&&(a(this,_i)||g(this,_i,new aD(this)),a(this,_i).show(n,i,this.direction==="ltr"))},bC=function(){var r,o,l;const e=document.getSelection();if(!e||e.isCollapsed){a(this,sr)&&((r=a(this,_i))==null||r.hide(),g(this,sr,null),x(this,z,un).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===a(this,sr))return;const i=x(this,z,am).call(this,e).closest(".textLayer");if(!i){a(this,sr)&&((o=a(this,_i))==null||o.hide(),g(this,sr,null),x(this,z,un).call(this,{hasSelectedText:!1}));return}if((l=a(this,_i))==null||l.hide(),g(this,sr,t),x(this,z,un).call(this,{hasSelectedText:!0}),!(a(this,pt)!==ie.HIGHLIGHT&&a(this,pt)!==ie.NONE)&&(a(this,pt)===ie.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),g(this,mo,this.isShiftKeyDown),!this.isShiftKeyDown)){const c=a(this,pt)===ie.HIGHLIGHT?x(this,z,Ew).call(this,i):null;if(c==null||c.toggleDrawing(),a(this,fu)){const u=new AbortController,h=this.combinedSignal(u),d=f=>{f.type==="pointerup"&&f.button!==0||(u.abort(),c==null||c.toggleDrawing(!0),f.type==="pointerup"&&x(this,z,ad).call(this,"main_toolbar"))};window.addEventListener("pointerup",d,{signal:h}),window.addEventListener("blur",d,{signal:h})}else c==null||c.toggleDrawing(!0),x(this,z,ad).call(this,"main_toolbar")}},ad=function(e=""){a(this,pt)===ie.HIGHLIGHT?this.highlightSelection(e):a(this,pf)&&x(this,z,wC).call(this)},_C=function(){document.addEventListener("selectionchange",x(this,z,bC).bind(this),{signal:this._signal})},xC=function(){if(a(this,go))return;g(this,go,new AbortController);const e=this.combinedSignal(a(this,go));window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})},AC=function(){var e;(e=a(this,go))==null||e.abort(),g(this,go,null)},Cw=function(){if(a(this,vo))return;g(this,vo,new AbortController);const e=this.combinedSignal(a(this,vo));window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})},SC=function(){var e;(e=a(this,vo))==null||e.abort(),g(this,vo,null)},EC=function(){if(a(this,ho))return;g(this,ho,new AbortController);const e=this.combinedSignal(a(this,ho));document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})},CC=function(){var e;(e=a(this,ho))==null||e.abort(),g(this,ho,null)},kC=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},un=function(e){Object.entries(e).some(([n,i])=>a(this,bf)[n]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(a(this,bf),e)}),a(this,pt)===ie.HIGHLIGHT&&e.hasSelectedEditor===!1&&x(this,z,Xi).call(this,[[ge.HIGHLIGHT_FREE,!0]]))},Xi=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},TC=async function(){if(!a(this,yo)){g(this,yo,!0);const e=[];for(const t of a(this,_t).values())e.push(t.enable());await Promise.all(e);for(const t of a(this,nt).values())t.enable()}},PC=function(){if(this.unselectAll(),a(this,yo)){g(this,yo,!1);for(const e of a(this,_t).values())e.disable();for(const e of a(this,nt).values())e.disable()}},kw=function(e){const t=a(this,_t).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},RC=function(){let e=null;for(e of a(this,Se));return e},ld=function(){if(a(this,nt).size===0)return!0;if(a(this,nt).size===1)for(const e of a(this,nt).values())return e.isEmpty();return!1},Tw=function(e){for(const t of a(this,Se))t.unselect();a(this,Se).clear();for(const t of e)t.isEmpty()||(a(this,Se).add(t),t.select());x(this,z,un).call(this,{hasSelectedEditor:this.hasSelection})},B(Hc,"TRANSLATE_SMALL",1),B(Hc,"TRANSLATE_BIG",10);let ic=Hc;var Tt,Ai,Ws,mu,Si,zn,yu,Ei,Cn,rr,Ua,Ci,Ao,ai,cd,lm;const hn=class hn{constructor(e){w(this,ai);w(this,Tt,null);w(this,Ai,!1);w(this,Ws,null);w(this,mu,null);w(this,Si,null);w(this,zn,null);w(this,yu,!1);w(this,Ei,null);w(this,Cn,null);w(this,rr,null);w(this,Ua,null);w(this,Ci,!1);g(this,Cn,e),g(this,Ci,e._uiManager.useNewAltTextFlow),a(hn,Ao)||g(hn,Ao,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(e){hn._l10n??(hn._l10n=e)}async render(){const e=g(this,Ws,document.createElement("button"));e.className="altText",e.tabIndex="0";const t=g(this,mu,document.createElement("span"));e.append(t),a(this,Ci)?(e.classList.add("new"),e.setAttribute("data-l10n-id",a(hn,Ao).missing),t.setAttribute("data-l10n-id",a(hn,Ao)["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const n=a(this,Cn)._uiManager._signal;e.addEventListener("contextmenu",js,{signal:n}),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:n});const i=r=>{r.preventDefault(),a(this,Cn)._uiManager.editAltText(a(this,Cn)),a(this,Ci)&&a(this,Cn)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:a(this,ai,cd)}})};return e.addEventListener("click",i,{capture:!0,signal:n}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(g(this,yu,!0),i(r))},{signal:n}),await x(this,ai,lm).call(this),e}finish(){a(this,Ws)&&(a(this,Ws).focus({focusVisible:a(this,yu)}),g(this,yu,!1))}isEmpty(){return a(this,Ci)?a(this,Tt)===null:!a(this,Tt)&&!a(this,Ai)}hasData(){return a(this,Ci)?a(this,Tt)!==null||!!a(this,rr):this.isEmpty()}get guessedText(){return a(this,rr)}async setGuessedText(e){a(this,Tt)===null&&(g(this,rr,e),g(this,Ua,await hn._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e})),x(this,ai,lm).call(this))}toggleAltTextBadge(e=!1){var t;if(!a(this,Ci)||a(this,Tt)){(t=a(this,Ei))==null||t.remove(),g(this,Ei,null);return}if(!a(this,Ei)){const n=g(this,Ei,document.createElement("div"));n.className="noAltTextBadge",a(this,Cn).div.append(n)}a(this,Ei).classList.toggle("hidden",!e)}serialize(e){let t=a(this,Tt);return!e&&a(this,rr)===t&&(t=a(this,Ua)),{altText:t,decorative:a(this,Ai),guessedText:a(this,rr),textWithDisclaimer:a(this,Ua)}}get data(){return{altText:a(this,Tt),decorative:a(this,Ai)}}set data({altText:e,decorative:t,guessedText:n,textWithDisclaimer:i,cancel:r=!1}){n&&(g(this,rr,n),g(this,Ua,i)),!(a(this,Tt)===e&&a(this,Ai)===t)&&(r||(g(this,Tt,e),g(this,Ai,t)),x(this,ai,lm).call(this))}toggle(e=!1){a(this,Ws)&&(!e&&a(this,zn)&&(clearTimeout(a(this,zn)),g(this,zn,null)),a(this,Ws).disabled=!e)}shown(){a(this,Cn)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:a(this,ai,cd)}})}destroy(){var e,t;(e=a(this,Ws))==null||e.remove(),g(this,Ws,null),g(this,mu,null),g(this,Si,null),(t=a(this,Ei))==null||t.remove(),g(this,Ei,null)}};Tt=new WeakMap,Ai=new WeakMap,Ws=new WeakMap,mu=new WeakMap,Si=new WeakMap,zn=new WeakMap,yu=new WeakMap,Ei=new WeakMap,Cn=new WeakMap,rr=new WeakMap,Ua=new WeakMap,Ci=new WeakMap,Ao=new WeakMap,ai=new WeakSet,cd=function(){return a(this,Tt)&&"added"||a(this,Tt)===null&&this.guessedText&&"review"||"missing"},lm=async function(){var i,r,o;const e=a(this,Ws);if(!e)return;if(a(this,Ci)){if(e.classList.toggle("done",!!a(this,Tt)),e.setAttribute("data-l10n-id",a(hn,Ao)[a(this,ai,cd)]),(i=a(this,mu))==null||i.setAttribute("data-l10n-id",a(hn,Ao)[`${a(this,ai,cd)}-label`]),!a(this,Tt)){(r=a(this,Si))==null||r.remove();return}}else{if(!a(this,Tt)&&!a(this,Ai)){e.classList.remove("done"),(o=a(this,Si))==null||o.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=a(this,Si);if(!t){g(this,Si,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${a(this,Cn).id}`;const l=100,c=a(this,Cn)._uiManager._signal;c.addEventListener("abort",()=>{clearTimeout(a(this,zn)),g(this,zn,null)},{once:!0}),e.addEventListener("mouseenter",()=>{g(this,zn,setTimeout(()=>{g(this,zn,null),a(this,Si).classList.add("show"),a(this,Cn)._reportTelemetry({action:"alt_text_tooltip"})},l))},{signal:c}),e.addEventListener("mouseleave",()=>{var u;a(this,zn)&&(clearTimeout(a(this,zn)),g(this,zn,null)),(u=a(this,Si))==null||u.classList.remove("show")},{signal:c})}a(this,Ai)?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=a(this,Tt)),t.parentNode||e.append(t);const n=a(this,Cn).getElementForAltText();n==null||n.setAttribute("aria-describedby",t.id)},w(hn,Ao,null),B(hn,"_l10n",null);let dy=hn;var jt,As,za,Be,Af,Ha,Gs,Va,Wa,Ga,Sf,Pw;class Og{constructor(e){w(this,Sf);w(this,jt,null);w(this,As,null);w(this,za,!1);w(this,Be,null);w(this,Af,null);w(this,Ha,null);w(this,Gs,null);w(this,Va,null);w(this,Wa,!1);w(this,Ga,null);g(this,Be,e)}renderForToolbar(){const e=g(this,As,document.createElement("button"));return e.className="comment",x(this,Sf,Pw).call(this,e,!1)}renderForStandalone(){const e=g(this,jt,document.createElement("button"));e.className="annotationCommentButton";const t=a(this,Be).commentButtonPosition;if(t){const{style:n}=e;n.insetInlineEnd=`calc(${100*(a(this,Be)._uiManager.direction==="ltr"?1-t[0]:t[0])}% - var(--comment-button-dim))`,n.top=`calc(${100*t[1]}% - var(--comment-button-dim))`;const i=a(this,Be).commentButtonColor;i&&(n.backgroundColor=i)}return x(this,Sf,Pw).call(this,e,!0)}focusButton(){setTimeout(()=>{var e;(e=a(this,jt)??a(this,As))==null||e.focus()},0)}onUpdatedColor(){if(!a(this,jt))return;const e=a(this,Be).commentButtonColor;e&&(a(this,jt).style.backgroundColor=e),a(this,Be)._uiManager.updatePopupColor(a(this,Be))}get commentButtonWidth(){var e;return(((e=a(this,jt))==null?void 0:e.getBoundingClientRect().width)??0)/a(this,Be).parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(a(this,Ga))return a(this,Ga);if(!a(this,jt))return null;const{x:e,y:t,height:n}=a(this,jt).getBoundingClientRect(),{x:i,y:r,width:o,height:l}=a(this,Be).parent.boundingClientRect;return[(e-i)/o,(t+n-r)/l]}set commentPopupPositionInLayer(e){g(this,Ga,e)}hasDefaultPopupPosition(){return a(this,Ga)===null}removeStandaloneCommentButton(){var e;(e=a(this,jt))==null||e.remove(),g(this,jt,null)}removeToolbarCommentButton(){var e;(e=a(this,As))==null||e.remove(),g(this,As,null)}setCommentButtonStates({selected:e,hasPopup:t}){a(this,jt)&&(a(this,jt).classList.toggle("selected",e),a(this,jt).ariaExpanded=t)}edit(e){const t=this.commentPopupPositionInLayer;let n,i;if(t)[n,i]=t;else{[n,i]=a(this,Be).commentButtonPosition;const{width:h,height:d,x:f,y:p}=a(this,Be);n=f+n*h,i=p+i*d}const r=a(this,Be).parent.boundingClientRect,{x:o,y:l,width:c,height:u}=r;a(this,Be)._uiManager.editComment(a(this,Be),o+n*c,l+i*u,{...e,parentDimensions:r})}finish(){a(this,As)&&(a(this,As).focus({focusVisible:a(this,za)}),g(this,za,!1))}isDeleted(){return a(this,Wa)||a(this,Gs)===""}isEmpty(){return a(this,Gs)===null}hasBeenEdited(){return this.isDeleted()||a(this,Gs)!==a(this,Af)}serialize(){return this.data}get data(){return{text:a(this,Gs),richText:a(this,Ha),date:a(this,Va),deleted:this.isDeleted()}}set data(e){if(e!==a(this,Gs)&&g(this,Ha,null),e===null){g(this,Gs,""),g(this,Wa,!0);return}g(this,Gs,e),g(this,Va,new Date),g(this,Wa,!1)}setInitialText(e,t=null){g(this,Af,e),this.data=e,g(this,Va,null),g(this,Ha,t)}shown(){}destroy(){var e,t;(e=a(this,As))==null||e.remove(),g(this,As,null),(t=a(this,jt))==null||t.remove(),g(this,jt,null),g(this,Gs,""),g(this,Ha,null),g(this,Va,null),g(this,Be,null),g(this,za,!1),g(this,Wa,!1)}}jt=new WeakMap,As=new WeakMap,za=new WeakMap,Be=new WeakMap,Af=new WeakMap,Ha=new WeakMap,Gs=new WeakMap,Va=new WeakMap,Wa=new WeakMap,Ga=new WeakMap,Sf=new WeakSet,Pw=function(e,t){if(!a(this,Be)._uiManager.hasCommentManager())return null;e.tabIndex="0",e.ariaHasPopup="dialog",t?(e.ariaControls="commentPopup",e.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(e.ariaControlsElements=[a(this,Be)._uiManager.getCommentDialogElement()],e.setAttribute("data-l10n-id","pdfjs-editor-add-comment-button"));const n=a(this,Be)._uiManager._signal;if(!(n instanceof AbortSignal)||n.aborted)return e;e.addEventListener("contextmenu",js,{signal:n}),t&&(e.addEventListener("focusin",r=>{a(this,Be)._focusEventsAllowed=!1,lt(r)},{capture:!0,signal:n}),e.addEventListener("focusout",r=>{a(this,Be)._focusEventsAllowed=!0,lt(r)},{capture:!0,signal:n})),e.addEventListener("pointerdown",r=>r.stopPropagation(),{signal:n});const i=r=>{r.preventDefault(),e===a(this,As)?this.edit():a(this,Be).toggleComment(!0)};return e.addEventListener("click",i,{capture:!0,signal:n}),e.addEventListener("keydown",r=>{r.target===e&&r.key==="Enter"&&(g(this,za,!0),i(r))},{signal:n}),e.addEventListener("pointerenter",()=>{a(this,Be).toggleComment(!1,!0)},{signal:n}),e.addEventListener("pointerleave",()=>{a(this,Be).toggleComment(!1,!1)},{signal:n}),e};var vu,qa,Ef,Cf,kf,Tf,Pf,or,Ka,ar,Xa,lr,fa,NC,IC,DC;const ix=class ix{constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:n=null,onPinchStart:i=null,onPinching:r=null,onPinchEnd:o=null,signal:l}){w(this,fa);w(this,vu);w(this,qa,!1);w(this,Ef,null);w(this,Cf);w(this,kf);w(this,Tf);w(this,Pf);w(this,or,null);w(this,Ka);w(this,ar,null);w(this,Xa);w(this,lr,null);g(this,vu,e),g(this,Ef,n),g(this,Cf,t),g(this,kf,i),g(this,Tf,r),g(this,Pf,o),g(this,Xa,new AbortController),g(this,Ka,AbortSignal.any([l,a(this,Xa).signal])),e.addEventListener("touchstart",x(this,fa,NC).bind(this),{passive:!1,signal:a(this,Ka)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Vi.pixelRatio}destroy(){var e,t;(e=a(this,Xa))==null||e.abort(),g(this,Xa,null),(t=a(this,or))==null||t.abort(),g(this,or,null)}};vu=new WeakMap,qa=new WeakMap,Ef=new WeakMap,Cf=new WeakMap,kf=new WeakMap,Tf=new WeakMap,Pf=new WeakMap,or=new WeakMap,Ka=new WeakMap,ar=new WeakMap,Xa=new WeakMap,lr=new WeakMap,fa=new WeakSet,NC=function(e){var i,r,o;if((i=a(this,Cf))!=null&&i.call(this))return;if(e.touches.length===1){if(a(this,or))return;const l=g(this,or,new AbortController),c=AbortSignal.any([a(this,Ka),l.signal]),u=a(this,vu),h={capture:!0,signal:c,passive:!1},d=f=>{var p;f.pointerType==="touch"&&((p=a(this,or))==null||p.abort(),g(this,or,null))};u.addEventListener("pointerdown",f=>{f.pointerType==="touch"&&(lt(f),d(f))},h),u.addEventListener("pointerup",d,h),u.addEventListener("pointercancel",d,h);return}if(!a(this,lr)){g(this,lr,new AbortController);const l=AbortSignal.any([a(this,Ka),a(this,lr).signal]),c=a(this,vu),u={signal:l,capture:!1,passive:!1};c.addEventListener("touchmove",x(this,fa,IC).bind(this),u);const h=x(this,fa,DC).bind(this);c.addEventListener("touchend",h,u),c.addEventListener("touchcancel",h,u),u.capture=!0,c.addEventListener("pointerdown",lt,u),c.addEventListener("pointermove",lt,u),c.addEventListener("pointercancel",lt,u),c.addEventListener("pointerup",lt,u),(r=a(this,kf))==null||r.call(this)}if(lt(e),e.touches.length!==2||(o=a(this,Ef))!=null&&o.call(this)){g(this,ar,null);return}let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]),g(this,ar,{touch0X:t.screenX,touch0Y:t.screenY,touch1X:n.screenX,touch1Y:n.screenY})},IC=function(e){var S;if(!a(this,ar)||e.touches.length!==2)return;lt(e);let[t,n]=e.touches;t.identifier>n.identifier&&([t,n]=[n,t]);const{screenX:i,screenY:r}=t,{screenX:o,screenY:l}=n,c=a(this,ar),{touch0X:u,touch0Y:h,touch1X:d,touch1Y:f}=c,p=d-u,y=f-h,_=o-i,A=l-r,m=Math.hypot(_,A)||1,b=Math.hypot(p,y)||1;if(!a(this,qa)&&Math.abs(b-m)<=ix.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(c.touch0X=i,c.touch0Y=r,c.touch1X=o,c.touch1Y=l,!a(this,qa)){g(this,qa,!0);return}const v=[(i+o)/2,(r+l)/2];(S=a(this,Tf))==null||S.call(this,v,b,m)},DC=function(e){var t;e.touches.length>=2||(a(this,lr)&&(a(this,lr).abort(),g(this,lr,null),(t=a(this,Pf))==null||t.call(this)),a(this,ar)&&(lt(e),g(this,ar,null),g(this,qa,!1)))};let fy=ix;var Ya,qs,Ge,De,cr,wu,So,Rf,Bt,Ja,ur,Ss,Eo,Nf,Qa,Hn,If,Za,hr,ki,bu,_u,Es,el,Df,Ty,ee,Rw,Of,Nw,cm,OC,LC,Iw,um,Dw,MC,FC,jC,Ow,BC,Lw,$C,UC,zC,Mw,ud;const se=class se{constructor(e){w(this,ee);w(this,Ya,null);w(this,qs,null);w(this,Ge,null);w(this,De,null);w(this,cr,null);w(this,wu,!1);w(this,So,null);w(this,Rf,"");w(this,Bt,null);w(this,Ja,null);w(this,ur,null);w(this,Ss,null);w(this,Eo,null);w(this,Nf,"");w(this,Qa,!1);w(this,Hn,null);w(this,If,!1);w(this,Za,!1);w(this,hr,!1);w(this,ki,null);w(this,bu,0);w(this,_u,0);w(this,Es,null);w(this,el,null);B(this,"isSelected",!1);B(this,"_isCopy",!1);B(this,"_editToolbar",null);B(this,"_initialOptions",Object.create(null));B(this,"_initialData",null);B(this,"_isVisible",!0);B(this,"_uiManager",null);B(this,"_focusEventsAllowed",!0);w(this,Df,!1);w(this,Ty,se._zIndex++);this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null,this.creationDate=e.creationDate||new Date,this.modificationDate=e.modificationDate||null,this.canAddComment=!0;const{rotation:t,rawDims:{pageWidth:n,pageHeight:i,pageX:r,pageY:o}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,i],this.pageTranslation=[r,o];const[l,c]=this.parentDimensions;this.x=e.x/l,this.y=e.y/c,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=se.prototype._resizeWithKeyboard,t=ic.TRANSLATE_SMALL,n=ic.TRANSLATE_BIG;return ae(this,"_resizerKeyboardManager",new ug([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,n]}],[["Escape","mac+Escape"],se.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return ae(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new uD({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(se._l10n??(se._l10n=e),se._l10nResizer||(se._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),se._borderLineWidth!==-1)return;const n=getComputedStyle(document.documentElement);se._borderLineWidth=parseFloat(n.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){Me("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return a(this,Df)}set _isDraggable(e){var t;g(this,Df,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=a(this,Ty)}setParent(e){var t;e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):(x(this,ee,ud).call(this),(t=a(this,Ss))==null||t.remove(),g(this,Ss,null)),this.parent=e}focusin(e){this._focusEventsAllowed&&(a(this,Qa)?g(this,Qa,!1):this.parent.setSelected(this))}focusout(e){var n;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(n=this.parent)!=null&&n.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,n,i){const[r,o]=this.parentDimensions;[n,i]=this.screenToPageTranslation(n,i),this.x=(e+n)/r,this.y=(t+i)/o,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[n,i]=this.parentDimensions;this.setAt(e*n,t*i,this.width*n,this.height*i),this._onTranslated()}translate(e,t){x(this,ee,Rw).call(this,this.parentDimensions,e,t)}translateInPage(e,t){a(this,Hn)||g(this,Hn,[this.x,this.y,this.width,this.height]),x(this,ee,Rw).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){a(this,Hn)||g(this,Hn,[this.x,this.y,this.width,this.height]);const{div:n,parentDimensions:[i,r]}=this;if(this.x+=e/i,this.y+=t/r,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:d,y:f}=this.div.getBoundingClientRect();this.parent.findNewParent(this,d,f)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:l}=this;const[c,u]=this.getBaseTranslation();o+=c,l+=u;const{style:h}=n;h.left=`${(100*o).toFixed(2)}%`,h.top=`${(100*l).toFixed(2)}%`,this._onTranslating(o,l),n.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!a(this,Hn)&&(a(this,Hn)[0]!==this.x||a(this,Hn)[1]!==this.y)}get _hasBeenResized(){return!!a(this,Hn)&&(a(this,Hn)[2]!==this.width||a(this,Hn)[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:n}=se,i=n/e,r=n/t;switch(this.rotation){case 90:return[-i,r];case 180:return[i,r];case 270:return[i,-r];default:return[-i,-r]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[n,i]}=this;let{x:r,y:o,width:l,height:c}=this;if(l*=n,c*=i,r*=n,o*=i,this._mustFixPosition)switch(e){case 0:r=mn(r,0,n-l),o=mn(o,0,i-c);break;case 90:r=mn(r,0,n-c),o=mn(o,l,i);break;case 180:r=mn(r,l,n),o=mn(o,c,i);break;case 270:r=mn(r,c,n),o=mn(o,0,i-l);break}this.x=r/=n,this.y=o/=i;const[u,h]=this.getBaseTranslation();r+=u,o+=h,t.left=`${(100*r).toFixed(2)}%`,t.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var n;return x(n=se,Of,Nw).call(n,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var n;return x(n=se,Of,Nw).call(n,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,n]}=this;return[t*e,n*e]}setDims(){const{div:{style:e},width:t,height:n}=this;e.width=`${(100*t).toFixed(2)}%`,e.height=`${(100*n).toFixed(2)}%`}getInitialTranslation(){return[0,0]}_onResized(){}static _round(e){return Math.round(e*1e4)/1e4}_onResizing(){}altTextFinish(){var e;(e=a(this,Ge))==null||e.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||a(this,Za))return this._editToolbar;this._editToolbar=new _w(this),this.div.append(this._editToolbar.render());const{toolbarButtons:e}=this;if(e)for(const[t,n]of e)await this._editToolbar.addButton(t,n);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){var e;(e=this._editToolbar)==null||e.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){var e;(e=this._editToolbar)==null||e.removeButton("comment")}removeEditToolbar(){var e,t;(e=this._editToolbar)==null||e.remove(),this._editToolbar=null,(t=a(this,Ge))==null||t.destroy()}addContainer(e){var n;const t=(n=this._editToolbar)==null?void 0:n.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return a(this,Ge)||(dy.initialize(se._l10n),g(this,Ge,new dy(this)),a(this,Ya)&&(a(this,Ge).data=a(this,Ya),g(this,Ya,null))),a(this,Ge)}get altTextData(){var e;return(e=a(this,Ge))==null?void 0:e.data}set altTextData(e){a(this,Ge)&&(a(this,Ge).data=e)}get guessedAltText(){var e;return(e=a(this,Ge))==null?void 0:e.guessedText}async setGuessedAltText(e){var t;await((t=a(this,Ge))==null?void 0:t.setGuessedText(e))}serializeAltText(e){var t;return(t=a(this,Ge))==null?void 0:t.serialize(e)}hasAltText(){return!!a(this,Ge)&&!a(this,Ge).isEmpty()}hasAltTextData(){var e;return((e=a(this,Ge))==null?void 0:e.hasData())??!1}focusCommentButton(){var e;(e=a(this,De))==null||e.focusButton()}addCommentButton(){return this.canAddComment?a(this,De)||g(this,De,new Og(this)):null}addStandaloneCommentButton(){if(this._uiManager.hasCommentManager()){if(a(this,cr)){this._uiManager.isEditingMode()&&a(this,cr).classList.remove("hidden");return}this.hasComment&&(g(this,cr,a(this,De).renderForStandalone()),this.div.append(a(this,cr)))}}removeStandaloneCommentButton(){a(this,De).removeStandaloneCommentButton(),g(this,cr,null)}hideStandaloneCommentButton(){var e;(e=a(this,cr))==null||e.classList.add("hidden")}get comment(){const{data:{richText:e,text:t,date:n,deleted:i}}=a(this,De);return{text:t,richText:e,date:n,deleted:i,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(e){a(this,De)||g(this,De,new Og(this)),a(this,De).data=e,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:e,popupRef:t,richText:n}){if(!t||(a(this,De)||g(this,De,new Og(this)),a(this,De).setInitialText(e,n),!this.annotationElementId))return;const i=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);i&&this.updateFromAnnotationLayer(i)}get hasEditedComment(){var e;return(e=a(this,De))==null?void 0:e.hasBeenEdited()}get hasDeletedComment(){var e;return(e=a(this,De))==null?void 0:e.isDeleted()}get hasComment(){return!!a(this,De)&&!a(this,De).isEmpty()&&!a(this,De).isDeleted()}async editComment(e){a(this,De)||g(this,De,new Og(this)),a(this,De).edit(e)}toggleComment(e,t=void 0){this.hasComment&&this._uiManager.toggleComment(this,e,t)}setSelectedCommentButton(e){a(this,De).setSelectedButton(e)}addComment(e){if(this.hasEditedComment){const[,,,i]=e.rect,[r]=this.pageDimensions,[o]=this.pageTranslation,l=o+r+1,c=i-100,u=l+180;e.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[l,c,u,i]}}}updateFromAnnotationLayer({popup:{contents:e,deleted:t}}){a(this,De).data=t?null:e}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){var o;const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=a(this,wu)?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),x(this,ee,Lw).call(this);const[t,n]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*n/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/n).toFixed(2)}%`);const[i,r]=this.getInitialTranslation();return this.translate(i,r),yC(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(a(this,el)||g(this,el,new fy({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:x(this,ee,MC).bind(this),onPinching:x(this,ee,FC).bind(this),onPinchEnd:x(this,ee,jC).bind(this),signal:this._uiManager._signal}))),this.addStandaloneCommentButton(),(o=this._uiManager._editorUndoBar)==null||o.hide(),e}pointerdown(e){const{isMac:t}=Kt.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(g(this,Qa,!0),this._isDraggable){x(this,ee,BC).call(this,e);return}x(this,ee,Ow).call(this,e)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){a(this,ki)&&clearTimeout(a(this,ki)),g(this,ki,setTimeout(()=>{var e;g(this,ki,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,n){e.changeParent(this),this.x=t,this.y=n,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,n=this.rotation){const i=this.parentScale,[r,o]=this.pageDimensions,[l,c]=this.pageTranslation,u=e/i,h=t/i,d=this.x*r,f=this.y*o,p=this.width*r,y=this.height*o;switch(n){case 0:return[d+u+l,o-f-h-y+c,d+u+p+l,o-f-h+c];case 90:return[d+h+l,o-f+u+c,d+h+y+l,o-f+u+p+c];case 180:return[d-u-p+l,o-f+h+c,d-u+l,o-f+h+y+c];case 270:return[d-h-y+l,o-f-u-p+c,d-h+l,o-f-u+c];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[n,i,r,o]=e,l=r-n,c=o-i;switch(this.rotation){case 0:return[n,t-o,l,c];case 90:return[n,t-i,c,l];case 180:return[r,t-i,l,c];case 270:return[r,t-o,c,l];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&se._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){var e;(e=a(this,De))==null||e.onUpdatedColor()}getData(){const{comment:{text:e,color:t,date:n,opacity:i,deleted:r,richText:o},uid:l,pageIndex:c,creationDate:u,modificationDate:h}=this;return{id:l,pageIndex:c,rect:this.getPDFRect(),richText:o,contentsObj:{str:e},creationDate:u,modificationDate:n||h,popupRef:!r,color:t,opacity:i}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),g(this,Za,!0),!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),g(this,Za,!1),!0):!1}isInEditMode(){return a(this,Za)}shouldGetKeyboardEvents(){return a(this,hr)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:n,right:i}=this.getClientDimensions(),{innerHeight:r,innerWidth:o}=window;return t<o&&i>0&&e<r&&n>0}rebuild(){x(this,ee,Lw).call(this)}rotate(e){}resize(){}serializeDeleted(){var e;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((e=this._initialData)==null?void 0:e.popupRef)||""}}serialize(e=!1,t=null){var n;return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:((n=this._initialData)==null?void 0:n.popupRef)||""}}static async deserialize(e,t,n){const i=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n,annotationElementId:e.annotationElementId,creationDate:e.creationDate,modificationDate:e.modificationDate});i.rotation=e.rotation,g(i,Ya,e.accessibilityData),i._isCopy=e.isCopy||!1;const[r,o]=i.pageDimensions,[l,c,u,h]=i.getRectInCurrentCoords(e.rect,o);return i.x=l/r,i.y=c/o,i.width=u/r,i.height=h/o,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var e,t,n;if((e=a(this,Eo))==null||e.abort(),g(this,Eo,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.hideCommentPopup(),a(this,ki)&&(clearTimeout(a(this,ki)),g(this,ki,null)),x(this,ee,ud).call(this),this.removeEditToolbar(),a(this,Es)){for(const i of a(this,Es).values())clearTimeout(i);g(this,Es,null)}this.parent=null,(t=a(this,el))==null||t.destroy(),g(this,el,null),(n=a(this,Ss))==null||n.remove(),g(this,Ss,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(x(this,ee,OC).call(this),a(this,Bt).classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[e,t]}=this,[n,i,r,o]=this.getPDFRect();return[se._round(n+(r-n)*e),se._round(i+(o-i)*(1-t))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return a(this,De).commentPopupPositionInLayer}set commentPopupPosition(e){a(this,De).commentPopupPositionInLayer=e}hasDefaultPopupPosition(){return a(this,De).hasDefaultPopupPosition()}get commentButtonWidth(){return a(this,De).commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(e){var t;(t=a(this,De))==null||t.setCommentButtonStates(e)}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),g(this,ur,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=a(this,Bt).children;if(!a(this,qs)){g(this,qs,Array.from(t));const o=x(this,ee,$C).bind(this),l=x(this,ee,UC).bind(this),c=this._uiManager._signal;for(const u of a(this,qs)){const h=u.getAttribute("data-resizer-name");u.setAttribute("role","spinbutton"),u.addEventListener("keydown",o,{signal:c}),u.addEventListener("blur",l,{signal:c}),u.addEventListener("focus",x(this,ee,zC).bind(this,h),{signal:c}),u.setAttribute("data-l10n-id",se._l10nResizer[h])}}const n=a(this,qs)[0];let i=0;for(const o of t){if(o===n)break;i++}const r=(360-this.rotation+this.parentRotation)%360/90*(a(this,qs).length/4);if(r!==i){if(r<i)for(let l=0;l<i-r;l++)a(this,Bt).append(a(this,Bt).firstChild);else if(r>i)for(let l=0;l<r-i;l++)a(this,Bt).firstChild.before(a(this,Bt).lastChild);let o=0;for(const l of t){const u=a(this,qs)[o++].getAttribute("data-resizer-name");l.setAttribute("data-l10n-id",se._l10nResizer[u])}}x(this,ee,Mw).call(this,0),g(this,hr,!0),a(this,Bt).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){a(this,hr)&&x(this,ee,Dw).call(this,a(this,Nf),{deltaX:e,deltaY:t,fromKeyboard:!0})}_stopResizingWithKeyboard(){x(this,ee,ud).call(this),this.div.focus()}select(){var e,t,n;if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var i,r;(i=this.div)!=null&&i.classList.contains("selectedEditor")&&((r=this._editToolbar)==null||r.show())});return}(t=this._editToolbar)==null||t.show(),(n=a(this,Ge))==null||n.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>{var e;return(e=this.div)==null?void 0:e.focus({preventScroll:!0})},0)}unselect(){var e,t,n,i,r;this.isSelected&&(this.isSelected=!1,(e=a(this,Bt))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(n=this.div)!=null&&n.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(i=this._editToolbar)==null||i.hide(),(r=a(this,Ge))==null||r.toggleAltTextBadge(!0),this.hideCommentPopup())}hideCommentPopup(){this.hasComment&&this._uiManager.toggleComment(null)}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){e.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.uid}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return a(this,If)}set isEditing(e){g(this,If,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){a(this,Es)||g(this,Es,new Map);const{action:n}=e;let i=a(this,Es).get(n);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(e),a(this,Es).delete(n),a(this,Es).size===0&&g(this,Es,null)},se._telemetryTimeout),a(this,Es).set(n,i);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),g(this,wu,!1)}disable(){this.div&&(this.div.tabIndex=-1),g(this,wu,!0)}updateFakeAnnotationElement(e){if(!a(this,Ss)&&!this.deleted){g(this,Ss,e.addFakeAnnotation(this));return}if(this.deleted){a(this,Ss).remove(),g(this,Ss,null);return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&a(this,Ss).updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const n=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),n.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;(t==null?void 0:t.nodeName)==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};Ya=new WeakMap,qs=new WeakMap,Ge=new WeakMap,De=new WeakMap,cr=new WeakMap,wu=new WeakMap,So=new WeakMap,Rf=new WeakMap,Bt=new WeakMap,Ja=new WeakMap,ur=new WeakMap,Ss=new WeakMap,Eo=new WeakMap,Nf=new WeakMap,Qa=new WeakMap,Hn=new WeakMap,If=new WeakMap,Za=new WeakMap,hr=new WeakMap,ki=new WeakMap,bu=new WeakMap,_u=new WeakMap,Es=new WeakMap,el=new WeakMap,Df=new WeakMap,Ty=new WeakMap,ee=new WeakSet,Rw=function([e,t],n,i){[n,i]=this.screenToPageTranslation(n,i),this.x+=n/e,this.y+=i/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},Of=new WeakSet,Nw=function(e,t,n){switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},cm=function(e){switch(e){case 90:{const[t,n]=this.pageDimensions;return[0,-t/n,n/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,n]=this.pageDimensions;return[0,t/n,-n/t,0]}default:return[1,0,0,1]}},OC=function(){if(a(this,Bt))return;g(this,Bt,document.createElement("div")),a(this,Bt).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const n of e){const i=document.createElement("div");a(this,Bt).append(i),i.classList.add("resizer",n),i.setAttribute("data-resizer-name",n),i.addEventListener("pointerdown",x(this,ee,LC).bind(this,n),{signal:t}),i.addEventListener("contextmenu",js,{signal:t}),i.tabIndex=-1}this.div.prepend(a(this,Bt))},LC=function(e,t){var h;t.preventDefault();const{isMac:n}=Kt.platform;if(t.button!==0||t.ctrlKey&&n)return;(h=a(this,Ge))==null||h.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,g(this,Ja,[t.screenX,t.screenY]);const r=new AbortController,o=this._uiManager.combinedSignal(r);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",x(this,ee,Dw).bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",lt,{passive:!1,signal:o}),window.addEventListener("contextmenu",js,{signal:o}),g(this,ur,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const l=this.parent.div.style.cursor,c=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const u=()=>{var d;r.abort(),this.parent.togglePointerEvents(!0),(d=a(this,Ge))==null||d.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=l,this.div.style.cursor=c,x(this,ee,um).call(this)};window.addEventListener("pointerup",u,{signal:o}),window.addEventListener("blur",u,{signal:o})},Iw=function(e,t,n,i){this.width=n,this.height=i,this.x=e,this.y=t,this.setDims(),this.fixAndSetPosition(),this._onResized()},um=function(){if(!a(this,ur))return;const{savedX:e,savedY:t,savedWidth:n,savedHeight:i}=a(this,ur);g(this,ur,null);const r=this.x,o=this.y,l=this.width,c=this.height;r===e&&o===t&&l===n&&c===i||this.addCommands({cmd:x(this,ee,Iw).bind(this,r,o,l,c),undo:x(this,ee,Iw).bind(this,e,t,n,i),mustExec:!0})},Dw=function(e,t){const[n,i]=this.parentDimensions,r=this.x,o=this.y,l=this.width,c=this.height,u=se.MIN_SIZE/n,h=se.MIN_SIZE/i,d=x(this,ee,cm).call(this,this.rotation),f=(G,M)=>[d[0]*G+d[2]*M,d[1]*G+d[3]*M],p=x(this,ee,cm).call(this,360-this.rotation),y=(G,M)=>[p[0]*G+p[2]*M,p[1]*G+p[3]*M];let _,A,m=!1,b=!1;switch(e){case"topLeft":m=!0,_=(G,M)=>[0,0],A=(G,M)=>[G,M];break;case"topMiddle":_=(G,M)=>[G/2,0],A=(G,M)=>[G/2,M];break;case"topRight":m=!0,_=(G,M)=>[G,0],A=(G,M)=>[0,M];break;case"middleRight":b=!0,_=(G,M)=>[G,M/2],A=(G,M)=>[0,M/2];break;case"bottomRight":m=!0,_=(G,M)=>[G,M],A=(G,M)=>[0,0];break;case"bottomMiddle":_=(G,M)=>[G/2,M],A=(G,M)=>[G/2,0];break;case"bottomLeft":m=!0,_=(G,M)=>[0,M],A=(G,M)=>[G,0];break;case"middleLeft":b=!0,_=(G,M)=>[0,M/2],A=(G,M)=>[G,M/2];break}const v=_(l,c),S=A(l,c);let C=f(...S);const k=se._round(r+C[0]),T=se._round(o+C[1]);let I=1,O=1,L,j;if(t.fromKeyboard)({deltaX:L,deltaY:j}=t);else{const{screenX:G,screenY:M}=t,[P,R]=a(this,Ja);[L,j]=this.screenToPageTranslation(G-P,M-R),a(this,Ja)[0]=G,a(this,Ja)[1]=M}if([L,j]=y(L/n,j/i),m){const G=Math.hypot(l,c);I=O=Math.max(Math.min(Math.hypot(S[0]-v[0]-L,S[1]-v[1]-j)/G,1/l,1/c),u/l,h/c)}else b?I=mn(Math.abs(S[0]-v[0]-L),u,1)/l:O=mn(Math.abs(S[1]-v[1]-j),h,1)/c;const H=se._round(l*I),J=se._round(c*O);C=f(...A(H,J));const Y=k-C[0],te=T-C[1];a(this,Hn)||g(this,Hn,[this.x,this.y,this.width,this.height]),this.width=H,this.height=J,this.x=Y,this.y=te,this.setDims(),this.fixAndSetPosition(),this._onResizing()},MC=function(){var e;g(this,ur,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(e=a(this,Ge))==null||e.toggle(!1),this.parent.togglePointerEvents(!1)},FC=function(e,t,n){let r=.7*(n/t)+1-.7;if(r===1)return;const o=x(this,ee,cm).call(this,this.rotation),l=(k,T)=>[o[0]*k+o[2]*T,o[1]*k+o[3]*T],[c,u]=this.parentDimensions,h=this.x,d=this.y,f=this.width,p=this.height,y=se.MIN_SIZE/c,_=se.MIN_SIZE/u;r=Math.max(Math.min(r,1/f,1/p),y/f,_/p);const A=se._round(f*r),m=se._round(p*r);if(A===f&&m===p)return;a(this,Hn)||g(this,Hn,[h,d,f,p]);const b=l(f/2,p/2),v=se._round(h+b[0]),S=se._round(d+b[1]),C=l(A/2,m/2);this.x=v-C[0],this.y=S-C[1],this.width=A,this.height=m,this.setDims(),this.fixAndSetPosition(),this._onResizing()},jC=function(){var e;(e=a(this,Ge))==null||e.toggle(!0),this.parent.togglePointerEvents(!0),x(this,ee,um).call(this)},Ow=function(e){const{isMac:t}=Kt.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},BC=function(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let n=!1;const i=new AbortController,r=this._uiManager.combinedSignal(i),o={capture:!0,passive:!1,signal:r},l=u=>{i.abort(),g(this,So,null),g(this,Qa,!1),this._uiManager.endDragSession()||x(this,ee,Ow).call(this,u),n&&this._onStopDragging()};t&&(g(this,bu,e.clientX),g(this,_u,e.clientY),g(this,So,e.pointerId),g(this,Rf,e.pointerType),window.addEventListener("pointermove",u=>{n||(n=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:h,clientY:d,pointerId:f}=u;if(f!==a(this,So)){lt(u);return}const[p,y]=this.screenToPageTranslation(h-a(this,bu),d-a(this,_u));g(this,bu,h),g(this,_u,d),this._uiManager.dragSelectedEditors(p,y)},o),window.addEventListener("touchmove",lt,o),window.addEventListener("pointerdown",u=>{u.pointerType===a(this,Rf)&&(a(this,el)||u.isPrimary)&&l(u),lt(u)},o));const c=u=>{if(!a(this,So)||a(this,So)===u.pointerId){l(u);return}lt(u)};window.addEventListener("pointerup",c,{signal:r}),window.addEventListener("blur",c,{signal:r})},Lw=function(){if(a(this,Eo)||!this.div)return;g(this,Eo,new AbortController);const e=this._uiManager.combinedSignal(a(this,Eo));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})},$C=function(e){se._resizerKeyboardManager.exec(this,e)},UC=function(e){var t;a(this,hr)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==a(this,Bt)&&x(this,ee,ud).call(this)},zC=function(e){g(this,Nf,a(this,hr)?e:"")},Mw=function(e){if(a(this,qs))for(const t of a(this,qs))t.tabIndex=e},ud=function(){g(this,hr,!1),x(this,ee,Mw).call(this,-1),x(this,ee,um).call(this)},w(se,Of),B(se,"_l10n",null),B(se,"_l10nResizer",null),B(se,"_borderLineWidth",-1),B(se,"_colorManager",new Sw),B(se,"_zIndex",1),B(se,"_telemetryTimeout",1e3);let Ue=se;class uD extends Ue{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const WA=3285377520,gs=4294901760,pi=65535;class HC{constructor(e){this.h1=e?e&4294967295:WA,this.h2=e?e&4294967295:WA}update(e){let t,n;if(typeof e=="string"){t=new Uint8Array(e.length*2),n=0;for(let _=0,A=e.length;_<A;_++){const m=e.charCodeAt(_);m<=255?t[n++]=m:(t[n++]=m>>>8,t[n++]=m&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),n=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=n>>2,r=n-i*4,o=new Uint32Array(t.buffer,0,i);let l=0,c=0,u=this.h1,h=this.h2;const d=3432918353,f=461845907,p=d&pi,y=f&pi;for(let _=0;_<i;_++)_&1?(l=o[_],l=l*d&gs|l*p&pi,l=l<<15|l>>>17,l=l*f&gs|l*y&pi,u^=l,u=u<<13|u>>>19,u=u*5+3864292196):(c=o[_],c=c*d&gs|c*p&pi,c=c<<15|c>>>17,c=c*f&gs|c*y&pi,h^=c,h=h<<13|h>>>19,h=h*5+3864292196);switch(l=0,r){case 3:l^=t[i*4+2]<<16;case 2:l^=t[i*4+1]<<8;case 1:l^=t[i*4],l=l*d&gs|l*p&pi,l=l<<15|l>>>17,l=l*f&gs|l*y&pi,i&1?u^=l:h^=l}this.h1=u,this.h2=h}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&gs|e*36045&pi,t=t*4283543511&gs|((t<<16|e>>>16)*2950163797&gs)>>>16,e^=t>>>1,e=e*444984403&gs|e*60499&pi,t=t*3301882366&gs|((t<<16|e>>>16)*3120437893&gs)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const Fw=Object.freeze({map:null,hash:"",transfer:void 0});var tl,nl,dr,$t,Py,VC;class q_{constructor(){w(this,Py);w(this,tl,!1);w(this,nl,null);w(this,dr,null);w(this,$t,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const n=a(this,$t).get(e);return n===void 0?t:Object.assign(t,n)}getRawValue(e){return a(this,$t).get(e)}remove(e){const t=a(this,$t).get(e);if(t!==void 0&&(t instanceof Ue&&a(this,dr).delete(t.annotationElementId),a(this,$t).delete(e),a(this,$t).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const n of a(this,$t).values())if(n instanceof Ue)return;this.onAnnotationEditor(null)}}setValue(e,t){const n=a(this,$t).get(e);let i=!1;if(n!==void 0)for(const[r,o]of Object.entries(t))n[r]!==o&&(i=!0,n[r]=o);else i=!0,a(this,$t).set(e,t);i&&x(this,Py,VC).call(this),t instanceof Ue&&((a(this,dr)||g(this,dr,new Map)).set(t.annotationElementId,t),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type))}has(e){return a(this,$t).has(e)}get size(){return a(this,$t).size}resetModified(){a(this,tl)&&(g(this,tl,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new WC(this)}get serializable(){if(a(this,$t).size===0)return Fw;const e=new Map,t=new HC,n=[],i=Object.create(null);let r=!1;for(const[o,l]of a(this,$t)){const c=l instanceof Ue?l.serialize(!1,i):l;c&&(e.set(o,c),t.update(`${o}:${JSON.stringify(c)}`),r||(r=!!c.bitmap))}if(r)for(const o of e.values())o.bitmap&&n.push(o.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:n}:Fw}get editorStats(){let e=null;const t=new Map;let n=0,i=0;for(const r of a(this,$t).values()){if(!(r instanceof Ue)){r.popup&&(r.popup.deleted?i+=1:n+=1);continue}r.isCommentDeleted?i+=1:r.hasEditedComment&&(n+=1);const o=r.telemetryFinalData;if(!o)continue;const{type:l}=o;t.has(l)||t.set(l,Object.getPrototypeOf(r).constructor),e||(e=Object.create(null));const c=e[l]||(e[l]=new Map);for(const[u,h]of Object.entries(o)){if(u==="type")continue;let d=c.get(u);d||(d=new Map,c.set(u,d));const f=d.get(h)??0;d.set(h,f+1)}}if((i>0||n>0)&&(e||(e=Object.create(null)),e.comments={deleted:i,edited:n}),!e)return null;for(const[r,o]of t)e[r]=o.computeTelemetryFinalData(e[r]);return e}resetModifiedIds(){g(this,nl,null)}updateEditor(e,t){var i;const n=(i=a(this,dr))==null?void 0:i.get(e);return n?(n.updateFromAnnotationLayer(t),!0):!1}getEditor(e){var t;return((t=a(this,dr))==null?void 0:t.get(e))||null}get modifiedIds(){if(a(this,nl))return a(this,nl);const e=[];if(a(this,dr))for(const t of a(this,dr).values())t.serialize()&&e.push(t.annotationElementId);return g(this,nl,{ids:new Set(e),hash:e.join(",")})}[Symbol.iterator](){return a(this,$t).entries()}}tl=new WeakMap,nl=new WeakMap,dr=new WeakMap,$t=new WeakMap,Py=new WeakSet,VC=function(){a(this,tl)||(g(this,tl,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var Lf;class WC extends q_{constructor(t){super();w(this,Lf);const{map:n,hash:i,transfer:r}=t.serializable,o=structuredClone(n,r?{transfer:r}:null);g(this,Lf,{map:o,hash:i,transfer:r})}get print(){Me("Should not call PrintAnnotationStorage.print")}get serializable(){return a(this,Lf)}get modifiedIds(){return ae(this,"modifiedIds",{ids:new Set,hash:""})}}Lf=new WeakMap;var xu;class hD{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){w(this,xu,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),a(this,xu).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:n}){if(!(!e||a(this,xu).has(e.loadedName))){if(me(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:r,style:o}=e,l=new FontFace(i,r,o);this.addNativeFontFace(l);try{await l.load(),a(this,xu).add(i),n==null||n(e)}catch{ne(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(l)}return}Me("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const n=e.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(i){throw ne(`Failed to load font '${n.family}': '${i}'.`),e.disableFontFace=!0,i}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const i=this._queueLoadingCallback(n);this._prepareFontLoadEvent(e,i)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return ae(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return ae(this,"isSyncFontLoadingSupported",gn||Kt.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(me(!i.done,"completeRequest() cannot be called twice."),i.done=!0;n.length>0&&n[0].done;){const r=n.shift();setTimeout(r.callback,0)}}const{loadingRequests:n}=this,i={done:!1,complete:t,callback:e};return n.push(i),i}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return ae(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function n(S,C){return S.charCodeAt(C)<<24|S.charCodeAt(C+1)<<16|S.charCodeAt(C+2)<<8|S.charCodeAt(C+3)&255}function i(S,C,k,T){const I=S.substring(0,C),O=S.substring(C+k);return I+T+O}let r,o;const l=this._document.createElement("canvas");l.width=1,l.height=1;const c=l.getContext("2d");let u=0;function h(S,C){if(++u>30){ne("Load test font never loaded."),C();return}if(c.font="30px "+S,c.fillText(".",0,20),c.getImageData(0,0,1,1).data[3]>0){C();return}setTimeout(h.bind(null,S,C))}const d=`lt${Date.now()}${this.loadTestFontId++}`;let f=this._loadTestFont;f=i(f,976,d.length,d);const y=16,_=1482184792;let A=n(f,y);for(r=0,o=d.length-3;r<o;r+=4)A=A-_+n(d,r)|0;r<d.length&&(A=A-_+n(d+"XXX",r)|0),f=i(f,y,4,WI(A));const m=`url(data:font/opentype;base64,${btoa(f)});`,b=`@font-face {font-family:"${d}";src:${m}}`;this.insertRule(b);const v=this._document.createElement("div");v.style.visibility="hidden",v.style.width=v.style.height="10px",v.style.position="absolute",v.style.top=v.style.left="0px";for(const S of[e.loadedName,d]){const C=this._document.createElement("span");C.textContent="Hi",C.style.fontFamily=S,v.append(C)}this._document.body.append(v),h(d,()=>{v.remove(),t.complete()})}}xu=new WeakMap;var Te;class dD{constructor(e,t=null,n,i){w(this,Te);this.compiledGlyphs=Object.create(null),g(this,Te,e),this._inspectFont=t,n&&Object.assign(this,n),i&&(this.charProcOperatorList=i)}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const n={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(n.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,n)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var n;if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${lC(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${e}}`}return(n=this._inspectFont)==null||n.call(this,this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const n=this.loadedName+"_path_"+t;let i;try{i=e.get(n)}catch(o){ne(`getPathGenerator - ignoring character: "${o}".`)}const r=hC(i);return this.fontExtraProperties||e.delete(n),this.compiledGlyphs[t]=r}get black(){return a(this,Te).black}get bold(){return a(this,Te).bold}get disableFontFace(){return a(this,Te).disableFontFace??!1}get fontExtraProperties(){return a(this,Te).fontExtraProperties??!1}get isInvalidPDFjsFont(){return a(this,Te).isInvalidPDFjsFont}get isType3Font(){return a(this,Te).isType3Font}get italic(){return a(this,Te).italic}get missingFile(){return a(this,Te).missingFile}get remeasure(){return a(this,Te).remeasure}get vertical(){return a(this,Te).vertical}get ascent(){return a(this,Te).ascent}get defaultWidth(){return a(this,Te).defaultWidth}get descent(){return a(this,Te).descent}get bbox(){return a(this,Te).bbox}get fontMatrix(){return a(this,Te).fontMatrix}get fallbackName(){return a(this,Te).fallbackName}get loadedName(){return a(this,Te).loadedName}get mimetype(){return a(this,Te).mimetype}get name(){return a(this,Te).name}get data(){return a(this,Te).data}clearData(){a(this,Te).clearData()}get cssFontInfo(){return a(this,Te).cssFontInfo}get systemFontInfo(){return a(this,Te).systemFontInfo}get defaultVMetrics(){return a(this,Te).defaultVMetrics}}Te=new WeakMap;var Au,Su,Mf,Eu,hm;const Vc=class Vc{constructor(e){w(this,Eu);w(this,Au);w(this,Su);w(this,Mf);g(this,Au,e),g(this,Su,new DataView(a(this,Au))),g(this,Mf,new TextDecoder)}static write(e){const t=new TextEncoder,n={};let i=0;for(const u of Vc.strings){const h=t.encode(e[u]);n[u]=h,i+=4+h.length}const r=new ArrayBuffer(i),o=new Uint8Array(r),l=new DataView(r);let c=0;for(const u of Vc.strings){const h=n[u],d=h.length;l.setUint32(c,d),o.set(h,c+4),c+=4+d}return me(c===r.byteLength,"CssFontInfo.write: Buffer overflow"),r}get fontFamily(){return x(this,Eu,hm).call(this,0)}get fontWeight(){return x(this,Eu,hm).call(this,1)}get italicAngle(){return x(this,Eu,hm).call(this,2)}};Au=new WeakMap,Su=new WeakMap,Mf=new WeakMap,Eu=new WeakSet,hm=function(e){me(e<Vc.strings.length,"Invalid string index");let t=0;for(let i=0;i<e;i++)t+=a(this,Su).getUint32(t)+4;const n=a(this,Su).getUint32(t);return a(this,Mf).decode(new Uint8Array(a(this,Au),t+4,n))},B(Vc,"strings",["fontFamily","fontWeight","italicAngle"]);let py=Vc;var Co,Ti,sl,il,hd;const Wc=class Wc{constructor(e){w(this,il);w(this,Co);w(this,Ti);w(this,sl);g(this,Co,e),g(this,Ti,new DataView(a(this,Co))),g(this,sl,new TextDecoder)}static write(e){const t=new TextEncoder,n={};let i=0;for(const f of Wc.strings){const p=t.encode(e[f]);n[f]=p,i+=4+p.length}i+=4;let r,o,l=1+i;e.style&&(r=t.encode(e.style.style),o=t.encode(e.style.weight),l+=4+r.length+4+o.length);const c=new ArrayBuffer(l),u=new Uint8Array(c),h=new DataView(c);let d=0;h.setUint8(d++,e.guessFallback?1:0),h.setUint32(d,0),d+=4,i=0;for(const f of Wc.strings){const p=n[f],y=p.length;i+=4+y,h.setUint32(d,y),u.set(p,d+4),d+=4+y}return h.setUint32(d-i-4,i),e.style&&(h.setUint32(d,r.length),u.set(r,d+4),d+=4+r.length,h.setUint32(d,o.length),u.set(o,d+4),d+=4+o.length),me(d<=c.byteLength,"SubstitionInfo.write: Buffer overflow"),c.transferToFixedLength(d)}get guessFallback(){return a(this,Ti).getUint8(0)!==0}get css(){return x(this,il,hd).call(this,0)}get loadedName(){return x(this,il,hd).call(this,1)}get baseFontName(){return x(this,il,hd).call(this,2)}get src(){return x(this,il,hd).call(this,3)}get style(){let e=1;e+=4+a(this,Ti).getUint32(e);const t=a(this,Ti).getUint32(e),n=a(this,sl).decode(new Uint8Array(a(this,Co),e+4,t));e+=4+t;const i=a(this,Ti).getUint32(e),r=a(this,sl).decode(new Uint8Array(a(this,Co),e+4,i));return{style:n,weight:r}}};Co=new WeakMap,Ti=new WeakMap,sl=new WeakMap,il=new WeakSet,hd=function(e){me(e<Wc.strings.length,"Invalid string index");let t=5;for(let i=0;i<e;i++)t+=a(this,Ti).getUint32(t)+4;const n=a(this,Ti).getUint32(t);return a(this,sl).decode(new Uint8Array(a(this,Co),t+4,n))},B(Wc,"strings",["css","loadedName","baseFontName","src"]);let gy=Wc;var Cu,ku,Tu,Pu,Vn,Pi,Ff,Pe,ot,zs,dm,dd;const re=class re{constructor({data:e,extra:t}){w(this,ot);w(this,Pi);w(this,Ff);w(this,Pe);g(this,Pi,e),g(this,Ff,new TextDecoder),g(this,Pe,new DataView(a(this,Pi))),t&&Object.assign(this,t)}get black(){return x(this,ot,zs).call(this,0)}get bold(){return x(this,ot,zs).call(this,1)}get disableFontFace(){return x(this,ot,zs).call(this,2)}get fontExtraProperties(){return x(this,ot,zs).call(this,3)}get isInvalidPDFjsFont(){return x(this,ot,zs).call(this,4)}get isType3Font(){return x(this,ot,zs).call(this,5)}get italic(){return x(this,ot,zs).call(this,6)}get missingFile(){return x(this,ot,zs).call(this,7)}get remeasure(){return x(this,ot,zs).call(this,8)}get vertical(){return x(this,ot,zs).call(this,9)}get ascent(){return x(this,ot,dm).call(this,0)}get defaultWidth(){return x(this,ot,dm).call(this,1)}get descent(){return x(this,ot,dm).call(this,2)}get bbox(){let e=a(re,ku);if(a(this,Pe).getUint8(e)===0)return;e+=1;const n=[];for(let i=0;i<4;i++)n.push(a(this,Pe).getInt16(e,!0)),e+=2;return n}get fontMatrix(){let e=a(re,Tu);if(a(this,Pe).getUint8(e)===0)return;e+=1;const n=[];for(let i=0;i<6;i++)n.push(a(this,Pe).getFloat64(e,!0)),e+=8;return n}get defaultVMetrics(){let e=a(re,Pu);if(a(this,Pe).getUint8(e)===0)return;e+=1;const n=[];for(let i=0;i<3;i++)n.push(a(this,Pe).getInt16(e,!0)),e+=2;return n}get fallbackName(){return x(this,ot,dd).call(this,0)}get loadedName(){return x(this,ot,dd).call(this,1)}get mimetype(){return x(this,ot,dd).call(this,2)}get name(){return x(this,ot,dd).call(this,3)}get data(){let e=a(re,Vn);const t=a(this,Pe).getUint32(e);e+=4+t;const n=a(this,Pe).getUint32(e);e+=4+n;const i=a(this,Pe).getUint32(e);e+=4+i;const r=a(this,Pe).getUint32(e);if(r!==0)return new Uint8Array(a(this,Pi),e+4,r)}clearData(){let e=a(re,Vn);const t=a(this,Pe).getUint32(e);e+=4+t;const n=a(this,Pe).getUint32(e);e+=4+n;const i=a(this,Pe).getUint32(e);e+=4+i;const r=a(this,Pe).getUint32(e);new Uint8Array(a(this,Pi),e+4,r).fill(0),a(this,Pe).setUint32(e,0)}get cssFontInfo(){let e=a(re,Vn);const t=a(this,Pe).getUint32(e);e+=4+t;const n=a(this,Pe).getUint32(e);e+=4+n;const i=a(this,Pe).getUint32(e);if(i===0)return null;const r=new Uint8Array(i);return r.set(new Uint8Array(a(this,Pi),e+4,i)),new py(r.buffer)}get systemFontInfo(){let e=a(re,Vn);const t=a(this,Pe).getUint32(e);e+=4+t;const n=a(this,Pe).getUint32(e);if(n===0)return null;const i=new Uint8Array(n);return i.set(new Uint8Array(a(this,Pi),e+4,n)),new gy(i.buffer)}static write(e){const t=e.systemFontInfo?gy.write(e.systemFontInfo):null,n=e.cssFontInfo?py.write(e.cssFontInfo):null,i=new TextEncoder,r={};let o=0;for(const _ of re.strings)r[_]=i.encode(e[_]),o+=4+r[_].length;const l=a(re,Vn)+4+o+4+(t?t.byteLength:0)+4+(n?n.byteLength:0)+4+(e.data?e.data.length:0),c=new ArrayBuffer(l),u=new Uint8Array(c),h=new DataView(c);let d=0;const f=re.bools.length;let p=0,y=0;for(let _=0;_<f;_++){const A=e[re.bools[_]];p|=(A===void 0?0:A?2:1)<<y,y+=2,(y===8||_===f-1)&&(h.setUint8(d++,p),p=0,y=0)}me(d===a(re,Cu),"FontInfo.write: Boolean properties offset mismatch");for(const _ of re.numbers)h.setFloat64(d,e[_]),d+=8;if(me(d===a(re,ku),"FontInfo.write: Number properties offset mismatch"),e.bbox){h.setUint8(d++,4);for(const _ of e.bbox)h.setInt16(d,_,!0),d+=2}else h.setUint8(d++,0),d+=2*4;if(me(d===a(re,Tu),"FontInfo.write: BBox properties offset mismatch"),e.fontMatrix){h.setUint8(d++,6);for(const _ of e.fontMatrix)h.setFloat64(d,_,!0),d+=8}else h.setUint8(d++,0),d+=8*6;if(me(d===a(re,Pu),"FontInfo.write: FontMatrix properties offset mismatch"),e.defaultVMetrics){h.setUint8(d++,1);for(const _ of e.defaultVMetrics)h.setInt16(d,_,!0),d+=2}else h.setUint8(d++,0),d+=3*2;me(d===a(re,Vn),"FontInfo.write: DefaultVMetrics properties offset mismatch"),h.setUint32(a(re,Vn),0),d+=4;for(const _ of re.strings){const A=r[_],m=A.length;h.setUint32(d,m),u.set(A,d+4),d+=4+m}if(h.setUint32(a(re,Vn),d-a(re,Vn)-4),!t)h.setUint32(d,0),d+=4;else{const _=t.byteLength;h.setUint32(d,_),me(d+4+_<=c.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),u.set(new Uint8Array(t),d+4),d+=4+_}if(!n)h.setUint32(d,0),d+=4;else{const _=n.byteLength;h.setUint32(d,_),me(d+4+_<=c.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),u.set(new Uint8Array(n),d+4),d+=4+_}return e.data===void 0?(h.setUint32(d,0),d+=4):(h.setUint32(d,e.data.length),u.set(e.data,d+4),d+=4+e.data.length),me(d<=c.byteLength,"FontInfo.write: Buffer overflow"),c.transferToFixedLength(d)}};Cu=new WeakMap,ku=new WeakMap,Tu=new WeakMap,Pu=new WeakMap,Vn=new WeakMap,Pi=new WeakMap,Ff=new WeakMap,Pe=new WeakMap,ot=new WeakSet,zs=function(e){me(e<re.bools.length,"Invalid boolean index");const t=Math.floor(e/4),n=e*2%8,i=a(this,Pe).getUint8(t)>>n&3;return i===0?void 0:i===2},dm=function(e){return me(e<re.numbers.length,"Invalid number index"),a(this,Pe).getFloat64(a(re,Cu)+e*8)},dd=function(e){me(e<re.strings.length,"Invalid string index");let t=a(re,Vn)+4;for(let r=0;r<e;r++)t+=a(this,Pe).getUint32(t)+4;const n=a(this,Pe).getUint32(t),i=new Uint8Array(n);return i.set(new Uint8Array(a(this,Pi),t+4,n)),a(this,Ff).decode(i)},B(re,"bools",["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"]),B(re,"numbers",["ascent","defaultWidth","descent"]),B(re,"strings",["fallbackName","loadedName","mimetype","name"]),w(re,Cu,Math.ceil(re.bools.length*2/8)),w(re,ku,a(re,Cu)+re.numbers.length*8),w(re,Tu,a(re,ku)+1+2*4),w(re,Pu,a(re,Tu)+1+8*6),w(re,Vn,a(re,Pu)+1+2*3);let jw=re;var jf,Bf,$f,Uf,zf,Hf,Vf,Wf;const je=class je{constructor(e){this.buffer=e,this.view=new DataView(e),this.data=new Uint8Array(e)}static write(e){let t,n=null,i=[],r=[],o=[],l=[],c=null,u=null;switch(e[0]){case"RadialAxial":t=e[1]==="axial"?1:2,n=e[2],o=e[3],t===1?i.push(...e[4],...e[5]):i.push(e[4][0],e[4][1],e[6],e[5][0],e[5][1],e[7]);break;case"Mesh":t=3,c=e[1],i=e[2],r=e[3],l=e[4]||[],n=e[6],u=e[7];break;default:throw new Error(`Unsupported pattern type: ${e[0]}`)}const h=Math.floor(i.length/2),d=Math.floor(r.length/3),f=o.length,p=l.length;let y=0;for(const C of l)y+=1,y=Math.ceil(y/4)*4,y+=4+C.coords.length*4,y+=4+C.colors.length*4,C.verticesPerRow!==void 0&&(y+=4);const _=20+h*8+d*3+f*8+(n?16:0)+(u?3:0)+y,A=new ArrayBuffer(_),m=new DataView(A),b=new Uint8Array(A);m.setUint8(a(je,jf),t),m.setUint8(a(je,Bf),n?1:0),m.setUint8(a(je,$f),u?1:0),m.setUint8(a(je,Uf),c),m.setUint32(a(je,zf),h,!0),m.setUint32(a(je,Hf),d,!0),m.setUint32(a(je,Vf),f,!0),m.setUint32(a(je,Wf),p,!0);let v=20;new Float32Array(A,v,h*2).set(i),v+=h*8,b.set(r,v),v+=d*3;for(const[C,k]of o)m.setFloat32(v,C,!0),v+=4,m.setUint32(v,parseInt(k.slice(1),16),!0),v+=4;if(n)for(const C of n)m.setFloat32(v,C,!0),v+=4;u&&(b.set(u,v),v+=3);for(let C=0;C<l.length;C++){const k=l[C];m.setUint8(v,k.type),v+=1,v=Math.ceil(v/4)*4,m.setUint32(v,k.coords.length,!0),v+=4,new Int32Array(A,v,k.coords.length).set(k.coords),v+=k.coords.length*4,m.setUint32(v,k.colors.length,!0),v+=4,new Int32Array(A,v,k.colors.length).set(k.colors),v+=k.colors.length*4,k.verticesPerRow!==void 0&&(m.setUint32(v,k.verticesPerRow,!0),v+=4)}return A}getIR(){const e=this.view,t=this.data[a(je,jf)],n=!!this.data[a(je,Bf)],i=!!this.data[a(je,$f)],r=e.getUint32(a(je,zf),!0),o=e.getUint32(a(je,Hf),!0),l=e.getUint32(a(je,Vf),!0),c=e.getUint32(a(je,Wf),!0);let u=20;const h=new Float32Array(this.buffer,u,r*2);u+=r*8;const d=new Uint8Array(this.buffer,u,o*3);u+=o*3;const f=[];for(let A=0;A<l;++A){const m=e.getFloat32(u,!0);u+=4;const b=e.getUint32(u,!0);u+=4,f.push([m,`#${b.toString(16).padStart(6,"0")}`])}let p=null;if(n){p=[];for(let A=0;A<4;++A)p.push(e.getFloat32(u,!0)),u+=4}let y=null;i&&(y=new Uint8Array(this.buffer,u,3),u+=3);const _=[];for(let A=0;A<c;++A){const m=e.getUint8(u);u+=1,u=Math.ceil(u/4)*4;const b=e.getUint32(u,!0);u+=4;const v=new Int32Array(this.buffer,u,b);u+=b*4;const S=e.getUint32(u,!0);u+=4;const C=new Int32Array(this.buffer,u,S);u+=S*4;const k={type:m,coords:v,colors:C};m===mw.LATTICE&&(k.verticesPerRow=e.getUint32(u,!0),u+=4),_.push(k)}if(t===1)return["RadialAxial","axial",p,f,Array.from(h.slice(0,2)),Array.from(h.slice(2,4)),null,null];if(t===2)return["RadialAxial","radial",p,f,[h[0],h[1]],[h[3],h[4]],h[2],h[5]];if(t===3){const A=this.data[a(je,Uf)];let m=null;if(h.length>0){let b=h[0],v=h[0],S=h[1],C=h[1];for(let k=0;k<h.length;k+=2){const T=h[k],I=h[k+1];b=b>T?T:b,S=S>I?I:S,v=v<T?T:v,C=C<I?I:C}m=[b,S,v,C]}return["Mesh",A,h,d,_,m,p,y]}throw new Error(`Unsupported pattern kind: ${t}`)}};jf=new WeakMap,Bf=new WeakMap,$f=new WeakMap,Uf=new WeakMap,zf=new WeakMap,Hf=new WeakMap,Vf=new WeakMap,Wf=new WeakMap,w(je,jf,0),w(je,Bf,1),w(je,$f,2),w(je,Uf,3),w(je,zf,4),w(je,Hf,8),w(je,Vf,12),w(je,Wf,16);let Bw=je;function fD(s){if(s instanceof URL)return s.href;if(typeof s=="string"){if(gn)return s;const e=URL.parse(s,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function pD(s){if(gn&&typeof Buffer<"u"&&s instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(s instanceof Uint8Array&&s.byteLength===s.buffer.byteLength)return s;if(typeof s=="string")return og(s);if(s instanceof ArrayBuffer||ArrayBuffer.isView(s)||typeof s=="object"&&!isNaN(s==null?void 0:s.length))return new Uint8Array(s);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Lg(s){if(typeof s!="string")return null;if(s.endsWith("/"))return s;throw new Error(`Invalid factory url: "${s}" must include trailing slash.`)}const $w=s=>typeof s=="object"&&Number.isInteger(s==null?void 0:s.num)&&s.num>=0&&Number.isInteger(s==null?void 0:s.gen)&&s.gen>=0,gD=s=>typeof s=="object"&&typeof(s==null?void 0:s.name)=="string",mD=YI.bind(null,$w,gD);var fr,Ry;class yD{constructor(){w(this,fr,new Map);w(this,Ry,Promise.resolve())}postMessage(e,t){const n={data:structuredClone(e,t?{transfer:t}:null)};a(this,Ry).then(()=>{for(const[i]of a(this,fr))i.call(this,n)})}addEventListener(e,t,n=null){let i=null;if((n==null?void 0:n.signal)instanceof AbortSignal){const{signal:r}=n;if(r.aborted){ne("LoopbackPort - cannot use an `aborted` signal.");return}const o=()=>this.removeEventListener(e,t);i=()=>r.removeEventListener("abort",o),r.addEventListener("abort",o)}a(this,fr).set(t,i)}removeEventListener(e,t){const n=a(this,fr).get(t);n==null||n(),a(this,fr).delete(t)}terminate(){for(const[,e]of a(this,fr))e==null||e();a(this,fr).clear()}}fr=new WeakMap,Ry=new WeakMap;const Mg={DATA:1,ERROR:2},dt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function GA(){}function Sn(s){if(s instanceof ha||s instanceof yw||s instanceof jA||s instanceof uy||s instanceof Q0)return s;switch(s instanceof Error||typeof s=="object"&&s!==null||Me('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),s.name){case"AbortException":return new ha(s.message);case"InvalidPDFException":return new yw(s.message);case"PasswordException":return new jA(s.message,s.code);case"ResponseException":return new uy(s.message,s.status,s.missing);case"UnknownErrorException":return new Q0(s.message,s.details)}return new Q0(s.message,s.toString())}var Ru,Os,GC,qC,KC,fm;class fd{constructor(e,t,n){w(this,Os);w(this,Ru,new AbortController);this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),n.addEventListener("message",x(this,Os,GC).bind(this),{signal:a(this,Ru).signal})}on(e,t){const n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){const i=this.callbackId++,r=Promise.withResolvers();this.callbackCapabilities[i]=r;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:i,data:t},n)}catch(o){r.reject(o)}return r.promise}sendWithStream(e,t,n,i){const r=this.streamId++,o=this.sourceName,l=this.targetName,c=this.comObj;return new ReadableStream({start:u=>{const h=Promise.withResolvers();return this.streamControllers[r]={controller:u,startCall:h,pullCall:null,cancelCall:null,isClosed:!1},c.postMessage({sourceName:o,targetName:l,action:e,streamId:r,data:t,desiredSize:u.desiredSize},i),h.promise},pull:u=>{const h=Promise.withResolvers();return this.streamControllers[r].pullCall=h,c.postMessage({sourceName:o,targetName:l,stream:dt.PULL,streamId:r,desiredSize:u.desiredSize}),h.promise},cancel:u=>{me(u instanceof Error,"cancel must have a valid reason");const h=Promise.withResolvers();return this.streamControllers[r].cancelCall=h,this.streamControllers[r].isClosed=!0,c.postMessage({sourceName:o,targetName:l,stream:dt.CANCEL,streamId:r,reason:Sn(u)}),h.promise}},n)}destroy(){var e;(e=a(this,Ru))==null||e.abort(),g(this,Ru,null)}}Ru=new WeakMap,Os=new WeakSet,GC=function({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){x(this,Os,KC).call(this,e);return}if(e.callback){const n=e.callbackId,i=this.callbackCapabilities[n];if(!i)throw new Error(`Cannot resolve callback ${n}`);if(delete this.callbackCapabilities[n],e.callback===Mg.DATA)i.resolve(e.data);else if(e.callback===Mg.ERROR)i.reject(Sn(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const n=this.sourceName,i=e.sourceName,r=this.comObj;Promise.try(t,e.data).then(function(o){r.postMessage({sourceName:n,targetName:i,callback:Mg.DATA,callbackId:e.callbackId,data:o})},function(o){r.postMessage({sourceName:n,targetName:i,callback:Mg.ERROR,callbackId:e.callbackId,reason:Sn(o)})});return}if(e.streamId){x(this,Os,qC).call(this,e);return}t(e.data)},qC=function(e){const t=e.streamId,n=this.sourceName,i=e.sourceName,r=this.comObj,o=this,l=this.actionHandler[e.action],c={enqueue(u,h=1,d){if(this.isCancelled)return;const f=this.desiredSize;this.desiredSize-=h,f>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),r.postMessage({sourceName:n,targetName:i,stream:dt.ENQUEUE,streamId:t,chunk:u},d)},close(){this.isCancelled||(this.isCancelled=!0,r.postMessage({sourceName:n,targetName:i,stream:dt.CLOSE,streamId:t}),delete o.streamSinks[t])},error(u){me(u instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,r.postMessage({sourceName:n,targetName:i,stream:dt.ERROR,streamId:t,reason:Sn(u)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};c.sinkCapability.resolve(),c.ready=c.sinkCapability.promise,this.streamSinks[t]=c,Promise.try(l,e.data,c).then(function(){r.postMessage({sourceName:n,targetName:i,stream:dt.START_COMPLETE,streamId:t,success:!0})},function(u){r.postMessage({sourceName:n,targetName:i,stream:dt.START_COMPLETE,streamId:t,reason:Sn(u)})})},KC=function(e){const t=e.streamId,n=this.sourceName,i=e.sourceName,r=this.comObj,o=this.streamControllers[t],l=this.streamSinks[t];switch(e.stream){case dt.START_COMPLETE:e.success?o.startCall.resolve():o.startCall.reject(Sn(e.reason));break;case dt.PULL_COMPLETE:e.success?o.pullCall.resolve():o.pullCall.reject(Sn(e.reason));break;case dt.PULL:if(!l){r.postMessage({sourceName:n,targetName:i,stream:dt.PULL_COMPLETE,streamId:t,success:!0});break}l.desiredSize<=0&&e.desiredSize>0&&l.sinkCapability.resolve(),l.desiredSize=e.desiredSize,Promise.try(l.onPull||GA).then(function(){r.postMessage({sourceName:n,targetName:i,stream:dt.PULL_COMPLETE,streamId:t,success:!0})},function(u){r.postMessage({sourceName:n,targetName:i,stream:dt.PULL_COMPLETE,streamId:t,reason:Sn(u)})});break;case dt.ENQUEUE:if(me(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(e.chunk);break;case dt.CLOSE:if(me(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),x(this,Os,fm).call(this,o,t);break;case dt.ERROR:me(o,"error should have stream controller"),o.controller.error(Sn(e.reason)),x(this,Os,fm).call(this,o,t);break;case dt.CANCEL_COMPLETE:e.success?o.cancelCall.resolve():o.cancelCall.reject(Sn(e.reason)),x(this,Os,fm).call(this,o,t);break;case dt.CANCEL:if(!l)break;const c=Sn(e.reason);Promise.try(l.onCancel||GA,c).then(function(){r.postMessage({sourceName:n,targetName:i,stream:dt.CANCEL_COMPLETE,streamId:t,success:!0})},function(u){r.postMessage({sourceName:n,targetName:i,stream:dt.CANCEL_COMPLETE,streamId:t,reason:Sn(u)})}),l.sinkCapability.reject(c),l.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},fm=async function(e,t){var n,i,r;await Promise.allSettled([(n=e.startCall)==null?void 0:n.promise,(i=e.pullCall)==null?void 0:i.promise,(r=e.cancelCall)==null?void 0:r.promise]),delete this.streamControllers[t]};var Gf;class XC{constructor({enableHWA:e=!1}){w(this,Gf,!1);g(this,Gf,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!a(this,Gf)})}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){Me("Abstract method `_createCanvas` called.")}}Gf=new WeakMap;class vD extends XC{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const n=this._document.createElement("canvas");return n.width=e,n.height=t,n}}class YC{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(n=>({cMapData:n,isCompressed:this.isCompressed})).catch(n=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){Me("Abstract method `_fetch` called.")}}class qA extends YC{async _fetch(e){const t=await ag(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):og(t)}}class JC{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,n,i,r){return"none"}destroy(e=!1){}}var rl,Nu,pr,gr,nn,ol,al,V,Qt,pd,Ac,pm,Sc,QC,Uw,Ec,gd,md,zw,yd;class wD extends JC{constructor({docId:t,ownerDocument:n=globalThis.document}){super();w(this,V);w(this,rl);w(this,Nu);w(this,pr);w(this,gr);w(this,nn);w(this,ol);w(this,al,0);g(this,gr,t),g(this,nn,n)}addFilter(t){if(!t)return"none";let n=a(this,V,Qt).get(t);if(n)return n;const[i,r,o]=x(this,V,pm).call(this,t),l=t.length===1?i:`${i}${r}${o}`;if(n=a(this,V,Qt).get(l),n)return a(this,V,Qt).set(t,n),n;const c=`g_${a(this,gr)}_transfer_map_${yt(this,al)._++}`,u=x(this,V,Sc).call(this,c);a(this,V,Qt).set(t,u),a(this,V,Qt).set(l,u);const h=x(this,V,Ec).call(this,c);return x(this,V,md).call(this,i,r,o,h),u}addHCMFilter(t,n){var y;const i=`${t}-${n}`,r="base";let o=a(this,V,pd).get(r);if((o==null?void 0:o.key)===i||(o?((y=o.filter)==null||y.remove(),o.key=i,o.url="none",o.filter=null):(o={key:i,url:"none",filter:null},a(this,V,pd).set(r,o)),!t||!n))return o.url;const l=x(this,V,yd).call(this,t);t=K.makeHexColor(...l);const c=x(this,V,yd).call(this,n);if(n=K.makeHexColor(...c),a(this,V,Ac).style.color="",t==="#000000"&&n==="#ffffff"||t===n)return o.url;const u=new Array(256);for(let _=0;_<=255;_++){const A=_/255;u[_]=A<=.03928?A/12.92:((A+.055)/1.055)**2.4}const h=u.join(","),d=`g_${a(this,gr)}_hcm_filter`,f=o.filter=x(this,V,Ec).call(this,d);x(this,V,md).call(this,h,h,h,f),x(this,V,Uw).call(this,f);const p=(_,A)=>{const m=l[_]/255,b=c[_]/255,v=new Array(A+1);for(let S=0;S<=A;S++)v[S]=m+S/A*(b-m);return v.join(",")};return x(this,V,md).call(this,p(0,5),p(1,5),p(2,5),f),o.url=x(this,V,Sc).call(this,d),o.url}addAlphaFilter(t){let n=a(this,V,Qt).get(t);if(n)return n;const[i]=x(this,V,pm).call(this,[t]),r=`alpha_${i}`;if(n=a(this,V,Qt).get(r),n)return a(this,V,Qt).set(t,n),n;const o=`g_${a(this,gr)}_alpha_map_${yt(this,al)._++}`,l=x(this,V,Sc).call(this,o);a(this,V,Qt).set(t,l),a(this,V,Qt).set(r,l);const c=x(this,V,Ec).call(this,o);return x(this,V,zw).call(this,i,c),l}addLuminosityFilter(t){let n=a(this,V,Qt).get(t||"luminosity");if(n)return n;let i,r;if(t?([i]=x(this,V,pm).call(this,[t]),r=`luminosity_${i}`):r="luminosity",n=a(this,V,Qt).get(r),n)return a(this,V,Qt).set(t,n),n;const o=`g_${a(this,gr)}_luminosity_map_${yt(this,al)._++}`,l=x(this,V,Sc).call(this,o);a(this,V,Qt).set(t,l),a(this,V,Qt).set(r,l);const c=x(this,V,Ec).call(this,o);return x(this,V,QC).call(this,c),t&&x(this,V,zw).call(this,i,c),l}addHighlightHCMFilter(t,n,i,r,o){var b;const l=`${n}-${i}-${r}-${o}`;let c=a(this,V,pd).get(t);if((c==null?void 0:c.key)===l||(c?((b=c.filter)==null||b.remove(),c.key=l,c.url="none",c.filter=null):(c={key:l,url:"none",filter:null},a(this,V,pd).set(t,c)),!n||!i))return c.url;const[u,h]=[n,i].map(x(this,V,yd).bind(this));let d=Math.round(.2126*u[0]+.7152*u[1]+.0722*u[2]),f=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),[p,y]=[r,o].map(x(this,V,yd).bind(this));f<d&&([d,f,p,y]=[f,d,y,p]),a(this,V,Ac).style.color="";const _=(v,S,C)=>{const k=new Array(256),T=(f-d)/C,I=v/255,O=(S-v)/(255*C);let L=0;for(let j=0;j<=C;j++){const H=Math.round(d+j*T),J=I+j*O;for(let Y=L;Y<=H;Y++)k[Y]=J;L=H+1}for(let j=L;j<256;j++)k[j]=k[L-1];return k.join(",")},A=`g_${a(this,gr)}_hcm_${t}_filter`,m=c.filter=x(this,V,Ec).call(this,A);return x(this,V,Uw).call(this,m),x(this,V,md).call(this,_(p[0],y[0],5),_(p[1],y[1],5),_(p[2],y[2],5),m),c.url=x(this,V,Sc).call(this,A),c.url}destroy(t=!1){var n,i,r,o;t&&((n=a(this,ol))!=null&&n.size)||((i=a(this,pr))==null||i.parentNode.parentNode.remove(),g(this,pr,null),(r=a(this,Nu))==null||r.clear(),g(this,Nu,null),(o=a(this,ol))==null||o.clear(),g(this,ol,null),g(this,al,0))}}rl=new WeakMap,Nu=new WeakMap,pr=new WeakMap,gr=new WeakMap,nn=new WeakMap,ol=new WeakMap,al=new WeakMap,V=new WeakSet,Qt=function(){return a(this,Nu)||g(this,Nu,new Map)},pd=function(){return a(this,ol)||g(this,ol,new Map)},Ac=function(){if(!a(this,pr)){const t=a(this,nn).createElement("div"),{style:n}=t;n.visibility="hidden",n.contain="strict",n.width=n.height=0,n.position="absolute",n.top=n.left=0,n.zIndex=-1;const i=a(this,nn).createElementNS(Ki,"svg");i.setAttribute("width",0),i.setAttribute("height",0),g(this,pr,a(this,nn).createElementNS(Ki,"defs")),t.append(i),i.append(a(this,pr)),a(this,nn).body.append(t)}return a(this,pr)},pm=function(t){if(t.length===1){const u=t[0],h=new Array(256);for(let f=0;f<256;f++)h[f]=u[f]/255;const d=h.join(",");return[d,d,d]}const[n,i,r]=t,o=new Array(256),l=new Array(256),c=new Array(256);for(let u=0;u<256;u++)o[u]=n[u]/255,l[u]=i[u]/255,c[u]=r[u]/255;return[o.join(","),l.join(","),c.join(",")]},Sc=function(t){if(a(this,rl)===void 0){g(this,rl,"");const n=a(this,nn).URL;n!==a(this,nn).baseURI&&(d0(n)?ne('#createUrl: ignore "data:"-URL for performance reasons.'):g(this,rl,rC(n,"")))}return`url(${a(this,rl)}#${t})`},QC=function(t){const n=a(this,nn).createElementNS(Ki,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(n)},Uw=function(t){const n=a(this,nn).createElementNS(Ki,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(n)},Ec=function(t){const n=a(this,nn).createElementNS(Ki,"filter");return n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("id",t),a(this,V,Ac).append(n),n},gd=function(t,n,i){const r=a(this,nn).createElementNS(Ki,n);r.setAttribute("type","discrete"),r.setAttribute("tableValues",i),t.append(r)},md=function(t,n,i,r){const o=a(this,nn).createElementNS(Ki,"feComponentTransfer");r.append(o),x(this,V,gd).call(this,o,"feFuncR",t),x(this,V,gd).call(this,o,"feFuncG",n),x(this,V,gd).call(this,o,"feFuncB",i)},zw=function(t,n){const i=a(this,nn).createElementNS(Ki,"feComponentTransfer");n.append(i),x(this,V,gd).call(this,i,"feFuncA",t)},yd=function(t){return a(this,V,Ac).style.color=t,cg(getComputedStyle(a(this,V,Ac)).getPropertyValue("color"))};class ZC{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){Me("Abstract method `_fetch` called.")}}class KA extends ZC{async _fetch(e){const t=await ag(e,"arraybuffer");return new Uint8Array(t)}}class ek{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(n=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){Me("Abstract method `_fetch` called.")}}class XA extends ek{async _fetch(e){const t=await ag(e,"arraybuffer");return new Uint8Array(t)}}gn&&ne("Please use the `legacy` build in Node.js environments.");async function K_(s){const t=await process.getBuiltinModule("fs").promises.readFile(s);return new Uint8Array(t)}class bD extends JC{}class _D extends XC{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class xD extends YC{async _fetch(e){return K_(e)}}class AD extends ZC{async _fetch(e){return K_(e)}}class SD extends ek{async _fetch(e){return K_(e)}}const yc="__forcedDependency",{floor:YA,ceil:JA}=Math;function Fg(s,e,t,n,i,r){s[e*4+0]=Math.min(s[e*4+0],t),s[e*4+1]=Math.min(s[e*4+1],n),s[e*4+2]=Math.max(s[e*4+2],i),s[e*4+3]=Math.max(s[e*4+3],r)}const Hw=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];var Iu,ko;class ED{constructor(e,t){w(this,Iu);w(this,ko);g(this,Iu,e),g(this,ko,t)}get length(){return a(this,Iu).length}isEmpty(e){return a(this,Iu)[e]===Hw}minX(e){return a(this,ko)[e*4+0]/256}minY(e){return a(this,ko)[e*4+1]/256}maxX(e){return(a(this,ko)[e*4+2]+1)/256}maxY(e){return(a(this,ko)[e*4+3]+1)/256}}Iu=new WeakMap,ko=new WeakMap;const jg=(s,e)=>{if(!s)return;let t=s.get(e);return t||(t={dependencies:new Set,isRenderingOperation:!1},s.set(e,t)),t};var kn,Tn,ll,Ks,cl,mr,Ee,Re,yr,Pn,qf,Du,ul,hl,vr,sn,Ri,Kf,Vw;class CD{constructor(e,t,n=!1){w(this,Kf);w(this,kn,{__proto__:null});w(this,Tn,{__proto__:null,transform:[],moveText:[],sameLineText:[],[yc]:[]});w(this,ll,new Map);w(this,Ks,[]);w(this,cl,[]);w(this,mr,[[1,0,0,1,0,0]]);w(this,Ee,[-1/0,-1/0,1/0,1/0]);w(this,Re,new Float64Array([1/0,1/0,-1/0,-1/0]));w(this,yr,-1);w(this,Pn,new Set);w(this,qf,new Map);w(this,Du,new Map);w(this,ul);w(this,hl);w(this,vr);w(this,sn);w(this,Ri);g(this,ul,e.width),g(this,hl,e.height),x(this,Kf,Vw).call(this,t),n&&g(this,Ri,new Map)}growOperationsCount(e){e>=a(this,sn).length&&x(this,Kf,Vw).call(this,e,a(this,sn))}save(e){return g(this,kn,{__proto__:a(this,kn)}),g(this,Tn,{__proto__:a(this,Tn),transform:{__proto__:a(this,Tn).transform},moveText:{__proto__:a(this,Tn).moveText},sameLineText:{__proto__:a(this,Tn).sameLineText},[yc]:{__proto__:a(this,Tn)[yc]}}),g(this,Ee,{__proto__:a(this,Ee)}),a(this,Ks).push(e),this}restore(e){var i;const t=Object.getPrototypeOf(a(this,kn));if(t===null)return this;g(this,kn,t),g(this,Tn,Object.getPrototypeOf(a(this,Tn))),g(this,Ee,Object.getPrototypeOf(a(this,Ee)));const n=a(this,Ks).pop();return n!==void 0&&((i=jg(a(this,Ri),e))==null||i.dependencies.add(n),a(this,sn)[e]=a(this,sn)[n]),this}recordOpenMarker(e){return a(this,Ks).push(e),this}getOpenMarker(){return a(this,Ks).length===0?null:a(this,Ks).at(-1)}recordCloseMarker(e){var n;const t=a(this,Ks).pop();return t!==void 0&&((n=jg(a(this,Ri),e))==null||n.dependencies.add(t),a(this,sn)[e]=a(this,sn)[t]),this}beginMarkedContent(e){return a(this,cl).push(e),this}endMarkedContent(e){var n;const t=a(this,cl).pop();return t!==void 0&&((n=jg(a(this,Ri),e))==null||n.dependencies.add(t),a(this,sn)[e]=a(this,sn)[t]),this}pushBaseTransform(e){return a(this,mr).push(K.multiplyByDOMMatrix(a(this,mr).at(-1),e.getTransform())),this}popBaseTransform(){return a(this,mr).length>1&&a(this,mr).pop(),this}recordSimpleData(e,t){return a(this,kn)[e]=t,this}recordIncrementalData(e,t){return a(this,Tn)[e].push(t),this}resetIncrementalData(e,t){return a(this,Tn)[e].length=0,this}recordNamedData(e,t){return a(this,ll).set(e,t),this}recordSimpleDataFromNamed(e,t,n){a(this,kn)[e]=a(this,ll).get(t)??n}recordFutureForcedDependency(e,t){return this.recordIncrementalData(yc,t),this}inheritSimpleDataAsFutureForcedDependencies(e){for(const t of e)t in a(this,kn)&&this.recordFutureForcedDependency(t,a(this,kn)[t]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const e of a(this,Pn))this.recordFutureForcedDependency(yc,e);return this}resetBBox(e){return a(this,yr)!==e&&(g(this,yr,e),a(this,Re)[0]=1/0,a(this,Re)[1]=1/0,a(this,Re)[2]=-1/0,a(this,Re)[3]=-1/0),this}recordClipBox(e,t,n,i,r,o){const l=K.multiplyByDOMMatrix(a(this,mr).at(-1),t.getTransform()),c=[1/0,1/0,-1/0,-1/0];K.axialAlignedBoundingBox([n,r,i,o],l,c);const u=K.intersect(a(this,Ee),c);return u?(a(this,Ee)[0]=u[0],a(this,Ee)[1]=u[1],a(this,Ee)[2]=u[2],a(this,Ee)[3]=u[3]):(a(this,Ee)[0]=a(this,Ee)[1]=1/0,a(this,Ee)[2]=a(this,Ee)[3]=-1/0),this}recordBBox(e,t,n,i,r,o){const l=a(this,Ee);if(l[0]===1/0)return this;const c=K.multiplyByDOMMatrix(a(this,mr).at(-1),t.getTransform());if(l[0]===-1/0)return K.axialAlignedBoundingBox([n,r,i,o],c,a(this,Re)),this;const u=[1/0,1/0,-1/0,-1/0];return K.axialAlignedBoundingBox([n,r,i,o],c,u),a(this,Re)[0]=Math.min(a(this,Re)[0],Math.max(u[0],l[0])),a(this,Re)[1]=Math.min(a(this,Re)[1],Math.max(u[1],l[1])),a(this,Re)[2]=Math.max(a(this,Re)[2],Math.min(u[2],l[2])),a(this,Re)[3]=Math.max(a(this,Re)[3],Math.min(u[3],l[3])),this}recordCharacterBBox(e,t,n,i=1,r=0,o=0,l){const c=n.bbox;let u,h;if(c&&(u=c[2]!==c[0]&&c[3]!==c[1]&&a(this,Du).get(n),u!==!1&&(h=[0,0,0,0],K.axialAlignedBoundingBox(c,n.fontMatrix,h),(i!==1||r!==0||o!==0)&&K.scaleMinMax([i,0,0,-i,r,o],h),u)))return this.recordBBox(e,t,h[0],h[2],h[1],h[3]);if(!l)return this.recordFullPageBBox(e);const d=l();return c&&h&&u===void 0&&(u=h[0]<=r-d.actualBoundingBoxLeft&&h[2]>=r+d.actualBoundingBoxRight&&h[1]<=o-d.actualBoundingBoxAscent&&h[3]>=o+d.actualBoundingBoxDescent,a(this,Du).set(n,u),u)?this.recordBBox(e,t,h[0],h[2],h[1],h[3]):this.recordBBox(e,t,r-d.actualBoundingBoxLeft,r+d.actualBoundingBoxRight,o-d.actualBoundingBoxAscent,o+d.actualBoundingBoxDescent)}recordFullPageBBox(e){return a(this,Re)[0]=Math.max(0,a(this,Ee)[0]),a(this,Re)[1]=Math.max(0,a(this,Ee)[1]),a(this,Re)[2]=Math.min(a(this,ul),a(this,Ee)[2]),a(this,Re)[3]=Math.min(a(this,hl),a(this,Ee)[3]),this}getSimpleIndex(e){return a(this,kn)[e]}recordDependencies(e,t){const n=a(this,Pn),i=a(this,kn),r=a(this,Tn);for(const o of t)o in a(this,kn)?n.add(i[o]):o in r&&r[o].forEach(n.add,n);return this}recordNamedDependency(e,t){return a(this,ll).has(t)&&a(this,Pn).add(a(this,ll).get(t)),this}recordOperation(e,t=!1){if(this.recordDependencies(e,[yc]),a(this,Ri)){const n=jg(a(this,Ri),e),{dependencies:i}=n;a(this,Pn).forEach(i.add,i),a(this,Ks).forEach(i.add,i),a(this,cl).forEach(i.add,i),i.delete(e),n.isRenderingOperation=!0}if(a(this,yr)===e){const n=YA(a(this,Re)[0]*256/a(this,ul)),i=YA(a(this,Re)[1]*256/a(this,hl)),r=JA(a(this,Re)[2]*256/a(this,ul)),o=JA(a(this,Re)[3]*256/a(this,hl));Fg(a(this,vr),e,n,i,r,o);for(const l of a(this,Pn))l!==e&&Fg(a(this,vr),l,n,i,r,o);for(const l of a(this,Ks))l!==e&&Fg(a(this,vr),l,n,i,r,o);for(const l of a(this,cl))l!==e&&Fg(a(this,vr),l,n,i,r,o);t||(a(this,Pn).clear(),g(this,yr,-1))}return this}recordShowTextOperation(e,t=!1){const n=Array.from(a(this,Pn));this.recordOperation(e,t),this.recordIncrementalData("sameLineText",e);for(const i of n)this.recordIncrementalData("sameLineText",i);return this}bboxToClipBoxDropOperation(e,t=!1){return a(this,yr)===e&&(g(this,yr,-1),a(this,Ee)[0]=Math.max(a(this,Ee)[0],a(this,Re)[0]),a(this,Ee)[1]=Math.max(a(this,Ee)[1],a(this,Re)[1]),a(this,Ee)[2]=Math.min(a(this,Ee)[2],a(this,Re)[2]),a(this,Ee)[3]=Math.min(a(this,Ee)[3],a(this,Re)[3]),t||a(this,Pn).clear()),this}_takePendingDependencies(){const e=a(this,Pn);return g(this,Pn,new Set),e}_extractOperation(e){const t=a(this,qf).get(e);return a(this,qf).delete(e),t}_pushPendingDependencies(e){for(const t of e)a(this,Pn).add(t)}take(){return a(this,Du).clear(),new ED(a(this,sn),a(this,vr))}takeDebugMetadata(){return a(this,Ri)}}kn=new WeakMap,Tn=new WeakMap,ll=new WeakMap,Ks=new WeakMap,cl=new WeakMap,mr=new WeakMap,Ee=new WeakMap,Re=new WeakMap,yr=new WeakMap,Pn=new WeakMap,qf=new WeakMap,Du=new WeakMap,ul=new WeakMap,hl=new WeakMap,vr=new WeakMap,sn=new WeakMap,Ri=new WeakMap,Kf=new WeakSet,Vw=function(e,t){const n=new ArrayBuffer(e*4);g(this,vr,new Uint8ClampedArray(n)),g(this,sn,new Uint32Array(n)),t&&t.length>0?(a(this,sn).set(t),a(this,sn).fill(Hw,t.length)):a(this,sn).fill(Hw)};var Oe,st,Xs,Ou,Lu;const rx=class rx{constructor(e,t,n){w(this,Oe);w(this,st);w(this,Xs);w(this,Ou,0);w(this,Lu,0);if(e instanceof rx&&a(e,Xs)===!!n)return e;g(this,Oe,e),g(this,st,t),g(this,Xs,!!n)}growOperationsCount(){throw new Error("Unreachable")}save(e){return yt(this,Lu)._++,a(this,Oe).save(a(this,st)),this}restore(e){return a(this,Lu)>0&&(a(this,Oe).restore(a(this,st)),yt(this,Lu)._--),this}recordOpenMarker(e){return yt(this,Ou)._++,this}getOpenMarker(){return a(this,Ou)>0?a(this,st):a(this,Oe).getOpenMarker()}recordCloseMarker(e){return yt(this,Ou)._--,this}beginMarkedContent(e){return this}endMarkedContent(e){return this}pushBaseTransform(e){return a(this,Oe).pushBaseTransform(e),this}popBaseTransform(){return a(this,Oe).popBaseTransform(),this}recordSimpleData(e,t){return a(this,Oe).recordSimpleData(e,a(this,st)),this}recordIncrementalData(e,t){return a(this,Oe).recordIncrementalData(e,a(this,st)),this}resetIncrementalData(e,t){return a(this,Oe).resetIncrementalData(e,a(this,st)),this}recordNamedData(e,t){return this}recordSimpleDataFromNamed(e,t,n){return a(this,Oe).recordSimpleDataFromNamed(e,t,a(this,st)),this}recordFutureForcedDependency(e,t){return a(this,Oe).recordFutureForcedDependency(e,a(this,st)),this}inheritSimpleDataAsFutureForcedDependencies(e){return a(this,Oe).inheritSimpleDataAsFutureForcedDependencies(e),this}inheritPendingDependenciesAsFutureForcedDependencies(){return a(this,Oe).inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(e){return a(this,Xs)||a(this,Oe).resetBBox(a(this,st)),this}recordClipBox(e,t,n,i,r,o){return a(this,Xs)||a(this,Oe).recordClipBox(a(this,st),t,n,i,r,o),this}recordBBox(e,t,n,i,r,o){return a(this,Xs)||a(this,Oe).recordBBox(a(this,st),t,n,i,r,o),this}recordCharacterBBox(e,t,n,i,r,o,l){return a(this,Xs)||a(this,Oe).recordCharacterBBox(a(this,st),t,n,i,r,o,l),this}recordFullPageBBox(e){return a(this,Xs)||a(this,Oe).recordFullPageBBox(a(this,st)),this}getSimpleIndex(e){return a(this,Oe).getSimpleIndex(e)}recordDependencies(e,t){return a(this,Oe).recordDependencies(a(this,st),t),this}recordNamedDependency(e,t){return a(this,Oe).recordNamedDependency(a(this,st),t),this}recordOperation(e){return a(this,Oe).recordOperation(a(this,st),!0),this}recordShowTextOperation(e){return a(this,Oe).recordShowTextOperation(a(this,st),!0),this}bboxToClipBoxDropOperation(e){return a(this,Xs)||a(this,Oe).bboxToClipBoxDropOperation(a(this,st),!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}};Oe=new WeakMap,st=new WeakMap,Xs=new WeakMap,Ou=new WeakMap,Lu=new WeakMap;let my=rx;const ms={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},Vt={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function Ww(s,e){if(!e)return;const t=e[2]-e[0],n=e[3]-e[1],i=new Path2D;i.rect(e[0],e[1],t,n),s.clip(i)}class X_{isModifyingCurrentTransform(){return!1}getPattern(){Me("Abstract method `getPattern` called.")}}class kD extends X_{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const n of this._colorStops)t.addColorStop(n[0],n[1]);return t}getPattern(e,t,n,i){let r;if(i===Vt.STROKE||i===Vt.FILL){const o=t.current.getClippedPathBoundingBox(i,Je(e))||[0,0,0,0],l=Math.ceil(o[2]-o[0])||1,c=Math.ceil(o[3]-o[1])||1,u=t.cachedCanvases.getCanvas("pattern",l,c),h=u.context;h.clearRect(0,0,h.canvas.width,h.canvas.height),h.beginPath(),h.rect(0,0,h.canvas.width,h.canvas.height),h.translate(-o[0],-o[1]),n=K.transform(n,[1,0,0,1,o[0],o[1]]),h.transform(...t.baseTransform),this.matrix&&h.transform(...this.matrix),Ww(h,this._bbox),h.fillStyle=this._createGradient(h),h.fill(),r=e.createPattern(u.canvas,"no-repeat");const d=new DOMMatrix(n);r.setTransform(d)}else Ww(e,this._bbox),r=this._createGradient(e);return r}}function tv(s,e,t,n,i,r,o,l){const c=e.coords,u=e.colors,h=s.data,d=s.width*4;let f;c[t+1]>c[n+1]&&(f=t,t=n,n=f,f=r,r=o,o=f),c[n+1]>c[i+1]&&(f=n,n=i,i=f,f=o,o=l,l=f),c[t+1]>c[n+1]&&(f=t,t=n,n=f,f=r,r=o,o=f);const p=(c[t]+e.offsetX)*e.scaleX,y=(c[t+1]+e.offsetY)*e.scaleY,_=(c[n]+e.offsetX)*e.scaleX,A=(c[n+1]+e.offsetY)*e.scaleY,m=(c[i]+e.offsetX)*e.scaleX,b=(c[i+1]+e.offsetY)*e.scaleY;if(y>=b)return;const v=u[r],S=u[r+1],C=u[r+2],k=u[o],T=u[o+1],I=u[o+2],O=u[l],L=u[l+1],j=u[l+2],H=Math.round(y),J=Math.round(b);let Y,te,G,M,P,R,N,D;for(let F=H;F<=J;F++){if(F<A){const ue=F<y?0:(y-F)/(y-A);Y=p-(p-_)*ue,te=v-(v-k)*ue,G=S-(S-T)*ue,M=C-(C-I)*ue}else{let ue;F>b?ue=1:A===b?ue=0:ue=(A-F)/(A-b),Y=_-(_-m)*ue,te=k-(k-O)*ue,G=T-(T-L)*ue,M=I-(I-j)*ue}let U;F<y?U=0:F>b?U=1:U=(y-F)/(y-b),P=p-(p-m)*U,R=v-(v-O)*U,N=S-(S-L)*U,D=C-(C-j)*U;const Z=Math.round(Math.min(Y,P)),be=Math.round(Math.max(Y,P));let _e=d*F+Z*4;for(let ue=Z;ue<=be;ue++)U=(Y-ue)/(Y-P),U<0?U=0:U>1&&(U=1),h[_e++]=te-(te-R)*U|0,h[_e++]=G-(G-N)*U|0,h[_e++]=M-(M-D)*U|0,h[_e++]=255}}function TD(s,e,t){const n=e.coords,i=e.colors;let r,o;switch(e.type){case mw.LATTICE:const l=e.verticesPerRow,c=Math.floor(n.length/l)-1,u=l-1;for(r=0;r<c;r++){let h=r*l;for(let d=0;d<u;d++,h++)tv(s,t,n[h],n[h+1],n[h+l],i[h],i[h+1],i[h+l]),tv(s,t,n[h+l+1],n[h+1],n[h+l],i[h+l+1],i[h+1],i[h+l])}break;case mw.TRIANGLES:for(r=0,o=n.length;r<o;r+=3)tv(s,t,n[r],n[r+1],n[r+2],i[r],i[r+1],i[r+2]);break;default:throw new Error("illegal figure")}}class PD extends X_{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,n){const l=Math.floor(this._bounds[0]),c=Math.floor(this._bounds[1]),u=Math.ceil(this._bounds[2])-l,h=Math.ceil(this._bounds[3])-c,d=Math.min(Math.ceil(Math.abs(u*e[0]*1.1)),3e3),f=Math.min(Math.ceil(Math.abs(h*e[1]*1.1)),3e3),p=u/d,y=h/f,_={coords:this._coords,colors:this._colors,offsetX:-l,offsetY:-c,scaleX:1/p,scaleY:1/y},A=d+2*2,m=f+2*2,b=n.getCanvas("mesh",A,m),v=b.context,S=v.createImageData(d,f);if(t){const k=S.data;for(let T=0,I=k.length;T<I;T+=4)k[T]=t[0],k[T+1]=t[1],k[T+2]=t[2],k[T+3]=255}for(const k of this._figures)TD(S,k,_);return v.putImageData(S,2,2),{canvas:b.canvas,offsetX:l-2*p,offsetY:c-2*y,scaleX:p,scaleY:y}}isModifyingCurrentTransform(){return!0}getPattern(e,t,n,i){Ww(e,this._bbox);const r=new Float32Array(2);if(i===Vt.SHADING)K.singularValueDecompose2dScale(Je(e),r);else if(this.matrix){K.singularValueDecompose2dScale(this.matrix,r);const[l,c]=r;K.singularValueDecompose2dScale(t.baseTransform,r),r[0]*=l,r[1]*=c}else K.singularValueDecompose2dScale(t.baseTransform,r);const o=this._createMeshCanvas(r,i===Vt.SHADING?null:this._background,t.cachedCanvases);return i!==Vt.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(o.offsetX,o.offsetY),e.scale(o.scaleX,o.scaleY),e.createPattern(o.canvas,"no-repeat")}}class RD extends X_{getPattern(){return"hotpink"}}function ND(s){switch(s[0]){case"RadialAxial":return new kD(s);case"Mesh":return new PD(s);case"Dummy":return new RD}throw new Error(`Unknown IR type: ${s[0]}`)}const QA={COLORED:1,UNCOLORED:2},Ny=class Ny{constructor(e,t,n,i){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=n,this.baseTransform=i}createPatternCanvas(e,t){var R,N;const{bbox:n,operatorList:i,paintType:r,tilingType:o,color:l,canvasGraphicsFactory:c}=this;let{xstep:u,ystep:h}=this;u=Math.abs(u),h=Math.abs(h),h0("TilingType: "+o);const d=n[0],f=n[1],p=n[2],y=n[3],_=p-d,A=y-f,m=new Float32Array(2);K.singularValueDecompose2dScale(this.matrix,m);const[b,v]=m;K.singularValueDecompose2dScale(this.baseTransform,m);const S=b*m[0],C=v*m[1];let k=_,T=A,I=!1,O=!1;const L=Math.ceil(u*S),j=Math.ceil(h*C),H=Math.ceil(_*S),J=Math.ceil(A*C);L>=H?k=u:I=!0,j>=J?T=h:O=!0;const Y=this.getSizeAndScale(k,this.ctx.canvas.width,S),te=this.getSizeAndScale(T,this.ctx.canvas.height,C),G=e.cachedCanvases.getCanvas("pattern",Y.size,te.size),M=G.context,P=c.createCanvasGraphics(M,t);if(P.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(P,r,l),M.translate(-Y.scale*d,-te.scale*f),P.transform(0,Y.scale,0,0,te.scale,0,0),M.save(),(R=P.dependencyTracker)==null||R.save(),this.clipBbox(P,d,f,p,y),P.baseTransform=Je(P.ctx),P.executeOperatorList(i),P.endDrawing(),(N=P.dependencyTracker)==null||N.restore(),M.restore(),I||O){const D=G.canvas;I&&(k=u),O&&(T=h);const F=this.getSizeAndScale(k,this.ctx.canvas.width,S),U=this.getSizeAndScale(T,this.ctx.canvas.height,C),Z=F.size,be=U.size,_e=e.cachedCanvases.getCanvas("pattern-workaround",Z,be),ue=_e.context,kt=I?Math.floor(_/u):0,va=O?Math.floor(A/h):0;for(let Bs=0;Bs<=kt;Bs++)for(let ln=0;ln<=va;ln++)ue.drawImage(D,Z*Bs,be*ln,Z,be,0,0,Z,be);return{canvas:_e.canvas,scaleX:F.scale,scaleY:U.scale,offsetX:d,offsetY:f}}return{canvas:G.canvas,scaleX:Y.scale,scaleY:te.scale,offsetX:d,offsetY:f}}getSizeAndScale(e,t,n){const i=Math.max(Ny.MAX_PATTERN_SIZE,t);let r=Math.ceil(e*n);return r>=i?r=i:n=r/e,{scale:n,size:r}}clipBbox(e,t,n,i,r){const o=i-t,l=r-n;e.ctx.rect(t,n,o,l),K.axialAlignedBoundingBox([t,n,i,r],Je(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){const i=e.ctx,r=e.current;switch(t){case QA.COLORED:const{fillStyle:o,strokeStyle:l}=this.ctx;i.fillStyle=r.fillColor=o,i.strokeStyle=r.strokeColor=l;break;case QA.UNCOLORED:i.fillStyle=i.strokeStyle=n,r.fillColor=r.strokeColor=n;break;default:throw new VI(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,n,i,r){let o=n;i!==Vt.SHADING&&(o=K.transform(o,t.baseTransform),this.matrix&&(o=K.transform(o,this.matrix)));const l=this.createPatternCanvas(t,r);let c=new DOMMatrix(o);c=c.translate(l.offsetX,l.offsetY),c=c.scale(1/l.scaleX,1/l.scaleY);const u=e.createPattern(l.canvas,"repeat");return u.setTransform(c),u}};B(Ny,"MAX_PATTERN_SIZE",3e3);let Gw=Ny;function ID({src:s,srcPos:e=0,dest:t,width:n,height:i,nonBlackColor:r=4294967295,inverseDecode:o=!1}){const l=Kt.isLittleEndian?4278190080:255,[c,u]=o?[r,l]:[l,r],h=n>>3,d=n&7,f=s.length;t=new Uint32Array(t.buffer);let p=0;for(let y=0;y<i;y++){for(const A=e+h;e<A;e++){const m=e<f?s[e]:255;t[p++]=m&128?u:c,t[p++]=m&64?u:c,t[p++]=m&32?u:c,t[p++]=m&16?u:c,t[p++]=m&8?u:c,t[p++]=m&4?u:c,t[p++]=m&2?u:c,t[p++]=m&1?u:c}if(d===0)continue;const _=e<f?s[e++]:255;for(let A=0;A<d;A++)t[p++]=_&1<<7-A?u:c}return{srcPos:e,destPos:p}}const ZA=16,eS=100,DD=15,tS=10,Dn=16,nv=new DOMMatrix,as=new Float32Array(2),zc=new Float32Array([1/0,1/0,-1/0,-1/0]);function OD(s,e){if(s._removeMirroring)throw new Error("Context is already forwarding operations.");s.__originalSave=s.save,s.__originalRestore=s.restore,s.__originalRotate=s.rotate,s.__originalScale=s.scale,s.__originalTranslate=s.translate,s.__originalTransform=s.transform,s.__originalSetTransform=s.setTransform,s.__originalResetTransform=s.resetTransform,s.__originalClip=s.clip,s.__originalMoveTo=s.moveTo,s.__originalLineTo=s.lineTo,s.__originalBezierCurveTo=s.bezierCurveTo,s.__originalRect=s.rect,s.__originalClosePath=s.closePath,s.__originalBeginPath=s.beginPath,s._removeMirroring=()=>{s.save=s.__originalSave,s.restore=s.__originalRestore,s.rotate=s.__originalRotate,s.scale=s.__originalScale,s.translate=s.__originalTranslate,s.transform=s.__originalTransform,s.setTransform=s.__originalSetTransform,s.resetTransform=s.__originalResetTransform,s.clip=s.__originalClip,s.moveTo=s.__originalMoveTo,s.lineTo=s.__originalLineTo,s.bezierCurveTo=s.__originalBezierCurveTo,s.rect=s.__originalRect,s.closePath=s.__originalClosePath,s.beginPath=s.__originalBeginPath,delete s._removeMirroring},s.save=function(){e.save(),this.__originalSave()},s.restore=function(){e.restore(),this.__originalRestore()},s.translate=function(t,n){e.translate(t,n),this.__originalTranslate(t,n)},s.scale=function(t,n){e.scale(t,n),this.__originalScale(t,n)},s.transform=function(t,n,i,r,o,l){e.transform(t,n,i,r,o,l),this.__originalTransform(t,n,i,r,o,l)},s.setTransform=function(t,n,i,r,o,l){e.setTransform(t,n,i,r,o,l),this.__originalSetTransform(t,n,i,r,o,l)},s.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},s.rotate=function(t){e.rotate(t),this.__originalRotate(t)},s.clip=function(t){e.clip(t),this.__originalClip(t)},s.moveTo=function(t,n){e.moveTo(t,n),this.__originalMoveTo(t,n)},s.lineTo=function(t,n){e.lineTo(t,n),this.__originalLineTo(t,n)},s.bezierCurveTo=function(t,n,i,r,o,l){e.bezierCurveTo(t,n,i,r,o,l),this.__originalBezierCurveTo(t,n,i,r,o,l)},s.rect=function(t,n,i,r){e.rect(t,n,i,r),this.__originalRect(t,n,i,r)},s.closePath=function(){e.closePath(),this.__originalClosePath()},s.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class LD{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n){let i;return this.cache[e]!==void 0?(i=this.cache[e],this.canvasFactory.reset(i,t,n)):(i=this.canvasFactory.create(t,n),this.cache[e]=i),i}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function Bg(s,e,t,n,i,r,o,l,c,u){const[h,d,f,p,y,_]=Je(s);if(d===0&&f===0){const b=o*h+y,v=Math.round(b),S=l*p+_,C=Math.round(S),k=(o+c)*h+y,T=Math.abs(Math.round(k)-v)||1,I=(l+u)*p+_,O=Math.abs(Math.round(I)-C)||1;return s.setTransform(Math.sign(h),0,0,Math.sign(p),v,C),s.drawImage(e,t,n,i,r,0,0,T,O),s.setTransform(h,d,f,p,y,_),[T,O]}if(h===0&&p===0){const b=l*f+y,v=Math.round(b),S=o*d+_,C=Math.round(S),k=(l+u)*f+y,T=Math.abs(Math.round(k)-v)||1,I=(o+c)*d+_,O=Math.abs(Math.round(I)-C)||1;return s.setTransform(0,Math.sign(d),Math.sign(f),0,v,C),s.drawImage(e,t,n,i,r,0,0,O,T),s.setTransform(h,d,f,p,y,_),[O,T]}s.drawImage(e,t,n,i,r,o,l,c,u);const A=Math.hypot(h,d),m=Math.hypot(f,p);return[A*c,m*u]}class nS{constructor(e,t,n){B(this,"alphaIsShape",!1);B(this,"fontSize",0);B(this,"fontSizeScale",1);B(this,"textMatrix",null);B(this,"textMatrixScale",1);B(this,"fontMatrix",gw);B(this,"leading",0);B(this,"x",0);B(this,"y",0);B(this,"lineX",0);B(this,"lineY",0);B(this,"charSpacing",0);B(this,"wordSpacing",0);B(this,"textHScale",1);B(this,"textRenderingMode",Ft.FILL);B(this,"textRise",0);B(this,"fillColor","#000000");B(this,"strokeColor","#000000");B(this,"patternFill",!1);B(this,"patternStroke",!1);B(this,"fillAlpha",1);B(this,"strokeAlpha",1);B(this,"lineWidth",1);B(this,"activeSMask",null);B(this,"transferMaps","none");n==null||n(this),this.clipBox=new Float32Array([0,0,e,t]),this.minMax=zc.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=Vt.FILL,t=null){const n=this.minMax.slice();if(e===Vt.STROKE){t||Me("Stroke bounding box must include transform."),K.singularValueDecompose2dScale(t,as);const i=as[0]*this.lineWidth/2,r=as[1]*this.lineWidth/2;n[0]-=i,n[1]-=r,n[2]+=i,n[3]+=r}return n}updateClipFromPath(){const e=K.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(zc,0)}getClippedPathBoundingBox(e=Vt.FILL,t=null){return K.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function sS(s,e){if(e instanceof ImageData){s.putImageData(e,0,0);return}const t=e.height,n=e.width,i=t%Dn,r=(t-i)/Dn,o=i===0?r:r+1,l=s.createImageData(n,Dn);let c=0,u;const h=e.data,d=l.data;let f,p,y,_;if(e.kind===im.GRAYSCALE_1BPP){const A=h.byteLength,m=new Uint32Array(d.buffer,0,d.byteLength>>2),b=m.length,v=n+7>>3,S=4294967295,C=Kt.isLittleEndian?4278190080:255;for(f=0;f<o;f++){for(y=f<r?Dn:i,u=0,p=0;p<y;p++){const k=A-c;let T=0;const I=k>v?n:k*8-7,O=I&-8;let L=0,j=0;for(;T<O;T+=8)j=h[c++],m[u++]=j&128?S:C,m[u++]=j&64?S:C,m[u++]=j&32?S:C,m[u++]=j&16?S:C,m[u++]=j&8?S:C,m[u++]=j&4?S:C,m[u++]=j&2?S:C,m[u++]=j&1?S:C;for(;T<I;T++)L===0&&(j=h[c++],L=128),m[u++]=j&L?S:C,L>>=1}for(;u<b;)m[u++]=0;s.putImageData(l,0,f*Dn)}}else if(e.kind===im.RGBA_32BPP){for(p=0,_=n*Dn*4,f=0;f<r;f++)d.set(h.subarray(c,c+_)),c+=_,s.putImageData(l,0,p),p+=Dn;f<o&&(_=n*i*4,d.set(h.subarray(c,c+_)),s.putImageData(l,0,p))}else if(e.kind===im.RGB_24BPP)for(y=Dn,_=n*y,f=0;f<o;f++){for(f>=r&&(y=i,_=n*y),u=0,p=_;p--;)d[u++]=h[c++],d[u++]=h[c++],d[u++]=h[c++],d[u++]=255;s.putImageData(l,0,f*Dn)}else throw new Error(`bad image kind: ${e.kind}`)}function iS(s,e){if(e.bitmap){s.drawImage(e.bitmap,0,0);return}const t=e.height,n=e.width,i=t%Dn,r=(t-i)/Dn,o=i===0?r:r+1,l=s.createImageData(n,Dn);let c=0;const u=e.data,h=l.data;for(let d=0;d<o;d++){const f=d<r?Dn:i;({srcPos:c}=ID({src:u,srcPos:c,dest:h,width:n,height:f,nonBlackColor:0})),s.putImageData(l,0,d*Dn)}}function Yh(s,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const n of t)s[n]!==void 0&&(e[n]=s[n]);s.setLineDash!==void 0&&(e.setLineDash(s.getLineDash()),e.lineDashOffset=s.lineDashOffset)}function $g(s){s.strokeStyle=s.fillStyle="#000000",s.fillRule="nonzero",s.globalAlpha=1,s.lineWidth=1,s.lineCap="butt",s.lineJoin="miter",s.miterLimit=10,s.globalCompositeOperation="source-over",s.font="10px sans-serif",s.setLineDash!==void 0&&(s.setLineDash([]),s.lineDashOffset=0);const{filter:e}=s;e!=="none"&&e!==""&&(s.filter="none")}function rS(s,e){if(e)return!0;K.singularValueDecompose2dScale(s,as);const t=Math.fround(Vi.pixelRatio*da.PDF_TO_CSS_UNITS);return as[0]<=t&&as[1]<=t}const MD=["butt","round","square"],FD=["miter","round","bevel"],jD={},oS={};var hi,qw,Kw,Xw;const ox=class ox{constructor(e,t,n,i,r,{optionalContentConfig:o,markedContentStack:l=null},c,u,h){w(this,hi);this.ctx=e,this.current=new nS(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=i,this.filterFactory=r,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=l||[],this.optionalContentConfig=o,this.cachedCanvases=new LD(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=c,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=u,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=h??null}getObject(e,t,n=null){var i;return typeof t=="string"?((i=this.dependencyTracker)==null||i.recordNamedDependency(e,t),t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t)):n}beginDrawing({transform:e,viewport:t,transparency:n=!1,background:i=null}){const r=this.ctx.canvas.width,o=this.ctx.canvas.height,l=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,r,o),this.ctx.fillStyle=l,n){const c=this.cachedCanvases.getCanvas("transparent",r,o);this.compositeCtx=this.ctx,this.transparentCanvas=c.canvas,this.ctx=c.context,this.ctx.save(),this.ctx.transform(...Je(this.compositeCtx))}this.ctx.save(),$g(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=Je(this.ctx)}executeOperatorList(e,t,n,i,r){var m;const o=e.argsArray,l=e.fnArray;let c=t||0;const u=o.length;if(u===c)return c;const h=u-c>tS&&typeof n=="function",d=h?Date.now()+DD:0;let f=0;const p=this.commonObjs,y=this.objs;let _,A;for(;;){if(i!==void 0&&c===i.nextBreakPoint)return i.breakIt(c,n),c;if(!r||r(c))if(_=l[c],A=o[c]??null,_!==sf.dependency)A===null?this[_](c):this[_](c,...A);else for(const b of A){(m=this.dependencyTracker)==null||m.recordNamedData(b,c);const v=b.startsWith("g_")?p:y;if(!v.has(b))return v.get(b,n),c}if(c++,c===u)return c;if(h&&++f>tS){if(Date.now()>d)return n(),c;f=0}}}endDrawing(){x(this,hi,qw).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),x(this,hi,Kw).call(this)}_scaleImage(e,t){const n=e.width??e.displayWidth,i=e.height??e.displayHeight;let r=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),l=n,c=i,u="prescale1",h,d;for(;r>2&&l>1||o>2&&c>1;){let f=l,p=c;r>2&&l>1&&(f=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l/2),r/=l/f),o>2&&c>1&&(p=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c)/2,o/=c/p),h=this.cachedCanvases.getCanvas(u,f,p),d=h.context,d.clearRect(0,0,f,p),d.drawImage(e,0,0,l,c,0,0,f,p),e=h.canvas,l=f,c=p,u=u==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:l,paintHeight:c}}_createMaskCanvas(e,t){var L,j;const n=this.ctx,{width:i,height:r}=t,o=this.current.fillColor,l=this.current.patternFill,c=Je(n);let u,h,d,f;if((t.bitmap||t.data)&&t.count>1){const H=t.bitmap||t.data.buffer;h=JSON.stringify(l?c:[c.slice(0,4),o]),u=this._cachedBitmapsMap.get(H),u||(u=new Map,this._cachedBitmapsMap.set(H,u));const J=u.get(h);if(J&&!l){const Y=Math.round(Math.min(c[0],c[2])+c[4]),te=Math.round(Math.min(c[1],c[3])+c[5]);return(L=this.dependencyTracker)==null||L.recordDependencies(e,ms.transformAndFill),{canvas:J,offsetX:Y,offsetY:te}}d=J}d||(f=this.cachedCanvases.getCanvas("maskCanvas",i,r),iS(f.context,t));let p=K.transform(c,[1/i,0,0,-1/r,0,0]);p=K.transform(p,[1,0,0,1,0,-r]);const y=zc.slice();K.axialAlignedBoundingBox([0,0,i,r],p,y);const[_,A,m,b]=y,v=Math.round(m-_)||1,S=Math.round(b-A)||1,C=this.cachedCanvases.getCanvas("fillCanvas",v,S),k=C.context,T=_,I=A;k.translate(-T,-I),k.transform(...p),d||(d=this._scaleImage(f.canvas,fi(k)),d=d.img,u&&l&&u.set(h,d)),k.imageSmoothingEnabled=rS(Je(k),t.interpolate),Bg(k,d,0,0,d.width,d.height,0,0,i,r),k.globalCompositeOperation="source-in";const O=K.transform(fi(k),[1,0,0,1,-T,-I]);return k.fillStyle=l?o.getPattern(n,this,O,Vt.FILL,e):o,k.fillRect(0,0,i,r),u&&!l&&(this.cachedCanvases.delete("fillCanvas"),u.set(h,C.canvas)),(j=this.dependencyTracker)==null||j.recordDependencies(e,ms.transformAndFill),{canvas:C.canvas,offsetX:Math.round(T),offsetY:Math.round(I)}}setLineWidth(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("lineWidth",e),t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("lineCap",e),this.ctx.lineCap=MD[t]}setLineJoin(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("lineJoin",e),this.ctx.lineJoin=FD[t]}setMiterLimit(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("miterLimit",e),this.ctx.miterLimit=t}setDash(e,t,n){var r;(r=this.dependencyTracker)==null||r.recordSimpleData("dash",e);const i=this.ctx;i.setLineDash!==void 0&&(i.setLineDash(t),i.lineDashOffset=n)}setRenderingIntent(e,t){}setFlatness(e,t){}setGState(e,t){var n,i,r,o,l;for(const[c,u]of t)switch(c){case"LW":this.setLineWidth(e,u);break;case"LC":this.setLineCap(e,u);break;case"LJ":this.setLineJoin(e,u);break;case"ML":this.setMiterLimit(e,u);break;case"D":this.setDash(e,u[0],u[1]);break;case"RI":this.setRenderingIntent(e,u);break;case"FL":this.setFlatness(e,u);break;case"Font":this.setFont(e,u[0],u[1]);break;case"CA":(n=this.dependencyTracker)==null||n.recordSimpleData("strokeAlpha",e),this.current.strokeAlpha=u;break;case"ca":(i=this.dependencyTracker)==null||i.recordSimpleData("fillAlpha",e),this.ctx.globalAlpha=this.current.fillAlpha=u;break;case"BM":(r=this.dependencyTracker)==null||r.recordSimpleData("globalCompositeOperation",e),this.ctx.globalCompositeOperation=u;break;case"SMask":(o=this.dependencyTracker)==null||o.recordSimpleData("SMask",e),this.current.activeSMask=u?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":(l=this.dependencyTracker)==null||l.recordSimpleData("filter",e),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(u);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(e){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,n=this.ctx.canvas.height,i="smaskGroupAt"+this.groupLevel,r=this.cachedCanvases.getCanvas(i,t,n);this.suspendedCtx=this.ctx;const o=this.ctx=r.context;o.setTransform(this.suspendedCtx.getTransform()),Yh(this.suspendedCtx,o),OD(o,this.suspendedCtx),this.setGState(e,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Yh(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,n,i){const r=i[0],o=i[1],l=i[2]-r,c=i[3]-o;l===0||c===0||(this.genericComposeSMask(t.context,n,l,c,t.subtype,t.backdrop,t.transferMap,r,o,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())}genericComposeSMask(e,t,n,i,r,o,l,c,u,h,d){let f=e.canvas,p=c-h,y=u-d;if(o)if(p<0||y<0||p+n>f.width||y+i>f.height){const A=this.cachedCanvases.getCanvas("maskExtension",n,i),m=A.context;m.drawImage(f,-p,-y),m.globalCompositeOperation="destination-atop",m.fillStyle=o,m.fillRect(0,0,n,i),m.globalCompositeOperation="source-over",f=A.canvas,p=y=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const A=new Path2D;A.rect(p,y,n,i),e.clip(A),e.globalCompositeOperation="destination-atop",e.fillStyle=o,e.fillRect(p,y,n,i),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),r==="Alpha"&&l?t.filter=this.filterFactory.addAlphaFilter(l):r==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(l));const _=new Path2D;_.rect(c,u,n,i),t.clip(_),t.globalCompositeOperation="destination-in",t.drawImage(f,p,y,n,i,c,u,n,i),t.restore()}save(e){var n;this.inSMaskMode&&Yh(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone(),(n=this.dependencyTracker)==null||n.save(e)}restore(e){var t;if((t=this.dependencyTracker)==null||t.restore(e),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&Yh(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,n,i,r,o,l){var c;(c=this.dependencyTracker)==null||c.recordIncrementalData("transform",e),this.ctx.transform(t,n,i,r,o,l),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n,i){let[r]=n;if(!i){r||(r=n[0]=new Path2D),this[t](e,r);return}if(this.dependencyTracker!==null){const o=t===sf.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(e).recordBBox(e,this.ctx,i[0]-o,i[2]+o,i[1]-o,i[3]+o).recordDependencies(e,["transform"])}r instanceof Path2D||(r=n[0]=hC(r)),K.axialAlignedBoundingBox(i,Je(this.ctx),this.current.minMax),this[t](e,r),this._pathStartIdx=e}closePath(e){this.ctx.closePath()}stroke(e,t,n=!0){var o;const i=this.ctx,r=this.current.strokeColor;if(i.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof r=="object"&&(r!=null&&r.getPattern)){const l=r.isModifyingCurrentTransform()?i.getTransform():null;if(i.save(),i.strokeStyle=r.getPattern(i,this,fi(i),Vt.STROKE,e),l){const c=new Path2D;c.addPath(t,i.getTransform().invertSelf().multiplySelf(l)),t=c}this.rescaleAndStroke(t,!1),i.restore()}else this.rescaleAndStroke(t,!0);(o=this.dependencyTracker)==null||o.recordDependencies(e,ms.stroke),n&&this.consumePath(e,t,this.current.getClippedPathBoundingBox(Vt.STROKE,Je(this.ctx))),i.globalAlpha=this.current.fillAlpha}closeStroke(e,t){this.stroke(e,t)}fill(e,t,n=!0){var u,h,d;const i=this.ctx,r=this.current.fillColor,o=this.current.patternFill;let l=!1;if(o){const f=r.isModifyingCurrentTransform()?i.getTransform():null;if((u=this.dependencyTracker)==null||u.save(e),i.save(),i.fillStyle=r.getPattern(i,this,fi(i),Vt.FILL,e),f){const p=new Path2D;p.addPath(t,i.getTransform().invertSelf().multiplySelf(f)),t=p}l=!0}const c=this.current.getClippedPathBoundingBox();this.contentVisible&&c!==null&&(this.pendingEOFill?(i.fill(t,"evenodd"),this.pendingEOFill=!1):i.fill(t)),(h=this.dependencyTracker)==null||h.recordDependencies(e,ms.fill),l&&(i.restore(),(d=this.dependencyTracker)==null||d.restore(e)),n&&this.consumePath(e,t,c)}eoFill(e,t){this.pendingEOFill=!0,this.fill(e,t)}fillStroke(e,t){this.fill(e,t,!1),this.stroke(e,t,!1),this.consumePath(e,t)}eoFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}closeFillStroke(e,t){this.fillStroke(e,t)}closeEOFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}endPath(e,t){this.consumePath(e,t)}rawFillPath(e,t){var n;this.ctx.fill(t),(n=this.dependencyTracker)==null||n.recordDependencies(e,ms.rawFillPath).recordOperation(e)}clip(e){var t;(t=this.dependencyTracker)==null||t.recordFutureForcedDependency("clipMode",e),this.pendingClip=jD}eoClip(e){var t;(t=this.dependencyTracker)==null||t.recordFutureForcedDependency("clipMode",e),this.pendingClip=oS}beginText(e){var t;this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,(t=this.dependencyTracker)==null||t.recordOpenMarker(e).resetIncrementalData("sameLineText").resetIncrementalData("moveText",e)}endText(e){const t=this.pendingTextPaths,n=this.ctx;if(this.dependencyTracker){const{dependencyTracker:i}=this;t!==void 0&&i.recordFutureForcedDependency("textClip",i.getOpenMarker()).recordFutureForcedDependency("textClip",e),i.recordCloseMarker(e)}if(t!==void 0){const i=new Path2D,r=n.getTransform().invertSelf();for(const{transform:o,x:l,y:c,fontSize:u,path:h}of t)h&&i.addPath(h,new DOMMatrix(o).preMultiplySelf(r).translate(l,c).scale(u,-u));n.clip(i)}delete this.pendingTextPaths}setCharSpacing(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("charSpacing",e),this.current.charSpacing=t}setWordSpacing(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("wordSpacing",e),this.current.wordSpacing=t}setHScale(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("hScale",e),this.current.textHScale=t/100}setLeading(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("leading",e),this.current.leading=-t}setFont(e,t,n){var d,f;(d=this.dependencyTracker)==null||d.recordSimpleData("font",e).recordSimpleDataFromNamed("fontObj",t,e);const i=this.commonObjs.get(t),r=this.current;if(!i)throw new Error(`Can't find font for ${t}`);if(r.fontMatrix=i.fontMatrix||gw,(r.fontMatrix[0]===0||r.fontMatrix[3]===0)&&ne("Invalid font matrix for font "+t),n<0?(n=-n,r.fontDirection=-1):r.fontDirection=1,this.current.font=i,this.current.fontSize=n,i.isType3Font)return;const o=i.loadedName||"sans-serif",l=((f=i.systemFontInfo)==null?void 0:f.css)||`"${o}", ${i.fallbackName}`;let c="normal";i.black?c="900":i.bold&&(c="bold");const u=i.italic?"italic":"normal";let h=n;n<ZA?h=ZA:n>eS&&(h=eS),this.current.fontSizeScale=n/h,this.ctx.font=`${u} ${c} ${h}px ${l}`}setTextRenderingMode(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("textRenderingMode",e),this.current.textRenderingMode=t}setTextRise(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("textRise",e),this.current.textRise=t}moveText(e,t,n){var i;(i=this.dependencyTracker)==null||i.resetIncrementalData("sameLineText").recordIncrementalData("moveText",e),this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=n}setLeadingMoveText(e,t,n){this.setLeading(e,-n),this.moveText(e,t,n)}setTextMatrix(e,t){var i;(i=this.dependencyTracker)==null||i.resetIncrementalData("sameLineText").recordSimpleData("textMatrix",e);const{current:n}=this;n.textMatrix=t,n.textMatrixScale=Math.hypot(t[0],t[1]),n.x=n.lineX=0,n.y=n.lineY=0}nextLine(e){var t;this.moveText(e,0,this.current.leading),(t=this.dependencyTracker)==null||t.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??e)}paintChar(e,t,n,i,r,o){var m,b,v,S;const l=this.ctx,c=this.current,u=c.font,h=c.textRenderingMode,d=c.fontSize/c.fontSizeScale,f=h&Ft.FILL_STROKE_MASK,p=!!(h&Ft.ADD_TO_PATH_FLAG),y=c.patternFill&&!u.missingFile,_=c.patternStroke&&!u.missingFile;let A;if((u.disableFontFace||p||y||_)&&!u.missingFile&&(A=u.getPathGenerator(this.commonObjs,t)),A&&(u.disableFontFace||y||_)){l.save(),l.translate(n,i),l.scale(d,-d),(m=this.dependencyTracker)==null||m.recordCharacterBBox(e,l,u);let C;if(f===Ft.FILL||f===Ft.FILL_STROKE)if(r){C=l.getTransform(),l.setTransform(...r);const k=x(this,hi,Xw).call(this,A,C,r);l.fill(k)}else l.fill(A);if(f===Ft.STROKE||f===Ft.FILL_STROKE)if(o){C||(C=l.getTransform()),l.setTransform(...o);const{a:k,b:T,c:I,d:O}=C,L=K.inverseTransform(o),j=K.transform([k,T,I,O,0,0],L);K.singularValueDecompose2dScale(j,as),l.lineWidth*=Math.max(as[0],as[1])/d,l.stroke(x(this,hi,Xw).call(this,A,C,o))}else l.lineWidth/=d,l.stroke(A);l.restore()}else(f===Ft.FILL||f===Ft.FILL_STROKE)&&(l.fillText(t,n,i),(b=this.dependencyTracker)==null||b.recordCharacterBBox(e,l,u,d,n,i,()=>l.measureText(t))),(f===Ft.STROKE||f===Ft.FILL_STROKE)&&(this.dependencyTracker&&((v=this.dependencyTracker)==null||v.recordCharacterBBox(e,l,u,d,n,i,()=>l.measureText(t)).recordDependencies(e,ms.stroke)),l.strokeText(t,n,i));p&&((this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:Je(l),x:n,y:i,fontSize:d,path:A}),(S=this.dependencyTracker)==null||S.recordCharacterBBox(e,l,u,d,n,i))}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let n=!1;for(let i=3;i<t.length;i+=4)if(t[i]>0&&t[i]<255){n=!0;break}return ae(this,"isFontSubpixelAAEnabled",n)}showText(e,t){var I,O,L,j;this.dependencyTracker&&(this.dependencyTracker.recordDependencies(e,ms.showText).resetBBox(e),this.current.textRenderingMode&Ft.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",e).inheritPendingDependenciesAsFutureForcedDependencies());const n=this.current,i=n.font;if(i.isType3Font){this.showType3Text(e,t),(I=this.dependencyTracker)==null||I.recordShowTextOperation(e);return}const r=n.fontSize;if(r===0){(O=this.dependencyTracker)==null||O.recordOperation(e);return}const o=this.ctx,l=n.fontSizeScale,c=n.charSpacing,u=n.wordSpacing,h=n.fontDirection,d=n.textHScale*h,f=t.length,p=i.vertical,y=p?1:-1,_=i.defaultVMetrics,A=r*n.fontMatrix[0],m=n.textRenderingMode===Ft.FILL&&!i.disableFontFace&&!n.patternFill;o.save(),n.textMatrix&&o.transform(...n.textMatrix),o.translate(n.x,n.y+n.textRise),h>0?o.scale(d,-1):o.scale(d,1);let b,v;if(n.patternFill){o.save();const H=n.fillColor.getPattern(o,this,fi(o),Vt.FILL,e);b=Je(o),o.restore(),o.fillStyle=H}if(n.patternStroke){o.save();const H=n.strokeColor.getPattern(o,this,fi(o),Vt.STROKE,e);v=Je(o),o.restore(),o.strokeStyle=H}let S=n.lineWidth;const C=n.textMatrixScale;if(C===0||S===0){const H=n.textRenderingMode&Ft.FILL_STROKE_MASK;(H===Ft.STROKE||H===Ft.FILL_STROKE)&&(S=this.getSinglePixelWidth())}else S/=C;if(l!==1&&(o.scale(l,l),S/=l),o.lineWidth=S,i.isInvalidPDFjsFont){const H=[];let J=0;for(const te of t)H.push(te.unicode),J+=te.width;const Y=H.join("");if(o.fillText(Y,0,0),this.dependencyTracker!==null){const te=o.measureText(Y);this.dependencyTracker.recordBBox(e,this.ctx,-te.actualBoundingBoxLeft,te.actualBoundingBoxRight,-te.actualBoundingBoxAscent,te.actualBoundingBoxDescent).recordShowTextOperation(e)}n.x+=J*A*d,o.restore(),this.compose();return}let k=0,T;for(T=0;T<f;++T){const H=t[T];if(typeof H=="number"){k+=y*H*r/1e3;continue}let J=!1;const Y=(H.isSpace?u:0)+c,te=H.fontChar,G=H.accent;let M,P,R=H.width;if(p){const F=H.vmetric||_,U=-(H.vmetric?F[1]:R*.5)*A,Z=F[2]*A;R=F?-F[0]:R,M=U/l,P=(k+Z)/l}else M=k/l,P=0;let N;if(i.remeasure&&R>0){N=o.measureText(te);const F=N.width*1e3/r*l;if(R<F&&this.isFontSubpixelAAEnabled){const U=R/F;J=!0,o.save(),o.scale(U,1),M/=U}else R!==F&&(M+=(R-F)/2e3*r/l)}if(this.contentVisible&&(H.isInFont||i.missingFile)){if(m&&!G)o.fillText(te,M,P),(L=this.dependencyTracker)==null||L.recordCharacterBBox(e,o,N?{bbox:null}:i,r/l,M,P,()=>N??o.measureText(te));else if(this.paintChar(e,te,M,P,b,v),G){const F=M+r*G.offset.x/l,U=P-r*G.offset.y/l;this.paintChar(e,G.fontChar,F,U,b,v)}}const D=p?R*A-Y*h:R*A+Y*h;k+=D,J&&o.restore()}p?n.y-=k:n.x+=k*d,o.restore(),this.compose(),(j=this.dependencyTracker)==null||j.recordShowTextOperation(e)}showType3Text(e,t){const n=this.ctx,i=this.current,r=i.font,o=i.fontSize,l=i.fontDirection,c=r.vertical?1:-1,u=i.charSpacing,h=i.wordSpacing,d=i.textHScale*l,f=i.fontMatrix||gw,p=t.length,y=i.textRenderingMode===Ft.INVISIBLE;let _,A,m,b;if(y||o===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,n.save(),i.textMatrix&&n.transform(...i.textMatrix),n.translate(i.x,i.y+i.textRise),n.scale(d,l);const v=this.dependencyTracker;for(this.dependencyTracker=v?new my(v,e):null,_=0;_<p;++_){if(A=t[_],typeof A=="number"){b=c*A*o/1e3,this.ctx.translate(b,0),i.x+=b*d;continue}const S=(A.isSpace?h:0)+u,C=r.charProcOperatorList[A.operatorListId];C?this.contentVisible&&(this.save(),n.scale(o,o),n.transform(...f),this.executeOperatorList(C),this.restore()):ne(`Type3 character "${A.operatorListId}" is not available.`);const k=[A.width,0];K.applyTransform(k,f),m=k[0]*o+S,n.translate(m,0),i.x+=m*d}n.restore(),v&&(this.dependencyTracker=v)}setCharWidth(e,t,n){}setCharWidthAndBounds(e,t,n,i,r,o,l){var u;const c=new Path2D;c.rect(i,r,o-i,l-r),this.ctx.clip(c),(u=this.dependencyTracker)==null||u.recordBBox(e,this.ctx,i,o,r,l).recordClipBox(e,this.ctx,i,o,r,l),this.endPath(e)}getColorN_Pattern(e,t){let n;if(t[0]==="TilingPattern"){const i=this.baseTransform||Je(this.ctx),r={createCanvasGraphics:(o,l)=>new ox(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new my(this.dependencyTracker,l,!0):null)};n=new Gw(t,this.ctx,r,i)}else n=this._getPattern(e,t[1],t[2]);return n}setStrokeColorN(e,...t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("strokeColor",e),this.current.strokeColor=this.getColorN_Pattern(e,t),this.current.patternStroke=!0}setFillColorN(e,...t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("fillColor",e),this.current.fillColor=this.getColorN_Pattern(e,t),this.current.patternFill=!0}setStrokeRGBColor(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(e){var t;(t=this.dependencyTracker)==null||t.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t){var n;(n=this.dependencyTracker)==null||n.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(e){var t;(t=this.dependencyTracker)==null||t.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t,n=null){let i;return this.cachedPatterns.has(t)?i=this.cachedPatterns.get(t):(i=ND(this.getObject(e,t)),this.cachedPatterns.set(t,i)),n&&(i.matrix=n),i}shadingFill(e,t){var o;if(!this.contentVisible)return;const n=this.ctx;this.save(e);const i=this._getPattern(e,t);n.fillStyle=i.getPattern(n,this,fi(n),Vt.SHADING,e);const r=fi(n);if(r){const{width:l,height:c}=n.canvas,u=zc.slice();K.axialAlignedBoundingBox([0,0,l,c],r,u);const[h,d,f,p]=u;this.ctx.fillRect(h,d,f-h,p-d)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);(o=this.dependencyTracker)==null||o.resetBBox(e).recordFullPageBBox(e).recordDependencies(e,ms.transform).recordDependencies(e,ms.fill).recordOperation(e),this.compose(this.current.getClippedPathBoundingBox()),this.restore(e)}beginInlineImage(){Me("Should not call beginInlineImage")}beginImageData(){Me("Should not call beginImageData")}paintFormXObjectBegin(e,t,n){var i;if(this.contentVisible&&(this.save(e),this.baseTransformStack.push(this.baseTransform),t&&this.transform(e,...t),this.baseTransform=Je(this.ctx),n)){K.axialAlignedBoundingBox(n,this.baseTransform,this.current.minMax);const[r,o,l,c]=n,u=new Path2D;u.rect(r,o,l-r,c-o),this.ctx.clip(u),(i=this.dependencyTracker)==null||i.recordClipBox(e,this.ctx,r,l,o,c),this.endPath(e)}}paintFormXObjectEnd(e){this.contentVisible&&(this.restore(e),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e,t){var v;if(!this.contentVisible)return;this.save(e),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const n=this.ctx;t.isolated||h0("TODO: Support non-isolated groups."),t.knockout&&ne("Knockout groups not supported.");const i=Je(n);if(t.matrix&&n.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let r=zc.slice();K.axialAlignedBoundingBox(t.bbox,Je(n),r);const o=[0,0,n.canvas.width,n.canvas.height];r=K.intersect(r,o)||[0,0,0,0];const l=Math.floor(r[0]),c=Math.floor(r[1]),u=Math.max(Math.ceil(r[2])-l,1),h=Math.max(Math.ceil(r[3])-c,1);this.current.startNewPathAndClipBox([0,0,u,h]);let d="groupAt"+this.groupLevel;t.smask&&(d+="_smask_"+this.smaskCounter++%2);const f=this.cachedCanvases.getCanvas(d,u,h),p=f.context;p.translate(-l,-c),p.transform(...i);let y=new Path2D;const[_,A,m,b]=t.bbox;if(y.rect(_,A,m-_,b-A),t.matrix){const S=new Path2D;S.addPath(y,new DOMMatrix(t.matrix)),y=S}p.clip(y),t.smask&&this.smaskStack.push({canvas:f.canvas,context:p,offsetX:l,offsetY:c,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}),(!t.smask||this.dependencyTracker)&&(n.setTransform(1,0,0,1,0,0),n.translate(l,c),n.save()),Yh(n,p),this.ctx=p,(v=this.dependencyTracker)==null||v.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(n),this.setGState(e,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(n),this.groupLevel++}endGroup(e,t){var r;if(!this.contentVisible)return;this.groupLevel--;const n=this.ctx,i=this.groupStack.pop();if(this.ctx=i,this.ctx.imageSmoothingEnabled=!1,(r=this.dependencyTracker)==null||r.popBaseTransform(),t.smask)this.tempSMask=this.smaskStack.pop(),this.restore(e),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const o=Je(this.ctx);this.restore(e),this.ctx.save(),this.ctx.setTransform(...o);const l=zc.slice();K.axialAlignedBoundingBox([0,0,n.canvas.width,n.canvas.height],o,l),this.ctx.drawImage(n.canvas,0,0),this.ctx.restore(),this.compose(l)}}beginAnnotation(e,t,n,i,r,o){if(x(this,hi,qw).call(this),$g(this.ctx),this.ctx.save(),this.save(e),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),n){const l=n[2]-n[0],c=n[3]-n[1];if(o&&this.annotationCanvasMap){i=i.slice(),i[4]-=n[0],i[5]-=n[1],n=n.slice(),n[0]=n[1]=0,n[2]=l,n[3]=c,K.singularValueDecompose2dScale(Je(this.ctx),as);const{viewportScale:u}=this,h=Math.ceil(l*this.outputScaleX*u),d=Math.ceil(c*this.outputScaleY*u);this.annotationCanvas=this.canvasFactory.create(h,d);const{canvas:f,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(t,f),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(as[0],0,0,-as[1],0,c*as[1]),$g(this.ctx)}else{$g(this.ctx),this.endPath(e);const u=new Path2D;u.rect(n[0],n[1],l,c),this.ctx.clip(u)}}this.current=new nS(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(e,...i),this.transform(e,...r)}endAnnotation(e){this.annotationCanvas&&(this.ctx.restore(),x(this,hi,Kw).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e,t){var l;if(!this.contentVisible)return;const n=t.count;t=this.getObject(e,t.data,t),t.count=n;const i=this.ctx,r=this._createMaskCanvas(e,t),o=r.canvas;i.save(),i.setTransform(1,0,0,1,0,0),i.drawImage(o,r.offsetX,r.offsetY),(l=this.dependencyTracker)==null||l.resetBBox(e).recordBBox(e,this.ctx,r.offsetX,r.offsetX+o.width,r.offsetY,r.offsetY+o.height).recordOperation(e),i.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,n,i=0,r=0,o,l){var d,f,p;if(!this.contentVisible)return;t=this.getObject(e,t.data,t);const c=this.ctx;c.save();const u=Je(c);c.transform(n,i,r,o,0,0);const h=this._createMaskCanvas(e,t);c.setTransform(1,0,0,1,h.offsetX-u[4],h.offsetY-u[5]),(d=this.dependencyTracker)==null||d.resetBBox(e);for(let y=0,_=l.length;y<_;y+=2){const A=K.transform(u,[n,i,r,o,l[y],l[y+1]]);c.drawImage(h.canvas,A[4],A[5]),(f=this.dependencyTracker)==null||f.recordBBox(e,this.ctx,A[4],A[4]+h.canvas.width,A[5],A[5]+h.canvas.height)}c.restore(),this.compose(),(p=this.dependencyTracker)==null||p.recordOperation(e)}paintImageMaskXObjectGroup(e,t){var o,l,c;if(!this.contentVisible)return;const n=this.ctx,i=this.current.fillColor,r=this.current.patternFill;(o=this.dependencyTracker)==null||o.resetBBox(e).recordDependencies(e,ms.transformAndFill);for(const u of t){const{data:h,width:d,height:f,transform:p}=u,y=this.cachedCanvases.getCanvas("maskCanvas",d,f),_=y.context;_.save();const A=this.getObject(e,h,u);iS(_,A),_.globalCompositeOperation="source-in",_.fillStyle=r?i.getPattern(_,this,fi(n),Vt.FILL,e):i,_.fillRect(0,0,d,f),_.restore(),n.save(),n.transform(...p),n.scale(1,-1),Bg(n,y.canvas,0,0,d,f,0,-1,1,1),(l=this.dependencyTracker)==null||l.recordBBox(e,n,0,d,0,f),n.restore()}this.compose(),(c=this.dependencyTracker)==null||c.recordOperation(e)}paintImageXObject(e,t){if(!this.contentVisible)return;const n=this.getObject(e,t);if(!n){ne("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e,n)}paintImageXObjectRepeat(e,t,n,i,r){if(!this.contentVisible)return;const o=this.getObject(e,t);if(!o){ne("Dependent image isn't ready yet");return}const l=o.width,c=o.height,u=[];for(let h=0,d=r.length;h<d;h+=2)u.push({transform:[n,0,0,i,r[h],r[h+1]],x:0,y:0,w:l,h:c});this.paintInlineImageXObjectGroup(e,o,u)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:n,height:i}=e,r=this.cachedCanvases.getCanvas("inlineImage",n,i),o=r.context;return o.filter=this.current.transferMaps,o.drawImage(t,0,0),o.filter="none",r.canvas}paintInlineImageXObject(e,t){var u;if(!this.contentVisible)return;const n=t.width,i=t.height,r=this.ctx;this.save(e);const{filter:o}=r;o!=="none"&&o!==""&&(r.filter="none"),r.scale(1/n,-1/i);let l;if(t.bitmap)l=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)l=t;else{const d=this.cachedCanvases.getCanvas("inlineImage",n,i).context;sS(d,t),l=this.applyTransferMapsToCanvas(d)}const c=this._scaleImage(l,fi(r));r.imageSmoothingEnabled=rS(Je(r),t.interpolate),(u=this.dependencyTracker)==null||u.resetBBox(e).recordBBox(e,r,0,n,-i,0).recordDependencies(e,ms.imageXObject).recordOperation(e),Bg(r,c.img,0,0,c.paintWidth,c.paintHeight,0,-i,n,i),this.compose(),this.restore(e)}paintInlineImageXObjectGroup(e,t,n){var o,l,c;if(!this.contentVisible)return;const i=this.ctx;let r;if(t.bitmap)r=t.bitmap;else{const u=t.width,h=t.height,f=this.cachedCanvases.getCanvas("inlineImage",u,h).context;sS(f,t),r=this.applyTransferMapsToCanvas(f)}(o=this.dependencyTracker)==null||o.resetBBox(e);for(const u of n)i.save(),i.transform(...u.transform),i.scale(1,-1),Bg(i,r,u.x,u.y,u.w,u.h,0,-1,1,1),(l=this.dependencyTracker)==null||l.recordBBox(e,i,0,1,-1,0),i.restore();(c=this.dependencyTracker)==null||c.recordOperation(e),this.compose()}paintSolidColorImageMask(e){var t;this.contentVisible&&((t=this.dependencyTracker)==null||t.resetBBox(e).recordBBox(e,this.ctx,0,1,0,1).recordDependencies(e,ms.fill).recordOperation(e),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e,t){}markPointProps(e,t,n){}beginMarkedContent(e,t){var n;(n=this.dependencyTracker)==null||n.beginMarkedContent(e),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t,n){var i;(i=this.dependencyTracker)==null||i.beginMarkedContent(e),t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(n)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(e){var t;(t=this.dependencyTracker)==null||t.endMarkedContent(e),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(e){}endCompat(e){}consumePath(e,t,n){var o,l;const i=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(n);const r=this.ctx;this.pendingClip?(i||(this.pendingClip===oS?r.clip(t,"evenodd"):r.clip(t)),this.pendingClip=null,(o=this.dependencyTracker)==null||o.bboxToClipBoxDropOperation(e).recordFutureForcedDependency("clipPath",e)):(l=this.dependencyTracker)==null||l.recordOperation(e),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=Je(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),i=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,i)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:n,c:i,d:r}=this.ctx.getTransform();let o,l;if(n===0&&i===0){const c=Math.abs(t),u=Math.abs(r);if(c===u)if(e===0)o=l=1/c;else{const h=c*e;o=l=h<1?1/h:1}else if(e===0)o=1/c,l=1/u;else{const h=c*e,d=u*e;o=h<1?1/h:1,l=d<1?1/d:1}}else{const c=Math.abs(t*r-n*i),u=Math.hypot(t,n),h=Math.hypot(i,r);if(e===0)o=h/c,l=u/c;else{const d=e*c;o=h>d?h/d:1,l=u>d?u/d:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=l}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:n,current:{lineWidth:i}}=this,[r,o]=this.getScaleForStroking();if(r===o){n.lineWidth=(i||1)*r,n.stroke(e);return}const l=n.getLineDash();t&&n.save(),n.scale(r,o),nv.a=1/r,nv.d=1/o;const c=new Path2D;if(c.addPath(e,nv),l.length>0){const u=Math.max(r,o);n.setLineDash(l.map(h=>h/u)),n.lineDashOffset/=u}n.lineWidth=i||1,n.stroke(c),t&&n.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};hi=new WeakSet,qw=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},Kw=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}},Xw=function(e,t,n){const i=new Path2D;return i.addPath(e,new DOMMatrix(n).invertSelf().multiplySelf(t)),i};let Zc=ox;for(const s in sf)Zc.prototype[s]!==void 0&&(Zc.prototype[sf[s]]=Zc.prototype[s]);var Xf,Yf;class oi{static get workerPort(){return a(this,Xf)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");g(this,Xf,e)}static get workerSrc(){return a(this,Yf)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");g(this,Yf,e)}}Xf=new WeakMap,Yf=new WeakMap,w(oi,Xf,null),w(oi,Yf,"");var Mu,Jf;class BD{constructor({parsedData:e,rawData:t}){w(this,Mu);w(this,Jf);g(this,Mu,e),g(this,Jf,t)}getRaw(){return a(this,Jf)}get(e){return a(this,Mu).get(e)??null}[Symbol.iterator](){return a(this,Mu).entries()}}Mu=new WeakMap,Jf=new WeakMap;const Cc=Symbol("INTERNAL");var Qf,Zf,ep,Fu;class $D{constructor(e,{name:t,intent:n,usage:i,rbGroups:r}){w(this,Qf,!1);w(this,Zf,!1);w(this,ep,!1);w(this,Fu,!0);g(this,Qf,!!(e&rs.DISPLAY)),g(this,Zf,!!(e&rs.PRINT)),this.name=t,this.intent=n,this.usage=i,this.rbGroups=r}get visible(){if(a(this,ep))return a(this,Fu);if(!a(this,Fu))return!1;const{print:e,view:t}=this.usage;return a(this,Qf)?(t==null?void 0:t.viewState)!=="OFF":a(this,Zf)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,n=!1){e!==Cc&&Me("Internal method `_setVisible` called."),g(this,ep,n),g(this,Fu,t)}}Qf=new WeakMap,Zf=new WeakMap,ep=new WeakMap,Fu=new WeakMap;var To,Ne,ju,Bu,tp,Yw;class UD{constructor(e,t=rs.DISPLAY){w(this,tp);w(this,To,null);w(this,Ne,new Map);w(this,ju,null);w(this,Bu,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,g(this,Bu,e.order);for(const n of e.groups)a(this,Ne).set(n.id,new $D(t,n));if(e.baseState==="OFF")for(const n of a(this,Ne).values())n._setVisible(Cc,!1);for(const n of e.on)a(this,Ne).get(n)._setVisible(Cc,!0);for(const n of e.off)a(this,Ne).get(n)._setVisible(Cc,!1);g(this,ju,this.getHash())}}isVisible(e){if(a(this,Ne).size===0)return!0;if(!e)return h0("Optional content group not defined."),!0;if(e.type==="OCG")return a(this,Ne).has(e.id)?a(this,Ne).get(e.id).visible:(ne(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return x(this,tp,Yw).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!a(this,Ne).has(t))return ne(`Optional content group not found: ${t}`),!0;if(a(this,Ne).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!a(this,Ne).has(t))return ne(`Optional content group not found: ${t}`),!0;if(!a(this,Ne).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!a(this,Ne).has(t))return ne(`Optional content group not found: ${t}`),!0;if(!a(this,Ne).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!a(this,Ne).has(t))return ne(`Optional content group not found: ${t}`),!0;if(a(this,Ne).get(t).visible)return!1}return!0}return ne(`Unknown optional content policy ${e.policy}.`),!0}return ne(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,n=!0){var r;const i=a(this,Ne).get(e);if(!i){ne(`Optional content group not found: ${e}`);return}if(n&&t&&i.rbGroups.length)for(const o of i.rbGroups)for(const l of o)l!==e&&((r=a(this,Ne).get(l))==null||r._setVisible(Cc,!1,!0));i._setVisible(Cc,!!t,!0),g(this,To,null)}setOCGState({state:e,preserveRB:t}){let n;for(const i of e){switch(i){case"ON":case"OFF":case"Toggle":n=i;continue}const r=a(this,Ne).get(i);if(r)switch(n){case"ON":this.setVisibility(i,!0,t);break;case"OFF":this.setVisibility(i,!1,t);break;case"Toggle":this.setVisibility(i,!r.visible,t);break}}g(this,To,null)}get hasInitialVisibility(){return a(this,ju)===null||this.getHash()===a(this,ju)}getOrder(){return a(this,Ne).size?a(this,Bu)?a(this,Bu).slice():[...a(this,Ne).keys()]:null}getGroup(e){return a(this,Ne).get(e)||null}getHash(){if(a(this,To)!==null)return a(this,To);const e=new HC;for(const[t,n]of a(this,Ne))e.update(`${t}:${n.visible}`);return g(this,To,e.hexdigest())}[Symbol.iterator](){return a(this,Ne).entries()}}To=new WeakMap,Ne=new WeakMap,ju=new WeakMap,Bu=new WeakMap,tp=new WeakSet,Yw=function(e){const t=e.length;if(t<2)return!0;const n=e[0];for(let i=1;i<t;i++){const r=e[i];let o;if(Array.isArray(r))o=x(this,tp,Yw).call(this,r);else if(a(this,Ne).has(r))o=a(this,Ne).get(r).visible;else return ne(`Optional content group not found: ${r}`),!0;switch(n){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return n==="And"};class zD{constructor(e,{disableRange:t=!1,disableStream:n=!1}){me(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:r,progressiveDone:o,contentDispositionFilename:l}=e;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=l,(r==null?void 0:r.length)>0){const c=r instanceof Uint8Array&&r.byteLength===r.buffer.byteLength?r.buffer:new Uint8Array(r).buffer;this._queuedChunks.push(c)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!n,this._isRangeSupported=!t,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((c,u)=>{this._onReceiveData({begin:c,chunk:u})}),e.addProgressListener((c,u)=>{this._onProgress({loaded:c,total:u})}),e.addProgressiveReadListener(c=>{this._onReceiveData({chunk:c})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const n=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{const i=this._rangeReaders.some(function(r){return r._begin!==e?!1:(r._enqueue(n),!0)});me(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,n,i,r;e.total===void 0?(n=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||n.call(t,{loaded:e.loaded}):(r=(i=this._fullRequestReader)==null?void 0:i.onProgress)==null||r.call(i,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){me(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new HD(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new VD(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeReaders.slice(0))n.cancel(e);this._pdfDataRangeTransport.abort()}}class HD{constructor(e,t,n=!1,i=null){this._stream=e,this._done=n||!1,this._filename=G_(i)?i:null,this._queuedChunks=t||[],this._loaded=0;for(const r of this._queuedChunks)this._loaded+=r.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class VD{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function WD(s){let e=!0,t=n("filename\\*","i").exec(s);if(t){t=t[1];let h=l(t);return h=unescape(h),h=c(h),h=u(h),r(h)}if(t=o(s),t){const h=u(t);return r(h)}if(t=n("filename","i").exec(s),t){t=t[1];let h=l(t);return h=u(h),r(h)}function n(h,d){return new RegExp("(?:^|;)\\s*"+h+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',d)}function i(h,d){if(h){if(!/^[\x00-\xFF]+$/.test(d))return d;try{const f=new TextDecoder(h,{fatal:!0}),p=og(d);d=f.decode(p),e=!1}catch{}}return d}function r(h){return e&&/[\x80-\xff]/.test(h)&&(h=i("utf-8",h),e&&(h=i("iso-8859-1",h))),h}function o(h){const d=[];let f;const p=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(f=p.exec(h))!==null;){let[,_,A,m]=f;if(_=parseInt(_,10),_ in d){if(_===0)break;continue}d[_]=[A,m]}const y=[];for(let _=0;_<d.length&&_ in d;++_){let[A,m]=d[_];m=l(m),A&&(m=unescape(m),_===0&&(m=c(m))),y.push(m)}return y.join("")}function l(h){if(h.startsWith('"')){const d=h.slice(1).split('\\"');for(let f=0;f<d.length;++f){const p=d[f].indexOf('"');p!==-1&&(d[f]=d[f].slice(0,p),d.length=f+1),d[f]=d[f].replaceAll(/\\(.)/g,"$1")}h=d.join('"')}return h}function c(h){const d=h.indexOf("'");if(d===-1)return h;const f=h.slice(0,d),y=h.slice(d+1).replace(/^[^']*'/,"");return i(f,y)}function u(h){return!h.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(h)?h:h.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(d,f,p,y){if(p==="q"||p==="Q")return y=y.replaceAll("_"," "),y=y.replaceAll(/=([0-9a-fA-F]{2})/g,function(_,A){return String.fromCharCode(parseInt(A,16))}),i(f,y);try{y=atob(y)}catch{}return i(f,y)})}return""}function tk(s,e){const t=new Headers;if(!s||!e||typeof e!="object")return t;for(const n in e){const i=e[n];i!==void 0&&t.append(n,i)}return t}function f0(s){var e;return((e=URL.parse(s))==null?void 0:e.origin)??null}function nk({responseHeaders:s,isHttp:e,rangeChunkSize:t,disableRange:n}){const i={allowRangeRequests:!1,suggestedLength:void 0},r=parseInt(s.get("Content-Length"),10);return!Number.isInteger(r)||(i.suggestedLength=r,r<=2*t)||n||!e||s.get("Accept-Ranges")!=="bytes"||(s.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function sk(s){const e=s.get("Content-Disposition");if(e){let t=WD(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(G_(t))return t}return null}function hg(s,e){return new uy(`Unexpected server response (${s}) while retrieving PDF "${e}".`,s,s===404||s===0&&e.startsWith("file:"))}function ik(s){return s===200||s===206}function rk(s,e,t){return{method:"GET",headers:s,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function ok(s){return s instanceof Uint8Array?s.buffer:s instanceof ArrayBuffer?s:(ne(`getArrayBuffer - unexpected data format: ${s}`),new Uint8Array(s).buffer)}class GD{constructor(e){B(this,"_responseOrigin",null);this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=tk(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return me(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new qD(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new KD(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class qD{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const n=new Headers(e.headers),i=t.url;fetch(i,rk(n,this._withCredentials,this._abortController)).then(r=>{if(e._responseOrigin=f0(r.url),!ik(r.status))throw hg(r.status,i);this._reader=r.body.getReader(),this._headersCapability.resolve();const o=r.headers,{allowRangeRequests:l,suggestedLength:c}=nk({responseHeaders:o,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=l,this._contentLength=c||this._contentLength,this._filename=sk(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new ha("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:ok(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class KD{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;const i=e.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const r=new Headers(e.headers);r.append("Range",`bytes=${t}-${n-1}`);const o=i.url;fetch(o,rk(r,this._withCredentials,this._abortController)).then(l=>{const c=f0(l.url);if(c!==e._responseOrigin)throw new Error(`Expected range response-origin "${c}" to match "${e._responseOrigin}".`);if(!ik(l.status))throw hg(l.status,o);this._readCapability.resolve(),this._reader=l.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:ok(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const sv=200,iv=206;function XD(s){const e=s.response;return typeof e!="string"?e:og(e).buffer}class YD{constructor({url:e,httpHeaders:t,withCredentials:n}){B(this,"_responseOrigin",null);this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=tk(this.isHttp,t),this.withCredentials=n||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,n=this.currXhrId++,i=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[r,o]of this.headers)t.setRequestHeader(r,o);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),i.expectedStatus=iv):i.expectedStatus=sv,t.responseType="arraybuffer",me(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),i.onHeadersReceived=e.onHeadersReceived,i.onDone=e.onDone,i.onError=e.onError,i.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){var i;const n=this.pendingRequests[e];n&&((i=n.onProgress)==null||i.call(n,t))}onStateChange(e,t){const n=this.pendingRequests[e];if(!n)return;const i=n.xhr;if(i.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),i.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],i.status===0&&this.isHttp){n.onError(i.status);return}const r=i.status||sv;if(!(r===sv&&n.expectedStatus===iv)&&r!==n.expectedStatus){n.onError(i.status);return}const l=XD(i);if(r===iv){const c=i.getResponseHeader("Content-Range"),u=/bytes (\d+)-(\d+)\/(\d+)/.exec(c);u?n.onDone({begin:parseInt(u[1],10),chunk:l}):(ne('Missing or invalid "Content-Range" header.'),n.onError(0))}else l?n.onDone({begin:0,chunk:l}):n.onError(i.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class JD{constructor(e){this._source=e,this._manager=new YD(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return me(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new QD(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const n=new ZD(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class QD{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=f0(t.responseURL);const n=t.getAllResponseHeaders(),i=new Headers(n?n.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(l=>{const[c,...u]=l.split(": ");return[c,u.join(": ")]}):[]),{allowRangeRequests:r,suggestedLength:o}=nk({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});r&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=sk(i),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=hg(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class ZD{constructor(e,t,n){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:n,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var t;const e=f0((t=this._manager.getRequestXhr(this._requestId))==null?void 0:t.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??(this._storedError=hg(e,this._url));for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const eO=/^[a-z][a-z0-9\-+.]+:/i;function tO(s){if(eO.test(s))return new URL(s);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(s))}class nO{constructor(e){this.source=e,this.url=tO(e.url),me(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return me(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new sO(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new iO(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class sO{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const n=process.getBuiltinModule("fs");n.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(n.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=hg(0,this._url.href)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new ha("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class iO{constructor(e,t,n){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=e.source;this._isStreamingSupported=!i.disableStream;const r=process.getBuiltinModule("fs");this._setReadableStream(r.createReadStream(this._url,{start:t,end:n-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Jh=Symbol("INITIAL_DATA");var Wn,np,Jw;class ak{constructor(){w(this,np);w(this,Wn,Object.create(null))}get(e,t=null){if(t){const i=x(this,np,Jw).call(this,e);return i.promise.then(()=>t(i.data)),null}const n=a(this,Wn)[e];if(!n||n.data===Jh)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){const t=a(this,Wn)[e];return!!t&&t.data!==Jh}delete(e){const t=a(this,Wn)[e];return!t||t.data===Jh?!1:(delete a(this,Wn)[e],!0)}resolve(e,t=null){const n=x(this,np,Jw).call(this,e);n.data=t,n.resolve()}clear(){var e;for(const t in a(this,Wn)){const{data:n}=a(this,Wn)[t];(e=n==null?void 0:n.bitmap)==null||e.close()}g(this,Wn,Object.create(null))}*[Symbol.iterator](){for(const e in a(this,Wn)){const{data:t}=a(this,Wn)[e];t!==Jh&&(yield[e,t])}}}Wn=new WeakMap,np=new WeakSet,Jw=function(e){var t;return(t=a(this,Wn))[e]||(t[e]={...Promise.withResolvers(),data:Jh})};const rO=1e5,aS=30;var vS,Po,Rn,sp,ip,dl,wr,rp,op,fl,$u,Uu,Ro,zu,ap,Hu,pl,lp,cp,Vu,gl,up,No,Wu,Kr,lk,ck,Qw,hs,gm,Zw,uk,hk;const wt=class wt{constructor({textContentSource:e,container:t,viewport:n}){w(this,Kr);w(this,Po,Promise.withResolvers());w(this,Rn,null);w(this,sp,!1);w(this,ip,!!((vS=globalThis.FontInspector)!=null&&vS.enabled));w(this,dl,null);w(this,wr,null);w(this,rp,0);w(this,op,0);w(this,fl,null);w(this,$u,null);w(this,Uu,0);w(this,Ro,0);w(this,zu,Object.create(null));w(this,ap,[]);w(this,Hu,null);w(this,pl,[]);w(this,lp,new WeakMap);w(this,cp,null);var c;if(e instanceof ReadableStream)g(this,Hu,e);else if(typeof e=="object")g(this,Hu,new ReadableStream({start(u){u.enqueue(e),u.close()}}));else throw new Error('No "textContentSource" parameter specified.');g(this,Rn,g(this,$u,t)),g(this,Ro,n.scale*Vi.pixelRatio),g(this,Uu,n.rotation),g(this,wr,{div:null,properties:null,ctx:null});const{pageWidth:i,pageHeight:r,pageX:o,pageY:l}=n.rawDims;g(this,cp,[1,0,0,-1,-o,l+r]),g(this,op,i),g(this,rp,r),x(c=wt,hs,uk).call(c),sc(t,n),a(this,Po).promise.finally(()=>{a(wt,Wu).delete(this),g(this,wr,null),g(this,zu,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=Kt.platform;return ae(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{a(this,fl).read().then(({value:t,done:n})=>{if(n){a(this,Po).resolve();return}a(this,dl)??g(this,dl,t.lang),Object.assign(a(this,zu),t.styles),x(this,Kr,lk).call(this,t.items),e()},a(this,Po).reject)};return g(this,fl,a(this,Hu).getReader()),a(wt,Wu).add(this),e(),a(this,Po).promise}update({viewport:e,onBefore:t=null}){var r;const n=e.scale*Vi.pixelRatio,i=e.rotation;if(i!==a(this,Uu)&&(t==null||t(),g(this,Uu,i),sc(a(this,$u),{rotation:i})),n!==a(this,Ro)){t==null||t(),g(this,Ro,n);const o={div:null,properties:null,ctx:x(r=wt,hs,gm).call(r,a(this,dl))};for(const l of a(this,pl))o.properties=a(this,lp).get(l),o.div=l,x(this,Kr,Qw).call(this,o)}}cancel(){var t;const e=new ha("TextLayer task cancelled.");(t=a(this,fl))==null||t.cancel(e).catch(()=>{}),g(this,fl,null),a(this,Po).reject(e)}get textDivs(){return a(this,pl)}get textContentItemsStr(){return a(this,ap)}static cleanup(){if(!(a(this,Wu).size>0)){a(this,Vu).clear();for(const{canvas:e}of a(this,gl).values())e.remove();a(this,gl).clear()}}};Po=new WeakMap,Rn=new WeakMap,sp=new WeakMap,ip=new WeakMap,dl=new WeakMap,wr=new WeakMap,rp=new WeakMap,op=new WeakMap,fl=new WeakMap,$u=new WeakMap,Uu=new WeakMap,Ro=new WeakMap,zu=new WeakMap,ap=new WeakMap,Hu=new WeakMap,pl=new WeakMap,lp=new WeakMap,cp=new WeakMap,Vu=new WeakMap,gl=new WeakMap,up=new WeakMap,No=new WeakMap,Wu=new WeakMap,Kr=new WeakSet,lk=function(e){var i,r;if(a(this,sp))return;(r=a(this,wr)).ctx??(r.ctx=x(i=wt,hs,gm).call(i,a(this,dl)));const t=a(this,pl),n=a(this,ap);for(const o of e){if(t.length>rO){ne("Ignoring additional textDivs for performance reasons."),g(this,sp,!0);return}if(o.str===void 0){if(o.type==="beginMarkedContentProps"||o.type==="beginMarkedContent"){const l=a(this,Rn);g(this,Rn,document.createElement("span")),a(this,Rn).classList.add("markedContent"),o.id&&a(this,Rn).setAttribute("id",`${o.id}`),l.append(a(this,Rn))}else o.type==="endMarkedContent"&&g(this,Rn,a(this,Rn).parentNode);continue}n.push(o.str),x(this,Kr,ck).call(this,o)}},ck=function(e){var _;const t=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};a(this,pl).push(t);const i=K.transform(a(this,cp),e.transform);let r=Math.atan2(i[1],i[0]);const o=a(this,zu)[e.fontName];o.vertical&&(r+=Math.PI/2);let l=a(this,ip)&&o.fontSubstitution||o.fontFamily;l=wt.fontFamilyMap.get(l)||l;const c=Math.hypot(i[2],i[3]),u=c*x(_=wt,hs,hk).call(_,l,o,a(this,dl));let h,d;r===0?(h=i[4],d=i[5]-u):(h=i[4]+u*Math.sin(r),d=i[5]-u*Math.cos(r));const f="calc(var(--total-scale-factor) *",p=t.style;a(this,Rn)===a(this,$u)?(p.left=`${(100*h/a(this,op)).toFixed(2)}%`,p.top=`${(100*d/a(this,rp)).toFixed(2)}%`):(p.left=`${f}${h.toFixed(2)}px)`,p.top=`${f}${d.toFixed(2)}px)`),p.fontSize=`${f}${(a(wt,No)*c).toFixed(2)}px)`,p.fontFamily=l,n.fontSize=c,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,a(this,ip)&&(t.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName),r!==0&&(n.angle=r*(180/Math.PI));let y=!1;if(e.str.length>1)y=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const A=Math.abs(e.transform[0]),m=Math.abs(e.transform[3]);A!==m&&Math.max(A,m)/Math.min(A,m)>1.5&&(y=!0)}if(y&&(n.canvasWidth=o.vertical?e.height:e.width),a(this,lp).set(t,n),a(this,wr).div=t,a(this,wr).properties=n,x(this,Kr,Qw).call(this,a(this,wr)),n.hasText&&a(this,Rn).append(t),n.hasEOL){const A=document.createElement("br");A.setAttribute("role","presentation"),a(this,Rn).append(A)}},Qw=function(e){var l;const{div:t,properties:n,ctx:i}=e,{style:r}=t;let o="";if(a(wt,No)>1&&(o=`scale(${1/a(wt,No)})`),n.canvasWidth!==0&&n.hasText){const{fontFamily:c}=r,{canvasWidth:u,fontSize:h}=n;x(l=wt,hs,Zw).call(l,i,h*a(this,Ro),c);const{width:d}=i.measureText(t.textContent);d>0&&(o=`scaleX(${u*a(this,Ro)/d}) ${o}`)}n.angle!==0&&(o=`rotate(${n.angle}deg) ${o}`),o.length>0&&(r.transform=o)},hs=new WeakSet,gm=function(e=null){let t=a(this,gl).get(e||(e=""));if(!t){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=e,document.body.append(n),t=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),a(this,gl).set(e,t),a(this,up).set(t,{size:0,family:""})}return t},Zw=function(e,t,n){const i=a(this,up).get(e);t===i.size&&n===i.family||(e.font=`${t}px ${n}`,i.size=t,i.family=n)},uk=function(){if(a(this,No)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),g(this,No,e.getBoundingClientRect().height),e.remove()},hk=function(e,t,n){const i=a(this,Vu).get(e);if(i)return i;const r=x(this,hs,gm).call(this,n);r.canvas.width=r.canvas.height=aS,x(this,hs,Zw).call(this,r,aS,e);const o=r.measureText(""),l=o.fontBoundingBoxAscent,c=Math.abs(o.fontBoundingBoxDescent);r.canvas.width=r.canvas.height=0;let u=.8;return l?u=l/(l+c):(Kt.platform.isFirefox&&ne("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?u=t.ascent:t.descent&&(u=1+t.descent)),a(this,Vu).set(e,u),u},w(wt,hs),w(wt,Vu,new Map),w(wt,gl,new Map),w(wt,up,new WeakMap),w(wt,No,null),w(wt,Wu,new Set);let of=wt;const oO=100;function Y_(s={}){typeof s=="string"||s instanceof URL?s={url:s}:(s instanceof ArrayBuffer||ArrayBuffer.isView(s))&&(s={data:s});const e=new eb,{docId:t}=e,n=s.url?fD(s.url):null,i=s.data?pD(s.data):null,r=s.httpHeaders||null,o=s.withCredentials===!0,l=s.password??null,c=s.range instanceof dk?s.range:null,u=Number.isInteger(s.rangeChunkSize)&&s.rangeChunkSize>0?s.rangeChunkSize:2**16;let h=s.worker instanceof af?s.worker:null;const d=s.verbosity,f=typeof s.docBaseUrl=="string"&&!d0(s.docBaseUrl)?s.docBaseUrl:null,p=Lg(s.cMapUrl),y=s.cMapPacked!==!1,_=s.CMapReaderFactory||(gn?xD:qA),A=Lg(s.iccUrl),m=Lg(s.standardFontDataUrl),b=s.StandardFontDataFactory||(gn?AD:KA),v=Lg(s.wasmUrl),S=s.WasmFactory||(gn?SD:XA),C=s.stopAtErrors!==!0,k=Number.isInteger(s.maxImageSize)&&s.maxImageSize>-1?s.maxImageSize:-1,T=s.isEvalSupported!==!1,I=typeof s.isOffscreenCanvasSupported=="boolean"?s.isOffscreenCanvasSupported:!gn,O=typeof s.isImageDecoderSupported=="boolean"?s.isImageDecoderSupported:!gn&&(Kt.platform.isFirefox||!globalThis.chrome),L=Number.isInteger(s.canvasMaxAreaInBytes)?s.canvasMaxAreaInBytes:-1,j=typeof s.disableFontFace=="boolean"?s.disableFontFace:gn,H=s.fontExtraProperties===!0,J=s.enableXfa===!0,Y=s.ownerDocument||globalThis.document,te=s.disableRange===!0,G=s.disableStream===!0,M=s.disableAutoFetch===!0,P=s.pdfBug===!0,R=s.CanvasFactory||(gn?_D:vD),N=s.FilterFactory||(gn?bD:wD),D=s.enableHWA===!0,F=s.useWasm!==!1,U=c?c.length:s.length??NaN,Z=typeof s.useSystemFonts=="boolean"?s.useSystemFonts:!gn&&!j,be=typeof s.useWorkerFetch=="boolean"?s.useWorkerFetch:!!(_===qA&&b===KA&&S===XA&&p&&m&&v&&rd(p,document.baseURI)&&rd(m,document.baseURI)&&rd(v,document.baseURI)),_e=null;UI(d);const ue={canvasFactory:new R({ownerDocument:Y,enableHWA:D}),filterFactory:new N({docId:t,ownerDocument:Y}),cMapReaderFactory:be?null:new _({baseUrl:p,isCompressed:y}),standardFontDataFactory:be?null:new b({baseUrl:m}),wasmFactory:be?null:new S({baseUrl:v})};h||(h=af.create({verbosity:d,port:oi.workerPort}),e._worker=h);const kt={docId:t,apiVersion:"5.4.394",data:i,password:l,disableAutoFetch:M,rangeChunkSize:u,length:U,docBaseUrl:f,enableXfa:J,evaluatorOptions:{maxImageSize:k,disableFontFace:j,ignoreErrors:C,isEvalSupported:T,isOffscreenCanvasSupported:I,isImageDecoderSupported:O,canvasMaxAreaInBytes:L,fontExtraProperties:H,useSystemFonts:Z,useWasm:F,useWorkerFetch:be,cMapUrl:p,iccUrl:A,standardFontDataUrl:m,wasmUrl:v}},va={ownerDocument:Y,pdfBug:P,styleElement:_e,loadingParams:{disableAutoFetch:M,enableXfa:J}};return h.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const Bs=h.messageHandler.sendWithPromise("GetDocRequest",kt,i?[i.buffer]:null);let ln;if(c)ln=new zD(c,{disableRange:te,disableStream:G});else if(!i){if(!n)throw new Error("getDocument - no `url` parameter provided.");const g0=rd(n)?GD:gn?nO:JD;ln=new g0({url:n,length:U,httpHeaders:r,withCredentials:o,rangeChunkSize:u,disableRange:te,disableStream:G})}return Bs.then(g0=>{if(e.destroyed)throw new Error("Loading aborted");if(h.destroyed)throw new Error("Worker was destroyed");const cx=new fd(t,g0,h.port),xT=new cO(cx,e,ln,va,ue,D);e._transport=xT,cx.send("Ready",null)})}).catch(e._capability.reject),e}var Iy;const Dy=class Dy{constructor(){B(this,"_capability",Promise.withResolvers());B(this,"_transport",null);B(this,"_worker",null);B(this,"docId",`d${yt(Dy,Iy)._++}`);B(this,"destroyed",!1);B(this,"onPassword",null);B(this,"onProgress",null)}get promise(){return this._capability.promise}async destroy(){var e,t,n,i;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(r){throw(n=this._worker)!=null&&n.port&&delete this._worker._pendingDestroy,r}this._transport=null,(i=this._worker)==null||i.destroy(),this._worker=null}async getData(){return this._transport.getData()}};Iy=new WeakMap,w(Dy,Iy,0);let eb=Dy;var ml,hp,dp,fp,pp;class dk{constructor(e,t,n=!1,i=null){w(this,ml,Promise.withResolvers());w(this,hp,[]);w(this,dp,[]);w(this,fp,[]);w(this,pp,[]);this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=i}addRangeListener(e){a(this,pp).push(e)}addProgressListener(e){a(this,fp).push(e)}addProgressiveReadListener(e){a(this,dp).push(e)}addProgressiveDoneListener(e){a(this,hp).push(e)}onDataRange(e,t){for(const n of a(this,pp))n(e,t)}onDataProgress(e,t){a(this,ml).promise.then(()=>{for(const n of a(this,fp))n(e,t)})}onDataProgressiveRead(e){a(this,ml).promise.then(()=>{for(const t of a(this,dp))t(e)})}onDataProgressiveDone(){a(this,ml).promise.then(()=>{for(const e of a(this,hp))e()})}transportReady(){a(this,ml).resolve()}requestDataRange(e,t){Me("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}ml=new WeakMap,hp=new WeakMap,dp=new WeakMap,fp=new WeakMap,pp=new WeakMap;class aO{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return ae(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(e,t){return this._transport.getAnnotationsByType(e,t)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var br,yl,vd;class lO{constructor(e,t,n,i=!1){w(this,yl);w(this,br,!1);this._pageIndex=e,this._pageInfo=t,this._transport=n,this._stats=i?new $A:null,this._pdfBug=i,this.commonObjs=n.commonObjs,this.objs=new ak,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:i=0,dontFlip:r=!1}={}){return new lg({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:n,offsetY:i,dontFlip:r})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return ae(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,canvas:t=e.canvas,viewport:n,intent:i="display",annotationMode:r=oo.ENABLE,transform:o=null,background:l=null,optionalContentConfigPromise:c=null,annotationCanvasMap:u=null,pageColors:h=null,printAnnotationStorage:d=null,isEditing:f=!1,recordOperations:p=!1,operationsFilter:y=null}){var O,L,j;(O=this._stats)==null||O.time("Overall");const _=this._transport.getRenderingIntent(i,r,d,f),{renderingIntent:A,cacheKey:m}=_;g(this,br,!1),c||(c=this._transport.getOptionalContentConfig(A));let b=this._intentStates.get(m);b||(b=Object.create(null),this._intentStates.set(m,b)),b.streamReaderCancelTimeout&&(clearTimeout(b.streamReaderCancelTimeout),b.streamReaderCancelTimeout=null);const v=!!(A&rs.PRINT);b.displayReadyCapability||(b.displayReadyCapability=Promise.withResolvers(),b.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(L=this._stats)==null||L.time("Page Request"),this._pumpOperatorList(_));const S=!!(this._pdfBug&&((j=globalThis.StepperManager)!=null&&j.enabled)),C=!this.recordedBBoxes&&(p||S),k=H=>{var J,Y;if(b.renderTasks.delete(T),C){const te=(J=T.gfx)==null?void 0:J.dependencyTracker.take();te&&(T.stepper&&T.stepper.setOperatorBBoxes(te,T.gfx.dependencyTracker.takeDebugMetadata()),p&&(this.recordedBBoxes=te))}v&&g(this,br,!0),x(this,yl,vd).call(this),H?(T.capability.reject(H),this._abortOperatorList({intentState:b,reason:H instanceof Error?H:new Error(H)})):T.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(Y=globalThis.Stats)!=null&&Y.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},T=new tb({callback:k,params:{canvas:t,canvasContext:e,dependencyTracker:C?new CD(t,b.operatorList.length,S):null,viewport:n,transform:o,background:l},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:u,operatorList:b.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!v,pdfBug:this._pdfBug,pageColors:h,enableHWA:this._transport.enableHWA,operationsFilter:y});(b.renderTasks||(b.renderTasks=new Set)).add(T);const I=T.task;return Promise.all([b.displayReadyCapability.promise,c]).then(([H,J])=>{var Y;if(this.destroyed){k();return}if((Y=this._stats)==null||Y.time("Rendering"),!(J.renderingIntent&A))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");T.initializeGraphics({transparency:H,optionalContentConfig:J}),T.operatorListChanged()}).catch(k),I}getOperatorList({intent:e="display",annotationMode:t=oo.ENABLE,printAnnotationStorage:n=null,isEditing:i=!1}={}){var u;function r(){l.operatorList.lastChunk&&(l.opListReadCapability.resolve(l.operatorList),l.renderTasks.delete(c))}const o=this._transport.getRenderingIntent(e,t,n,i,!0);let l=this._intentStates.get(o.cacheKey);l||(l=Object.create(null),this._intentStates.set(o.cacheKey,l));let c;return l.opListReadCapability||(c=Object.create(null),c.operatorListChanged=r,l.opListReadCapability=Promise.withResolvers(),(l.renderTasks||(l.renderTasks=new Set)).add(c),l.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(u=this._stats)==null||u.time("Page Request"),this._pumpOperatorList(o)),l.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>rf.textContent(n));const t=this.streamTextContent(e);return new Promise(function(n,i){function r(){o.read().then(function({value:c,done:u}){if(u){n(l);return}l.lang??(l.lang=c.lang),Object.assign(l.styles,c.styles),l.items.push(...c.items),r()},i)}const o=t.getReader(),l={items:[],styles:Object.create(null),lang:null};r()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),g(this,br,!1),Promise.all(e)}cleanup(e=!1){g(this,br,!0);const t=x(this,yl,vd).call(this);return e&&t&&this._stats&&(this._stats=new $A),t}_startRenderPage(e,t){var i,r;const n=this._intentStates.get(t);n&&((i=this._stats)==null||i.timeEnd("Page Request"),(r=n.displayReadyCapability)==null||r.resolve(e))}_renderPageChunk(e,t){for(let n=0,i=e.length;n<i;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const n of t.renderTasks)n.operatorListChanged();e.lastChunk&&x(this,yl,vd).call(this)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:n,modifiedIds:i}){const{map:r,transfer:o}=n,c=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:r,modifiedIds:i},o).getReader(),u=this._intentStates.get(t);u.streamReader=c;const h=()=>{c.read().then(({value:d,done:f})=>{if(f){u.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(d,u),h())},d=>{if(u.streamReader=null,!this._transport.destroyed){if(u.operatorList){u.operatorList.lastChunk=!0;for(const f of u.renderTasks)f.operatorListChanged();x(this,yl,vd).call(this)}if(u.displayReadyCapability)u.displayReadyCapability.reject(d);else if(u.opListReadCapability)u.opListReadCapability.reject(d);else throw d}})};h()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!n){if(e.renderTasks.size>0)return;if(t instanceof W_){let i=oO;t.extraDelay>0&&t.extraDelay<1e3&&(i+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},i);return}}if(e.streamReader.cancel(new ha(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[i,r]of this._intentStates)if(r===e){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}br=new WeakMap,yl=new WeakSet,vd=function(){if(!a(this,br)||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),g(this,br,!1),!0};var Io,Ys,_r,vl,Oy,wl,bl,vn,mm,fk,pk,wd,Gu,ym;const We=class We{constructor({name:e=null,port:t=null,verbosity:n=zI()}={}){w(this,vn);w(this,Io,Promise.withResolvers());w(this,Ys,null);w(this,_r,null);w(this,vl,null);if(this.name=e,this.destroyed=!1,this.verbosity=n,t){if(a(We,bl).has(t))throw new Error("Cannot use more than one PDFWorker per port.");a(We,bl).set(t,this),x(this,vn,fk).call(this,t)}else x(this,vn,pk).call(this)}get promise(){return a(this,Io).promise}get port(){return a(this,_r)}get messageHandler(){return a(this,Ys)}destroy(){var e,t;this.destroyed=!0,(e=a(this,vl))==null||e.terminate(),g(this,vl,null),a(We,bl).delete(a(this,_r)),g(this,_r,null),(t=a(this,Ys))==null||t.destroy(),g(this,Ys,null)}static create(e){const t=a(this,bl).get(e==null?void 0:e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new We(e)}static get workerSrc(){if(oi.workerSrc)return oi.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return ae(this,"_setupFakeWorkerGlobal",(async()=>a(this,Gu,ym)?a(this,Gu,ym):(await import(this.workerSrc)).WorkerMessageHandler)())}};Io=new WeakMap,Ys=new WeakMap,_r=new WeakMap,vl=new WeakMap,Oy=new WeakMap,wl=new WeakMap,bl=new WeakMap,vn=new WeakSet,mm=function(){a(this,Io).resolve(),a(this,Ys).send("configure",{verbosity:this.verbosity})},fk=function(e){g(this,_r,e),g(this,Ys,new fd("main","worker",e)),a(this,Ys).on("ready",()=>{}),x(this,vn,mm).call(this)},pk=function(){if(a(We,wl)||a(We,Gu,ym)){x(this,vn,wd).call(this);return}let{workerSrc:e}=We;try{We._isSameOrigin(window.location,e)||(e=We._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),n=new fd("main","worker",t),i=()=>{r.abort(),n.destroy(),t.terminate(),this.destroyed?a(this,Io).reject(new Error("Worker was destroyed")):x(this,vn,wd).call(this)},r=new AbortController;t.addEventListener("error",()=>{a(this,vl)||i()},{signal:r.signal}),n.on("test",l=>{if(r.abort(),this.destroyed||!l){i();return}g(this,Ys,n),g(this,_r,t),g(this,vl,t),x(this,vn,mm).call(this)}),n.on("ready",l=>{if(r.abort(),this.destroyed){i();return}try{o()}catch{x(this,vn,wd).call(this)}});const o=()=>{const l=new Uint8Array;n.send("test",l,[l.buffer])};o();return}catch{h0("The worker has been disabled.")}x(this,vn,wd).call(this)},wd=function(){a(We,wl)||(ne("Setting up fake worker."),g(We,wl,!0)),We._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){a(this,Io).reject(new Error("Worker was destroyed"));return}const t=new yD;g(this,_r,t);const n=`fake${yt(We,Oy)._++}`,i=new fd(n+"_worker",n,t);e.setup(i,t),g(this,Ys,new fd(n,n+"_worker",t)),x(this,vn,mm).call(this)}).catch(e=>{a(this,Io).reject(new Error(`Setting up fake worker failed: "${e.message}".`))})},Gu=new WeakSet,ym=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},w(We,Gu),w(We,Oy,0),w(We,wl,!1),w(We,bl,new WeakMap),gn&&(g(We,wl,!0),oi.workerSrc||(oi.workerSrc="./pdf.worker.mjs")),We._isSameOrigin=(e,t)=>{const n=URL.parse(e);if(!(n!=null&&n.origin)||n.origin==="null")return!1;const i=new URL(t,n);return n.origin===i.origin},We._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},We.fromPort=e=>{if(eD("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return We.create(e)};let af=We;var xr,Ni,qu,Ku,Ar,_l,bd;class cO{constructor(e,t,n,i,r,o){w(this,_l);w(this,xr,new Map);w(this,Ni,new Map);w(this,qu,new Map);w(this,Ku,new Map);w(this,Ar,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new ak,this.fontLoader=new hD({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=r.canvasFactory,this.filterFactory=r.filterFactory,this.cMapReaderFactory=r.cMapReaderFactory,this.standardFontDataFactory=r.standardFontDataFactory,this.wasmFactory=r.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=o,this.setupMessageHandler()}get annotationStorage(){return ae(this,"annotationStorage",new q_)}getRenderingIntent(e,t=oo.ENABLE,n=null,i=!1,r=!1){let o=rs.DISPLAY,l=Fw;switch(e){case"any":o=rs.ANY;break;case"display":break;case"print":o=rs.PRINT;break;default:ne(`getRenderingIntent - invalid intent: ${e}`)}const c=o&rs.PRINT&&n instanceof WC?n:this.annotationStorage;switch(t){case oo.DISABLE:o+=rs.ANNOTATIONS_DISABLE;break;case oo.ENABLE:break;case oo.ENABLE_FORMS:o+=rs.ANNOTATIONS_FORMS;break;case oo.ENABLE_STORAGE:o+=rs.ANNOTATIONS_STORAGE,l=c.serializable;break;default:ne(`getRenderingIntent - invalid annotationMode: ${t}`)}i&&(o+=rs.IS_EDITING),r&&(o+=rs.OPLIST);const{ids:u,hash:h}=c.modifiedIds,d=[o,l.hash,h];return{renderingIntent:o,cacheKey:d.join("_"),annotationStorageSerializable:l,modifiedIds:u}}destroy(){var n;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(n=a(this,Ar))==null||n.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const i of a(this,Ni).values())e.push(i._destroy());a(this,Ni).clear(),a(this,qu).clear(),a(this,Ku).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var i,r;this.commonObjs.clear(),this.fontLoader.clear(),a(this,xr).clear(),this.filterFactory.destroy(),of.cleanup(),(i=this._networkStream)==null||i.cancelAllRequests(new ha("Worker was terminated.")),(r=this.messageHandler)==null||r.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(n,i)=>{me(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=r=>{this._lastProgress={loaded:r.loaded,total:r.total}},i.onPull=()=>{this._fullReader.read().then(function({value:r,done:o}){if(o){i.close();return}me(r instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(r),1,[r])}).catch(r=>{i.error(r)})},i.onCancel=r=>{this._fullReader.cancel(r),i.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("ReaderHeadersReady",async n=>{var l;await this._fullReader.headersReady;const{isStreamingSupported:i,isRangeSupported:r,contentLength:o}=this._fullReader;return(!i||!r)&&(this._lastProgress&&((l=t.onProgress)==null||l.call(t,this._lastProgress)),this._fullReader.onProgress=c=>{var u;(u=t.onProgress)==null||u.call(t,{loaded:c.loaded,total:c.total})}),{isStreamingSupported:i,isRangeSupported:r,contentLength:o}}),e.on("GetRangeReader",(n,i)=>{me(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const r=this._networkStream.getRangeReader(n.begin,n.end);if(!r){i.close();return}i.onPull=()=>{r.read().then(function({value:o,done:l}){if(l){i.close();return}me(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{i.error(o)})},i.onCancel=o=>{r.cancel(o),i.ready.catch(l=>{if(!this.destroyed)throw l})}}),e.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,t._capability.resolve(new aO(n,this))}),e.on("DocException",n=>{t._capability.reject(Sn(n))}),e.on("PasswordRequest",n=>{g(this,Ar,Promise.withResolvers());try{if(!t.onPassword)throw Sn(n);const i=r=>{r instanceof Error?a(this,Ar).reject(r):a(this,Ar).resolve({password:r})};t.onPassword(i,n.code)}catch(i){a(this,Ar).reject(i)}return a(this,Ar).promise}),e.on("DataLoaded",n=>{var i;(i=t.onProgress)==null||i.call(t,{loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),e.on("StartRenderPage",n=>{if(this.destroyed)return;a(this,Ni).get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),e.on("commonobj",([n,i,r])=>{var o;if(this.destroyed||this.commonObjs.has(n))return null;switch(i){case"Font":if("error"in r){const f=r.error;ne(`Error during font loading: ${f}`),this.commonObjs.resolve(n,f);break}const l=new jw(r),c=this._params.pdfBug&&((o=globalThis.FontInspector)!=null&&o.enabled)?(f,p)=>globalThis.FontInspector.fontAdded(f,p):null,u=new dD(l,c,r.extra,r.charProcOperatorList);this.fontLoader.bind(u).catch(()=>e.sendWithPromise("FontFallback",{id:n})).finally(()=>{!u.fontExtraProperties&&u.data&&u.clearData(),this.commonObjs.resolve(n,u)});break;case"CopyLocalImage":const{imageRef:h}=r;me(h,"The imageRef must be defined.");for(const f of a(this,Ni).values())for(const[,p]of f.objs)if((p==null?void 0:p.ref)===h)return p.dataLen?(this.commonObjs.resolve(n,structuredClone(p)),p.dataLen):null;break;case"FontPath":case"Image":this.commonObjs.resolve(n,r);break;case"Pattern":const d=new Bw(r);this.commonObjs.resolve(n,d.getIR());break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),e.on("obj",([n,i,r,o])=>{var c;if(this.destroyed)return;const l=a(this,Ni).get(i);if(!l.objs.has(n)){if(l._intentStates.size===0){(c=o==null?void 0:o.bitmap)==null||c.close();return}switch(r){case"Image":case"Pattern":l.objs.resolve(n,o);break;default:throw new Error(`Got unknown object type ${r}`)}}}),e.on("DocProgress",n=>{var i;this.destroyed||(i=t.onProgress)==null||i.call(t,{loaded:n.loaded,total:n.total})}),e.on("FetchBinaryData",async n=>{if(this.destroyed)throw new Error("Worker was destroyed.");const i=this[n.type];if(!i)throw new Error(`${n.type} not initialized, see the \`useWorkerFetch\` parameter.`);return i.fetch(n)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var n;this.annotationStorage.size<=0&&ne("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((n=this._fullReader)==null?void 0:n.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,n=a(this,qu).get(t);if(n)return n;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(r=>{if(this.destroyed)throw new Error("Transport destroyed");r.refStr&&a(this,Ku).set(r.refStr,e);const o=new lO(t,r,this,this._params.pdfBug);return a(this,Ni).set(t,o),o});return a(this,qu).set(t,i),i}getPageIndex(e){return $w(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return x(this,_l,bd).call(this,"GetFieldObjects")}hasJSActions(){return x(this,_l,bd).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(e,t){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:e,pageIndexesToSkip:t})}getDocJSActions(){return x(this,_l,bd).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return x(this,_l,bd).call(this,"GetOptionalContentConfig").then(t=>new UD(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=a(this,xr).get(e);if(t)return t;const n=this.messageHandler.sendWithPromise(e,null).then(i=>{var r,o;return{info:i[0],metadata:i[1]?new BD(i[1]):null,contentDispositionFilename:((r=this._fullReader)==null?void 0:r.filename)??null,contentLength:((o=this._fullReader)==null?void 0:o.contentLength)??null}});return a(this,xr).set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of a(this,Ni).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),a(this,xr).clear(),this.filterFactory.destroy(!0),of.cleanup()}}cachedPageNumber(e){if(!$w(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return a(this,Ku).get(t)??null}}xr=new WeakMap,Ni=new WeakMap,qu=new WeakMap,Ku=new WeakMap,Ar=new WeakMap,_l=new WeakSet,bd=function(e,t=null){const n=a(this,xr).get(e);if(n)return n;const i=this.messageHandler.sendWithPromise(e,t);return a(this,xr).set(e,i),i};var Do;class uO{constructor(e){w(this,Do,null);B(this,"onContinue",null);B(this,"onError",null);g(this,Do,e)}get promise(){return a(this,Do).capability.promise}cancel(e=0){a(this,Do).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=a(this,Do).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=a(this,Do);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}Do=new WeakMap;var Oo,xl;const Ra=class Ra{constructor({callback:e,params:t,objs:n,commonObjs:i,annotationCanvasMap:r,operatorList:o,pageIndex:l,canvasFactory:c,filterFactory:u,useRequestAnimationFrame:h=!1,pdfBug:d=!1,pageColors:f=null,enableHWA:p=!1,operationsFilter:y=null}){w(this,Oo,null);this.callback=e,this.params=t,this.objs=n,this.commonObjs=i,this.annotationCanvasMap=r,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=l,this.canvasFactory=c,this.filterFactory=u,this._pdfBug=d,this.pageColors=f,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=h===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new uO(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvas,this._canvasContext=t.canvas?null:t.canvasContext,this._enableHWA=p,this._dependencyTracker=t.dependencyTracker,this._operationsFilter=y}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var c,u;if(this.cancelled)return;if(this._canvas){if(a(Ra,xl).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");a(Ra,xl).add(this._canvas)}this._pdfBug&&((c=globalThis.StepperManager)!=null&&c.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:n,transform:i,background:r,dependencyTracker:o}=this.params,l=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new Zc(l,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors,o),this.gfx.beginDrawing({transform:i,viewport:n,transparency:e,background:r}),this.operatorListIdx=0,this.graphicsReady=!0,(u=this.graphicsReadyCallback)==null||u.call(this)}cancel(e=null,t=0){var n,i,r;this.running=!1,this.cancelled=!0,(n=this.gfx)==null||n.endDrawing(),a(this,Oo)&&(window.cancelAnimationFrame(a(this,Oo)),g(this,Oo,null)),a(Ra,xl).delete(this._canvas),e||(e=new W_(`Rendering cancelled, page ${this._pageIndex+1}`,t)),this.callback(e),(r=(i=this.task).onError)==null||r.call(i,e)}operatorListChanged(){var e,t;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.gfx.dependencyTracker)==null||e.growOperationsCount(this.operatorList.fnArray.length),(t=this.stepper)==null||t.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?g(this,Oo,window.requestAnimationFrame(()=>{g(this,Oo,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),a(Ra,xl).delete(this._canvas),this.callback())))}};Oo=new WeakMap,xl=new WeakMap,w(Ra,xl,new WeakSet);let tb=Ra;const hO="5.4.394",dO="2cc809ade";var Gn,Al,Xu,xt,gp,Yu,Sr,mp,Lo,Js,yp,Ie,nb,sb,ib,Ea,gk,Zr;const En=class En{constructor({editor:e=null,uiManager:t=null}){w(this,Ie);w(this,Gn,null);w(this,Al,null);w(this,Xu);w(this,xt,null);w(this,gp,!1);w(this,Yu,!1);w(this,Sr,null);w(this,mp);w(this,Lo,null);w(this,Js,null);var n,i;e?(g(this,Yu,!1),g(this,Sr,e)):g(this,Yu,!0),g(this,Js,(e==null?void 0:e._uiManager)||t),g(this,mp,a(this,Js)._eventBus),g(this,Xu,((n=e==null?void 0:e.color)==null?void 0:n.toUpperCase())||((i=a(this,Js))==null?void 0:i.highlightColors.values().next().value)||"#FFFF98"),a(En,yp)||g(En,yp,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return ae(this,"_keyboardManager",new ug([[["Escape","mac+Escape"],En.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],En.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],En.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],En.prototype._moveToPrevious],[["Home","mac+Home"],En.prototype._moveToBeginning],[["End","mac+End"],En.prototype._moveToEnd]]))}renderButton(){const e=g(this,Gn,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",a(this,Sr)&&(e.ariaControls=`${a(this,Sr).id}_colorpicker_dropdown`);const t=a(this,Js)._signal;e.addEventListener("click",x(this,Ie,Ea).bind(this),{signal:t}),e.addEventListener("keydown",x(this,Ie,ib).bind(this),{signal:t});const n=g(this,Al,document.createElement("span"));return n.className="swatch",n.ariaHidden="true",n.style.backgroundColor=a(this,Xu),e.append(n),e}renderMainDropdown(){const e=g(this,xt,x(this,Ie,nb).call(this));return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}_colorSelectFromKeyboard(e){if(e.target===a(this,Gn)){x(this,Ie,Ea).call(this,e);return}const t=e.target.getAttribute("data-color");t&&x(this,Ie,sb).call(this,t,e)}_moveToNext(e){var t,n;if(!a(this,Ie,Zr)){x(this,Ie,Ea).call(this,e);return}if(e.target===a(this,Gn)){(t=a(this,xt).firstChild)==null||t.focus();return}(n=e.target.nextSibling)==null||n.focus()}_moveToPrevious(e){var t,n;if(e.target===((t=a(this,xt))==null?void 0:t.firstChild)||e.target===a(this,Gn)){a(this,Ie,Zr)&&this._hideDropdownFromKeyboard();return}a(this,Ie,Zr)||x(this,Ie,Ea).call(this,e),(n=e.target.previousSibling)==null||n.focus()}_moveToBeginning(e){var t;if(!a(this,Ie,Zr)){x(this,Ie,Ea).call(this,e);return}(t=a(this,xt).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!a(this,Ie,Zr)){x(this,Ie,Ea).call(this,e);return}(t=a(this,xt).lastChild)==null||t.focus()}hideDropdown(){var e,t;(e=a(this,xt))==null||e.classList.add("hidden"),a(this,Gn).ariaExpanded="false",(t=a(this,Lo))==null||t.abort(),g(this,Lo,null)}_hideDropdownFromKeyboard(){var e;if(!a(this,Yu)){if(!a(this,Ie,Zr)){(e=a(this,Sr))==null||e.unselect();return}this.hideDropdown(),a(this,Gn).focus({preventScroll:!0,focusVisible:a(this,gp)})}}updateColor(e){if(a(this,Al)&&(a(this,Al).style.backgroundColor=e),!a(this,xt))return;const t=a(this,Js).highlightColors.values();for(const n of a(this,xt).children)n.ariaSelected=t.next().value===e.toUpperCase()}destroy(){var e,t;(e=a(this,Gn))==null||e.remove(),g(this,Gn,null),g(this,Al,null),(t=a(this,xt))==null||t.remove(),g(this,xt,null)}};Gn=new WeakMap,Al=new WeakMap,Xu=new WeakMap,xt=new WeakMap,gp=new WeakMap,Yu=new WeakMap,Sr=new WeakMap,mp=new WeakMap,Lo=new WeakMap,Js=new WeakMap,yp=new WeakMap,Ie=new WeakSet,nb=function(){const e=document.createElement("div"),t=a(this,Js)._signal;e.addEventListener("contextmenu",js,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),a(this,Sr)&&(e.id=`${a(this,Sr).id}_colorpicker_dropdown`);for(const[n,i]of a(this,Js).highlightColors){const r=document.createElement("button");r.tabIndex="0",r.role="option",r.setAttribute("data-color",i),r.title=n,r.setAttribute("data-l10n-id",a(En,yp)[n]);const o=document.createElement("span");r.append(o),o.className="swatch",o.style.backgroundColor=i,r.ariaSelected=i===a(this,Xu),r.addEventListener("click",x(this,Ie,sb).bind(this,i),{signal:t}),e.append(r)}return e.addEventListener("keydown",x(this,Ie,ib).bind(this),{signal:t}),e},sb=function(e,t){t.stopPropagation(),a(this,mp).dispatch("switchannotationeditorparams",{source:this,type:ge.HIGHLIGHT_COLOR,value:e}),this.updateColor(e)},ib=function(e){En._keyboardManager.exec(this,e)},Ea=function(e){if(a(this,Ie,Zr)){this.hideDropdown();return}if(g(this,gp,e.detail===0),a(this,Lo)||(g(this,Lo,new AbortController),window.addEventListener("pointerdown",x(this,Ie,gk).bind(this),{signal:a(this,Js).combinedSignal(a(this,Lo))})),a(this,Gn).ariaExpanded="true",a(this,xt)){a(this,xt).classList.remove("hidden");return}const t=g(this,xt,x(this,Ie,nb).call(this));a(this,Gn).append(t)},gk=function(e){var t;(t=a(this,xt))!=null&&t.contains(e.target)||this.hideDropdown()},Zr=function(){return a(this,xt)&&!a(this,xt).classList.contains("hidden")},w(En,yp,null);let yy=En;var Ii,vp,Ju,wp;const Na=class Na{constructor(e){w(this,Ii,null);w(this,vp,null);w(this,Ju,null);g(this,vp,e),g(this,Ju,e._uiManager),a(Na,wp)||g(Na,wp,Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"}))}renderButton(){if(a(this,Ii))return a(this,Ii);const{editorType:e,colorType:t,color:n}=a(this,vp),i=g(this,Ii,document.createElement("input"));return i.type="color",i.value=n||"#000000",i.className="basicColorPicker",i.tabIndex=0,i.setAttribute("data-l10n-id",a(Na,wp)[e]),i.addEventListener("input",()=>{a(this,Ju).updateParams(t,i.value)},{signal:a(this,Ju)._signal}),i}update(e){a(this,Ii)&&(a(this,Ii).value=e)}destroy(){var e;(e=a(this,Ii))==null||e.remove(),g(this,Ii,null)}hideDropdown(){}};Ii=new WeakMap,vp=new WeakMap,Ju=new WeakMap,wp=new WeakMap,w(Na,wp,null);let vy=Na;function lS(s){return Math.floor(Math.max(0,Math.min(1,s))*255).toString(16).padStart(2,"0")}function Qh(s){return Math.max(0,Math.min(255,255*s))}class cS{static CMYK_G([e,t,n,i]){return["G",1-Math.min(1,.3*e+.59*n+.11*t+i)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=Qh(e),[e,e,e]}static G_HTML([e]){const t=lS(e);return`#${t}${t}${t}`}static RGB_G([e,t,n]){return["G",.3*e+.59*t+.11*n]}static RGB_rgb(e){return e.map(Qh)}static RGB_HTML(e){return`#${e.map(lS).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,n,i]){return["RGB",1-Math.min(1,e+i),1-Math.min(1,n+i),1-Math.min(1,t+i)]}static CMYK_rgb([e,t,n,i]){return[Qh(1-Math.min(1,e+i)),Qh(1-Math.min(1,n+i)),Qh(1-Math.min(1,t+i))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,n]){const i=1-e,r=1-t,o=1-n,l=Math.min(i,r,o);return["CMYK",i,r,o,l]}}class fO{create(e,t,n=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),n||(i.setAttribute("width",`${e}px`),i.setAttribute("height",`${t}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${e} ${t}`),i}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){Me("Abstract method `_createSVG` called.")}}class wy extends fO{_createSVG(e){return document.createElementNS(Ki,e)}}const pO=9,rc=new WeakSet,gO=new Date().getTimezoneOffset()*60*1e3;class rv{static create(e){switch(e.data.annotationType){case ft.LINK:return new J_(e);case ft.TEXT:return new yO(e);case ft.WIDGET:switch(e.data.fieldType){case"Tx":return new vO(e);case"Btn":return e.data.radioButton?new vk(e):e.data.checkBox?new bO(e):new _O(e);case"Ch":return new xO(e);case"Sig":return new wO(e)}return new uc(e);case ft.POPUP:return new ob(e);case ft.FREETEXT:return new Ak(e);case ft.LINE:return new SO(e);case ft.SQUARE:return new EO(e);case ft.CIRCLE:return new CO(e);case ft.POLYLINE:return new Sk(e);case ft.CARET:return new TO(e);case ft.INK:return new Q_(e);case ft.POLYGON:return new kO(e);case ft.HIGHLIGHT:return new Ek(e);case ft.UNDERLINE:return new PO(e);case ft.SQUIGGLY:return new RO(e);case ft.STRIKEOUT:return new NO(e);case ft.STAMP:return new Ck(e);case ft.FILEATTACHMENT:return new IO(e);default:return new et(e)}}}var Sl,Qu,Cs,bp,rb;const ax=class ax{constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:i=!1}={}){w(this,bp);w(this,Sl,null);w(this,Qu,!1);w(this,Cs,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableComment=e.enableComment,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,this.hasOwnCommentButton=!1,t&&(this.contentElement=this.container=this._createContainer(n)),i&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:t}){return!!(e!=null&&e.str||t!=null&&t.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return ax._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){var n;const{data:e}=this,t=(n=this.annotationStorage)==null?void 0:n.getEditor(e.id);return t?t.getData():e}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){var l;const e=(l=this.annotationStorage)==null?void 0:l.getEditor(this.data.id);if(e)return e.commentButtonPositionInPage;const{quadPoints:t,inkLists:n,rect:i}=this.data;let r=-1/0,o=-1/0;if((t==null?void 0:t.length)>=8){for(let c=0;c<t.length;c+=8)t[c+1]>o?(o=t[c+1],r=t[c+2]):t[c+1]===o&&(r=Math.max(r,t[c+2]));return[r,o]}if((n==null?void 0:n.length)>=1){for(const c of n)for(let u=0,h=c.length;u<h;u+=2)c[u+1]>o?(o=c[u+1],r=c[u]):c[u+1]===o&&(r=Math.max(r,c[u]));if(r!==1/0)return[r,o]}return i?[i[2],i[3]]:null}_normalizePoint(e){const{page:{view:t},viewport:{rawDims:{pageWidth:n,pageHeight:i,pageX:r,pageY:o}}}=this.parent;return e[1]=t[3]-e[1]+t[1],e[0]=100*(e[0]-r)/n,e[1]=100*(e[1]-o)/i,e}get commentText(){var t,n,i;const{data:e}=this;return((n=(t=this.annotationStorage.getRawValue(`${nf}${e.id}`))==null?void 0:t.popup)==null?void 0:n.contents)||((i=e.contentsObj)==null?void 0:i.str)||""}set commentText(e){const{data:t}=this,n={deleted:!e,contents:e||""};this.annotationStorage.updateEditor(t.id,{popup:n})||this.annotationStorage.setValue(`${nf}${t.id}`,{id:t.id,annotationType:t.annotationType,pageIndex:this.parent.page._pageIndex,popup:n,popupRef:t.popupRef,modificationDate:new Date}),e||this.removePopup()}removePopup(){var e,t;(t=((e=a(this,Cs))==null?void 0:e.popup)||this.popup)==null||t.remove(),g(this,Cs,this.popup=null)}updateEdited(e){var r;if(!this.container)return;e.rect&&(a(this,Sl)||g(this,Sl,{rect:this.data.rect.slice(0)}));const{rect:t,popup:n}=e;t&&x(this,bp,rb).call(this,t);let i=((r=a(this,Cs))==null?void 0:r.popup)||this.popup;!i&&(n!=null&&n.text)&&(this._createPopup(n),i=a(this,Cs).popup),i&&(i.updateEdited(e),n!=null&&n.deleted&&(i.remove(),g(this,Cs,null),this.popup=null))}resetEdited(){var e;a(this,Sl)&&(x(this,bp,rb).call(this,a(this,Sl).rect),(e=a(this,Cs))==null||e.popup.resetEdited(),g(this,Sl,null))}_createContainer(e){const{data:t,parent:{page:n,viewport:i}}=this,r=document.createElement("section");r.setAttribute("data-annotation-id",t.id),!(this instanceof uc)&&!(this instanceof J_)&&(r.tabIndex=0);const{style:o}=r;if(o.zIndex=this.parent.zIndex,this.parent.zIndex+=2,t.alternativeText&&(r.title=t.alternativeText),t.noRotate&&r.classList.add("norotate"),!t.rect||this instanceof ob){const{rotation:_}=t;return!t.hasOwnCanvas&&_!==0&&this.setRotation(_,r),r}const{width:l,height:c}=this;if(!e&&t.borderStyle.width>0){o.borderWidth=`${t.borderStyle.width}px`;const _=t.borderStyle.horizontalCornerRadius,A=t.borderStyle.verticalCornerRadius;if(_>0||A>0){const b=`calc(${_}px * var(--total-scale-factor)) / calc(${A}px * var(--total-scale-factor))`;o.borderRadius=b}else if(this instanceof vk){const b=`calc(${l}px * var(--total-scale-factor)) / calc(${c}px * var(--total-scale-factor))`;o.borderRadius=b}switch(t.borderStyle.style){case _c.SOLID:o.borderStyle="solid";break;case _c.DASHED:o.borderStyle="dashed";break;case _c.BEVELED:ne("Unimplemented border style: beveled");break;case _c.INSET:ne("Unimplemented border style: inset");break;case _c.UNDERLINE:o.borderBottomStyle="solid";break}const m=t.borderColor||null;m?(g(this,Qu,!0),o.borderColor=K.makeHexColor(m[0]|0,m[1]|0,m[2]|0)):o.borderWidth=0}const u=K.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),{pageWidth:h,pageHeight:d,pageX:f,pageY:p}=i.rawDims;o.left=`${100*(u[0]-f)/h}%`,o.top=`${100*(u[1]-p)/d}%`;const{rotation:y}=t;return t.hasOwnCanvas||y===0?(o.width=`${100*l/h}%`,o.height=`${100*c/d}%`):this.setRotation(y,r),r}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:n,pageHeight:i}=this.parent.viewport.rawDims;let{width:r,height:o}=this;e%180!==0&&([r,o]=[o,r]),t.style.width=`${100*r/n}%`,t.style.height=`${100*o/i}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,n,i)=>{const r=i.detail[t],o=r[0],l=r.slice(1);i.target.style[n]=cS[`${o}_HTML`](l),this.annotationStorage.setValue(this.data.id,{[n]:cS[`${o}_rgb`](l)})};return ae(this,"_commonActions",{display:t=>{const{display:n}=t.detail,i=n%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:n===1||n===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:n}=t.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const n=t.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(e,t){const n=this._commonActions;for(const i of Object.keys(t.detail)){const r=e[i]||n[i];r==null||r(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const n=this._commonActions;for(const[i,r]of Object.entries(t)){const o=n[i];if(o){const l={detail:{[i]:r},target:e};o(l),delete t[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,n,i,r]=this.data.rect.map(_=>Math.fround(_));if(e.length===8){const[_,A,m,b]=e.subarray(2,6);if(i===_&&r===A&&t===m&&n===b)return}const{style:o}=this.container;let l;if(a(this,Qu)){const{borderColor:_,borderWidth:A}=o;o.borderWidth=0,l=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${_}" stroke-width="${A}">`],this.container.classList.add("hasBorder")}const c=i-t,u=r-n,{svgFactory:h}=this,d=h.createElement("svg");d.classList.add("quadrilateralsContainer"),d.setAttribute("width",0),d.setAttribute("height",0),d.role="none";const f=h.createElement("defs");d.append(f);const p=h.createElement("clipPath"),y=`clippath_${this.data.id}`;p.setAttribute("id",y),p.setAttribute("clipPathUnits","objectBoundingBox"),f.append(p);for(let _=2,A=e.length;_<A;_+=8){const m=e[_],b=e[_+1],v=e[_+2],S=e[_+3],C=h.createElement("rect"),k=(v-t)/c,T=(r-b)/u,I=(m-v)/c,O=(b-S)/u;C.setAttribute("x",k),C.setAttribute("y",T),C.setAttribute("width",I),C.setAttribute("height",O),p.append(C),l==null||l.push(`<rect vector-effect="non-scaling-stroke" x="${k}" y="${T}" width="${I}" height="${O}"/>`)}a(this,Qu)&&(l.push("</g></svg>')"),o.backgroundImage=l.join("")),this.container.append(d),this.container.style.clipPath=`url(#${y})`}_createPopup(e=null){const{data:t}=this;let n,i;e?(n={str:e.text},i=e.date):(n=t.contentsObj,i=t.modificationDate),g(this,Cs,new ob({data:{color:t.color,titleObj:t.titleObj,modificationDate:i,contentsObj:n,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]}))}get hasPopupElement(){return!!(a(this,Cs)||this.popup||this.data.popupRef)}get extraPopupElement(){return a(this,Cs)}render(){Me("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const n=[];if(this._fieldObjects){const i=this._fieldObjects[e];if(i)for(const{page:r,id:o,exportValues:l}of i){if(r===-1||o===t)continue;const c=typeof l=="string"?l:null,u=document.querySelector(`[data-element-id="${o}"]`);if(u&&!rc.has(u)){ne(`_getElementsByName - element not allowed: ${o}`);continue}n.push({id:o,exportValue:c,domElement:u})}return n}for(const i of document.getElementsByName(e)){const{exportValue:r}=i,o=i.getAttribute("data-element-id");o!==t&&rc.has(i)&&n.push({id:o,exportValue:r,domElement:i})}return n}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var n;(n=this.linkService.eventBus)==null||n.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}};Sl=new WeakMap,Qu=new WeakMap,Cs=new WeakMap,bp=new WeakSet,rb=function(e){const{container:{style:t},data:{rect:n,rotation:i},parent:{viewport:{rawDims:{pageWidth:r,pageHeight:o,pageX:l,pageY:c}}}}=this;n==null||n.splice(0,4,...e),t.left=`${100*(e[0]-l)/r}%`,t.top=`${100*(o-e[3]+c)/o}%`,i===0?(t.width=`${100*(e[2]-e[0])/r}%`,t.height=`${100*(e[3]-e[1])/o}%`):this.setRotation(i)};let et=ax;class mO extends et{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.editor=e.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:e}=this;e.hasComment&&this._createPopup(e.comment)}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(e){this.editor.comment=e,e||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.parent.removeAnnotation(this.data.id),this.container.remove(),this.container=null,this.removePopup()}}var ls,Ca,mk,yk;class J_ extends et{constructor(t,n=null){super(t,{isRenderable:!0,ignoreBorder:!!(n!=null&&n.ignoreBorder),createQuadrilaterals:!0});w(this,ls);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:n}=this,i=document.createElement("a");i.setAttribute("data-element-id",t.id);let r=!1;return t.url?(n.addLinkAttributes(i,t.url,t.newWindow),r=!0):t.action?(this._bindNamedAction(i,t.action,t.overlaidText),r=!0):t.attachment?(x(this,ls,mk).call(this,i,t.attachment,t.overlaidText,t.attachmentDest),r=!0):t.setOCGState?(x(this,ls,yk).call(this,i,t.setOCGState,t.overlaidText),r=!0):t.dest?(this._bindLink(i,t.dest,t.overlaidText),r=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,t),r=!0),t.resetForm?(this._bindResetFormAction(i,t.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(i,""),r=!0)),this.container.classList.add("linkAnnotation"),r&&(this.contentElement=i,this.container.append(i)),this.container}_bindLink(t,n,i=""){t.href=this.linkService.getDestinationHash(n),t.onclick=()=>(n&&this.linkService.goToDestination(n),!1),(n||n==="")&&x(this,ls,Ca).call(this),i&&(t.title=i)}_bindNamedAction(t,n,i=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(n),!1),i&&(t.title=i),x(this,ls,Ca).call(this)}_bindJSAction(t,n){t.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const r of Object.keys(n.actions)){const o=i.get(r);o&&(t[o]=()=>{var l;return(l=this.linkService.eventBus)==null||l.dispatch("dispatcheventinsandbox",{source:this,detail:{id:n.id,name:r}}),!1})}n.overlaidText&&(t.title=n.overlaidText),t.onclick||(t.onclick=()=>!1),x(this,ls,Ca).call(this)}_bindResetFormAction(t,n){const i=t.onclick;if(i||(t.href=this.linkService.getAnchorUrl("")),x(this,ls,Ca).call(this),!this._fieldObjects){ne('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(t.onclick=()=>!1);return}t.onclick=()=>{var d;i==null||i();const{fields:r,refs:o,include:l}=n,c=[];if(r.length!==0||o.length!==0){const f=new Set(o);for(const p of r){const y=this._fieldObjects[p]||[];for(const{id:_}of y)f.add(_)}for(const p of Object.values(this._fieldObjects))for(const y of p)f.has(y.id)===l&&c.push(y)}else for(const f of Object.values(this._fieldObjects))c.push(...f);const u=this.annotationStorage,h=[];for(const f of c){const{id:p}=f;switch(h.push(p),f.type){case"text":{const _=f.defaultValue||"";u.setValue(p,{value:_});break}case"checkbox":case"radiobutton":{const _=f.defaultValue===f.exportValues;u.setValue(p,{value:_});break}case"combobox":case"listbox":{const _=f.defaultValue||"";u.setValue(p,{value:_});break}default:continue}const y=document.querySelector(`[data-element-id="${p}"]`);if(y){if(!rc.has(y)){ne(`_bindResetFormAction - element not allowed: ${p}`);continue}}else continue;y.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((d=this.linkService.eventBus)==null||d.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:h,name:"ResetForm"}})),!1}}}ls=new WeakSet,Ca=function(){this.container.setAttribute("data-internal-link","")},mk=function(t,n,i="",r=null){t.href=this.linkService.getAnchorUrl(""),n.description?t.title=n.description:i&&(t.title=i),t.onclick=()=>{var o;return(o=this.downloadManager)==null||o.openOrDownloadData(n.content,n.filename,r),!1},x(this,ls,Ca).call(this)},yk=function(t,n,i=""){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(n),!1),i&&(t.title=i),x(this,ls,Ca).call(this)};class yO extends et{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(e),this.container}}class uc extends et{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return Kt.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,n,i,r){n.includes("mouse")?e.addEventListener(n,o=>{var l;(l=this.linkService.eventBus)==null||l.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):e.addEventListener(n,o=>{var l;if(n==="blur"){if(!t.focused||!o.relatedTarget)return;t.focused=!1}else if(n==="focus"){if(t.focused)return;t.focused=!0}r&&((l=this.linkService.eventBus)==null||l.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:r(o)}}))})}_setEventListeners(e,t,n,i){var r,o,l;for(const[c,u]of n)(u==="Action"||(r=this.data.actions)!=null&&r[u])&&((u==="Focus"||u==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,c,u,i),u==="Focus"&&!((o=this.data.actions)!=null&&o.Blur)?this._setEventListener(e,t,"blur","Blur",null):u==="Blur"&&!((l=this.data.actions)!=null&&l.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":K.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||pO,r=e.style;let o;const l=2,c=u=>Math.round(10*u)/10;if(this.data.multiLine){const u=Math.abs(this.data.rect[3]-this.data.rect[1]-l),h=Math.round(u/(J0*i))||1,d=u/h;o=Math.min(i,c(d/J0))}else{const u=Math.abs(this.data.rect[3]-this.data.rect[1]-l);o=Math.min(i,c(u/J0))}r.fontSize=`calc(${o}px * var(--total-scale-factor))`,r.color=K.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(r.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class vO extends uc{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,n,i){const r=this.annotationStorage;for(const o of this._getElementsByName(e.name,e.id))o.domElement&&(o.domElement[t]=n),r.setValue(o.id,{[i]:n})}render(){var i,r;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){const o=e.getValue(t,{value:this.data.fieldValue});let l=o.value||"";const c=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;c&&l.length>c&&(l=l.slice(0,c));let u=o.formattedValue||((i=this.data.textContent)==null?void 0:i.join(`
`))||null;u&&this.data.comb&&(u=u.replaceAll(/\s+/g,""));const h={userValue:l,formattedValue:u,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=u??l,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type=this.data.password?"password":"text",n.setAttribute("value",u??l),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),rc.add(n),this.contentElement=n,n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=0;const{datetimeFormat:d,datetimeType:f,timeStep:p}=this.data,y=!!f&&this.enableScripting;d&&(n.title=d),this._setRequired(n,this.data.required),c&&(n.maxLength=c),n.addEventListener("input",A=>{e.setValue(t,{value:A.target.value}),this.setPropertyOnSiblings(n,"value",A.target.value,"value"),h.formattedValue=null}),n.addEventListener("resetform",A=>{const m=this.data.defaultFieldValue??"";n.value=h.userValue=m,h.formattedValue=null});let _=A=>{const{formattedValue:m}=h;m!=null&&(A.target.value=m),A.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",m=>{var v;if(h.focused)return;const{target:b}=m;if(y&&(b.type=f,p&&(b.step=p)),h.userValue){const S=h.userValue;if(y)if(f==="time"){const C=new Date(S),k=[C.getHours(),C.getMinutes(),C.getSeconds()];b.value=k.map(T=>T.toString().padStart(2,"0")).join(":")}else b.value=new Date(S-gO).toISOString().split(f==="date"?"T":".",1)[0];else b.value=S}h.lastCommittedValue=b.value,h.commitKey=1,(v=this.data.actions)!=null&&v.Focus||(h.focused=!0)}),n.addEventListener("updatefromsandbox",m=>{this.showElementAndHideCanvas(m.target);const b={value(v){h.userValue=v.detail.value??"",y||e.setValue(t,{value:h.userValue.toString()}),v.target.value=h.userValue},formattedValue(v){const{formattedValue:S}=v.detail;h.formattedValue=S,S!=null&&v.target!==document.activeElement&&(v.target.value=S);const C={formattedValue:S};y&&(C.value=S),e.setValue(t,C)},selRange(v){v.target.setSelectionRange(...v.detail.selRange)},charLimit:v=>{var T;const{charLimit:S}=v.detail,{target:C}=v;if(S===0){C.removeAttribute("maxLength");return}C.setAttribute("maxLength",S);let k=h.userValue;!k||k.length<=S||(k=k.slice(0,S),C.value=h.userValue=k,e.setValue(t,{value:k}),(T=this.linkService.eventBus)==null||T.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:k,willCommit:!0,commitKey:1,selStart:C.selectionStart,selEnd:C.selectionEnd}}))}};this._dispatchEventFromSandbox(b,m)}),n.addEventListener("keydown",m=>{var S;h.commitKey=1;let b=-1;if(m.key==="Escape"?b=0:m.key==="Enter"&&!this.data.multiLine?b=2:m.key==="Tab"&&(h.commitKey=3),b===-1)return;const{value:v}=m.target;h.lastCommittedValue!==v&&(h.lastCommittedValue=v,h.userValue=v,(S=this.linkService.eventBus)==null||S.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:v,willCommit:!0,commitKey:b,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}}))});const A=_;_=null,n.addEventListener("blur",m=>{var S,C;if(!h.focused||!m.relatedTarget)return;(S=this.data.actions)!=null&&S.Blur||(h.focused=!1);const{target:b}=m;let{value:v}=b;if(y){if(v&&f==="time"){const k=v.split(":").map(T=>parseInt(T,10));v=new Date(2e3,0,1,k[0],k[1],k[2]||0).valueOf(),b.step=""}else v.includes("T")||(v=`${v}T00:00`),v=new Date(v).valueOf();b.type="text"}h.userValue=v,h.lastCommittedValue!==v&&((C=this.linkService.eventBus)==null||C.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:v,willCommit:!0,commitKey:h.commitKey,selStart:m.target.selectionStart,selEnd:m.target.selectionEnd}})),A(m)}),(r=this.data.actions)!=null&&r.Keystroke&&n.addEventListener("beforeinput",m=>{var O;h.lastCommittedValue=null;const{data:b,target:v}=m,{value:S,selectionStart:C,selectionEnd:k}=v;let T=C,I=k;switch(m.inputType){case"deleteWordBackward":{const L=S.substring(0,C).match(/\w*[^\w]*$/);L&&(T-=L[0].length);break}case"deleteWordForward":{const L=S.substring(C).match(/^[^\w]*\w*/);L&&(I+=L[0].length);break}case"deleteContentBackward":C===k&&(T-=1);break;case"deleteContentForward":C===k&&(I+=1);break}m.preventDefault(),(O=this.linkService.eventBus)==null||O.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:S,change:b||"",willCommit:!1,selStart:T,selEnd:I}})}),this._setEventListeners(n,h,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],m=>m.target.value)}if(_&&n.addEventListener("blur",_),this.data.comb){const m=(this.data.rect[2]-this.data.rect[0])/c;n.classList.add("comb"),n.style.letterSpacing=`calc(${m}px * var(--total-scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class wO extends uc{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class bO extends uc{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,n=t.id;let i=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",e.setValue(n,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const r=document.createElement("input");return rc.add(r),r.setAttribute("data-element-id",n),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="checkbox",r.name=t.fieldName,i&&r.setAttribute("checked",!0),r.setAttribute("exportValue",t.exportValue),r.tabIndex=0,r.addEventListener("change",o=>{const{name:l,checked:c}=o.target;for(const u of this._getElementsByName(l,n)){const h=c&&u.exportValue===t.exportValue;u.domElement&&(u.domElement.checked=h),e.setValue(u.id,{value:h})}e.setValue(n,{value:c})}),r.addEventListener("resetform",o=>{const l=t.defaultFieldValue||"Off";o.target.checked=l===t.exportValue}),this.enableScripting&&this.hasJSActions&&(r.addEventListener("updatefromsandbox",o=>{const l={value(c){c.target.checked=c.detail.value!=="Off",e.setValue(n,{value:c.target.checked})}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class vk extends uc{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,n=t.id;let i=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;if(typeof i=="string"&&(i=i!==t.buttonValue,e.setValue(n,{value:i})),i)for(const o of this._getElementsByName(t.fieldName,n))e.setValue(o.id,{value:!1});const r=document.createElement("input");if(rc.add(r),r.setAttribute("data-element-id",n),r.disabled=t.readOnly,this._setRequired(r,this.data.required),r.type="radio",r.name=t.fieldName,i&&r.setAttribute("checked",!0),r.tabIndex=0,r.addEventListener("change",o=>{const{name:l,checked:c}=o.target;for(const u of this._getElementsByName(l,n))e.setValue(u.id,{value:!1});e.setValue(n,{value:c})}),r.addEventListener("resetform",o=>{const l=t.defaultFieldValue;o.target.checked=l!=null&&l===t.buttonValue}),this.enableScripting&&this.hasJSActions){const o=t.buttonValue;r.addEventListener("updatefromsandbox",l=>{const c={value:u=>{const h=o===u.detail.value;for(const d of this._getElementsByName(u.target.name)){const f=h&&d.id===n;d.domElement&&(d.domElement.checked=f),e.setValue(d.id,{value:f})}}};this._dispatchEventFromSandbox(c,l)}),this._setEventListeners(r,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],l=>l.target.checked)}return this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class _O extends J_{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),e}}class xO extends uc{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),i=document.createElement("select");rc.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=0;let r=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",h=>{const d=this.data.defaultFieldValue;for(const f of i.options)f.selected=f.value===d});for(const h of this.data.options){const d=document.createElement("option");d.textContent=h.displayValue,d.value=h.exportValue,n.value.includes(h.exportValue)&&(d.setAttribute("selected",!0),r=!1),i.append(d)}let o=null;if(r){const h=document.createElement("option");h.value=" ",h.setAttribute("hidden",!0),h.setAttribute("selected",!0),i.prepend(h),o=()=>{h.remove(),i.removeEventListener("input",o),o=null},i.addEventListener("input",o)}const l=h=>{const d=h?"value":"textContent",{options:f,multiple:p}=i;return p?Array.prototype.filter.call(f,y=>y.selected).map(y=>y[d]):f.selectedIndex===-1?null:f[f.selectedIndex][d]};let c=l(!1);const u=h=>{const d=h.target.options;return Array.prototype.map.call(d,f=>({displayValue:f.textContent,exportValue:f.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",h=>{const d={value(f){o==null||o();const p=f.detail.value,y=new Set(Array.isArray(p)?p:[p]);for(const _ of i.options)_.selected=y.has(_.value);e.setValue(t,{value:l(!0)}),c=l(!1)},multipleSelection(f){i.multiple=!0},remove(f){const p=i.options,y=f.detail.remove;p[y].selected=!1,i.remove(y),p.length>0&&Array.prototype.findIndex.call(p,A=>A.selected)===-1&&(p[0].selected=!0),e.setValue(t,{value:l(!0),items:u(f)}),c=l(!1)},clear(f){for(;i.length!==0;)i.remove(0);e.setValue(t,{value:null,items:[]}),c=l(!1)},insert(f){const{index:p,displayValue:y,exportValue:_}=f.detail.insert,A=i.children[p],m=document.createElement("option");m.textContent=y,m.value=_,A?A.before(m):i.append(m),e.setValue(t,{value:l(!0),items:u(f)}),c=l(!1)},items(f){const{items:p}=f.detail;for(;i.length!==0;)i.remove(0);for(const y of p){const{displayValue:_,exportValue:A}=y,m=document.createElement("option");m.textContent=_,m.value=A,i.append(m)}i.options.length>0&&(i.options[0].selected=!0),e.setValue(t,{value:l(!0),items:u(f)}),c=l(!1)},indices(f){const p=new Set(f.detail.indices);for(const y of f.target.options)y.selected=p.has(y.index);e.setValue(t,{value:l(!0)}),c=l(!1)},editable(f){f.target.disabled=!f.detail.editable}};this._dispatchEventFromSandbox(d,h)}),i.addEventListener("input",h=>{var p;const d=l(!0),f=l(!1);e.setValue(t,{value:d}),h.preventDefault(),(p=this.linkService.eventBus)==null||p.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:c,change:f,changeEx:d,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],h=>h.target.value)):i.addEventListener("input",function(h){e.setValue(t,{value:l(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}var _p,ab;class ob extends et{constructor(t){const{data:n,elements:i,parent:r}=t,o=!!r._commentManager;super(t,{isRenderable:!o&&et._hasPopupData(n)});w(this,_p);if(this.elements=i,o&&et._hasPopupData(n)){const l=this.popup=x(this,_p,ab).call(this);for(const c of i)c.popup=l}else this.popup=null}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const n=this.popup=x(this,_p,ab).call(this),i=[];for(const r of this.elements)r.popup=n,r.container.ariaHasPopup="dialog",i.push(r.data.id),r.addHighlightArea();return this.container.setAttribute("aria-controls",i.map(r=>`${Uc}${r}`).join(",")),this.container}}_p=new WeakSet,ab=function(){return new AO({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})};var qn,Mo,Ly,My,Zu,eh,it,Di,Fo,El,th,nh,Oi,Kn,Er,Cr,rt,kr,jo,xp,Tr,sh,Cl,Bo,Pt,$o,ce,vm,lb,cb,ub,wm,hb,wk,bk,_k,xk,bm,_m,db;class AO{constructor({container:e,color:t,elements:n,titleObj:i,modificationDate:r,contentsObj:o,richText:l,parent:c,rect:u,parentRect:h,open:d,commentManager:f=null}){w(this,ce);w(this,qn,null);w(this,Mo,x(this,ce,_k).bind(this));w(this,Ly,x(this,ce,db).bind(this));w(this,My,x(this,ce,_m).bind(this));w(this,Zu,x(this,ce,bm).bind(this));w(this,eh,null);w(this,it,null);w(this,Di,null);w(this,Fo,null);w(this,El,null);w(this,th,null);w(this,nh,null);w(this,Oi,!1);w(this,Kn,null);w(this,Er,null);w(this,Cr,null);w(this,rt,null);w(this,kr,null);w(this,jo,null);w(this,xp,null);w(this,Tr,null);w(this,sh,null);w(this,Cl,null);w(this,Bo,!1);w(this,Pt,null);w(this,$o,null);g(this,it,e),g(this,sh,i),g(this,Di,o),g(this,Tr,l),g(this,th,c),g(this,eh,t),g(this,xp,u),g(this,nh,h),g(this,El,n),g(this,qn,f),g(this,Pt,n[0]),g(this,Fo,hy.toDateObject(r)),this.trigger=n.flatMap(p=>p.getElementsToTriggerPopup()),f||(x(this,ce,vm).call(this),a(this,it).hidden=!0,d&&x(this,ce,bm).call(this))}renderCommentButton(){if(a(this,rt)){a(this,rt).parentNode||a(this,Pt).container.after(a(this,rt));return}if(a(this,kr)||x(this,ce,lb).call(this),!a(this,kr))return;const{signal:e}=g(this,Er,new AbortController),t=a(this,Pt).hasOwnCommentButton,n=()=>{a(this,qn).toggleCommentPopup(this,!0,void 0,!t)},i=()=>{a(this,qn).toggleCommentPopup(this,!1,!0,!t)},r=()=>{a(this,qn).toggleCommentPopup(this,!1,!1)};if(t){g(this,rt,a(this,Pt).container);for(const o of this.trigger)o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.addEventListener("keydown",a(this,Mo),{signal:e}),o.addEventListener("click",n,{signal:e}),o.addEventListener("pointerenter",i,{signal:e}),o.addEventListener("pointerleave",r,{signal:e}),o.classList.add("popupTriggerArea")}else{const o=g(this,rt,document.createElement("button"));o.className="annotationCommentButton";const l=a(this,Pt).container;o.style.zIndex=l.style.zIndex+1,o.tabIndex=0,o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.setAttribute("data-l10n-id","pdfjs-show-comment-button"),x(this,ce,ub).call(this),x(this,ce,cb).call(this),o.addEventListener("keydown",a(this,Mo),{signal:e}),o.addEventListener("click",n,{signal:e}),o.addEventListener("pointerenter",i,{signal:e}),o.addEventListener("pointerleave",r,{signal:e}),l.after(o)}}get commentButtonColor(){const{color:e,opacity:t}=a(this,Pt).commentData;return e?a(this,th)._commentManager.makeCommentColor(e,t):null}focusCommentButton(){setTimeout(()=>{var e;(e=a(this,rt))==null||e.focus()},0)}getData(){const{richText:e,color:t,opacity:n,creationDate:i,modificationDate:r}=a(this,Pt).commentData;return{contentsObj:{str:this.comment},richText:e,color:t,opacity:n,creationDate:i,modificationDate:r}}get elementBeforePopup(){return a(this,rt)}get comment(){return a(this,$o)||g(this,$o,a(this,Pt).commentText),a(this,$o)}set comment(e){e!==this.comment&&(a(this,Pt).commentText=g(this,$o,e))}focus(){var e;(e=a(this,Pt).container)==null||e.focus()}get parentBoundingClientRect(){return a(this,Pt).layer.getBoundingClientRect()}setCommentButtonStates({selected:e,hasPopup:t}){a(this,rt)&&(a(this,rt).classList.toggle("selected",e),a(this,rt).ariaExpanded=t)}setSelectedCommentButton(e){a(this,rt).classList.toggle("selected",e)}get commentPopupPosition(){if(a(this,jo))return a(this,jo);const{x:e,y:t,height:n}=a(this,rt).getBoundingClientRect(),{x:i,y:r,width:o,height:l}=a(this,Pt).layer.getBoundingClientRect();return[(e-i)/o,(t+n-r)/l]}set commentPopupPosition(e){g(this,jo,e)}hasDefaultPopupPosition(){return a(this,jo)===null}get commentButtonPosition(){return a(this,kr)}get commentButtonWidth(){return a(this,rt).getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(e){const[t,n]=a(this,jo)||this.commentButtonPosition.map(u=>u/100),i=this.parentBoundingClientRect,{x:r,y:o,width:l,height:c}=i;a(this,qn).showDialog(null,this,r+t*l,o+n*c,{...e,parentDimensions:i})}render(){var n,i;if(a(this,Kn))return;const e=g(this,Kn,document.createElement("div"));if(e.className="popup",a(this,eh)){const r=e.style.outlineColor=K.makeHexColor(...a(this,eh));e.style.backgroundColor=`color-mix(in srgb, ${r} 30%, white)`}const t=document.createElement("span");if(t.className="header",(n=a(this,sh))!=null&&n.str){const r=document.createElement("span");r.className="title",t.append(r),{dir:r.dir,str:r.textContent}=a(this,sh)}if(e.append(t),a(this,Fo)){const r=document.createElement("time");r.className="popupDate",r.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),r.setAttribute("data-l10n-args",JSON.stringify({dateObj:a(this,Fo).valueOf()})),r.dateTime=a(this,Fo).toISOString(),t.append(r)}uC({html:a(this,ce,wm)||a(this,Di).str,dir:(i=a(this,Di))==null?void 0:i.dir,className:"popupContent"},e),a(this,it).append(e)}updateEdited({rect:e,popup:t,deleted:n}){var i;if(a(this,qn)){n?(this.remove(),g(this,$o,null)):t&&(t.deleted?this.remove():(x(this,ce,ub).call(this),g(this,$o,t.text))),e&&(g(this,kr,null),x(this,ce,lb).call(this),x(this,ce,cb).call(this));return}if(n||t!=null&&t.deleted){this.remove();return}x(this,ce,vm).call(this),a(this,Cl)||g(this,Cl,{contentsObj:a(this,Di),richText:a(this,Tr)}),e&&g(this,Cr,null),t&&t.text&&(g(this,Tr,x(this,ce,bk).call(this,t.text)),g(this,Fo,hy.toDateObject(t.date)),g(this,Di,null)),(i=a(this,Kn))==null||i.remove(),g(this,Kn,null)}resetEdited(){var e;a(this,Cl)&&({contentsObj:yt(this,Di)._,richText:yt(this,Tr)._}=a(this,Cl),g(this,Cl,null),(e=a(this,Kn))==null||e.remove(),g(this,Kn,null),g(this,Cr,null))}remove(){var e,t,n;if((e=a(this,Er))==null||e.abort(),g(this,Er,null),(t=a(this,Kn))==null||t.remove(),g(this,Kn,null),g(this,Bo,!1),g(this,Oi,!1),(n=a(this,rt))==null||n.remove(),g(this,rt,null),this.trigger)for(const i of this.trigger)i.classList.remove("popupTriggerArea")}forceHide(){g(this,Bo,this.isVisible),a(this,Bo)&&(a(this,it).hidden=!0)}maybeShow(){a(this,qn)||(x(this,ce,vm).call(this),a(this,Bo)&&(a(this,Kn)||x(this,ce,_m).call(this),g(this,Bo,!1),a(this,it).hidden=!1))}get isVisible(){return a(this,qn)?!1:a(this,it).hidden===!1}}qn=new WeakMap,Mo=new WeakMap,Ly=new WeakMap,My=new WeakMap,Zu=new WeakMap,eh=new WeakMap,it=new WeakMap,Di=new WeakMap,Fo=new WeakMap,El=new WeakMap,th=new WeakMap,nh=new WeakMap,Oi=new WeakMap,Kn=new WeakMap,Er=new WeakMap,Cr=new WeakMap,rt=new WeakMap,kr=new WeakMap,jo=new WeakMap,xp=new WeakMap,Tr=new WeakMap,sh=new WeakMap,Cl=new WeakMap,Bo=new WeakMap,Pt=new WeakMap,$o=new WeakMap,ce=new WeakSet,vm=function(){var t;if(a(this,Er))return;g(this,Er,new AbortController);const{signal:e}=a(this,Er);for(const n of this.trigger)n.addEventListener("click",a(this,Zu),{signal:e}),n.addEventListener("pointerenter",a(this,My),{signal:e}),n.addEventListener("pointerleave",a(this,Ly),{signal:e}),n.classList.add("popupTriggerArea");for(const n of a(this,El))(t=n.container)==null||t.addEventListener("keydown",a(this,Mo),{signal:e})},lb=function(){const e=a(this,El).find(t=>t.hasCommentButton);e&&g(this,kr,e._normalizePoint(e.commentButtonPosition))},cb=function(){if(a(this,Pt).extraPopupElement&&!a(this,Pt).editor)return;a(this,rt)||this.renderCommentButton();const[e,t]=a(this,kr),{style:n}=a(this,rt);n.left=`calc(${e}%)`,n.top=`calc(${t}% - var(--comment-button-dim))`},ub=function(){a(this,Pt).extraPopupElement||(a(this,rt)||this.renderCommentButton(),a(this,rt).style.backgroundColor=this.commentButtonColor||"")},wm=function(){const e=a(this,Tr),t=a(this,Di);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&a(this,Tr).html||null},hb=function(){var e,t,n;return((n=(t=(e=a(this,ce,wm))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.fontSize)||0},wk=function(){var e,t,n;return((n=(t=(e=a(this,ce,wm))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.color)||null},bk=function(e){const t=[],n={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},i={style:{color:a(this,ce,wk),fontSize:a(this,ce,hb)?`calc(${a(this,ce,hb)}px * var(--total-scale-factor))`:""}};for(const r of e.split(`
`))t.push({name:"span",value:r,attributes:i});return n},_k=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&a(this,Oi))&&x(this,ce,bm).call(this)},xk=function(){if(a(this,Cr)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:i,pageY:r}}}=a(this,th);let o=!!a(this,nh),l=o?a(this,nh):a(this,xp);for(const y of a(this,El))if(!l||K.intersect(y.data.rect,l)!==null){l=y.data.rect,o=!0;break}const c=K.normalizeRect([l[0],e[3]-l[1]+e[1],l[2],e[3]-l[3]+e[1]]),h=o?l[2]-l[0]+5:0,d=c[0]+h,f=c[1];g(this,Cr,[100*(d-i)/t,100*(f-r)/n]);const{style:p}=a(this,it);p.left=`${a(this,Cr)[0]}%`,p.top=`${a(this,Cr)[1]}%`},bm=function(){if(a(this,qn)){a(this,qn).toggleCommentPopup(this,!1);return}g(this,Oi,!a(this,Oi)),a(this,Oi)?(x(this,ce,_m).call(this),a(this,it).addEventListener("click",a(this,Zu)),a(this,it).addEventListener("keydown",a(this,Mo))):(x(this,ce,db).call(this),a(this,it).removeEventListener("click",a(this,Zu)),a(this,it).removeEventListener("keydown",a(this,Mo)))},_m=function(){a(this,Kn)||this.render(),this.isVisible?a(this,Oi)&&a(this,it).classList.add("focused"):(x(this,ce,xk).call(this),a(this,it).hidden=!1,a(this,it).style.zIndex=parseInt(a(this,it).style.zIndex)+1e3)},db=function(){a(this,it).classList.remove("focused"),!(a(this,Oi)||!this.isVisible)&&(a(this,it).hidden=!0,a(this,it).style.zIndex=parseInt(a(this,it).style.zIndex)-1e3)};class Ak extends et{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=ie.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=this.contentElement=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const n=document.createElement("span");n.textContent=t,e.append(n)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}var Ap;class SO extends et{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});w(this,Ap,null)}render(){this.container.classList.add("lineAnnotation");const{data:t,width:n,height:i}=this,r=this.svgFactory.create(n,i,!0),o=g(this,Ap,this.svgFactory.createElement("svg:line"));return o.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),o.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),o.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),o.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),o.setAttribute("stroke-width",t.borderStyle.width||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return a(this,Ap)}addHighlightArea(){this.container.classList.add("highlightArea")}}Ap=new WeakMap;var Sp;class EO extends et{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});w(this,Sp,null)}render(){this.container.classList.add("squareAnnotation");const{data:t,width:n,height:i}=this,r=this.svgFactory.create(n,i,!0),o=t.borderStyle.width,l=g(this,Sp,this.svgFactory.createElement("svg:rect"));return l.setAttribute("x",o/2),l.setAttribute("y",o/2),l.setAttribute("width",n-o),l.setAttribute("height",i-o),l.setAttribute("stroke-width",o||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),r.append(l),this.container.append(r),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return a(this,Sp)}addHighlightArea(){this.container.classList.add("highlightArea")}}Sp=new WeakMap;var Ep;class CO extends et{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});w(this,Ep,null)}render(){this.container.classList.add("circleAnnotation");const{data:t,width:n,height:i}=this,r=this.svgFactory.create(n,i,!0),o=t.borderStyle.width,l=g(this,Ep,this.svgFactory.createElement("svg:ellipse"));return l.setAttribute("cx",n/2),l.setAttribute("cy",i/2),l.setAttribute("rx",n/2-o/2),l.setAttribute("ry",i/2-o/2),l.setAttribute("stroke-width",o||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),r.append(l),this.container.append(r),!t.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return a(this,Ep)}addHighlightArea(){this.container.classList.add("highlightArea")}}Ep=new WeakMap;var Cp;class Sk extends et{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});w(this,Cp,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:n,borderStyle:i,popupRef:r},width:o,height:l}=this;if(!n)return this.container;const c=this.svgFactory.create(o,l,!0);let u=[];for(let d=0,f=n.length;d<f;d+=2){const p=n[d]-t[0],y=t[3]-n[d+1];u.push(`${p},${y}`)}u=u.join(" ");const h=g(this,Cp,this.svgFactory.createElement(this.svgElementName));return h.setAttribute("points",u),h.setAttribute("stroke-width",i.width||1),h.setAttribute("stroke","transparent"),h.setAttribute("fill","transparent"),c.append(h),this.container.append(c),!r&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}getElementsToTriggerPopup(){return a(this,Cp)}addHighlightArea(){this.container.classList.add("highlightArea")}}Cp=new WeakMap;class kO extends Sk{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class TO extends et{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container}}var kp,kl,Tp,fb;class Q_ extends et{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});w(this,Tp);w(this,kp,null);w(this,kl,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?ie.HIGHLIGHT:ie.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,rotation:n,inkLists:i,borderStyle:r,popupRef:o}}=this,{transform:l,width:c,height:u}=x(this,Tp,fb).call(this,n,t),h=this.svgFactory.create(c,u,!0),d=g(this,kp,this.svgFactory.createElement("svg:g"));h.append(d),d.setAttribute("stroke-width",r.width||1),d.setAttribute("stroke-linecap","round"),d.setAttribute("stroke-linejoin","round"),d.setAttribute("stroke-miterlimit",10),d.setAttribute("stroke","transparent"),d.setAttribute("fill","transparent"),d.setAttribute("transform",l);for(let f=0,p=i.length;f<p;f++){const y=this.svgFactory.createElement(this.svgElementName);a(this,kl).push(y),y.setAttribute("points",i[f].join(",")),d.append(y)}return!o&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.append(h),this._editOnDoubleClick(),this.container}updateEdited(t){super.updateEdited(t);const{thickness:n,points:i,rect:r}=t,o=a(this,kp);if(n>=0&&o.setAttribute("stroke-width",n||1),i)for(let l=0,c=a(this,kl).length;l<c;l++)a(this,kl)[l].setAttribute("points",i[l].join(","));if(r){const{transform:l,width:c,height:u}=x(this,Tp,fb).call(this,this.data.rotation,r);o.parentElement.setAttribute("viewBox",`0 0 ${c} ${u}`),o.setAttribute("transform",l)}}getElementsToTriggerPopup(){return a(this,kl)}addHighlightArea(){this.container.classList.add("highlightArea")}}kp=new WeakMap,kl=new WeakMap,Tp=new WeakSet,fb=function(t,n){switch(t){case 90:return{transform:`rotate(90) translate(${-n[0]},${n[1]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};case 180:return{transform:`rotate(180) translate(${-n[2]},${n[1]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]};case 270:return{transform:`rotate(270) translate(${-n[2]},${n[3]}) scale(1,-1)`,width:n[3]-n[1],height:n[2]-n[0]};default:return{transform:`translate(${-n[0]},${n[3]}) scale(1,-1)`,width:n[2]-n[0],height:n[3]-n[1]}}};class Ek extends et{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=ie.HIGHLIGHT}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){const n=document.createElement("mark");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class PO extends et{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("underlineAnnotation"),e){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class RO extends et{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("squigglyAnnotation"),e){const n=document.createElement("u");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class NO extends et{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this.container.classList.add("strikeoutAnnotation"),e){const n=document.createElement("s");n.classList.add("overlaidText"),n.textContent=e,this.container.append(n)}return this.container}}class Ck extends et{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=ie.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&(this.hasOwnCommentButton=!0,this._createPopup()),this._editOnDoubleClick(),this.container}}var Pp,Rp,pb;class IO extends et{constructor(t){var i;super(t,{isRenderable:!0});w(this,Rp);w(this,Pp,null);const{file:n}=this.data;this.filename=n.filename,this.content=n.content,(i=this.linkService.eventBus)==null||i.dispatch("fileattachmentannotation",{source:this,...n})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:n}=this;let i;n.hasAppearance||n.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(n.name)?"paperclip":"pushpin"}.svg`,n.fillAlpha&&n.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(n.fillAlpha*100)}%);`)),i.addEventListener("dblclick",x(this,Rp,pb).bind(this)),g(this,Pp,i);const{isMac:r}=Kt.platform;return t.addEventListener("keydown",o=>{o.key==="Enter"&&(r?o.metaKey:o.ctrlKey)&&x(this,Rp,pb).call(this)}),!n.popupRef&&this.hasPopupData?(this.hasOwnCommentButton=!0,this._createPopup()):i.classList.add("popupTriggerArea"),t.append(i),t}getElementsToTriggerPopup(){return a(this,Pp)}addHighlightArea(){this.container.classList.add("highlightArea")}}Pp=new WeakMap,Rp=new WeakSet,pb=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var Tl,Pl,ih,Uo,Np,Rl,Xn,Ip,Ur,xm,mb;const lx=class lx{constructor({div:e,accessibilityManager:t,annotationCanvasMap:n,annotationEditorUIManager:i,page:r,viewport:o,structTreeLayer:l,commentManager:c,linkService:u,annotationStorage:h}){w(this,Ur);w(this,Tl,null);w(this,Pl,null);w(this,ih,null);w(this,Uo,new Map);w(this,Np,null);w(this,Rl,null);w(this,Xn,[]);w(this,Ip,!1);this.div=e,g(this,Tl,t),g(this,Pl,n),g(this,Np,l||null),g(this,Rl,u||null),g(this,ih,h||new q_),this.page=r,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=i,this._commentManager=c||null}hasEditableAnnotations(){return a(this,Uo).size>0}async render(e){var l;const{annotations:t}=e,n=this.div;sc(n,this.viewport);const i=new Map,r=[],o={data:null,layer:n,linkService:a(this,Rl),downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new wy,annotationStorage:a(this,ih),enableComment:e.enableComment===!0,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const c of t){if(c.noHTML)continue;const u=c.annotationType===ft.POPUP;if(u){const f=i.get(c.id);if(!f)continue;if(!this._commentManager){r.push(c);continue}o.elements=f}else if(c.rect[2]===c.rect[0]||c.rect[3]===c.rect[1])continue;o.data=c;const h=rv.create(o);if(!h.isRenderable)continue;if(!u&&(a(this,Xn).push(h),c.popupRef)){const f=i.get(c.popupRef);f?f.push(h):i.set(c.popupRef,[h])}const d=h.render();c.hidden&&(d.style.visibility="hidden"),h._isEditable&&(a(this,Uo).set(h.data.id,h),(l=this._annotationEditorUIManager)==null||l.renderAnnotationElement(h))}await x(this,Ur,xm).call(this);for(const c of r){const u=o.elements=i.get(c.id);o.data=c;const h=rv.create(o);if(!h.isRenderable)continue;const d=h.render();h.contentElement.id=`${Uc}${c.id}`,c.hidden&&(d.style.visibility="hidden"),u.at(-1).container.after(d)}x(this,Ur,mb).call(this)}async addLinkAnnotations(e){const t={data:null,layer:this.div,linkService:a(this,Rl),svgFactory:new wy,parent:this};for(const n of e){n.borderStyle||(n.borderStyle=lx._defaultBorderStyle),t.data=n;const i=rv.create(t);i.isRenderable&&(i.render(),i.contentElement.id=`${Uc}${n.id}`,a(this,Xn).push(i))}await x(this,Ur,xm).call(this)}update({viewport:e}){const t=this.div;this.viewport=e,sc(t,{rotation:e.rotation}),x(this,Ur,mb).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(a(this,Uo).values())}getEditableAnnotation(e){return a(this,Uo).get(e)}addFakeAnnotation(e){const{div:t}=this,{id:n,rotation:i}=e,r=new mO({data:{id:n,rect:e.getPDFRect(),rotation:i},editor:e,layer:t,parent:this,enableComment:!!this._commentManager,linkService:a(this,Rl),annotationStorage:a(this,ih)});return r.render(),r.contentElement.id=`${Uc}${n}`,r.createOrUpdatePopup(),a(this,Xn).push(r),r}removeAnnotation(e){var i;const t=a(this,Xn).findIndex(r=>r.data.id===e);if(t<0)return;const[n]=a(this,Xn).splice(t,1);(i=a(this,Tl))==null||i.removePointerInTextLayer(n.contentElement)}updateFakeAnnotations(e){if(e.length!==0){for(const t of e)t.updateFakeAnnotationElement(this);x(this,Ur,xm).call(this)}}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}static get _defaultBorderStyle(){return ae(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:_c.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}};Tl=new WeakMap,Pl=new WeakMap,ih=new WeakMap,Uo=new WeakMap,Np=new WeakMap,Rl=new WeakMap,Xn=new WeakMap,Ip=new WeakMap,Ur=new WeakSet,xm=async function(){var n,i,r;if(a(this,Xn).length===0)return;this.div.replaceChildren();const e=[];if(!a(this,Ip)){g(this,Ip,!0);for(const{contentElement:o,data:{id:l}}of a(this,Xn)){const c=o.id=`${Uc}${l}`;e.push((n=a(this,Np))==null?void 0:n.getAriaAttributes(c).then(u=>{if(u)for(const[h,d]of u)o.setAttribute(h,d)}))}}a(this,Xn).sort(({data:{rect:[o,l,c,u]}},{data:{rect:[h,d,f,p]}})=>{if(o===c&&l===u)return 1;if(h===f&&d===p)return-1;const y=u,_=l,A=(l+u)/2,m=p,b=d,v=(d+p)/2;if(A>=m&&v<=_)return-1;if(v>=y&&A<=b)return 1;const S=(o+c)/2,C=(h+f)/2;return S-C});const t=document.createDocumentFragment();for(const o of a(this,Xn))t.append(o.container),this._commentManager?(r=((i=o.extraPopupElement)==null?void 0:i.popup)||o.popup)==null||r.renderCommentButton():o.extraPopupElement&&t.append(o.extraPopupElement.render());if(this.div.append(t),await Promise.all(e),a(this,Tl))for(const o of a(this,Xn))a(this,Tl).addPointerInTextLayer(o.contentElement,!1)},mb=function(){var t;if(!a(this,Pl))return;const e=this.div;for(const[n,i]of a(this,Pl)){const r=e.querySelector(`[data-annotation-id="${n}"]`);if(!r)continue;i.className="annotationContent";const{firstChild:o}=r;o?o.nodeName==="CANVAS"?o.replaceWith(i):o.classList.contains("annotationContent")?o.after(i):o.before(i):r.append(i);const l=a(this,Uo).get(n);l&&(l._hasNoCanvas?((t=this._annotationEditorUIManager)==null||t.setMissingCanvas(n,r.id,i),l._hasNoCanvas=!1):l.canvas=i)}a(this,Pl).clear()};let gb=lx;const Ug=/\r\n?|\n/g;var Yn,Dp,Nl,Jn,mt,kk,Tk,Pk,Am,zr,Sm,Em,Rk,vb,Nk;const He=class He extends Ue{constructor(t){super({...t,name:"freeTextEditor"});w(this,mt);w(this,Yn,"");w(this,Dp,`${this.id}-editor`);w(this,Nl,null);w(this,Jn);B(this,"_colorPicker",null);this.color=t.color||He._defaultColor||Ue._defaultLineColor,g(this,Jn,t.fontSize||He._defaultFontSize),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert"),this.canAddComment=!1}static get _keyboardManager(){const t=He.prototype,n=o=>o.isEmpty(),i=ic.TRANSLATE_SMALL,r=ic.TRANSLATE_BIG;return ae(this,"_keyboardManager",new ug([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-i,0],checker:n}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-r,0],checker:n}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[i,0],checker:n}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[r,0],checker:n}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-i],checker:n}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-r],checker:n}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,i],checker:n}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,r],checker:n}]]))}static initialize(t,n){Ue.initialize(t,n);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,n){switch(t){case ge.FREETEXT_SIZE:He._defaultFontSize=n;break;case ge.FREETEXT_COLOR:He._defaultColor=n;break}}updateParams(t,n){switch(t){case ge.FREETEXT_SIZE:x(this,mt,kk).call(this,n);break;case ge.FREETEXT_COLOR:x(this,mt,Tk).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[ge.FREETEXT_SIZE,He._defaultFontSize],[ge.FREETEXT_COLOR,He._defaultColor||Ue._defaultLineColor]]}get propertiesToUpdate(){return[[ge.FREETEXT_SIZE,a(this,Jn)],[ge.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new vy(this)),[["colorPicker",this._colorPicker]]}get colorType(){return ge.FREETEXT_COLOR}onUpdatedColor(){var t;this.editorDiv.style.color=this.color,(t=this._colorPicker)==null||t.update(this.color),super.onUpdatedColor()}_translateEmpty(t,n){this._uiManager.translateSelectedEditors(t,n,!0)}getInitialTranslation(){const t=this.parentScale;return[-He._internalPadding*t,-(He._internalPadding+a(this,Jn))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),g(this,Nl,new AbortController);const t=this._uiManager.combinedSignal(a(this,Nl));return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:t}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:t}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:t}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:t}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:t}),!0}disableEditMode(){var t;return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",a(this,Dp)),this._isDraggable=!0,(t=a(this,Nl))==null||t.abort(),g(this,Nl,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(t){var n;this.width||(this.enableEditMode(),t&&this.editorDiv.focus(),(n=this._initialOptions)!=null&&n.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=a(this,Yn),n=g(this,Yn,x(this,mt,Pk).call(this).trimEnd());if(t===n)return;const i=r=>{if(g(this,Yn,r),!r){this.remove();return}x(this,mt,Em).call(this),this._uiManager.rebuild(this),x(this,mt,Am).call(this)};this.addCommands({cmd:()=>{i(n)},undo:()=>{i(t)},mustExec:!1}),x(this,mt,Am).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){He._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let t,n;(this._isCopy||this.annotationElementId)&&(t=this.x,n=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",a(this,Dp)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${a(this,Jn)}px * var(--total-scale-factor))`,i.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[r,o]=this.parentDimensions;if(this.annotationElementId){const{position:l}=this._initialData;let[c,u]=this.getInitialTranslation();[c,u]=this.pageTranslationToScreen(c,u);const[h,d]=this.pageDimensions,[f,p]=this.pageTranslation;let y,_;switch(this.rotation){case 0:y=t+(l[0]-f)/h,_=n+this.height-(l[1]-p)/d;break;case 90:y=t+(l[0]-f)/h,_=n-(l[1]-p)/d,[c,u]=[u,-c];break;case 180:y=t-this.width+(l[0]-f)/h,_=n-(l[1]-p)/d,[c,u]=[-c,-u];break;case 270:y=t+(l[0]-f-this.height*d)/h,_=n+(l[1]-p-this.width*h)/d,[c,u]=[-u,c];break}this.setAt(y*r,_*o,c,u)}else this._moveAfterPaste(t,n);x(this,mt,Em).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var y,_,A;const n=t.clipboardData||window.clipboardData,{types:i}=n;if(i.length===1&&i[0]==="text/plain")return;t.preventDefault();const r=x(y=He,zr,vb).call(y,n.getData("text")||"").replaceAll(Ug,`
`);if(!r)return;const o=window.getSelection();if(!o.rangeCount)return;this.editorDiv.normalize(),o.deleteFromDocument();const l=o.getRangeAt(0);if(!r.includes(`
`)){l.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),o.collapseToStart();return}const{startContainer:c,startOffset:u}=l,h=[],d=[];if(c.nodeType===Node.TEXT_NODE){const m=c.parentElement;if(d.push(c.nodeValue.slice(u).replaceAll(Ug,"")),m!==this.editorDiv){let b=h;for(const v of this.editorDiv.childNodes){if(v===m){b=d;continue}b.push(x(_=He,zr,Sm).call(_,v))}}h.push(c.nodeValue.slice(0,u).replaceAll(Ug,""))}else if(c===this.editorDiv){let m=h,b=0;for(const v of this.editorDiv.childNodes)b++===u&&(m=d),m.push(x(A=He,zr,Sm).call(A,v))}g(this,Yn,`${h.join(`
`)}${r}${d.join(`
`)}`),x(this,mt,Em).call(this);const f=new Range;let p=Math.sumPrecise(h.map(m=>m.length));for(const{firstChild:m}of this.editorDiv.childNodes)if(m.nodeType===Node.TEXT_NODE){const b=m.nodeValue.length;if(p<=b){f.setStart(m,p),f.setEnd(m,p);break}p-=b}o.removeAllRanges(),o.addRange(f)}get contentDiv(){return this.editorDiv}getPDFRect(){const t=He._internalPadding*this.parentScale;return this.getRect(t,t)}static async deserialize(t,n,i){var l;let r=null;if(t instanceof Ak){const{data:{defaultAppearanceData:{fontSize:c,fontColor:u},rect:h,rotation:d,id:f,popupRef:p,richText:y,contentsObj:_,creationDate:A,modificationDate:m},textContent:b,textPosition:v,parent:{page:{pageNumber:S}}}=t;if(!b||b.length===0)return null;r=t={annotationType:ie.FREETEXT,color:Array.from(u),fontSize:c,value:b.join(`
`),position:v,pageIndex:S-1,rect:h.slice(0),rotation:d,annotationElementId:f,id:f,deleted:!1,popupRef:p,comment:(_==null?void 0:_.str)||null,richText:y,creationDate:A,modificationDate:m}}const o=await super.deserialize(t,n,i);return g(o,Jn,t.fontSize),o.color=K.makeHexColor(...t.color),g(o,Yn,x(l=He,zr,vb).call(l,t.value)),o._initialData=r,t.comment&&o.setCommentData(t),o}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const n=Ue._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),i=Object.assign(super.serialize(t),{color:n,fontSize:a(this,Jn),value:x(this,mt,Rk).call(this)});return this.addComment(i),t?(i.isCopy=!0,i):this.annotationElementId&&!x(this,mt,Nk).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(t){const n=super.renderAnnotationElement(t);if(!n)return null;const{style:i}=n;i.fontSize=`calc(${a(this,Jn)}px * var(--total-scale-factor))`,i.color=this.color,n.replaceChildren();for(const r of a(this,Yn).split(`
`)){const o=document.createElement("div");o.append(r?document.createTextNode(r):document.createElement("br")),n.append(o)}return t.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:a(this,Yn)}}),n}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};Yn=new WeakMap,Dp=new WeakMap,Nl=new WeakMap,Jn=new WeakMap,mt=new WeakSet,kk=function(t){const n=r=>{this.editorDiv.style.fontSize=`calc(${r}px * var(--total-scale-factor))`,this.translate(0,-(r-a(this,Jn))*this.parentScale),g(this,Jn,r),x(this,mt,Am).call(this)},i=a(this,Jn);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ge.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},Tk=function(t){const n=r=>{this.color=r,this.onUpdatedColor()},i=this.color;this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ge.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},Pk=function(){var i;const t=[];this.editorDiv.normalize();let n=null;for(const r of this.editorDiv.childNodes)(n==null?void 0:n.nodeType)===Node.TEXT_NODE&&r.nodeName==="BR"||(t.push(x(i=He,zr,Sm).call(i,r)),n=r);return t.join(`
`)},Am=function(){const[t,n]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:r,div:o}=this,l=o.style.display,c=o.classList.contains("hidden");o.classList.remove("hidden"),o.style.display="hidden",r.div.append(this.div),i=o.getBoundingClientRect(),o.remove(),o.style.display=l,o.classList.toggle("hidden",c)}this.rotation%180===this.parentRotation%180?(this.width=i.width/t,this.height=i.height/n):(this.width=i.height/t,this.height=i.width/n),this.fixAndSetPosition()},zr=new WeakSet,Sm=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(Ug,"")},Em=function(){if(this.editorDiv.replaceChildren(),!!a(this,Yn))for(const t of a(this,Yn).split(`
`)){const n=document.createElement("div");n.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(n)}},Rk=function(){return a(this,Yn).replaceAll(""," ")},vb=function(t){return t.replaceAll(" ","")},Nk=function(t){const{value:n,fontSize:i,color:r,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||t.value!==n||t.fontSize!==i||t.color.some((l,c)=>l!==r[c])||t.pageIndex!==o},w(He,zr),B(He,"_freeTextDefaultContent",""),B(He,"_internalPadding",0),B(He,"_defaultColor",null),B(He,"_defaultFontSize",10),B(He,"_type","freetext"),B(He,"_editorType",ie.FREETEXT);let yb=He;class W{toSVGPath(){Me("Abstract method `toSVGPath` must be implemented.")}get box(){Me("Abstract getter `box` must be implemented.")}serialize(e,t){Me("Abstract method `serialize` must be implemented.")}static _rescale(e,t,n,i,r,o){o||(o=new Float32Array(e.length));for(let l=0,c=e.length;l<c;l+=2)o[l]=t+e[l]*i,o[l+1]=n+e[l+1]*r;return o}static _rescaleAndSwap(e,t,n,i,r,o){o||(o=new Float32Array(e.length));for(let l=0,c=e.length;l<c;l+=2)o[l]=t+e[l+1]*i,o[l+1]=n+e[l]*r;return o}static _translate(e,t,n,i){i||(i=new Float32Array(e.length));for(let r=0,o=e.length;r<o;r+=2)i[r]=t+e[r],i[r+1]=n+e[r+1];return i}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,n,i,r){switch(r){case 90:return[1-t/n,e/i];case 180:return[1-e/n,1-t/i];case 270:return[t/n,1-e/i];default:return[e/n,t/i]}}static _normalizePagePoint(e,t,n){switch(n){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,n,i,r,o){return[(e+5*n)/6,(t+5*i)/6,(5*n+r)/6,(5*i+o)/6,(n+r)/2,(i+o)/2]}}B(W,"PRECISION",1e-4);var Qn,Qs,rh,oh,Li,he,Il,Dl,Op,Lp,ah,lh,zo,Mp,Fy,jy,Ct,_d,Ik,Dk,Ok,Lk,Mk,Fk;const er=class er{constructor({x:e,y:t},n,i,r,o,l=0){w(this,Ct);w(this,Qn);w(this,Qs,[]);w(this,rh);w(this,oh);w(this,Li,[]);w(this,he,new Float32Array(18));w(this,Il);w(this,Dl);w(this,Op);w(this,Lp);w(this,ah);w(this,lh);w(this,zo,[]);g(this,Qn,n),g(this,lh,r*i),g(this,oh,o),a(this,he).set([NaN,NaN,NaN,NaN,e,t],6),g(this,rh,l),g(this,Lp,a(er,Mp)*i),g(this,Op,a(er,jy)*i),g(this,ah,i),a(this,zo).push(e,t)}isEmpty(){return isNaN(a(this,he)[8])}add({x:e,y:t}){var O;g(this,Il,e),g(this,Dl,t);const[n,i,r,o]=a(this,Qn);let[l,c,u,h]=a(this,he).subarray(8,12);const d=e-u,f=t-h,p=Math.hypot(d,f);if(p<a(this,Op))return!1;const y=p-a(this,Lp),_=y/p,A=_*d,m=_*f;let b=l,v=c;l=u,c=h,u+=A,h+=m,(O=a(this,zo))==null||O.push(e,t);const S=-m/y,C=A/y,k=S*a(this,lh),T=C*a(this,lh);return a(this,he).set(a(this,he).subarray(2,8),0),a(this,he).set([u+k,h+T],4),a(this,he).set(a(this,he).subarray(14,18),12),a(this,he).set([u-k,h-T],16),isNaN(a(this,he)[6])?(a(this,Li).length===0&&(a(this,he).set([l+k,c+T],2),a(this,Li).push(NaN,NaN,NaN,NaN,(l+k-n)/r,(c+T-i)/o),a(this,he).set([l-k,c-T],14),a(this,Qs).push(NaN,NaN,NaN,NaN,(l-k-n)/r,(c-T-i)/o)),a(this,he).set([b,v,l,c,u,h],6),!this.isEmpty()):(a(this,he).set([b,v,l,c,u,h],6),Math.abs(Math.atan2(v-c,b-l)-Math.atan2(m,A))<Math.PI/2?([l,c,u,h]=a(this,he).subarray(2,6),a(this,Li).push(NaN,NaN,NaN,NaN,((l+u)/2-n)/r,((c+h)/2-i)/o),[l,c,b,v]=a(this,he).subarray(14,18),a(this,Qs).push(NaN,NaN,NaN,NaN,((b+l)/2-n)/r,((v+c)/2-i)/o),!0):([b,v,l,c,u,h]=a(this,he).subarray(0,6),a(this,Li).push(((b+5*l)/6-n)/r,((v+5*c)/6-i)/o,((5*l+u)/6-n)/r,((5*c+h)/6-i)/o,((l+u)/2-n)/r,((c+h)/2-i)/o),[u,h,l,c,b,v]=a(this,he).subarray(12,18),a(this,Qs).push(((b+5*l)/6-n)/r,((v+5*c)/6-i)/o,((5*l+u)/6-n)/r,((5*c+h)/6-i)/o,((l+u)/2-n)/r,((c+h)/2-i)/o),!0))}toSVGPath(){if(this.isEmpty())return"";const e=a(this,Li),t=a(this,Qs);if(isNaN(a(this,he)[6])&&!this.isEmpty())return x(this,Ct,Ik).call(this);const n=[];n.push(`M${e[4]} ${e[5]}`);for(let i=6;i<e.length;i+=6)isNaN(e[i])?n.push(`L${e[i+4]} ${e[i+5]}`):n.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);x(this,Ct,Ok).call(this,n);for(let i=t.length-6;i>=6;i-=6)isNaN(t[i])?n.push(`L${t[i+4]} ${t[i+5]}`):n.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);return x(this,Ct,Dk).call(this,n),n.join(" ")}newFreeDrawOutline(e,t,n,i,r,o){return new jk(e,t,n,i,r,o)}getOutlines(){var d;const e=a(this,Li),t=a(this,Qs),n=a(this,he),[i,r,o,l]=a(this,Qn),c=new Float32Array((((d=a(this,zo))==null?void 0:d.length)??0)+2);for(let f=0,p=c.length-2;f<p;f+=2)c[f]=(a(this,zo)[f]-i)/o,c[f+1]=(a(this,zo)[f+1]-r)/l;if(c[c.length-2]=(a(this,Il)-i)/o,c[c.length-1]=(a(this,Dl)-r)/l,isNaN(n[6])&&!this.isEmpty())return x(this,Ct,Lk).call(this,c);const u=new Float32Array(a(this,Li).length+24+a(this,Qs).length);let h=e.length;for(let f=0;f<h;f+=2){if(isNaN(e[f])){u[f]=u[f+1]=NaN;continue}u[f]=e[f],u[f+1]=e[f+1]}h=x(this,Ct,Fk).call(this,u,h);for(let f=t.length-6;f>=6;f-=6)for(let p=0;p<6;p+=2){if(isNaN(t[f+p])){u[h]=u[h+1]=NaN,h+=2;continue}u[h]=t[f+p],u[h+1]=t[f+p+1],h+=2}return x(this,Ct,Mk).call(this,u,h),this.newFreeDrawOutline(u,c,a(this,Qn),a(this,ah),a(this,rh),a(this,oh))}};Qn=new WeakMap,Qs=new WeakMap,rh=new WeakMap,oh=new WeakMap,Li=new WeakMap,he=new WeakMap,Il=new WeakMap,Dl=new WeakMap,Op=new WeakMap,Lp=new WeakMap,ah=new WeakMap,lh=new WeakMap,zo=new WeakMap,Mp=new WeakMap,Fy=new WeakMap,jy=new WeakMap,Ct=new WeakSet,_d=function(){const e=a(this,he).subarray(4,6),t=a(this,he).subarray(16,18),[n,i,r,o]=a(this,Qn);return[(a(this,Il)+(e[0]-t[0])/2-n)/r,(a(this,Dl)+(e[1]-t[1])/2-i)/o,(a(this,Il)+(t[0]-e[0])/2-n)/r,(a(this,Dl)+(t[1]-e[1])/2-i)/o]},Ik=function(){const[e,t,n,i]=a(this,Qn),[r,o,l,c]=x(this,Ct,_d).call(this);return`M${(a(this,he)[2]-e)/n} ${(a(this,he)[3]-t)/i} L${(a(this,he)[4]-e)/n} ${(a(this,he)[5]-t)/i} L${r} ${o} L${l} ${c} L${(a(this,he)[16]-e)/n} ${(a(this,he)[17]-t)/i} L${(a(this,he)[14]-e)/n} ${(a(this,he)[15]-t)/i} Z`},Dk=function(e){const t=a(this,Qs);e.push(`L${t[4]} ${t[5]} Z`)},Ok=function(e){const[t,n,i,r]=a(this,Qn),o=a(this,he).subarray(4,6),l=a(this,he).subarray(16,18),[c,u,h,d]=x(this,Ct,_d).call(this);e.push(`L${(o[0]-t)/i} ${(o[1]-n)/r} L${c} ${u} L${h} ${d} L${(l[0]-t)/i} ${(l[1]-n)/r}`)},Lk=function(e){const t=a(this,he),[n,i,r,o]=a(this,Qn),[l,c,u,h]=x(this,Ct,_d).call(this),d=new Float32Array(36);return d.set([NaN,NaN,NaN,NaN,(t[2]-n)/r,(t[3]-i)/o,NaN,NaN,NaN,NaN,(t[4]-n)/r,(t[5]-i)/o,NaN,NaN,NaN,NaN,l,c,NaN,NaN,NaN,NaN,u,h,NaN,NaN,NaN,NaN,(t[16]-n)/r,(t[17]-i)/o,NaN,NaN,NaN,NaN,(t[14]-n)/r,(t[15]-i)/o],0),this.newFreeDrawOutline(d,e,a(this,Qn),a(this,ah),a(this,rh),a(this,oh))},Mk=function(e,t){const n=a(this,Qs);return e.set([NaN,NaN,NaN,NaN,n[4],n[5]],t),t+=6},Fk=function(e,t){const n=a(this,he).subarray(4,6),i=a(this,he).subarray(16,18),[r,o,l,c]=a(this,Qn),[u,h,d,f]=x(this,Ct,_d).call(this);return e.set([NaN,NaN,NaN,NaN,(n[0]-r)/l,(n[1]-o)/c,NaN,NaN,NaN,NaN,u,h,NaN,NaN,NaN,NaN,d,f,NaN,NaN,NaN,NaN,(i[0]-r)/l,(i[1]-o)/c],t),t+=24},w(er,Mp,8),w(er,Fy,2),w(er,jy,a(er,Mp)+a(er,Fy));let by=er;var ch,Ol,Pr,Fp,Zn,jp,ut,By,Bk;class jk extends W{constructor(t,n,i,r,o,l){super();w(this,By);w(this,ch);w(this,Ol,new Float32Array(4));w(this,Pr);w(this,Fp);w(this,Zn);w(this,jp);w(this,ut);g(this,ut,t),g(this,Zn,n),g(this,ch,i),g(this,jp,r),g(this,Pr,o),g(this,Fp,l),this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],x(this,By,Bk).call(this,l);const[c,u,h,d]=a(this,Ol);for(let f=0,p=t.length;f<p;f+=2)t[f]=(t[f]-c)/h,t[f+1]=(t[f+1]-u)/d;for(let f=0,p=n.length;f<p;f+=2)n[f]=(n[f]-c)/h,n[f+1]=(n[f+1]-u)/d}toSVGPath(){const t=[`M${a(this,ut)[4]} ${a(this,ut)[5]}`];for(let n=6,i=a(this,ut).length;n<i;n+=6){if(isNaN(a(this,ut)[n])){t.push(`L${a(this,ut)[n+4]} ${a(this,ut)[n+5]}`);continue}t.push(`C${a(this,ut)[n]} ${a(this,ut)[n+1]} ${a(this,ut)[n+2]} ${a(this,ut)[n+3]} ${a(this,ut)[n+4]} ${a(this,ut)[n+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,n,i,r],o){const l=i-t,c=r-n;let u,h;switch(o){case 0:u=W._rescale(a(this,ut),t,r,l,-c),h=W._rescale(a(this,Zn),t,r,l,-c);break;case 90:u=W._rescaleAndSwap(a(this,ut),t,n,l,c),h=W._rescaleAndSwap(a(this,Zn),t,n,l,c);break;case 180:u=W._rescale(a(this,ut),i,n,-l,c),h=W._rescale(a(this,Zn),i,n,-l,c);break;case 270:u=W._rescaleAndSwap(a(this,ut),i,r,-l,-c),h=W._rescaleAndSwap(a(this,Zn),i,r,-l,-c);break}return{outline:Array.from(u),points:[Array.from(h)]}}get box(){return a(this,Ol)}newOutliner(t,n,i,r,o,l=0){return new by(t,n,i,r,o,l)}getNewOutline(t,n){const[i,r,o,l]=a(this,Ol),[c,u,h,d]=a(this,ch),f=o*h,p=l*d,y=i*h+c,_=r*d+u,A=this.newOutliner({x:a(this,Zn)[0]*f+y,y:a(this,Zn)[1]*p+_},a(this,ch),a(this,jp),t,a(this,Fp),n??a(this,Pr));for(let m=2;m<a(this,Zn).length;m+=2)A.add({x:a(this,Zn)[m]*f+y,y:a(this,Zn)[m+1]*p+_});return A.getOutlines()}}ch=new WeakMap,Ol=new WeakMap,Pr=new WeakMap,Fp=new WeakMap,Zn=new WeakMap,jp=new WeakMap,ut=new WeakMap,By=new WeakSet,Bk=function(t){const n=a(this,ut);let i=n[4],r=n[5];const o=[i,r,i,r];let l=i,c=r,u=i,h=r;const d=t?Math.max:Math.min,f=new Float32Array(4);for(let y=6,_=n.length;y<_;y+=6){const A=n[y+4],m=n[y+5];isNaN(n[y])?(K.pointBoundingBox(A,m,o),c>m?(l=A,c=m):c===m&&(l=d(l,A)),h<m?(u=A,h=m):h===m&&(u=d(u,A))):(f[0]=f[1]=1/0,f[2]=f[3]=-1/0,K.bezierBoundingBox(i,r,...n.slice(y,y+6),f),K.rectBoundingBox(f[0],f[1],f[2],f[3],o),c>f[1]?(l=f[0],c=f[1]):c===f[1]&&(l=d(l,f[0])),h<f[3]?(u=f[2],h=f[3]):h===f[3]&&(u=d(u,f[2]))),i=A,r=m}const p=a(this,Ol);p[0]=o[0]-a(this,Pr),p[1]=o[1]-a(this,Pr),p[2]=o[2]-o[0]+2*a(this,Pr),p[3]=o[3]-o[1]+2*a(this,Pr),this.firstPoint=[l,c],this.lastPoint=[u,h]};var Bp,$p,Up,Ho,Zs,bn,$k,Cm,Uk,zk,bb;class wb{constructor(e,t=0,n=0,i=!0){w(this,bn);w(this,Bp);w(this,$p);w(this,Up);w(this,Ho,[]);w(this,Zs,[]);const r=[1/0,1/0,-1/0,-1/0],l=10**-4;for(const{x:A,y:m,width:b,height:v}of e){const S=Math.floor((A-t)/l)*l,C=Math.ceil((A+b+t)/l)*l,k=Math.floor((m-t)/l)*l,T=Math.ceil((m+v+t)/l)*l,I=[S,k,T,!0],O=[C,k,T,!1];a(this,Ho).push(I,O),K.rectBoundingBox(S,k,C,T,r)}const c=r[2]-r[0]+2*n,u=r[3]-r[1]+2*n,h=r[0]-n,d=r[1]-n;let f=i?-1/0:1/0,p=1/0;const y=a(this,Ho).at(i?-1:-2),_=[y[0],y[2]];for(const A of a(this,Ho)){const[m,b,v,S]=A;!S&&i?b<p?(p=b,f=m):b===p&&(f=Math.max(f,m)):S&&!i&&(b<p?(p=b,f=m):b===p&&(f=Math.min(f,m))),A[0]=(m-h)/c,A[1]=(b-d)/u,A[2]=(v-d)/u}g(this,Bp,new Float32Array([h,d,c,u])),g(this,$p,[f,p]),g(this,Up,_)}getOutlines(){a(this,Ho).sort((t,n)=>t[0]-n[0]||t[1]-n[1]||t[2]-n[2]);const e=[];for(const t of a(this,Ho))t[3]?(e.push(...x(this,bn,bb).call(this,t)),x(this,bn,Uk).call(this,t)):(x(this,bn,zk).call(this,t),e.push(...x(this,bn,bb).call(this,t)));return x(this,bn,$k).call(this,e)}}Bp=new WeakMap,$p=new WeakMap,Up=new WeakMap,Ho=new WeakMap,Zs=new WeakMap,bn=new WeakSet,$k=function(e){const t=[],n=new Set;for(const o of e){const[l,c,u]=o;t.push([l,c,o],[l,u,o])}t.sort((o,l)=>o[1]-l[1]||o[0]-l[0]);for(let o=0,l=t.length;o<l;o+=2){const c=t[o][2],u=t[o+1][2];c.push(u),u.push(c),n.add(c),n.add(u)}const i=[];let r;for(;n.size>0;){const o=n.values().next().value;let[l,c,u,h,d]=o;n.delete(o);let f=l,p=c;for(r=[l,u],i.push(r);;){let y;if(n.has(h))y=h;else if(n.has(d))y=d;else break;n.delete(y),[l,c,u,h,d]=y,f!==l&&(r.push(f,p,l,p===c?c:u),f=l),p=p===c?u:c}r.push(f,p)}return new DO(i,a(this,Bp),a(this,$p),a(this,Up))},Cm=function(e){const t=a(this,Zs);let n=0,i=t.length-1;for(;n<=i;){const r=n+i>>1,o=t[r][0];if(o===e)return r;o<e?n=r+1:i=r-1}return i+1},Uk=function([,e,t]){const n=x(this,bn,Cm).call(this,e);a(this,Zs).splice(n,0,[e,t])},zk=function([,e,t]){const n=x(this,bn,Cm).call(this,e);for(let i=n;i<a(this,Zs).length;i++){const[r,o]=a(this,Zs)[i];if(r!==e)break;if(r===e&&o===t){a(this,Zs).splice(i,1);return}}for(let i=n-1;i>=0;i--){const[r,o]=a(this,Zs)[i];if(r!==e)break;if(r===e&&o===t){a(this,Zs).splice(i,1);return}}},bb=function(e){const[t,n,i]=e,r=[[t,n,i]],o=x(this,bn,Cm).call(this,i);for(let l=0;l<o;l++){const[c,u]=a(this,Zs)[l];for(let h=0,d=r.length;h<d;h++){const[,f,p]=r[h];if(!(u<=f||p<=c)){if(f>=c){if(p>u)r[h][1]=u;else{if(d===1)return[];r.splice(h,1),h--,d--}continue}r[h][2]=c,p>u&&r.push([t,u,p])}}}return r};var zp,uh;class DO extends W{constructor(t,n,i,r){super();w(this,zp);w(this,uh);g(this,uh,t),g(this,zp,n),this.firstPoint=i,this.lastPoint=r}toSVGPath(){const t=[];for(const n of a(this,uh)){let[i,r]=n;t.push(`M${i} ${r}`);for(let o=2;o<n.length;o+=2){const l=n[o],c=n[o+1];l===i?(t.push(`V${c}`),r=c):c===r&&(t.push(`H${l}`),i=l)}t.push("Z")}return t.join(" ")}serialize([t,n,i,r],o){const l=[],c=i-t,u=r-n;for(const h of a(this,uh)){const d=new Array(h.length);for(let f=0;f<h.length;f+=2)d[f]=t+h[f]*c,d[f+1]=r-h[f+1]*u;l.push(d)}return l}get box(){return a(this,zp)}get classNamesForOutlining(){return["highlightOutline"]}}zp=new WeakMap,uh=new WeakMap;class _b extends by{newFreeDrawOutline(e,t,n,i,r,o){return new OO(e,t,n,i,r,o)}}class OO extends jk{newOutliner(e,t,n,i,r,o=0){return new _b(e,t,n,i,r,o)}}var hh,Hp,Rr,Ll,Vp,Nn,Wp,Gp,Ml,es,ts,Ut,dh,fh,rn,ph,ks,qp,le,xb,km,Hk,Vk,Wk,Ab,ka,Ns,kc,Gk,Tm,Pm,qk,Kk,Xk,Yk,Jk;const xe=class xe extends Ue{constructor(t){super({...t,name:"highlightEditor"});w(this,le);w(this,hh,null);w(this,Hp,0);w(this,Rr);w(this,Ll,null);w(this,Vp,null);w(this,Nn,null);w(this,Wp,null);w(this,Gp,0);w(this,Ml,null);w(this,es,null);w(this,ts,null);w(this,Ut,!1);w(this,dh,null);w(this,fh,null);w(this,rn,null);w(this,ph,"");w(this,ks);w(this,qp,"");this.color=t.color||xe._defaultColor,g(this,ks,t.thickness||xe._defaultThickness),this.opacity=t.opacity||xe._defaultOpacity,g(this,Rr,t.boxes||null),g(this,qp,t.methodOfCreation||""),g(this,ph,t.text||""),this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",t.highlightId>-1?(g(this,Ut,!0),x(this,le,km).call(this,t),x(this,le,ka).call(this)):a(this,Rr)&&(g(this,hh,t.anchorNode),g(this,Hp,t.anchorOffset),g(this,Wp,t.focusNode),g(this,Gp,t.focusOffset),x(this,le,xb).call(this),x(this,le,ka).call(this),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}static get _keyboardManager(){const t=xe.prototype;return ae(this,"_keyboardManager",new ug([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:a(this,Ut)?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:a(this,ks),methodOfCreation:a(this,qp)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,n){var i;Ue.initialize(t,n),xe._defaultColor||(xe._defaultColor=((i=n.highlightColors)==null?void 0:i.values().next().value)||"#fff066")}static updateDefaultParams(t,n){switch(t){case ge.HIGHLIGHT_COLOR:xe._defaultColor=n;break;case ge.HIGHLIGHT_THICKNESS:xe._defaultThickness=n;break}}translateInPage(t,n){}get toolbarPosition(){return a(this,fh)}get commentButtonPosition(){return a(this,dh)}updateParams(t,n){switch(t){case ge.HIGHLIGHT_COLOR:x(this,le,Hk).call(this,n);break;case ge.HIGHLIGHT_THICKNESS:x(this,le,Vk).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[ge.HIGHLIGHT_COLOR,xe._defaultColor],[ge.HIGHLIGHT_THICKNESS,xe._defaultThickness]]}get propertiesToUpdate(){return[[ge.HIGHLIGHT_COLOR,this.color||xe._defaultColor],[ge.HIGHLIGHT_THICKNESS,a(this,ks)||xe._defaultThickness],[ge.HIGHLIGHT_FREE,a(this,Ut)]]}onUpdatedColor(){var t,n;(t=this.parent)==null||t.drawLayer.updateProperties(a(this,ts),{root:{fill:this.color,"fill-opacity":this.opacity}}),(n=a(this,Vp))==null||n.updateColor(this.color),super.onUpdatedColor()}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",g(this,Vp,new yy({editor:this}))]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(x(this,le,Pm).call(this))}getBaseTranslation(){return[0,0]}getRect(t,n){return super.getRect(t,n,x(this,le,Pm).call(this))}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),t&&this.div.focus()}remove(){x(this,le,Ab).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(x(this,le,ka).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let n=!1;this.parent&&!t?x(this,le,Ab).call(this):t&&(x(this,le,ka).call(this,t),n=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),n&&this.select()}rotate(t){var r,o,l;const{drawLayer:n}=this.parent;let i;a(this,Ut)?(t=(t-this.rotation+360)%360,i=x(r=xe,Ns,kc).call(r,a(this,es).box,t)):i=x(o=xe,Ns,kc).call(o,[this.x,this.y,this.width,this.height],t),n.updateProperties(a(this,ts),{bbox:i,root:{"data-main-rotation":t}}),n.updateProperties(a(this,rn),{bbox:x(l=xe,Ns,kc).call(l,a(this,Nn).box,t),root:{"data-main-rotation":t}})}render(){if(this.div)return this.div;const t=super.render();a(this,ph)&&(t.setAttribute("aria-label",a(this,ph)),t.setAttribute("role","mark")),a(this,Ut)?t.classList.add("free"):this.div.addEventListener("keydown",x(this,le,Gk).bind(this),{signal:this._uiManager._signal});const n=g(this,Ml,document.createElement("div"));return t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",n.style.clipPath=a(this,Ll),this.setDims(),yC(this,a(this,Ml),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(a(this,rn),{rootClass:{hovered:!0}})}pointerleave(){var t;this.isSelected||(t=this.parent)==null||t.drawLayer.updateProperties(a(this,rn),{rootClass:{hovered:!1}})}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:x(this,le,Tm).call(this,!0);break;case 1:case 3:x(this,le,Tm).call(this,!1);break}}select(){var t;super.select(),a(this,rn)&&((t=this.parent)==null||t.drawLayer.updateProperties(a(this,rn),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var t;super.unselect(),a(this,rn)&&((t=this.parent)==null||t.drawLayer.updateProperties(a(this,rn),{rootClass:{selected:!1}}),a(this,Ut)||x(this,le,Tm).call(this,!1))}get _mustFixPosition(){return!a(this,Ut)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.updateProperties(a(this,ts),{rootClass:{hidden:!t}}),this.parent.drawLayer.updateProperties(a(this,rn),{rootClass:{hidden:!t}}))}static startHighlighting(t,n,{target:i,x:r,y:o}){const{x:l,y:c,width:u,height:h}=i.getBoundingClientRect(),d=new AbortController,f=t.combinedSignal(d),p=y=>{d.abort(),x(this,Ns,Yk).call(this,t,y)};window.addEventListener("blur",p,{signal:f}),window.addEventListener("pointerup",p,{signal:f}),window.addEventListener("pointerdown",lt,{capture:!0,passive:!1,signal:f}),window.addEventListener("contextmenu",js,{signal:f}),i.addEventListener("pointermove",x(this,Ns,Xk).bind(this,t),{signal:f}),this._freeHighlight=new _b({x:r,y:o},[l,c,u,h],t.scale,this._defaultThickness/2,n,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(t,n,i){var _,A,m,b;let r=null;if(t instanceof Ek){const{data:{quadPoints:v,rect:S,rotation:C,id:k,color:T,opacity:I,popupRef:O,richText:L,contentsObj:j,creationDate:H,modificationDate:J},parent:{page:{pageNumber:Y}}}=t;r=t={annotationType:ie.HIGHLIGHT,color:Array.from(T),opacity:I,quadPoints:v,boxes:null,pageIndex:Y-1,rect:S.slice(0),rotation:C,annotationElementId:k,id:k,deleted:!1,popupRef:O,richText:L,comment:(j==null?void 0:j.str)||null,creationDate:H,modificationDate:J}}else if(t instanceof Q_){const{data:{inkLists:v,rect:S,rotation:C,id:k,color:T,borderStyle:{rawWidth:I},popupRef:O,richText:L,contentsObj:j,creationDate:H,modificationDate:J},parent:{page:{pageNumber:Y}}}=t;r=t={annotationType:ie.HIGHLIGHT,color:Array.from(T),thickness:I,inkLists:v,boxes:null,pageIndex:Y-1,rect:S.slice(0),rotation:C,annotationElementId:k,id:k,deleted:!1,popupRef:O,richText:L,comment:(j==null?void 0:j.str)||null,creationDate:H,modificationDate:J}}const{color:o,quadPoints:l,inkLists:c,opacity:u}=t,h=await super.deserialize(t,n,i);h.color=K.makeHexColor(...o),h.opacity=u||1,c&&g(h,ks,t.thickness),h._initialData=r,t.comment&&h.setCommentData(t);const[d,f]=h.pageDimensions,[p,y]=h.pageTranslation;if(l){const v=g(h,Rr,[]);for(let S=0;S<l.length;S+=8)v.push({x:(l[S]-p)/d,y:1-(l[S+1]-y)/f,width:(l[S+2]-l[S])/d,height:(l[S+1]-l[S+5])/f});x(_=h,le,xb).call(_),x(A=h,le,ka).call(A),h.rotate(h.rotation)}else if(c){g(h,Ut,!0);const v=c[0],S={x:v[0]-p,y:f-(v[1]-y)},C=new _b(S,[0,0,d,f],1,a(h,ks)/2,!0,.001);for(let I=0,O=v.length;I<O;I+=2)S.x=v[I]-p,S.y=f-(v[I+1]-y),C.add(S);const{id:k,clipPathId:T}=n.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:h.color,"fill-opacity":h._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:C.toSVGPath()}},!0,!0);x(m=h,le,km).call(m,{highlightOutlines:C.getOutlines(),highlightId:k,clipPathId:T}),x(b=h,le,ka).call(b),h.rotate(h.parentRotation)}return h}serialize(t=!1){if(this.isEmpty()||t)return null;if(this.deleted)return this.serializeDeleted();const n=Ue._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),i=super.serialize(t);return Object.assign(i,{color:n,opacity:this.opacity,thickness:a(this,ks),quadPoints:x(this,le,qk).call(this),outlines:x(this,le,Kk).call(this,i.rect)}),this.addComment(i),this.annotationElementId&&!x(this,le,Jk).call(this,i)?null:(i.id=this.annotationElementId,i)}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}};hh=new WeakMap,Hp=new WeakMap,Rr=new WeakMap,Ll=new WeakMap,Vp=new WeakMap,Nn=new WeakMap,Wp=new WeakMap,Gp=new WeakMap,Ml=new WeakMap,es=new WeakMap,ts=new WeakMap,Ut=new WeakMap,dh=new WeakMap,fh=new WeakMap,rn=new WeakMap,ph=new WeakMap,ks=new WeakMap,qp=new WeakMap,le=new WeakSet,xb=function(){const t=new wb(a(this,Rr),.001);g(this,es,t.getOutlines()),[this.x,this.y,this.width,this.height]=a(this,es).box;const n=new wb(a(this,Rr),.0025,.001,this._uiManager.direction==="ltr");g(this,Nn,n.getOutlines());const{firstPoint:i}=a(this,es);g(this,dh,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height]);const{lastPoint:r}=a(this,Nn);g(this,fh,[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height])},km=function({highlightOutlines:t,highlightId:n,clipPathId:i}){var f,p;if(g(this,es,t),g(this,Nn,t.getNewOutline(a(this,ks)/2+1.5,.0025)),n>=0)g(this,ts,n),g(this,Ll,i),this.parent.drawLayer.finalizeDraw(n,{bbox:t.box,path:{d:t.toSVGPath()}}),g(this,rn,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:a(this,Nn).box,path:{d:a(this,Nn).toSVGPath()}},!0));else if(this.parent){const y=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(a(this,ts),{bbox:x(f=xe,Ns,kc).call(f,a(this,es).box,(y-this.rotation+360)%360),path:{d:t.toSVGPath()}}),this.parent.drawLayer.updateProperties(a(this,rn),{bbox:x(p=xe,Ns,kc).call(p,a(this,Nn).box,y),path:{d:a(this,Nn).toSVGPath()}})}const[o,l,c,u]=t.box;switch(this.rotation){case 0:this.x=o,this.y=l,this.width=c,this.height=u;break;case 90:{const[y,_]=this.parentDimensions;this.x=l,this.y=1-o,this.width=c*_/y,this.height=u*y/_;break}case 180:this.x=1-o,this.y=1-l,this.width=c,this.height=u;break;case 270:{const[y,_]=this.parentDimensions;this.x=1-l,this.y=o,this.width=c*_/y,this.height=u*y/_;break}}const{firstPoint:h}=t;g(this,dh,[(h[0]-o)/c,(h[1]-l)/u]);const{lastPoint:d}=a(this,Nn);g(this,fh,[(d[0]-o)/c,(d[1]-l)/u])},Hk=function(t){const n=(o,l)=>{this.color=o,this.opacity=l,this.onUpdatedColor()},i=this.color,r=this.opacity;this.addCommands({cmd:n.bind(this,t,xe._defaultOpacity),undo:n.bind(this,i,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ge.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(t)},!0)},Vk=function(t){const n=a(this,ks),i=r=>{g(this,ks,r),x(this,le,Wk).call(this,r)};this.addCommands({cmd:i.bind(this,t),undo:i.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:ge.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},Wk=function(t){a(this,Ut)&&(x(this,le,km).call(this,{highlightOutlines:a(this,es).getNewOutline(t/2)}),this.fixAndSetPosition(),this.setDims())},Ab=function(){a(this,ts)===null||!this.parent||(this.parent.drawLayer.remove(a(this,ts)),g(this,ts,null),this.parent.drawLayer.remove(a(this,rn)),g(this,rn,null))},ka=function(t=this.parent){a(this,ts)===null&&({id:yt(this,ts)._,clipPathId:yt(this,Ll)._}=t.drawLayer.draw({bbox:a(this,es).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:a(this,Ut)},path:{d:a(this,es).toSVGPath()}},!1,!0),g(this,rn,t.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:a(this,Ut)},bbox:a(this,Nn).box,path:{d:a(this,Nn).toSVGPath()}},a(this,Ut))),a(this,Ml)&&(a(this,Ml).style.clipPath=a(this,Ll)))},Ns=new WeakSet,kc=function([t,n,i,r],o){switch(o){case 90:return[1-n-r,t,r,i];case 180:return[1-t-i,1-n-r,i,r];case 270:return[n,1-t-i,r,i]}return[t,n,i,r]},Gk=function(t){xe._keyboardManager.exec(this,t)},Tm=function(t){if(!a(this,hh))return;const n=window.getSelection();t?n.setPosition(a(this,hh),a(this,Hp)):n.setPosition(a(this,Wp),a(this,Gp))},Pm=function(){return a(this,Ut)?this.rotation:0},qk=function(){if(a(this,Ut))return null;const[t,n]=this.pageDimensions,[i,r]=this.pageTranslation,o=a(this,Rr),l=new Float32Array(o.length*8);let c=0;for(const{x:u,y:h,width:d,height:f}of o){const p=u*t+i,y=(1-h)*n+r;l[c]=l[c+4]=p,l[c+1]=l[c+3]=y,l[c+2]=l[c+6]=p+d*t,l[c+5]=l[c+7]=y-f*n,c+=8}return l},Kk=function(t){return a(this,es).serialize(t,x(this,le,Pm).call(this))},Xk=function(t,n){this._freeHighlight.add(n)&&t.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},Yk=function(t,n){this._freeHighlight.isEmpty()?t.drawLayer.remove(this._freeHighlightId):t.createAndAddNewEditor(n,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},Jk=function(t){const{color:n}=this._initialData;return this.hasEditedComment||t.color.some((i,r)=>i!==n[r])},w(xe,Ns),B(xe,"_defaultColor",null),B(xe,"_defaultOpacity",1),B(xe,"_defaultThickness",12),B(xe,"_type","highlight"),B(xe,"_editorType",ie.HIGHLIGHT),B(xe,"_freeHighlightId",-1),B(xe,"_freeHighlight",null),B(xe,"_freeHighlightClipId","");let _y=xe;var Fl;class Qk{constructor(){w(this,Fl,Object.create(null))}updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,n]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,n)}updateSVGProperty(e,t){a(this,Fl)[e]=t}toSVGProperties(){const e=a(this,Fl);return g(this,Fl,Object.create(null)),{root:e}}reset(){g(this,Fl,Object.create(null))}updateAll(e=this){this.updateProperties(e)}clone(){Me("Not implemented")}}Fl=new WeakMap;var ns,gh,Rt,jl,Bl,ve,Sb,Eb,Cb,xd,Zk,Rm,Ad,Tc;const pe=class pe extends Ue{constructor(t){super(t);w(this,ve);w(this,ns,null);w(this,gh);B(this,"_colorPicker",null);B(this,"_drawId",null);g(this,gh,t.mustBeCommitted||!1),this._addOutlines(t)}onUpdatedColor(){var t;(t=this._colorPicker)==null||t.update(this.color),super.onUpdatedColor()}_addOutlines(t){t.drawOutlines&&(x(this,ve,Sb).call(this,t),x(this,ve,xd).call(this))}static _mergeSVGProperties(t,n){const i=new Set(Object.keys(t));for(const[r,o]of Object.entries(n))i.has(r)?Object.assign(t[r],o):t[r]=o;return t}static getDefaultDrawingOptions(t){Me("Not implemented")}static get typesMap(){Me("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(t,n){const i=this.typesMap.get(t);i&&this._defaultDrawingOptions.updateProperty(i,n),this._currentParent&&(a(pe,Rt).updateProperty(i,n),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(t,n){const i=this.constructor.typesMap.get(t);i&&this._updateProperty(t,i,n)}static get defaultPropertiesToUpdate(){const t=[],n=this._defaultDrawingOptions;for(const[i,r]of this.typesMap)t.push([i,n[r]]);return t}get propertiesToUpdate(){const t=[],{_drawingOptions:n}=this;for(const[i,r]of this.constructor.typesMap)t.push([i,n[r]]);return t}_updateProperty(t,n,i){const r=this._drawingOptions,o=r[n],l=c=>{var h;r.updateProperty(n,c);const u=a(this,ns).updateProperty(n,c);u&&x(this,ve,Ad).call(this,u),(h=this.parent)==null||h.drawLayer.updateProperties(this._drawId,r.toSVGProperties()),t===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:l.bind(this,i),undo:l.bind(this,o),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:t,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,pe._mergeSVGProperties(a(this,ns).getPathResizingSVGProperties(x(this,ve,Rm).call(this)),{bbox:x(this,ve,Tc).call(this)}))}_onResized(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,pe._mergeSVGProperties(a(this,ns).getPathResizedSVGProperties(x(this,ve,Rm).call(this)),{bbox:x(this,ve,Tc).call(this)}))}_onTranslating(t,n){var i;(i=this.parent)==null||i.drawLayer.updateProperties(this._drawId,{bbox:x(this,ve,Tc).call(this)})}_onTranslated(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,pe._mergeSVGProperties(a(this,ns).getPathTranslatedSVGProperties(x(this,ve,Rm).call(this),this.parentDimensions),{bbox:x(this,ve,Tc).call(this)}))}_onStartDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var t;(t=this.parent)==null||t.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(t){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,a(this,gh)&&(g(this,gh,!1),this.commit(),this.parent.setSelected(this),t&&this.isOnScreen&&this.div.focus())}remove(){x(this,ve,Cb).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(x(this,ve,xd).call(this),x(this,ve,Ad).call(this,a(this,ns).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var i;let n=!1;this.parent&&!t?(this._uiManager.removeShouldRescale(this),x(this,ve,Cb).call(this)):t&&(this._uiManager.addShouldRescale(this),x(this,ve,xd).call(this,t),n=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(t),n&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,pe._mergeSVGProperties({bbox:x(this,ve,Tc).call(this)},a(this,ns).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&x(this,ve,Ad).call(this,a(this,ns).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let t,n;this._isCopy&&(t=this.x,n=this.y);const i=super.render();i.classList.add("draw");const r=document.createElement("div");return i.append(r),r.setAttribute("aria-hidden","true"),r.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(t,n),i}static createDrawerInstance(t,n,i,r,o){Me("Not implemented")}static startDrawing(t,n,i,r){var A;const{target:o,offsetX:l,offsetY:c,pointerId:u,pointerType:h}=r;if(Zt.isInitializedAndDifferentPointerType(h))return;const{viewport:{rotation:d}}=t,{width:f,height:p}=o.getBoundingClientRect(),y=g(pe,jl,new AbortController),_=t.combinedSignal(y);if(Zt.setPointer(h,u),window.addEventListener("pointerup",m=>{Zt.isSamePointerIdOrRemove(m.pointerId)&&this._endDraw(m)},{signal:_}),window.addEventListener("pointercancel",m=>{Zt.isSamePointerIdOrRemove(m.pointerId)&&this._currentParent.endDrawingSession()},{signal:_}),window.addEventListener("pointerdown",m=>{Zt.isSamePointerType(m.pointerType)&&(Zt.initializeAndAddPointerId(m.pointerId),a(pe,Rt).isCancellable()&&(a(pe,Rt).removeLastElement(),a(pe,Rt).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:_}),window.addEventListener("contextmenu",js,{signal:_}),o.addEventListener("pointermove",this._drawMove.bind(this),{signal:_}),o.addEventListener("touchmove",m=>{Zt.isSameTimeStamp(m.timeStamp)&&lt(m)},{signal:_}),t.toggleDrawing(),(A=n._editorUndoBar)==null||A.hide(),a(pe,Rt)){t.drawLayer.updateProperties(this._currentDrawId,a(pe,Rt).startNew(l,c,f,p,d));return}n.updateUIForDefaultProperties(this),g(pe,Rt,this.createDrawerInstance(l,c,f,p,d)),g(pe,Bl,this.getDefaultDrawingOptions()),this._currentParent=t,{id:this._currentDrawId}=t.drawLayer.draw(this._mergeSVGProperties(a(pe,Bl).toSVGProperties(),a(pe,Rt).defaultSVGProperties),!0,!1)}static _drawMove(t){if(Zt.isSameTimeStamp(t.timeStamp),!a(pe,Rt))return;const{offsetX:n,offsetY:i,pointerId:r}=t;if(Zt.isSamePointerId(r)){if(Zt.isUsingMultiplePointers()){this._endDraw(t);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,a(pe,Rt).add(n,i)),Zt.setTimeStamp(t.timeStamp),lt(t)}}static _cleanup(t){t&&(this._currentDrawId=-1,this._currentParent=null,g(pe,Rt,null),g(pe,Bl,null),Zt.clearPointerType(),Zt.clearTimeStamp()),a(pe,jl)&&(a(pe,jl).abort(),g(pe,jl,null),Zt.clearPointerIds())}static _endDraw(t){const n=this._currentParent;if(n){if(n.toggleDrawing(!0),this._cleanup(!1),(t==null?void 0:t.target)===n.div&&n.drawLayer.updateProperties(this._currentDrawId,a(pe,Rt).end(t.offsetX,t.offsetY)),this.supportMultipleDrawings){const i=a(pe,Rt),r=this._currentDrawId,o=i.getLastElement();n.addCommands({cmd:()=>{n.drawLayer.updateProperties(r,i.setLastElement(o))},undo:()=>{n.drawLayer.updateProperties(r,i.removeLastElement())},mustExec:!1,type:ge.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(t){const n=this._currentParent;if(!n)return null;if(n.toggleDrawing(!0),n.cleanUndoStack(ge.DRAW_STEP),!a(pe,Rt).isEmpty()){const{pageDimensions:[i,r],scale:o}=n,l=n.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:a(pe,Rt).getOutlines(i*o,r*o,o,this._INNER_MARGIN),drawingOptions:a(pe,Bl),mustBeCommitted:!t});return this._cleanup(!0),l}return n.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(t){}static deserializeDraw(t,n,i,r,o,l){Me("Not implemented")}static async deserialize(t,n,i){var d,f;const{rawDims:{pageWidth:r,pageHeight:o,pageX:l,pageY:c}}=n.viewport,u=this.deserializeDraw(l,c,r,o,this._INNER_MARGIN,t),h=await super.deserialize(t,n,i);return h.createDrawingOptions(t),x(d=h,ve,Sb).call(d,{drawOutlines:u}),x(f=h,ve,xd).call(f),h.onScaleChanging(),h.rotate(),h}serializeDraw(t){const[n,i]=this.pageTranslation,[r,o]=this.pageDimensions;return a(this,ns).serialize([n,i,r,o],t)}renderAnnotationElement(t){return t.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}};ns=new WeakMap,gh=new WeakMap,Rt=new WeakMap,jl=new WeakMap,Bl=new WeakMap,ve=new WeakSet,Sb=function({drawOutlines:t,drawId:n,drawingOptions:i}){g(this,ns,t),this._drawingOptions||(this._drawingOptions=i),this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),n>=0?(this._drawId=n,this.parent.drawLayer.finalizeDraw(n,t.defaultProperties)):this._drawId=x(this,ve,Eb).call(this,t,this.parent),x(this,ve,Ad).call(this,t.box)},Eb=function(t,n){const{id:i}=n.drawLayer.draw(pe._mergeSVGProperties(this._drawingOptions.toSVGProperties(),t.defaultSVGProperties),!1,!1);return i},Cb=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},xd=function(t=this.parent){if(!(this._drawId!==null&&this.parent===t)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,t.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=x(this,ve,Eb).call(this,a(this,ns),t)}},Zk=function([t,n,i,r]){const{parentDimensions:[o,l],rotation:c}=this;switch(c){case 90:return[n,1-t,i*(l/o),r*(o/l)];case 180:return[1-t,1-n,i,r];case 270:return[1-n,t,i*(l/o),r*(o/l)];default:return[t,n,i,r]}},Rm=function(){const{x:t,y:n,width:i,height:r,parentDimensions:[o,l],rotation:c}=this;switch(c){case 90:return[1-n,t,i*(o/l),r*(l/o)];case 180:return[1-t,1-n,i,r];case 270:return[n,1-t,i*(o/l),r*(l/o)];default:return[t,n,i,r]}},Ad=function(t){[this.x,this.y,this.width,this.height]=x(this,ve,Zk).call(this,t),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()},Tc=function(){const{x:t,y:n,width:i,height:r,rotation:o,parentRotation:l,parentDimensions:[c,u]}=this;switch((o*4+l)/90){case 1:return[1-n-r,t,r,i];case 2:return[1-t-i,1-n-r,i,r];case 3:return[n,1-t-i,r,i];case 4:return[t,n-i*(c/u),r*(u/c),i*(c/u)];case 5:return[1-n,t,i*(c/u),r*(u/c)];case 6:return[1-t-r*(u/c),1-n,r*(u/c),i*(c/u)];case 7:return[n-i*(c/u),1-t-r*(u/c),i*(c/u),r*(u/c)];case 8:return[t-i,n-r,i,r];case 9:return[1-n,t-i,r,i];case 10:return[1-t,1-n,i,r];case 11:return[n-r,1-t,r,i];case 12:return[t-r*(u/c),n,r*(u/c),i*(c/u)];case 13:return[1-n-i*(c/u),t-r*(u/c),i*(c/u),r*(u/c)];case 14:return[1-t,1-n-i*(c/u),r*(u/c),i*(c/u)];case 15:return[n,1-t,i*(c/u),r*(u/c)];default:return[t,n,i,r]}},B(pe,"_currentDrawId",-1),B(pe,"_currentParent",null),w(pe,Rt,null),w(pe,jl,null),w(pe,Bl,null),B(pe,"_INNER_MARGIN",3);let xy=pe;var Mi,Nt,It,$l,mh,dn,zt,Ts,Ul,zl,Hl,yh,Nm;class LO{constructor(e,t,n,i,r,o){w(this,yh);w(this,Mi,new Float64Array(6));w(this,Nt);w(this,It);w(this,$l);w(this,mh);w(this,dn);w(this,zt,"");w(this,Ts,0);w(this,Ul,new dg);w(this,zl);w(this,Hl);g(this,zl,n),g(this,Hl,i),g(this,$l,r),g(this,mh,o),[e,t]=x(this,yh,Nm).call(this,e,t);const l=g(this,Nt,[NaN,NaN,NaN,NaN,e,t]);g(this,dn,[e,t]),g(this,It,[{line:l,points:a(this,dn)}]),a(this,Mi).set(l,0)}updateProperty(e,t){e==="stroke-width"&&g(this,mh,t)}isEmpty(){return!a(this,It)||a(this,It).length===0}isCancellable(){return a(this,dn).length<=10}add(e,t){[e,t]=x(this,yh,Nm).call(this,e,t);const[n,i,r,o]=a(this,Mi).subarray(2,6),l=e-r,c=t-o;return Math.hypot(a(this,zl)*l,a(this,Hl)*c)<=2?null:(a(this,dn).push(e,t),isNaN(n)?(a(this,Mi).set([r,o,e,t],2),a(this,Nt).push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(a(this,Mi)[0])&&a(this,Nt).splice(6,6),a(this,Mi).set([n,i,r,o,e,t],0),a(this,Nt).push(...W.createBezierPoints(n,i,r,o,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const n=this.add(e,t);return n||(a(this,dn).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,n,i,r){g(this,zl,n),g(this,Hl,i),g(this,$l,r),[e,t]=x(this,yh,Nm).call(this,e,t);const o=g(this,Nt,[NaN,NaN,NaN,NaN,e,t]);g(this,dn,[e,t]);const l=a(this,It).at(-1);return l&&(l.line=new Float32Array(l.line),l.points=new Float32Array(l.points)),a(this,It).push({line:o,points:a(this,dn)}),a(this,Mi).set(o,0),g(this,Ts,0),this.toSVGPath(),null}getLastElement(){return a(this,It).at(-1)}setLastElement(e){return a(this,It)?(a(this,It).push(e),g(this,Nt,e.line),g(this,dn,e.points),g(this,Ts,0),{path:{d:this.toSVGPath()}}):a(this,Ul).setLastElement(e)}removeLastElement(){if(!a(this,It))return a(this,Ul).removeLastElement();a(this,It).pop(),g(this,zt,"");for(let e=0,t=a(this,It).length;e<t;e++){const{line:n,points:i}=a(this,It)[e];g(this,Nt,n),g(this,dn,i),g(this,Ts,0),this.toSVGPath()}return{path:{d:a(this,zt)}}}toSVGPath(){const e=W.svgRound(a(this,Nt)[4]),t=W.svgRound(a(this,Nt)[5]);if(a(this,dn).length===2)return g(this,zt,`${a(this,zt)} M ${e} ${t} Z`),a(this,zt);if(a(this,dn).length<=6){const i=a(this,zt).lastIndexOf("M");g(this,zt,`${a(this,zt).slice(0,i)} M ${e} ${t}`),g(this,Ts,6)}if(a(this,dn).length===4){const i=W.svgRound(a(this,Nt)[10]),r=W.svgRound(a(this,Nt)[11]);return g(this,zt,`${a(this,zt)} L ${i} ${r}`),g(this,Ts,12),a(this,zt)}const n=[];a(this,Ts)===0&&(n.push(`M ${e} ${t}`),g(this,Ts,6));for(let i=a(this,Ts),r=a(this,Nt).length;i<r;i+=6){const[o,l,c,u,h,d]=a(this,Nt).slice(i,i+6).map(W.svgRound);n.push(`C${o} ${l} ${c} ${u} ${h} ${d}`)}return g(this,zt,a(this,zt)+n.join(" ")),g(this,Ts,a(this,Nt).length),a(this,zt)}getOutlines(e,t,n,i){const r=a(this,It).at(-1);return r.line=new Float32Array(r.line),r.points=new Float32Array(r.points),a(this,Ul).build(a(this,It),e,t,n,a(this,$l),a(this,mh),i),g(this,Mi,null),g(this,Nt,null),g(this,It,null),g(this,zt,null),a(this,Ul)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}Mi=new WeakMap,Nt=new WeakMap,It=new WeakMap,$l=new WeakMap,mh=new WeakMap,dn=new WeakMap,zt=new WeakMap,Ts=new WeakMap,Ul=new WeakMap,zl=new WeakMap,Hl=new WeakMap,yh=new WeakSet,Nm=function(e,t){return W._normalizePoint(e,t,a(this,zl),a(this,Hl),a(this,$l))};var fn,Kp,Xp,ss,Fi,ji,vh,wh,Vl,Wt,Yi,eT,tT,nT;class dg extends W{constructor(){super(...arguments);w(this,Wt);w(this,fn);w(this,Kp,0);w(this,Xp);w(this,ss);w(this,Fi);w(this,ji);w(this,vh);w(this,wh);w(this,Vl)}build(t,n,i,r,o,l,c){g(this,Fi,n),g(this,ji,i),g(this,vh,r),g(this,wh,o),g(this,Vl,l),g(this,Xp,c??0),g(this,ss,t),x(this,Wt,tT).call(this)}get thickness(){return a(this,Vl)}setLastElement(t){return a(this,ss).push(t),{path:{d:this.toSVGPath()}}}removeLastElement(){return a(this,ss).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const t=[];for(const{line:n}of a(this,ss)){if(t.push(`M${W.svgRound(n[4])} ${W.svgRound(n[5])}`),n.length===6){t.push("Z");continue}if(n.length===12&&isNaN(n[6])){t.push(`L${W.svgRound(n[10])} ${W.svgRound(n[11])}`);continue}for(let i=6,r=n.length;i<r;i+=6){const[o,l,c,u,h,d]=n.subarray(i,i+6).map(W.svgRound);t.push(`C${o} ${l} ${c} ${u} ${h} ${d}`)}}return t.join("")}serialize([t,n,i,r],o){const l=[],c=[],[u,h,d,f]=x(this,Wt,eT).call(this);let p,y,_,A,m,b,v,S,C;switch(a(this,wh)){case 0:C=W._rescale,p=t,y=n+r,_=i,A=-r,m=t+u*i,b=n+(1-h-f)*r,v=t+(u+d)*i,S=n+(1-h)*r;break;case 90:C=W._rescaleAndSwap,p=t,y=n,_=i,A=r,m=t+h*i,b=n+u*r,v=t+(h+f)*i,S=n+(u+d)*r;break;case 180:C=W._rescale,p=t+i,y=n,_=-i,A=r,m=t+(1-u-d)*i,b=n+h*r,v=t+(1-u)*i,S=n+(h+f)*r;break;case 270:C=W._rescaleAndSwap,p=t+i,y=n+r,_=-i,A=-r,m=t+(1-h-f)*i,b=n+(1-u-d)*r,v=t+(1-h)*i,S=n+(1-u)*r;break}for(const{line:k,points:T}of a(this,ss))l.push(C(k,p,y,_,A,o?new Array(k.length):null)),c.push(C(T,p,y,_,A,o?new Array(T.length):null));return{lines:l,points:c,rect:[m,b,v,S]}}static deserialize(t,n,i,r,o,{paths:{lines:l,points:c},rotation:u,thickness:h}){const d=[];let f,p,y,_,A;switch(u){case 0:A=W._rescale,f=-t/i,p=n/r+1,y=1/i,_=-1/r;break;case 90:A=W._rescaleAndSwap,f=-n/r,p=-t/i,y=1/r,_=1/i;break;case 180:A=W._rescale,f=t/i+1,p=-n/r,y=-1/i,_=1/r;break;case 270:A=W._rescaleAndSwap,f=n/r+1,p=t/i+1,y=-1/r,_=-1/i;break}if(!l){l=[];for(const b of c){const v=b.length;if(v===2){l.push(new Float32Array([NaN,NaN,NaN,NaN,b[0],b[1]]));continue}if(v===4){l.push(new Float32Array([NaN,NaN,NaN,NaN,b[0],b[1],NaN,NaN,NaN,NaN,b[2],b[3]]));continue}const S=new Float32Array(3*(v-2));l.push(S);let[C,k,T,I]=b.subarray(0,4);S.set([NaN,NaN,NaN,NaN,C,k],0);for(let O=4;O<v;O+=2){const L=b[O],j=b[O+1];S.set(W.createBezierPoints(C,k,T,I,L,j),(O-2)*3),[C,k,T,I]=[T,I,L,j]}}}for(let b=0,v=l.length;b<v;b++)d.push({line:A(l[b].map(S=>S??NaN),f,p,y,_),points:A(c[b].map(S=>S??NaN),f,p,y,_)});const m=new this.prototype.constructor;return m.build(d,i,r,1,u,h,o),m}get box(){return a(this,fn)}updateProperty(t,n){return t==="stroke-width"?x(this,Wt,nT).call(this,n):null}updateParentDimensions([t,n],i){const[r,o]=x(this,Wt,Yi).call(this);g(this,Fi,t),g(this,ji,n),g(this,vh,i);const[l,c]=x(this,Wt,Yi).call(this),u=l-r,h=c-o,d=a(this,fn);return d[0]-=u,d[1]-=h,d[2]+=2*u,d[3]+=2*h,d}updateRotation(t){return g(this,Kp,t),{path:{transform:this.rotationTransform}}}get viewBox(){return a(this,fn).map(W.svgRound).join(" ")}get defaultProperties(){const[t,n]=a(this,fn);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${W.svgRound(t)} ${W.svgRound(n)}`}}}get rotationTransform(){const[,,t,n]=a(this,fn);let i=0,r=0,o=0,l=0,c=0,u=0;switch(a(this,Kp)){case 90:r=n/t,o=-t/n,c=t;break;case 180:i=-1,l=-1,c=t,u=n;break;case 270:r=-n/t,o=t/n,u=n;break;default:return""}return`matrix(${i} ${r} ${o} ${l} ${W.svgRound(c)} ${W.svgRound(u)})`}getPathResizingSVGProperties([t,n,i,r]){const[o,l]=x(this,Wt,Yi).call(this),[c,u,h,d]=a(this,fn);if(Math.abs(h-o)<=W.PRECISION||Math.abs(d-l)<=W.PRECISION){const A=t+i/2-(c+h/2),m=n+r/2-(u+d/2);return{path:{"transform-origin":`${W.svgRound(t)} ${W.svgRound(n)}`,transform:`${this.rotationTransform} translate(${A} ${m})`}}}const f=(i-2*o)/(h-2*o),p=(r-2*l)/(d-2*l),y=h/i,_=d/r;return{path:{"transform-origin":`${W.svgRound(c)} ${W.svgRound(u)}`,transform:`${this.rotationTransform} scale(${y} ${_}) translate(${W.svgRound(o)} ${W.svgRound(l)}) scale(${f} ${p}) translate(${W.svgRound(-o)} ${W.svgRound(-l)})`}}}getPathResizedSVGProperties([t,n,i,r]){const[o,l]=x(this,Wt,Yi).call(this),c=a(this,fn),[u,h,d,f]=c;if(c[0]=t,c[1]=n,c[2]=i,c[3]=r,Math.abs(d-o)<=W.PRECISION||Math.abs(f-l)<=W.PRECISION){const m=t+i/2-(u+d/2),b=n+r/2-(h+f/2);for(const{line:v,points:S}of a(this,ss))W._translate(v,m,b,v),W._translate(S,m,b,S);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${W.svgRound(t)} ${W.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const p=(i-2*o)/(d-2*o),y=(r-2*l)/(f-2*l),_=-p*(u+o)+t+o,A=-y*(h+l)+n+l;if(p!==1||y!==1||_!==0||A!==0)for(const{line:m,points:b}of a(this,ss))W._rescale(m,_,A,p,y,m),W._rescale(b,_,A,p,y,b);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${W.svgRound(t)} ${W.svgRound(n)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([t,n],i){const[r,o]=i,l=a(this,fn),c=t-l[0],u=n-l[1];if(a(this,Fi)===r&&a(this,ji)===o)for(const{line:h,points:d}of a(this,ss))W._translate(h,c,u,h),W._translate(d,c,u,d);else{const h=a(this,Fi)/r,d=a(this,ji)/o;g(this,Fi,r),g(this,ji,o);for(const{line:f,points:p}of a(this,ss))W._rescale(f,c,u,h,d,f),W._rescale(p,c,u,h,d,p);l[2]*=h,l[3]*=d}return l[0]=t,l[1]=n,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${W.svgRound(t)} ${W.svgRound(n)}`}}}get defaultSVGProperties(){const t=a(this,fn);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${W.svgRound(t[0])} ${W.svgRound(t[1])}`,transform:this.rotationTransform||null},bbox:t}}}fn=new WeakMap,Kp=new WeakMap,Xp=new WeakMap,ss=new WeakMap,Fi=new WeakMap,ji=new WeakMap,vh=new WeakMap,wh=new WeakMap,Vl=new WeakMap,Wt=new WeakSet,Yi=function(t=a(this,Vl)){const n=a(this,Xp)+t/2*a(this,vh);return a(this,wh)%180===0?[n/a(this,Fi),n/a(this,ji)]:[n/a(this,ji),n/a(this,Fi)]},eT=function(){const[t,n,i,r]=a(this,fn),[o,l]=x(this,Wt,Yi).call(this,0);return[t+o,n+l,i-2*o,r-2*l]},tT=function(){const t=g(this,fn,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:r}of a(this,ss)){if(r.length<=12){for(let c=4,u=r.length;c<u;c+=6)K.pointBoundingBox(r[c],r[c+1],t);continue}let o=r[4],l=r[5];for(let c=6,u=r.length;c<u;c+=6){const[h,d,f,p,y,_]=r.subarray(c,c+6);K.bezierBoundingBox(o,l,h,d,f,p,y,_,t),o=y,l=_}}const[n,i]=x(this,Wt,Yi).call(this);t[0]=mn(t[0]-n,0,1),t[1]=mn(t[1]-i,0,1),t[2]=mn(t[2]+n,0,1),t[3]=mn(t[3]+i,0,1),t[2]-=t[0],t[3]-=t[1]},nT=function(t){const[n,i]=x(this,Wt,Yi).call(this);g(this,Vl,t);const[r,o]=x(this,Wt,Yi).call(this),[l,c]=[r-n,o-i],u=a(this,fn);return u[0]-=l,u[1]-=c,u[2]+=2*l,u[3]+=2*c,u};class p0 extends Qk{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:Ue._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??(t=this["stroke-width"]),t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new p0(this._viewParameters);return e.updateAll(this),e}}var $y,sT;const Gc=class Gc extends xy{constructor(t){super({...t,name:"inkEditor"});w(this,$y);this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(t,n){Ue.initialize(t,n),this._defaultDrawingOptions=new p0(n.viewParameters)}static getDefaultDrawingOptions(t){const n=this._defaultDrawingOptions.clone();return n.updateProperties(t),n}static get supportMultipleDrawings(){return!0}static get typesMap(){return ae(this,"typesMap",new Map([[ge.INK_THICKNESS,"stroke-width"],[ge.INK_COLOR,"stroke"],[ge.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(t,n,i,r,o){return new LO(t,n,i,r,o,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(t,n,i,r,o,l){return dg.deserialize(t,n,i,r,o,l)}static async deserialize(t,n,i){let r=null;if(t instanceof Q_){const{data:{inkLists:l,rect:c,rotation:u,id:h,color:d,opacity:f,borderStyle:{rawWidth:p},popupRef:y,richText:_,contentsObj:A,creationDate:m,modificationDate:b},parent:{page:{pageNumber:v}}}=t;r=t={annotationType:ie.INK,color:Array.from(d),thickness:p,opacity:f,paths:{points:l},boxes:null,pageIndex:v-1,rect:c.slice(0),rotation:u,annotationElementId:h,id:h,deleted:!1,popupRef:y,richText:_,comment:(A==null?void 0:A.str)||null,creationDate:m,modificationDate:b}}const o=await super.deserialize(t,n,i);return o._initialData=r,t.comment&&o.setCommentData(t),o}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new vy(this)),[["colorPicker",this._colorPicker]]}get colorType(){return ge.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:t,_drawingOptions:n,parent:i}=this;n.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(t,n.toSVGProperties())}static onScaleChangingWhenDrawing(){const t=this._currentParent;t&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),t.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:t,thickness:n,opacity:i}){this._drawingOptions=Gc.getDefaultDrawingOptions({stroke:K.makeHexColor(...t),"stroke-width":n,"stroke-opacity":i})}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:n,points:i}=this.serializeDraw(t),{_drawingOptions:{stroke:r,"stroke-opacity":o,"stroke-width":l}}=this,c=Object.assign(super.serialize(t),{color:Ue._colorManager.convert(r),opacity:o,thickness:l,paths:{lines:n,points:i}});return this.addComment(c),t?(c.isCopy=!0,c):this.annotationElementId&&!x(this,$y,sT).call(this,c)?null:(c.id=this.annotationElementId,c)}renderAnnotationElement(t){if(this.deleted)return t.hide(),null;const{points:n,rect:i}=this.serializeDraw(!1);return t.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:n,popup:this.comment}),null}};$y=new WeakSet,sT=function(t){const{color:n,thickness:i,opacity:r,pageIndex:o}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||t.color.some((l,c)=>l!==n[c])||t.thickness!==i||t.opacity!==r||t.pageIndex!==o},B(Gc,"_type","ink"),B(Gc,"_editorType",ie.INK),B(Gc,"_defaultDrawingOptions",null);let kb=Gc;class Tb extends dg{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const zg=8,Zh=3;var Wl,Ae,Pb,ei,iT,rT,Rb,Im,oT,aT,lT,Nb,Ib,cT;class Mr{static extractContoursFromText(e,{fontFamily:t,fontStyle:n,fontWeight:i},r,o,l,c){let u=new OffscreenCanvas(1,1),h=u.getContext("2d",{alpha:!1});const d=200,f=h.font=`${n} ${i} ${d}px ${t}`,{actualBoundingBoxLeft:p,actualBoundingBoxRight:y,actualBoundingBoxAscent:_,actualBoundingBoxDescent:A,fontBoundingBoxAscent:m,fontBoundingBoxDescent:b,width:v}=h.measureText(e),S=1.5,C=Math.ceil(Math.max(Math.abs(p)+Math.abs(y)||0,v)*S),k=Math.ceil(Math.max(Math.abs(_)+Math.abs(A)||d,Math.abs(m)+Math.abs(b)||d)*S);u=new OffscreenCanvas(C,k),h=u.getContext("2d",{alpha:!0,willReadFrequently:!0}),h.font=f,h.filter="grayscale(1)",h.fillStyle="white",h.fillRect(0,0,C,k),h.fillStyle="black",h.fillText(e,C*(S-1)/2,k*(3-S)/2);const T=x(this,Ae,Nb).call(this,h.getImageData(0,0,C,k).data),I=x(this,Ae,lT).call(this,T),O=x(this,Ae,Ib).call(this,I),L=x(this,Ae,Rb).call(this,T,C,k,O);return this.processDrawnLines({lines:{curves:L,width:C,height:k},pageWidth:r,pageHeight:o,rotation:l,innerMargin:c,mustSmooth:!0,areContours:!0})}static process(e,t,n,i,r){const[o,l,c]=x(this,Ae,cT).call(this,e),[u,h]=x(this,Ae,aT).call(this,o,l,c,Math.hypot(l,c)*a(this,Wl).sigmaSFactor,a(this,Wl).sigmaR,a(this,Wl).kernelSize),d=x(this,Ae,Ib).call(this,h),f=x(this,Ae,Rb).call(this,u,l,c,d);return this.processDrawnLines({lines:{curves:f,width:l,height:c},pageWidth:t,pageHeight:n,rotation:i,innerMargin:r,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:n,rotation:i,innerMargin:r,mustSmooth:o,areContours:l}){i%180!==0&&([t,n]=[n,t]);const{curves:c,width:u,height:h}=e,d=e.thickness??0,f=[],p=Math.min(t/u,n/h),y=p/t,_=p/n,A=[];for(const{points:b}of c){const v=o?x(this,Ae,oT).call(this,b):b;if(!v)continue;A.push(v);const S=v.length,C=new Float32Array(S),k=new Float32Array(3*(S===2?2:S-2));if(f.push({line:k,points:C}),S===2){C[0]=v[0]*y,C[1]=v[1]*_,k.set([NaN,NaN,NaN,NaN,C[0],C[1]],0);continue}let[T,I,O,L]=v;T*=y,I*=_,O*=y,L*=_,C.set([T,I,O,L],0),k.set([NaN,NaN,NaN,NaN,T,I],0);for(let j=4;j<S;j+=2){const H=C[j]=v[j]*y,J=C[j+1]=v[j+1]*_;k.set(W.createBezierPoints(T,I,O,L,H,J),(j-2)*3),[T,I,O,L]=[O,L,H,J]}}if(f.length===0)return null;const m=l?new Tb:new dg;return m.build(f,t,n,1,i,l?0:d,r),{outline:m,newCurves:A,areContours:l,thickness:d,width:u,height:h}}static async compressSignature({outlines:e,areContours:t,thickness:n,width:i,height:r}){let o=1/0,l=-1/0,c=0;for(const v of e){c+=v.length;for(let S=2,C=v.length;S<C;S++){const k=v[S]-v[S-2];o=Math.min(o,k),l=Math.max(l,k)}}let u;o>=-128&&l<=127?u=Int8Array:o>=-32768&&l<=32767?u=Int16Array:u=Int32Array;const h=e.length,d=zg+Zh*h,f=new Uint32Array(d);let p=0;f[p++]=d*Uint32Array.BYTES_PER_ELEMENT+(c-2*h)*u.BYTES_PER_ELEMENT,f[p++]=0,f[p++]=i,f[p++]=r,f[p++]=t?0:1,f[p++]=Math.max(0,Math.floor(n??0)),f[p++]=h,f[p++]=u.BYTES_PER_ELEMENT;for(const v of e)f[p++]=v.length-2,f[p++]=v[0],f[p++]=v[1];const y=new CompressionStream("deflate-raw"),_=y.writable.getWriter();await _.ready,_.write(f);const A=u.prototype.constructor;for(const v of e){const S=new A(v.length-2);for(let C=2,k=v.length;C<k;C++)S[C-2]=v[C]-v[C-2];_.write(S)}_.close();const m=await new Response(y.readable).arrayBuffer(),b=new Uint8Array(m);return lC(b)}static async decompressSignature(e){try{const t=JI(e),{readable:n,writable:i}=new DecompressionStream("deflate-raw"),r=i.getWriter();await r.ready,r.write(t).then(async()=>{await r.ready,await r.close()}).catch(()=>{});let o=null,l=0;for await(const v of n)o||(o=new Uint8Array(new Uint32Array(v.buffer,0,4)[0])),o.set(v,l),l+=v.length;const c=new Uint32Array(o.buffer,0,o.length>>2),u=c[1];if(u!==0)throw new Error(`Invalid version: ${u}`);const h=c[2],d=c[3],f=c[4]===0,p=c[5],y=c[6],_=c[7],A=[],m=(zg+Zh*y)*Uint32Array.BYTES_PER_ELEMENT;let b;switch(_){case Int8Array.BYTES_PER_ELEMENT:b=new Int8Array(o.buffer,m);break;case Int16Array.BYTES_PER_ELEMENT:b=new Int16Array(o.buffer,m);break;case Int32Array.BYTES_PER_ELEMENT:b=new Int32Array(o.buffer,m);break}l=0;for(let v=0;v<y;v++){const S=c[Zh*v+zg],C=new Float32Array(S+2);A.push(C);for(let k=0;k<Zh-1;k++)C[k]=c[Zh*v+zg+k+1];for(let k=0;k<S;k++)C[k+2]=C[k]+b[l++]}return{areContours:f,thickness:p,outlines:A,width:h,height:d}}catch(t){return ne(`decompressSignature: ${t}`),null}}}Wl=new WeakMap,Ae=new WeakSet,Pb=function(e,t,n,i){return n-=e,i-=t,n===0?i>0?0:4:n===1?i+6:2-i},ei=new WeakMap,iT=function(e,t,n,i,r,o,l){const c=x(this,Ae,Pb).call(this,n,i,r,o);for(let u=0;u<8;u++){const h=(-u+c-l+16)%8,d=a(this,ei)[2*h],f=a(this,ei)[2*h+1];if(e[(n+d)*t+(i+f)]!==0)return h}return-1},rT=function(e,t,n,i,r,o,l){const c=x(this,Ae,Pb).call(this,n,i,r,o);for(let u=0;u<8;u++){const h=(u+c+l+16)%8,d=a(this,ei)[2*h],f=a(this,ei)[2*h+1];if(e[(n+d)*t+(i+f)]!==0)return h}return-1},Rb=function(e,t,n,i){const r=e.length,o=new Int32Array(r);for(let h=0;h<r;h++)o[h]=e[h]<=i?1:0;for(let h=1;h<n-1;h++)o[h*t]=o[h*t+t-1]=0;for(let h=0;h<t;h++)o[h]=o[t*n-1-h]=0;let l=1,c;const u=[];for(let h=1;h<n-1;h++){c=1;for(let d=1;d<t-1;d++){const f=h*t+d,p=o[f];if(p===0)continue;let y=h,_=d;if(p===1&&o[f-1]===0)l+=1,_-=1;else if(p>=1&&o[f+1]===0)l+=1,_+=1,p>1&&(c=p);else{p!==1&&(c=Math.abs(p));continue}const A=[d,h],m=_===d+1,b={isHole:m,points:A,id:l,parent:0};u.push(b);let v;for(const j of u)if(j.id===c){v=j;break}v?v.isHole?b.parent=m?v.parent:c:b.parent=m?c:v.parent:b.parent=m?c:0;const S=x(this,Ae,iT).call(this,o,t,h,d,y,_,0);if(S===-1){o[f]=-l,o[f]!==1&&(c=Math.abs(o[f]));continue}let C=a(this,ei)[2*S],k=a(this,ei)[2*S+1];const T=h+C,I=d+k;y=T,_=I;let O=h,L=d;for(;;){const j=x(this,Ae,rT).call(this,o,t,O,L,y,_,1);C=a(this,ei)[2*j],k=a(this,ei)[2*j+1];const H=O+C,J=L+k;A.push(J,H);const Y=O*t+L;if(o[Y+1]===0?o[Y]=-l:o[Y]===1&&(o[Y]=l),H===h&&J===d&&O===T&&L===I){o[f]!==1&&(c=Math.abs(o[f]));break}else y=O,_=L,O=H,L=J}}}return u},Im=function(e,t,n,i){if(n-t<=4){for(let T=t;T<n-2;T+=2)i.push(e[T],e[T+1]);return}const r=e[t],o=e[t+1],l=e[n-4]-r,c=e[n-3]-o,u=Math.hypot(l,c),h=l/u,d=c/u,f=h*o-d*r,p=c/l,y=1/u,_=Math.atan(p),A=Math.cos(_),m=Math.sin(_),b=y*(Math.abs(A)+Math.abs(m)),v=y*(1-b+b**2),S=Math.max(Math.atan(Math.abs(m+A)*v),Math.atan(Math.abs(m-A)*v));let C=0,k=t;for(let T=t+2;T<n-2;T+=2){const I=Math.abs(f-h*e[T+1]+d*e[T]);I>C&&(k=T,C=I)}C>(u*S)**2?(x(this,Ae,Im).call(this,e,t,k+2,i),x(this,Ae,Im).call(this,e,k,n,i)):i.push(r,o)},oT=function(e){const t=[],n=e.length;return x(this,Ae,Im).call(this,e,0,n,t),t.push(e[n-2],e[n-1]),t.length<=4?null:t},aT=function(e,t,n,i,r,o){const l=new Float32Array(o**2),c=-2*i**2,u=o>>1;for(let _=0;_<o;_++){const A=(_-u)**2;for(let m=0;m<o;m++)l[_*o+m]=Math.exp((A+(m-u)**2)/c)}const h=new Float32Array(256),d=-2*r**2;for(let _=0;_<256;_++)h[_]=Math.exp(_**2/d);const f=e.length,p=new Uint8Array(f),y=new Uint32Array(256);for(let _=0;_<n;_++)for(let A=0;A<t;A++){const m=_*t+A,b=e[m];let v=0,S=0;for(let k=0;k<o;k++){const T=_+k-u;if(!(T<0||T>=n))for(let I=0;I<o;I++){const O=A+I-u;if(O<0||O>=t)continue;const L=e[T*t+O],j=l[k*o+I]*h[Math.abs(L-b)];v+=L*j,S+=j}}const C=p[m]=Math.round(v/S);y[C]++}return[p,y]},lT=function(e){const t=new Uint32Array(256);for(const n of e)t[n]++;return t},Nb=function(e){const t=e.length,n=new Uint8ClampedArray(t>>2);let i=-1/0,r=1/0;for(let l=0,c=n.length;l<c;l++){const u=n[l]=e[l<<2];i=Math.max(i,u),r=Math.min(r,u)}const o=255/(i-r);for(let l=0,c=n.length;l<c;l++)n[l]=(n[l]-r)*o;return n},Ib=function(e){let t,n=-1/0,i=-1/0;const r=e.findIndex(c=>c!==0);let o=r,l=r;for(t=r;t<256;t++){const c=e[t];c>n&&(t-o>i&&(i=t-o,l=t-1),n=c,o=t)}for(t=l-1;t>=0&&!(e[t]>e[t+1]);t--);return t},cT=function(e){const t=e,{width:n,height:i}=e,{maxDim:r}=a(this,Wl);let o=n,l=i;if(n>r||i>r){let f=n,p=i,y=Math.log2(Math.max(n,i)/r);const _=Math.floor(y);y=y===_?_-1:_;for(let m=0;m<y;m++){o=Math.ceil(f/2),l=Math.ceil(p/2);const b=new OffscreenCanvas(o,l);b.getContext("2d").drawImage(e,0,0,f,p,0,0,o,l),f=o,p=l,e!==t&&e.close(),e=b.transferToImageBitmap()}const A=Math.min(r/o,r/l);o=Math.round(o*A),l=Math.round(l*A)}const u=new OffscreenCanvas(o,l).getContext("2d",{willReadFrequently:!0});u.fillStyle="white",u.fillRect(0,0,o,l),u.filter="grayscale(1)",u.drawImage(e,0,0,e.width,e.height,0,0,o,l);const h=u.getImageData(0,0,o,l).data;return[x(this,Ae,Nb).call(this,h),o,l]},w(Mr,Ae),w(Mr,Wl,{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}),w(Mr,ei,new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]));class Z_ extends Qk{constructor(){super(),super.updateProperties({fill:Ue._defaultLineColor,"stroke-width":0})}clone(){const e=new Z_;return e.updateAll(this),e}}class ex extends p0{constructor(e){super(e),super.updateProperties({stroke:Ue._defaultLineColor,"stroke-width":1})}clone(){const e=new ex(this._viewParameters);return e.updateAll(this),e}}var Vo,Bi,Wo,Gl;const $n=class $n extends xy{constructor(t){super({...t,mustBeCommitted:!0,name:"signatureEditor"});w(this,Vo,!1);w(this,Bi,null);w(this,Wo,null);w(this,Gl,null);this._willKeepAspectRatio=!0,g(this,Wo,t.signatureData||null),g(this,Bi,null),this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(t,n){Ue.initialize(t,n),this._defaultDrawingOptions=new Z_,this._defaultDrawnSignatureOptions=new ex(n.viewParameters)}static getDefaultDrawingOptions(t){const n=this._defaultDrawingOptions.clone();return n.updateProperties(t),n}static get supportMultipleDrawings(){return!1}static get typesMap(){return ae(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!a(this,Bi)}}static computeTelemetryFinalData(t){const n=t.get("hasDescription");return{hasAltText:n.get(!0)??0,hasNoAltText:n.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let t,n;const{_isCopy:i}=this;if(i&&(this._isCopy=!1,t=this.x,n=this.y),super.render(),this._drawId===null)if(a(this,Wo)){const{lines:r,mustSmooth:o,areContours:l,description:c,uuid:u,heightInPage:h}=a(this,Wo),{rawDims:{pageWidth:d,pageHeight:f},rotation:p}=this.parent.viewport,y=Mr.processDrawnLines({lines:r,pageWidth:d,pageHeight:f,rotation:p,innerMargin:$n._INNER_MARGIN,mustSmooth:o,areContours:l});this.addSignature(y,h,c,u)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:a(this,Bi)||""}));return i&&(this._isCopy=!0,this._moveAfterPaste(t,n)),this.div}setUuid(t){g(this,Gl,t),this.addEditToolbar()}getUuid(){return a(this,Gl)}get description(){return a(this,Bi)}set description(t){g(this,Bi,t),this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:t})),super.addEditToolbar().then(n=>{n==null||n.updateEditSignatureButton(t)}))}getSignaturePreview(){const{newCurves:t,areContours:n,thickness:i,width:r,height:o}=a(this,Wo),l=Math.max(r,o),c=Mr.processDrawnLines({lines:{curves:t.map(u=>({points:u})),thickness:i,width:r,height:o},pageWidth:l,pageHeight:l,rotation:0,innerMargin:0,mustSmooth:!1,areContours:n});return{areContours:n,outline:c.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(t,n,i,r){const{x:o,y:l}=this,{outline:c}=g(this,Wo,t);g(this,Vo,c instanceof Tb),this.description=i;let u;a(this,Vo)?u=$n.getDefaultDrawingOptions():(u=$n._defaultDrawnSignatureOptions.clone(),u.updateProperties({"stroke-width":c.thickness})),this._addOutlines({drawOutlines:c,drawingOptions:u});const[,h]=this.pageDimensions;let d=n/h;d=d>=1?.5:d,this.width*=d/this.height,this.width>=1&&(d*=.9/this.width,this.width=.9),this.height=d,this.setDims(),this.x=o,this.y=l,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(r),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!r,hasDescription:!!i}}),this.div.hidden=!1}getFromImage(t){const{rawDims:{pageWidth:n,pageHeight:i},rotation:r}=this.parent.viewport;return Mr.process(t,n,i,r,$n._INNER_MARGIN)}getFromText(t,n){const{rawDims:{pageWidth:i,pageHeight:r},rotation:o}=this.parent.viewport;return Mr.extractContoursFromText(t,n,i,r,o,$n._INNER_MARGIN)}getDrawnSignature(t){const{rawDims:{pageWidth:n,pageHeight:i},rotation:r}=this.parent.viewport;return Mr.processDrawnLines({lines:t,pageWidth:n,pageHeight:i,rotation:r,innerMargin:$n._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:t,thickness:n}){t?this._drawingOptions=$n.getDefaultDrawingOptions():(this._drawingOptions=$n._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":n}))}serialize(t=!1){if(this.isEmpty())return null;const{lines:n,points:i}=this.serializeDraw(t),{_drawingOptions:{"stroke-width":r}}=this,o=Object.assign(super.serialize(t),{isSignature:!0,areContours:a(this,Vo),color:[0,0,0],thickness:a(this,Vo)?0:r});return this.addComment(o),t?(o.paths={lines:n,points:i},o.uuid=a(this,Gl),o.isCopy=!0):o.lines=n,a(this,Bi)&&(o.accessibilityData={type:"Figure",alt:a(this,Bi)}),o}static deserializeDraw(t,n,i,r,o,l){return l.areContours?Tb.deserialize(t,n,i,r,o,l):dg.deserialize(t,n,i,r,o,l)}static async deserialize(t,n,i){var o;const r=await super.deserialize(t,n,i);return g(r,Vo,t.areContours),r.description=((o=t.accessibilityData)==null?void 0:o.alt)||"",g(r,Gl,t.uuid),r}};Vo=new WeakMap,Bi=new WeakMap,Wo=new WeakMap,Gl=new WeakMap,B($n,"_type","signature"),B($n,"_editorType",ie.SIGNATURE),B($n,"_defaultDrawingOptions",null);let Db=$n;var qe,Dt,Go,Nr,qo,bh,Ir,ql,$i,is,_h,we,Sd,Ed,Dm,Om,Lm,Lb,Mm,uT;class Ob extends Ue{constructor(t){super({...t,name:"stampEditor"});w(this,we);w(this,qe,null);w(this,Dt,null);w(this,Go,null);w(this,Nr,null);w(this,qo,null);w(this,bh,"");w(this,Ir,null);w(this,ql,!1);w(this,$i,null);w(this,is,!1);w(this,_h,!1);g(this,Nr,t.bitmapUrl),g(this,qo,t.bitmapFile),this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(t,n){Ue.initialize(t,n)}static isHandlingMimeForPasting(t){return ww.includes(t)}static paste(t,n){n.pasteEditor({mode:ie.STAMP},{bitmapFile:t.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var t;return{type:"stamp",hasAltText:!!((t=this.altTextData)!=null&&t.altText)}}static computeTelemetryFinalData(t){const n=t.get("hasAltText");return{hasAltText:n.get(!0)??0,hasNoAltText:n.get(!1)??0}}async mlGuessAltText(t=null,n=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:r,width:o,height:l}=t||this.copyCanvas(null,null,!0).imageData,c=await i.guess({name:"altText",request:{data:r,width:o,height:l,channels:r.length/(o*l)}});if(!c)throw new Error("No response from the AI service.");if(c.error)throw new Error("Error from the AI service.");if(c.cancel)return null;if(!c.output)throw new Error("No valid response from the AI service.");const u=c.output;return await this.setGuessedAltText(u),n&&!this.hasAltTextData()&&(this.altTextData={alt:u,decorative:!1}),u}remove(){var t;a(this,Dt)&&(g(this,qe,null),this._uiManager.imageManager.deleteId(a(this,Dt)),(t=a(this,Ir))==null||t.remove(),g(this,Ir,null),a(this,$i)&&(clearTimeout(a(this,$i)),g(this,$i,null))),super.remove()}rebuild(){if(!this.parent){a(this,Dt)&&x(this,we,Dm).call(this);return}super.rebuild(),this.div!==null&&(a(this,Dt)&&a(this,Ir)===null&&x(this,we,Dm).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(t){this._isDraggable=!0,t&&this.div.focus()}isEmpty(){return!(a(this,Go)||a(this,qe)||a(this,Nr)||a(this,qo)||a(this,Dt)||a(this,ql))}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let t,n;return this._isCopy&&(t=this.x,n=this.y),super.render(),this.div.hidden=!0,this.createAltText(),a(this,ql)||(a(this,qe)?x(this,we,Om).call(this):x(this,we,Dm).call(this)),this._isCopy&&this._moveAfterPaste(t,n),this._uiManager.addShouldRescale(this),this.div}setCanvas(t,n){const{id:i,bitmap:r}=this._uiManager.imageManager.getFromCanvas(t,n);n.remove(),i&&this._uiManager.imageManager.isValidId(i)&&(g(this,Dt,i),r&&g(this,qe,r),g(this,ql,!1),x(this,we,Om).call(this))}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;a(this,$i)!==null&&clearTimeout(a(this,$i)),g(this,$i,setTimeout(()=>{g(this,$i,null),x(this,we,Lb).call(this)},200))}copyCanvas(t,n,i=!1){t||(t=224);const{width:r,height:o}=a(this,qe),l=new Vi;let c=a(this,qe),u=r,h=o,d=null;if(n){if(r>n||o>n){const T=Math.min(n/r,n/o);u=Math.floor(r*T),h=Math.floor(o*T)}d=document.createElement("canvas");const p=d.width=Math.ceil(u*l.sx),y=d.height=Math.ceil(h*l.sy);a(this,is)||(c=x(this,we,Lm).call(this,p,y));const _=d.getContext("2d");_.filter=this._uiManager.hcmFilter;let A="white",m="#cfcfd8";this._uiManager.hcmFilter!=="none"?m="black":sD.isDarkMode&&(A="#8f8f9d",m="#42414d");const b=15,v=b*l.sx,S=b*l.sy,C=new OffscreenCanvas(v*2,S*2),k=C.getContext("2d");k.fillStyle=A,k.fillRect(0,0,v*2,S*2),k.fillStyle=m,k.fillRect(0,0,v,S),k.fillRect(v,S,v,S),_.fillStyle=_.createPattern(C,"repeat"),_.fillRect(0,0,p,y),_.drawImage(c,0,0,c.width,c.height,0,0,p,y)}let f=null;if(i){let p,y;if(l.symmetric&&c.width<t&&c.height<t)p=c.width,y=c.height;else if(c=a(this,qe),r>t||o>t){const m=Math.min(t/r,t/o);p=Math.floor(r*m),y=Math.floor(o*m),a(this,is)||(c=x(this,we,Lm).call(this,p,y))}const A=new OffscreenCanvas(p,y).getContext("2d",{willReadFrequently:!0});A.drawImage(c,0,0,c.width,c.height,0,0,p,y),f={width:p,height:y,data:A.getImageData(0,0,p,y).data}}return{canvas:d,width:u,height:h,imageData:f}}static async deserialize(t,n,i){var A;let r=null,o=!1;if(t instanceof Ck){const{data:{rect:m,rotation:b,id:v,structParent:S,popupRef:C,richText:k,contentsObj:T,creationDate:I,modificationDate:O},container:L,parent:{page:{pageNumber:j}},canvas:H}=t;let J,Y;H?(delete t.canvas,{id:J,bitmap:Y}=i.imageManager.getFromCanvas(L.id,H),H.remove()):(o=!0,t._hasNoCanvas=!0);const te=((A=await n._structTree.getAriaAttributes(`${Uc}${v}`))==null?void 0:A.get("aria-label"))||"";r=t={annotationType:ie.STAMP,bitmapId:J,bitmap:Y,pageIndex:j-1,rect:m.slice(0),rotation:b,annotationElementId:v,id:v,deleted:!1,accessibilityData:{decorative:!1,altText:te},isSvg:!1,structParent:S,popupRef:C,richText:k,comment:(T==null?void 0:T.str)||null,creationDate:I,modificationDate:O}}const l=await super.deserialize(t,n,i),{rect:c,bitmap:u,bitmapUrl:h,bitmapId:d,isSvg:f,accessibilityData:p}=t;o?(i.addMissingCanvas(t.id,l),g(l,ql,!0)):d&&i.imageManager.isValidId(d)?(g(l,Dt,d),u&&g(l,qe,u)):g(l,Nr,h),g(l,is,f);const[y,_]=l.pageDimensions;return l.width=(c[2]-c[0])/y,l.height=(c[3]-c[1])/_,p&&(l.altTextData=p),l._initialData=r,t.comment&&l.setCommentData(t),g(l,_h,!!r),l}serialize(t=!1,n=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i=Object.assign(super.serialize(t),{bitmapId:a(this,Dt),isSvg:a(this,is)});if(this.addComment(i),t)return i.bitmapUrl=x(this,we,Mm).call(this,!0),i.accessibilityData=this.serializeAltText(!0),i.isCopy=!0,i;const{decorative:r,altText:o}=this.serializeAltText(!1);if(!r&&o&&(i.accessibilityData={type:"Figure",alt:o}),this.annotationElementId){const c=x(this,we,uT).call(this,i);return c.isSame?null:(c.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1,i.id=this.annotationElementId,delete i.bitmapId,i)}if(n===null)return i;n.stamps||(n.stamps=new Map);const l=a(this,is)?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!n.stamps.has(a(this,Dt)))n.stamps.set(a(this,Dt),{area:l,serialized:i}),i.bitmap=x(this,we,Mm).call(this,!1);else if(a(this,is)){const c=n.stamps.get(a(this,Dt));l>c.area&&(c.area=l,c.serialized.bitmap.close(),c.serialized.bitmap=x(this,we,Mm).call(this,!1))}return i}renderAnnotationElement(t){return this.deleted?(t.hide(),null):(t.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}qe=new WeakMap,Dt=new WeakMap,Go=new WeakMap,Nr=new WeakMap,qo=new WeakMap,bh=new WeakMap,Ir=new WeakMap,ql=new WeakMap,$i=new WeakMap,is=new WeakMap,_h=new WeakMap,we=new WeakSet,Sd=function(t,n=!1){if(!t){this.remove();return}g(this,qe,t.bitmap),n||(g(this,Dt,t.id),g(this,is,t.isSvg)),t.file&&g(this,bh,t.file.name),x(this,we,Om).call(this)},Ed=function(){if(g(this,Go,null),this._uiManager.enableWaiting(!1),!!a(this,Ir)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&a(this,qe)){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&a(this,qe)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},Dm=function(){if(a(this,Dt)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(a(this,Dt)).then(i=>x(this,we,Sd).call(this,i,!0)).finally(()=>x(this,we,Ed).call(this));return}if(a(this,Nr)){const i=a(this,Nr);g(this,Nr,null),this._uiManager.enableWaiting(!0),g(this,Go,this._uiManager.imageManager.getFromUrl(i).then(r=>x(this,we,Sd).call(this,r)).finally(()=>x(this,we,Ed).call(this)));return}if(a(this,qo)){const i=a(this,qo);g(this,qo,null),this._uiManager.enableWaiting(!0),g(this,Go,this._uiManager.imageManager.getFromFile(i).then(r=>x(this,we,Sd).call(this,r)).finally(()=>x(this,we,Ed).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=ww.join(",");const n=this._uiManager._signal;g(this,Go,new Promise(i=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const r=await this._uiManager.imageManager.getFromFile(t.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),x(this,we,Sd).call(this,r)}i()},{signal:n}),t.addEventListener("cancel",()=>{this.remove(),i()},{signal:n})}).finally(()=>x(this,we,Ed).call(this))),t.click()},Om=function(){var u;const{div:t}=this;let{width:n,height:i}=a(this,qe);const[r,o]=this.pageDimensions,l=.75;if(this.width)n=this.width*r,i=this.height*o;else if(n>l*r||i>l*o){const h=Math.min(l*r/n,l*o/i);n*=h,i*=h}this._uiManager.enableWaiting(!1);const c=g(this,Ir,document.createElement("canvas"));c.setAttribute("role","img"),this.addContainer(c),this.width=n/r,this.height=i/o,this.setDims(),(u=this._initialOptions)!=null&&u.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(t.hidden=!1),x(this,we,Lb).call(this),a(this,_h)||(this.parent.addUndoableEditor(this),g(this,_h,!0)),this._reportTelemetry({action:"inserted_image"}),a(this,bh)&&this.div.setAttribute("aria-description",a(this,bh)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")},Lm=function(t,n){const{width:i,height:r}=a(this,qe);let o=i,l=r,c=a(this,qe);for(;o>2*t||l>2*n;){const u=o,h=l;o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2)),l>2*n&&(l=l>=16384?Math.floor(l/2)-1:Math.ceil(l/2));const d=new OffscreenCanvas(o,l);d.getContext("2d").drawImage(c,0,0,u,h,0,0,o,l),c=d.transferToImageBitmap()}return c},Lb=function(){const[t,n]=this.parentDimensions,{width:i,height:r}=this,o=new Vi,l=Math.ceil(i*t*o.sx),c=Math.ceil(r*n*o.sy),u=a(this,Ir);if(!u||u.width===l&&u.height===c)return;u.width=l,u.height=c;const h=a(this,is)?a(this,qe):x(this,we,Lm).call(this,l,c),d=u.getContext("2d");d.filter=this._uiManager.hcmFilter,d.drawImage(h,0,0,h.width,h.height,0,0,l,c)},Mm=function(t){if(t){if(a(this,is)){const r=this._uiManager.imageManager.getSvgUrl(a(this,Dt));if(r)return r}const n=document.createElement("canvas");return{width:n.width,height:n.height}=a(this,qe),n.getContext("2d").drawImage(a(this,qe),0,0),n.toDataURL()}if(a(this,is)){const[n,i]=this.pageDimensions,r=Math.round(this.width*n*da.PDF_TO_CSS_UNITS),o=Math.round(this.height*i*da.PDF_TO_CSS_UNITS),l=new OffscreenCanvas(r,o);return l.getContext("2d").drawImage(a(this,qe),0,0,a(this,qe).width,a(this,qe).height,0,0,r,o),l.transferToImageBitmap()}return structuredClone(a(this,qe))},uT=function(t){var l;const{pageIndex:n,accessibilityData:{altText:i}}=this._initialData,r=t.pageIndex===n,o=(((l=t.accessibilityData)==null?void 0:l.alt)||"")===i;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&r&&o,isSameAltText:o}},B(Ob,"_type","stamp"),B(Ob,"_editorType",ie.STAMP);var Kl,xh,Ko,Xo,Dr,In,Yo,Ah,Sh,ti,Or,Ot,Lr,Jo,Eh,X,Qo,Le,Fb,hT,mi,jb,Bb,Fm;const Hs=class Hs{constructor({uiManager:e,pageIndex:t,div:n,structTreeLayer:i,accessibilityManager:r,annotationLayer:o,drawLayer:l,textLayer:c,viewport:u,l10n:h}){w(this,Le);w(this,Kl);w(this,xh,!1);w(this,Ko,null);w(this,Xo,null);w(this,Dr,null);w(this,In,new Map);w(this,Yo,!1);w(this,Ah,!1);w(this,Sh,!1);w(this,ti,null);w(this,Or,null);w(this,Ot,null);w(this,Lr,null);w(this,Jo,null);w(this,Eh,-1);w(this,X);const d=[...a(Hs,Qo).values()];if(!Hs._initialized){Hs._initialized=!0;for(const f of d)f.initialize(h,e)}e.registerEditorTypes(d),g(this,X,e),this.pageIndex=t,this.div=n,g(this,Kl,r),g(this,Ko,o),this.viewport=u,g(this,Ot,c),this.drawLayer=l,this._structTree=i,a(this,X).addLayer(this)}get isEmpty(){return a(this,In).size===0}get isInvisible(){return this.isEmpty&&a(this,X).getMode()===ie.NONE}updateToolbar(e){a(this,X).updateToolbar(e)}updateMode(e=a(this,X).getMode()){switch(x(this,Le,Fm).call(this),e){case ie.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case ie.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case ie.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;if(t.toggle("nonEditing",!1),e===ie.POPUP)t.toggle("commentEditing",!0);else{t.toggle("commentEditing",!1);for(const n of a(Hs,Qo).values())t.toggle(`${n._type}Editing`,e===n._editorType)}this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=a(this,Ot))==null?void 0:t.div)}setEditingState(e){a(this,X).setEditingState(e)}addCommands(e){a(this,X).addCommands(e)}cleanUndoStack(e){a(this,X).cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=a(this,Ko))==null||t.togglePointerEvents(e)}async enable(){var n;g(this,Sh,!0),this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),(n=a(this,Jo))==null||n.abort(),g(this,Jo,null);const e=new Set;for(const i of a(this,Le,Fb))i.enableEditing(),i.show(!0),i.annotationElementId&&(a(this,X).removeChangedExistingAnnotation(i),e.add(i.annotationElementId));const t=a(this,Ko);if(t)for(const i of t.getEditableAnnotations()){if(i.hide(),a(this,X).isDeletedAnnotationElement(i.data.id)||e.has(i.data.id))continue;const r=await this.deserialize(i);r&&(this.addOrRebuild(r),r.enableEditing())}g(this,Sh,!1),a(this,X)._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){var i;if(g(this,Ah,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),a(this,Ot)&&!a(this,Jo)){g(this,Jo,new AbortController);const r=a(this,X).combinedSignal(a(this,Jo));a(this,Ot).div.addEventListener("pointerdown",o=>{const{clientX:c,clientY:u,timeStamp:h}=o,d=a(this,Eh);if(h-d>500){g(this,Eh,h);return}g(this,Eh,-1);const{classList:f}=this.div;f.toggle("getElements",!0);const p=document.elementsFromPoint(c,u);if(f.toggle("getElements",!1),!this.div.contains(p[0]))return;let y;const _=new RegExp(`^${nf}[0-9]+$`);for(const m of p)if(_.test(m.id)){y=m.id;break}if(!y)return;const A=a(this,In).get(y);(A==null?void 0:A.annotationElementId)===null&&(o.stopPropagation(),o.preventDefault(),A.dblclick(o))},{signal:r,capture:!0})}const e=a(this,Ko),t=[];if(e){const r=new Map,o=new Map;for(const c of a(this,Le,Fb)){if(c.disableEditing(),!c.annotationElementId){t.push(c);continue}if(c.serialize()!==null){r.set(c.annotationElementId,c);continue}else o.set(c.annotationElementId,c);(i=this.getEditableAnnotation(c.annotationElementId))==null||i.show(),c.remove()}const l=e.getEditableAnnotations();for(const c of l){const{id:u}=c.data;if(a(this,X).isDeletedAnnotationElement(u)){c.updateEdited({deleted:!0});continue}let h=o.get(u);if(h){h.resetAnnotationElement(c),h.show(!1),c.show();continue}h=r.get(u),h&&(a(this,X).addChangedExistingAnnotation(h),h.renderAnnotationElement(c)&&h.show(!1)),c.show()}}x(this,Le,Fm).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:n}=this.div;for(const r of a(Hs,Qo).values())n.remove(`${r._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),e==null||e.updateFakeAnnotations(t),g(this,Ah,!1)}getEditableAnnotation(e){var t;return((t=a(this,Ko))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){a(this,X).getActive()!==e&&a(this,X).setActiveEditor(e)}enableTextSelection(){var e;if(this.div.tabIndex=-1,(e=a(this,Ot))!=null&&e.div&&!a(this,Lr)){g(this,Lr,new AbortController);const t=a(this,X).combinedSignal(a(this,Lr));a(this,Ot).div.addEventListener("pointerdown",x(this,Le,hT).bind(this),{signal:t}),a(this,Ot).div.classList.add("highlighting")}}disableTextSelection(){var e;this.div.tabIndex=0,(e=a(this,Ot))!=null&&e.div&&a(this,Lr)&&(a(this,Lr).abort(),g(this,Lr,null),a(this,Ot).div.classList.remove("highlighting"))}enableClick(){if(a(this,Xo))return;g(this,Xo,new AbortController);const e=a(this,X).combinedSignal(a(this,Xo));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){var e;(e=a(this,Xo))==null||e.abort(),g(this,Xo,null)}attach(e){a(this,In).set(e.id,e);const{annotationElementId:t}=e;t&&a(this,X).isDeletedAnnotationElement(t)&&a(this,X).removeDeletedAnnotationElement(e)}detach(e){var t;a(this,In).delete(e.id),(t=a(this,Kl))==null||t.removePointerInTextLayer(e.contentDiv),!a(this,Ah)&&e.annotationElementId&&a(this,X).addDeletedAnnotationElement(e)}remove(e){this.detach(e),a(this,X).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(a(this,X).addDeletedAnnotationElement(e.annotationElementId),Ue.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),a(this,X).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!a(this,Sh)),a(this,X).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var n;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!a(this,Dr)&&(e._focusEventsAllowed=!1,g(this,Dr,setTimeout(()=>{g(this,Dr,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:a(this,X)._signal}),t.focus())},0))),e._structTreeParentId=(n=a(this,Kl))==null?void 0:n.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),n=()=>{e.remove()};this.addCommands({cmd:t,undo:n,mustExec:!1})}getEditorByUID(e){for(const t of a(this,In).values())if(t.uid===e)return t;return null}getNextId(){return a(this,X).getId()}combinedSignal(e){return a(this,X).combinedSignal(e)}canCreateNewEmptyEditor(){var e;return(e=a(this,Le,mi))==null?void 0:e.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await a(this,X).updateMode(e.mode);const{offsetX:n,offsetY:i}=x(this,Le,Bb).call(this),r=this.getNextId(),o=x(this,Le,jb).call(this,{parent:this,id:r,x:n,y:i,uiManager:a(this,X),isCentered:!0,...t});o&&this.add(o)}async deserialize(e){var t;return await((t=a(Hs,Qo).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,a(this,X)))||null}createAndAddNewEditor(e,t,n={}){const i=this.getNextId(),r=x(this,Le,jb).call(this,{parent:this,id:i,x:e.offsetX,y:e.offsetY,uiManager:a(this,X),isCentered:t,...n});return r&&this.add(r),r}get boundingClientRect(){return this.div.getBoundingClientRect()}addNewEditor(e={}){this.createAndAddNewEditor(x(this,Le,Bb).call(this),!0,e)}setSelected(e){a(this,X).setSelected(e)}toggleSelected(e){a(this,X).toggleSelected(e)}unselect(e){a(this,X).unselect(e)}pointerup(e){var i;const{isMac:t}=Kt.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!a(this,Yo)||(g(this,Yo,!1),(i=a(this,Le,mi))!=null&&i.isDrawer&&a(this,Le,mi).supportMultipleDrawings))return;if(!a(this,xh)){g(this,xh,!0);return}const n=a(this,X).getMode();if(n===ie.STAMP||n===ie.SIGNATURE){a(this,X).unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){var i;if(a(this,X).getMode()===ie.HIGHLIGHT&&this.enableTextSelection(),a(this,Yo)){g(this,Yo,!1);return}const{isMac:t}=Kt.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(g(this,Yo,!0),(i=a(this,Le,mi))!=null&&i.isDrawer){this.startDrawingSession(e);return}const n=a(this,X).getActive();g(this,xh,!n||n.isEmpty())}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),a(this,ti)){a(this,Le,mi).startDrawing(this,a(this,X),!1,e);return}a(this,X).setCurrentDrawingSession(this),g(this,ti,new AbortController);const t=a(this,X).combinedSignal(a(this,ti));this.div.addEventListener("blur",({relatedTarget:n})=>{n&&!this.div.contains(n)&&(g(this,Or,null),this.commitOrRemove())},{signal:t}),a(this,Le,mi).startDrawing(this,a(this,X),!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&g(this,Or,t);return}a(this,Or)&&setTimeout(()=>{var t;(t=a(this,Or))==null||t.focus(),g(this,Or,null)},0)}endDrawingSession(e=!1){return a(this,ti)?(a(this,X).setCurrentDrawingSession(null),a(this,ti).abort(),g(this,ti,null),g(this,Or,null),a(this,Le,mi).endDrawing(e)):null}findNewParent(e,t,n){const i=a(this,X).findParent(t,n);return i===null||i===this?!1:(i.changeParent(e),!0)}commitOrRemove(){return a(this,ti)?(this.endDrawingSession(),!0):!1}onScaleChanging(){a(this,ti)&&a(this,Le,mi).onScaleChangingWhenDrawing(this)}destroy(){var e,t;this.commitOrRemove(),((e=a(this,X).getActive())==null?void 0:e.parent)===this&&(a(this,X).commitOrRemove(),a(this,X).setActiveEditor(null)),a(this,Dr)&&(clearTimeout(a(this,Dr)),g(this,Dr,null));for(const n of a(this,In).values())(t=a(this,Kl))==null||t.removePointerInTextLayer(n.contentDiv),n.setParent(null),n.isAttachedToDOM=!1,n.div.remove();this.div=null,a(this,In).clear(),a(this,X).removeLayer(this)}render({viewport:e}){this.viewport=e,sc(this.div,e);for(const t of a(this,X).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){a(this,X).commitOrRemove(),x(this,Le,Fm).call(this);const t=this.viewport.rotation,n=e.rotation;if(this.viewport=e,sc(this.div,{rotation:n}),t!==n)for(const i of a(this,In).values())i.rotate(n)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return a(this,X).viewParameters.realScale}};Kl=new WeakMap,xh=new WeakMap,Ko=new WeakMap,Xo=new WeakMap,Dr=new WeakMap,In=new WeakMap,Yo=new WeakMap,Ah=new WeakMap,Sh=new WeakMap,ti=new WeakMap,Or=new WeakMap,Ot=new WeakMap,Lr=new WeakMap,Jo=new WeakMap,Eh=new WeakMap,X=new WeakMap,Qo=new WeakMap,Le=new WeakSet,Fb=function(){return a(this,In).size!==0?a(this,In).values():a(this,X).getEditors(this.pageIndex)},hT=function(e){a(this,X).unselectAll();const{target:t}=e;if(t===a(this,Ot).div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&a(this,Ot).div.contains(t)){const{isMac:n}=Kt.platform;if(e.button!==0||e.ctrlKey&&n)return;a(this,X).showAllEditors("highlight",!0,!0),a(this,Ot).div.classList.add("free"),this.toggleDrawing(),_y.startHighlighting(this,a(this,X).direction==="ltr",{target:a(this,Ot).div,x:e.x,y:e.y}),a(this,Ot).div.addEventListener("pointerup",()=>{a(this,Ot).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:a(this,X)._signal}),e.preventDefault()}},mi=function(){return a(Hs,Qo).get(a(this,X).getMode())},jb=function(e){const t=a(this,Le,mi);return t?new t.prototype.constructor(e):null},Bb=function(){const{x:e,y:t,width:n,height:i}=this.boundingClientRect,r=Math.max(0,e),o=Math.max(0,t),l=Math.min(window.innerWidth,e+n),c=Math.min(window.innerHeight,t+i),u=(r+l)/2-e,h=(o+c)/2-t,[d,f]=this.viewport.rotation%180===0?[u,h]:[h,u];return{offsetX:d,offsetY:f}},Fm=function(){for(const e of a(this,In).values())e.isEmpty()&&e.remove()},B(Hs,"_initialized",!1),w(Hs,Qo,new Map([yb,kb,Ob,_y,Db].map(e=>[e._editorType,e])));let Mb=Hs;var ni,pn,Xl,Yp,Uy,dT,Wi,Ub,fT,zb;const bt=class bt{constructor({pageIndex:e}){w(this,Wi);w(this,ni,null);w(this,pn,new Map);w(this,Xl,new Map);this.pageIndex=e}setParent(e){if(!a(this,ni)){g(this,ni,e);return}if(a(this,ni)!==e){if(a(this,pn).size>0)for(const t of a(this,pn).values())t.remove(),e.append(t);g(this,ni,e)}}static get _svgFactory(){return ae(this,"_svgFactory",new wy)}draw(e,t=!1,n=!1){const i=yt(bt,Yp)._++,r=x(this,Wi,Ub).call(this),o=bt._svgFactory.createElement("defs");r.append(o);const l=bt._svgFactory.createElement("path");o.append(l);const c=`path_p${this.pageIndex}_${i}`;l.setAttribute("id",c),l.setAttribute("vector-effect","non-scaling-stroke"),t&&a(this,Xl).set(i,l);const u=n?x(this,Wi,fT).call(this,o,c):null,h=bt._svgFactory.createElement("use");return r.append(h),h.setAttribute("href",`#${c}`),this.updateProperties(r,e),a(this,pn).set(i,r),{id:i,clipPathId:`url(#${u})`}}drawOutline(e,t){const n=yt(bt,Yp)._++,i=x(this,Wi,Ub).call(this),r=bt._svgFactory.createElement("defs");i.append(r);const o=bt._svgFactory.createElement("path");r.append(o);const l=`path_p${this.pageIndex}_${n}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke");let c;if(t){const d=bt._svgFactory.createElement("mask");r.append(d),c=`mask_p${this.pageIndex}_${n}`,d.setAttribute("id",c),d.setAttribute("maskUnits","objectBoundingBox");const f=bt._svgFactory.createElement("rect");d.append(f),f.setAttribute("width","1"),f.setAttribute("height","1"),f.setAttribute("fill","white");const p=bt._svgFactory.createElement("use");d.append(p),p.setAttribute("href",`#${l}`),p.setAttribute("stroke","none"),p.setAttribute("fill","black"),p.setAttribute("fill-rule","nonzero"),p.classList.add("mask")}const u=bt._svgFactory.createElement("use");i.append(u),u.setAttribute("href",`#${l}`),c&&u.setAttribute("mask",`url(#${c})`);const h=u.cloneNode();return i.append(h),u.classList.add("mainOutline"),h.classList.add("secondaryOutline"),this.updateProperties(i,e),a(this,pn).set(n,i),n}finalizeDraw(e,t){a(this,Xl).delete(e),this.updateProperties(e,t)}updateProperties(e,t){var c;if(!t)return;const{root:n,bbox:i,rootClass:r,path:o}=t,l=typeof e=="number"?a(this,pn).get(e):e;if(l){if(n&&x(this,Wi,zb).call(this,l,n),i&&x(c=bt,Uy,dT).call(c,l,i),r){const{classList:u}=l;for(const[h,d]of Object.entries(r))u.toggle(h,d)}if(o){const h=l.firstChild.firstChild;x(this,Wi,zb).call(this,h,o)}}}updateParent(e,t){if(t===this)return;const n=a(this,pn).get(e);n&&(a(t,ni).append(n),a(this,pn).delete(e),a(t,pn).set(e,n))}remove(e){a(this,Xl).delete(e),a(this,ni)!==null&&(a(this,pn).get(e).remove(),a(this,pn).delete(e))}destroy(){g(this,ni,null);for(const e of a(this,pn).values())e.remove();a(this,pn).clear(),a(this,Xl).clear()}};ni=new WeakMap,pn=new WeakMap,Xl=new WeakMap,Yp=new WeakMap,Uy=new WeakSet,dT=function(e,[t,n,i,r]){const{style:o}=e;o.top=`${100*n}%`,o.left=`${100*t}%`,o.width=`${100*i}%`,o.height=`${100*r}%`},Wi=new WeakSet,Ub=function(){const e=bt._svgFactory.create(1,1,!0);return a(this,ni).append(e),e.setAttribute("aria-hidden",!0),e},fT=function(e,t){const n=bt._svgFactory.createElement("clipPath");e.append(n);const i=`clip_${t}`;n.setAttribute("id",i),n.setAttribute("clipPathUnits","objectBoundingBox");const r=bt._svgFactory.createElement("use");return n.append(r),r.setAttribute("href",`#${t}`),r.classList.add("clip"),i},zb=function(e,t){for(const[n,i]of Object.entries(t))i===null?e.removeAttribute(n):e.setAttribute(n,i)},w(bt,Uy),w(bt,Yp,0);let $b=bt;globalThis._pdfjsTestingUtils={HighlightOutliner:wb};globalThis.pdfjsLib={AbortException:ha,AnnotationEditorLayer:Mb,AnnotationEditorParamsType:ge,AnnotationEditorType:ie,AnnotationEditorUIManager:ic,AnnotationLayer:gb,AnnotationMode:oo,AnnotationType:ft,applyOpacity:rD,build:dO,ColorPicker:yy,createValidAbsoluteUrl:iC,CSSConstants:iD,DOMSVGFactory:wy,DrawLayer:$b,FeatureTest:Kt,fetchData:ag,findContrastColor:oD,getDocument:Y_,getFilenameFromUrl:QI,getPdfFilenameFromUrl:ZI,getRGB:cg,getUuid:aC,getXfaPageViewport:tD,GlobalWorkerOptions:oi,ImageKind:im,InvalidPDFException:yw,isDataScheme:d0,isPdfFile:G_,isValidExplicitDest:mD,MathClamp:mn,noContextMenu:js,normalizeUnicode:XI,OPS:sf,OutputScale:Vi,PasswordResponses:$I,PDFDataRangeTransport:dk,PDFDateString:hy,PDFWorker:af,PermissionFlag:BI,PixelsPerInch:da,RenderingCancelledException:W_,renderRichText:uC,ResponseException:uy,setLayerDimensions:sc,shadow:ae,SignatureExtractor:Mr,stopEvent:lt,SupportedImageMimeTypes:ww,TextLayer:of,TouchManager:fy,updateUrlHash:rC,Util:K,VerbosityLevel:c0,version:hO,XfaLayer:cC};const pT="/assets/pdf.worker-zxMdjS_u.mjs";var MO={exports:{}};(function(s){var e=function(t){var n=Object.prototype,i=n.hasOwnProperty,r=Object.defineProperty||function(R,N,D){R[N]=D.value},o,l=typeof Symbol=="function"?Symbol:{},c=l.iterator||"@@iterator",u=l.asyncIterator||"@@asyncIterator",h=l.toStringTag||"@@toStringTag";function d(R,N,D){return Object.defineProperty(R,N,{value:D,enumerable:!0,configurable:!0,writable:!0}),R[N]}try{d({},"")}catch{d=function(N,D,F){return N[D]=F}}function f(R,N,D,F){var U=N&&N.prototype instanceof v?N:v,Z=Object.create(U.prototype),be=new G(F||[]);return r(Z,"_invoke",{value:H(R,D,be)}),Z}t.wrap=f;function p(R,N,D){try{return{type:"normal",arg:R.call(N,D)}}catch(F){return{type:"throw",arg:F}}}var y="suspendedStart",_="suspendedYield",A="executing",m="completed",b={};function v(){}function S(){}function C(){}var k={};d(k,c,function(){return this});var T=Object.getPrototypeOf,I=T&&T(T(M([])));I&&I!==n&&i.call(I,c)&&(k=I);var O=C.prototype=v.prototype=Object.create(k);S.prototype=C,r(O,"constructor",{value:C,configurable:!0}),r(C,"constructor",{value:S,configurable:!0}),S.displayName=d(C,h,"GeneratorFunction");function L(R){["next","throw","return"].forEach(function(N){d(R,N,function(D){return this._invoke(N,D)})})}t.isGeneratorFunction=function(R){var N=typeof R=="function"&&R.constructor;return N?N===S||(N.displayName||N.name)==="GeneratorFunction":!1},t.mark=function(R){return Object.setPrototypeOf?Object.setPrototypeOf(R,C):(R.__proto__=C,d(R,h,"GeneratorFunction")),R.prototype=Object.create(O),R},t.awrap=function(R){return{__await:R}};function j(R,N){function D(Z,be,_e,ue){var kt=p(R[Z],R,be);if(kt.type==="throw")ue(kt.arg);else{var va=kt.arg,Bs=va.value;return Bs&&typeof Bs=="object"&&i.call(Bs,"__await")?N.resolve(Bs.__await).then(function(ln){D("next",ln,_e,ue)},function(ln){D("throw",ln,_e,ue)}):N.resolve(Bs).then(function(ln){va.value=ln,_e(va)},function(ln){return D("throw",ln,_e,ue)})}}var F;function U(Z,be){function _e(){return new N(function(ue,kt){D(Z,be,ue,kt)})}return F=F?F.then(_e,_e):_e()}r(this,"_invoke",{value:U})}L(j.prototype),d(j.prototype,u,function(){return this}),t.AsyncIterator=j,t.async=function(R,N,D,F,U){U===void 0&&(U=Promise);var Z=new j(f(R,N,D,F),U);return t.isGeneratorFunction(N)?Z:Z.next().then(function(be){return be.done?be.value:Z.next()})};function H(R,N,D){var F=y;return function(Z,be){if(F===A)throw new Error("Generator is already running");if(F===m){if(Z==="throw")throw be;return P()}for(D.method=Z,D.arg=be;;){var _e=D.delegate;if(_e){var ue=J(_e,D);if(ue){if(ue===b)continue;return ue}}if(D.method==="next")D.sent=D._sent=D.arg;else if(D.method==="throw"){if(F===y)throw F=m,D.arg;D.dispatchException(D.arg)}else D.method==="return"&&D.abrupt("return",D.arg);F=A;var kt=p(R,N,D);if(kt.type==="normal"){if(F=D.done?m:_,kt.arg===b)continue;return{value:kt.arg,done:D.done}}else kt.type==="throw"&&(F=m,D.method="throw",D.arg=kt.arg)}}}function J(R,N){var D=N.method,F=R.iterator[D];if(F===o)return N.delegate=null,D==="throw"&&R.iterator.return&&(N.method="return",N.arg=o,J(R,N),N.method==="throw")||D!=="return"&&(N.method="throw",N.arg=new TypeError("The iterator does not provide a '"+D+"' method")),b;var U=p(F,R.iterator,N.arg);if(U.type==="throw")return N.method="throw",N.arg=U.arg,N.delegate=null,b;var Z=U.arg;if(!Z)return N.method="throw",N.arg=new TypeError("iterator result is not an object"),N.delegate=null,b;if(Z.done)N[R.resultName]=Z.value,N.next=R.nextLoc,N.method!=="return"&&(N.method="next",N.arg=o);else return Z;return N.delegate=null,b}L(O),d(O,h,"Generator"),d(O,c,function(){return this}),d(O,"toString",function(){return"[object Generator]"});function Y(R){var N={tryLoc:R[0]};1 in R&&(N.catchLoc=R[1]),2 in R&&(N.finallyLoc=R[2],N.afterLoc=R[3]),this.tryEntries.push(N)}function te(R){var N=R.completion||{};N.type="normal",delete N.arg,R.completion=N}function G(R){this.tryEntries=[{tryLoc:"root"}],R.forEach(Y,this),this.reset(!0)}t.keys=function(R){var N=Object(R),D=[];for(var F in N)D.push(F);return D.reverse(),function U(){for(;D.length;){var Z=D.pop();if(Z in N)return U.value=Z,U.done=!1,U}return U.done=!0,U}};function M(R){if(R){var N=R[c];if(N)return N.call(R);if(typeof R.next=="function")return R;if(!isNaN(R.length)){var D=-1,F=function U(){for(;++D<R.length;)if(i.call(R,D))return U.value=R[D],U.done=!1,U;return U.value=o,U.done=!0,U};return F.next=F}}return{next:P}}t.values=M;function P(){return{value:o,done:!0}}return G.prototype={constructor:G,reset:function(R){if(this.prev=0,this.next=0,this.sent=this._sent=o,this.done=!1,this.delegate=null,this.method="next",this.arg=o,this.tryEntries.forEach(te),!R)for(var N in this)N.charAt(0)==="t"&&i.call(this,N)&&!isNaN(+N.slice(1))&&(this[N]=o)},stop:function(){this.done=!0;var R=this.tryEntries[0],N=R.completion;if(N.type==="throw")throw N.arg;return this.rval},dispatchException:function(R){if(this.done)throw R;var N=this;function D(ue,kt){return Z.type="throw",Z.arg=R,N.next=ue,kt&&(N.method="next",N.arg=o),!!kt}for(var F=this.tryEntries.length-1;F>=0;--F){var U=this.tryEntries[F],Z=U.completion;if(U.tryLoc==="root")return D("end");if(U.tryLoc<=this.prev){var be=i.call(U,"catchLoc"),_e=i.call(U,"finallyLoc");if(be&&_e){if(this.prev<U.catchLoc)return D(U.catchLoc,!0);if(this.prev<U.finallyLoc)return D(U.finallyLoc)}else if(be){if(this.prev<U.catchLoc)return D(U.catchLoc,!0)}else if(_e){if(this.prev<U.finallyLoc)return D(U.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(R,N){for(var D=this.tryEntries.length-1;D>=0;--D){var F=this.tryEntries[D];if(F.tryLoc<=this.prev&&i.call(F,"finallyLoc")&&this.prev<F.finallyLoc){var U=F;break}}U&&(R==="break"||R==="continue")&&U.tryLoc<=N&&N<=U.finallyLoc&&(U=null);var Z=U?U.completion:{};return Z.type=R,Z.arg=N,U?(this.method="next",this.next=U.finallyLoc,b):this.complete(Z)},complete:function(R,N){if(R.type==="throw")throw R.arg;return R.type==="break"||R.type==="continue"?this.next=R.arg:R.type==="return"?(this.rval=this.arg=R.arg,this.method="return",this.next="end"):R.type==="normal"&&N&&(this.next=N),b},finish:function(R){for(var N=this.tryEntries.length-1;N>=0;--N){var D=this.tryEntries[N];if(D.finallyLoc===R)return this.complete(D.completion,D.afterLoc),te(D),b}},catch:function(R){for(var N=this.tryEntries.length-1;N>=0;--N){var D=this.tryEntries[N];if(D.tryLoc===R){var F=D.completion;if(F.type==="throw"){var U=F.arg;te(D)}return U}}throw new Error("illegal catch attempt")},delegateYield:function(R,N,D){return this.delegate={iterator:M(R),resultName:N,nextLoc:D},this.method==="next"&&(this.arg=o),b}},t}(s.exports);try{regeneratorRuntime=e}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}})(MO);var tx=(s,e)=>`${s}-${e}-${Math.random().toString(16).slice(3,8)}`;const FO=tx;let uS=0;var gT=({id:s,action:e,payload:t={}})=>{let n=s;return typeof n>"u"&&(n=FO("Job",uS),uS+=1),{id:n,action:e,payload:t}},Bh={};let nx=!1;Bh.logging=nx;Bh.setLogging=s=>{nx=s};Bh.log=(...s)=>nx?console.log.apply(void 0,s):null;const jO=gT,{log:Hg}=Bh,BO=tx;let hS=0;var $O=()=>{const s=BO("Scheduler",hS),e={},t={};let n=[];hS+=1;const i=()=>n.length,r=()=>Object.keys(e).length,o=()=>{if(n.length!==0){const d=Object.keys(e);for(let f=0;f<d.length;f+=1)if(typeof t[d[f]]>"u"){n[0](e[d[f]]);break}}},l=(d,f)=>new Promise((p,y)=>{const _=jO({action:d,payload:f});n.push(async A=>{n.shift(),t[A.id]=_;try{p(await A[d].apply(void 0,[...f,_.id]))}catch(m){y(m)}finally{delete t[A.id],o()}}),Hg(`[${s}]: Add ${_.id} to JobQueue`),Hg(`[${s}]: JobQueue length=${n.length}`),o()});return{addWorker:d=>(e[d.id]=d,Hg(`[${s}]: Add ${d.id}`),Hg(`[${s}]: Number of workers=${r()}`),o(),d.id),addJob:async(d,...f)=>{if(r()===0)throw Error(`[${s}]: You need to have at least one worker before adding jobs`);return l(d,f)},terminate:async()=>{Object.keys(e).forEach(async d=>{await e[d].terminate()}),n=[]},getQueueLen:i,getNumWorkers:r}};function UO(s){throw new Error('Could not dynamically require "'+s+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var zO=s=>{const e={};return typeof WorkerGlobalScope<"u"?e.type="webworker":typeof document=="object"?e.type="browser":typeof process=="object"&&typeof UO=="function"&&(e.type="node"),typeof s>"u"?e:e[s]};const HO=zO("type")==="browser",VO=HO?s=>new URL(s,window.location.href).href:s=>s;var WO=s=>{const e={...s};return["corePath","workerPath","langPath"].forEach(t=>{s[t]&&(e[t]=VO(e[t]))}),e},mT={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3};const GO="tesseract.js",qO="6.0.1",KO="Pure Javascript Multilingual OCR",XO="src/index.js",YO="commonjs",JO="src/index.d.ts",QO="dist/tesseract.min.js",ZO="dist/tesseract.min.js",eL={start:"node scripts/server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js && rollup -c scripts/rollup.esm.mjs","profile:tesseract":"webpack-bundle-analyzer dist/tesseract-stats.json","profile:worker":"webpack-bundle-analyzer dist/worker-stats.json",prepublishOnly:"npm run build",wait:"rimraf dist && wait-on http://localhost:3000/dist/tesseract.min.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser test:node:all","test:browser":"karma start karma.conf.js","test:node":"nyc mocha --exit --bail --require ./scripts/test-helper.mjs","test:node:all":"npm run test:node -- ./tests/*.test.mjs",lint:"eslint src","lint:fix":"eslint --fix src",postinstall:"opencollective-postinstall || true"},tL={"./src/worker/node/index.js":"./src/worker/browser/index.js"},nL="",sL=["jeromewu"],iL="Apache-2.0",rL={"@babel/core":"^7.21.4","@babel/eslint-parser":"^7.21.3","@babel/preset-env":"^7.21.4","@rollup/plugin-commonjs":"^24.1.0",acorn:"^8.8.2","babel-loader":"^9.1.2",buffer:"^6.0.3",cors:"^2.8.5",eslint:"^7.32.0","eslint-config-airbnb-base":"^14.2.1","eslint-plugin-import":"^2.27.5","expect.js":"^0.3.1",express:"^4.18.2",mocha:"^10.2.0","npm-run-all":"^4.1.5",karma:"^6.4.2","karma-chrome-launcher":"^3.2.0","karma-firefox-launcher":"^2.1.2","karma-mocha":"^2.0.1","karma-webpack":"^5.0.0",nyc:"^15.1.0",rimraf:"^5.0.0",rollup:"^3.20.7","wait-on":"^7.0.1",webpack:"^5.79.0","webpack-bundle-analyzer":"^4.8.0","webpack-cli":"^5.0.1","webpack-dev-middleware":"^6.0.2","rollup-plugin-sourcemaps":"^0.6.3"},oL={"bmp-js":"^0.1.0","idb-keyval":"^6.2.0","is-url":"^1.2.4","node-fetch":"^2.6.9","opencollective-postinstall":"^2.0.3","regenerator-runtime":"^0.13.3","tesseract.js-core":"^6.0.0","wasm-feature-detect":"^1.2.11",zlibjs:"^0.3.1"},aL={"@rollup/pluginutils":"^5.0.2"},lL={type:"git",url:"https://github.com/naptha/tesseract.js.git"},cL={url:"https://github.com/naptha/tesseract.js/issues"},uL="https://github.com/naptha/tesseract.js",hL={type:"opencollective",url:"https://opencollective.com/tesseractjs"},dL={name:GO,version:qO,description:KO,main:XO,type:YO,types:JO,unpkg:QO,jsdelivr:ZO,scripts:eL,browser:tL,author:nL,contributors:sL,license:iL,devDependencies:rL,dependencies:oL,overrides:aL,repository:lL,bugs:cL,homepage:uL,collective:hL};var fL={workerBlobURL:!0,logger:()=>{}};const pL=dL.version,gL=fL;var mL={...gL,workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${pL}/dist/worker.min.js`},yL=({workerPath:s,workerBlobURL:e})=>{let t;if(Blob&&URL&&e){const n=new Blob([`importScripts("${s}");`],{type:"application/javascript"});t=new Worker(URL.createObjectURL(n))}else t=new Worker(s);return t},vL=s=>{s.terminate()},wL=(s,e)=>{s.onmessage=({data:t})=>{e(t)}},bL=async(s,e)=>{s.postMessage(e)};const ov=s=>new Promise((e,t)=>{const n=new FileReader;n.onload=()=>{e(n.result)},n.onerror=({target:{error:{code:i}}})=>{t(Error(`File could not be read! Code=${i}`))},n.readAsArrayBuffer(s)}),Hb=async s=>{let e=s;if(typeof s>"u")return"undefined";if(typeof s=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(s)?e=atob(s.split(",")[1]).split("").map(t=>t.charCodeAt(0)):e=await(await fetch(s)).arrayBuffer();else if(typeof HTMLElement<"u"&&s instanceof HTMLElement)s.tagName==="IMG"&&(e=await Hb(s.src)),s.tagName==="VIDEO"&&(e=await Hb(s.poster)),s.tagName==="CANVAS"&&await new Promise(t=>{s.toBlob(async n=>{e=await ov(n),t()})});else if(typeof OffscreenCanvas<"u"&&s instanceof OffscreenCanvas){const t=await s.convertToBlob();e=await ov(t)}else(s instanceof File||s instanceof Blob)&&(e=await ov(s));return new Uint8Array(e)};var _L=Hb;const xL=mL,AL=yL,SL=vL,EL=wL,CL=bL,kL=_L;var TL={defaultOptions:xL,spawnWorker:AL,terminateWorker:SL,onMessage:EL,send:CL,loadImage:kL};const PL=WO,gi=gT,{log:dS}=Bh,RL=tx,_a=mT,{defaultOptions:NL,spawnWorker:IL,terminateWorker:DL,onMessage:OL,loadImage:fS,send:LL}=TL;let pS=0;var yT=async(s="eng",e=_a.LSTM_ONLY,t={},n={})=>{const i=RL("Worker",pS),{logger:r,errorHandler:o,...l}=PL({...NL,...t}),c={},u=typeof s=="string"?s.split("+"):s;let h=e,d=n;const f=[_a.DEFAULT,_a.LSTM_ONLY].includes(e)&&!l.legacyCore;let p,y;const _=new Promise((M,P)=>{y=M,p=P}),A=M=>{p(M.message)};let m=IL(l);m.onerror=A,pS+=1;const b=({id:M,action:P,payload:R})=>new Promise((N,D)=>{dS(`[${i}]: Start ${M}, action=${P}`);const F=`${P}-${M}`;c[F]={resolve:N,reject:D},LL(m,{workerId:i,jobId:M,action:P,payload:R})}),v=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),S=M=>b(gi({id:M,action:"load",payload:{options:{lstmOnly:f,corePath:l.corePath,logging:l.logging}}})),C=(M,P,R)=>b(gi({id:R,action:"FS",payload:{method:"writeFile",args:[M,P]}})),k=(M,P)=>b(gi({id:P,action:"FS",payload:{method:"readFile",args:[M,{encoding:"utf8"}]}})),T=(M,P)=>b(gi({id:P,action:"FS",payload:{method:"unlink",args:[M]}})),I=(M,P,R)=>b(gi({id:R,action:"FS",payload:{method:M,args:P}})),O=(M,P)=>b(gi({id:P,action:"loadLanguage",payload:{langs:M,options:{langPath:l.langPath,dataPath:l.dataPath,cachePath:l.cachePath,cacheMethod:l.cacheMethod,gzip:l.gzip,lstmOnly:[_a.DEFAULT,_a.LSTM_ONLY].includes(h)&&!l.legacyLang}}})),L=(M,P,R,N)=>b(gi({id:N,action:"initialize",payload:{langs:M,oem:P,config:R}})),j=(M="eng",P,R,N)=>{if(f&&[_a.TESSERACT_ONLY,_a.TESSERACT_LSTM_COMBINED].includes(P))throw Error("Legacy model requested but code missing.");const D=P||h;h=D;const F=R||d;d=F;const Z=(typeof M=="string"?M.split("+"):M).filter(be=>!u.includes(be));return u.push(...Z),Z.length>0?O(Z,N).then(()=>L(M,D,F,N)):L(M,D,F,N)},H=(M={},P)=>b(gi({id:P,action:"setParameters",payload:{params:M}})),J=async(M,P={},R={text:!0},N)=>b(gi({id:N,action:"recognize",payload:{image:await fS(M),options:P,output:R}})),Y=async(M,P)=>{if(f)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return b(gi({id:P,action:"detect",payload:{image:await fS(M)}}))},te=async()=>(m!==null&&(DL(m),m=null),Promise.resolve());OL(m,({workerId:M,jobId:P,status:R,action:N,data:D})=>{const F=`${N}-${P}`;if(R==="resolve")dS(`[${M}]: Complete ${P}`),c[F].resolve({jobId:P,data:D}),delete c[F];else if(R==="reject")if(c[F].reject(D),delete c[F],N==="load"&&p(D),o)o(D);else throw Error(D);else R==="progress"&&r({...D,userJobId:P})});const G={id:i,worker:m,load:v,writeText:C,readText:k,removeFile:T,FS:I,reinitialize:j,setParameters:H,recognize:J,detect:Y,terminate:te};return S().then(()=>O(s)).then(()=>L(s,e,n)).then(()=>y(G)).catch(()=>{}),_};const vT=yT,ML=async(s,e,t)=>{const n=await vT(e,1,t);return n.recognize(s).finally(async()=>{await n.terminate()})},FL=async(s,e)=>{const t=await vT("osd",0,e);return t.detect(s).finally(async()=>{await t.terminate()})};var jL={recognize:ML,detect:FL},BL={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"},$L={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"};const UL=$O,zL=yT,HL=jL,VL=BL,WL=mT,GL=$L,{setLogging:qL}=Bh;var KL={languages:VL,OEM:WL,PSM:GL,createScheduler:UL,createWorker:zL,setLogging:qL,...HL};async function XL(s){try{const e=await JL(s),t=gS(e,"proveedor"),n=sM(e),i=rM(e),r=i?sC(i):null,o=oM(e),l=aM(e),c=lM(e),u=gS(e,"receptor"),h=iM(e),d=cM(e),f=uM(e),p=hM({supplierCuit:t,invoiceType:r,pointOfSale:o,invoiceNumber:l,issueDate:c,totalAmount:d.totalAmount});return{supplierCuit:t,supplierName:n,invoiceType:r,pointOfSale:o,invoiceNumber:l,issueDate:c,receiverCuit:u,receiverName:h,...d,taxes:f,confidence:p,rawText:e}}catch(e){throw console.error("Error extracting data from PDF:",e),e}}oi.workerSrc=pT;let av=null,lv=null;async function YL(){return av||(lv||(lv=(async()=>{const s=await KL.createWorker({logger:()=>{}});return await s.load(),await s.loadLanguage("spa"),await s.initialize("spa"),av=s,s})()),lv)}async function JL(s){if(typeof window>"u")throw new Error("El OCR solo est disponible en el entorno del navegador");return s.type==="application/pdf"?QL(s):wT(s)}async function QL(s){const e=await s.arrayBuffer(),t=await Y_({data:new Uint8Array(e)}).promise;let n="";for(let i=1;i<=t.numPages;i++){const r=await t.getPage(i),o=await ZL(r);if(o.trim()){n+=`${o}
`;continue}const l=await eM(r);n+=`${l}
`}return n}async function ZL(s){return(await s.getTextContent()).items.map(n=>typeof n.str=="string"?n.str:"").filter(Boolean).join(" ")}async function eM(s){const e=s.getViewport({scale:2}),t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("No se pudo inicializar el canvas para OCR");t.width=e.width,t.height=e.height,await s.render({canvasContext:n,viewport:e}).promise;const i=await tM(t);return wT(i)}async function tM(s){return new Promise((e,t)=>{s.toBlob(n=>{n?e(n):t(new Error("No se pudo generar un blob desde el canvas"))},"image/png")})}async function wT(s){const e=await YL(),t=await nM(s),{data:n}=await e.recognize(t);return n.text}async function nM(s){return new Promise((e,t)=>{const n=new FileReader;n.onload=()=>e(n.result),n.onerror=()=>t(new Error("No se pudo leer el blob")),n.readAsDataURL(s)})}function gS(s,e){var n;const t=[/CUIT[:\s]*(\d{2}[-\s]?\d{8}[-\s]?\d{1})/gi,/(\d{2}[-\s]?\d{8}[-\s]?\d{1})/g];for(const i of t){const r=s.match(i);if(r&&r.length>0){const o=((n=r[e==="proveedor"?0:1])==null?void 0:n.replace(/[^0-9]/g,""))||null;if(o&&V_(o))return o}}return null}function sM(s){const e=[/Razn Social[:\s]+([A-Za-z0-9\s,.]+)/i,/Denominacin[:\s]+([A-Za-z0-9\s,.]+)/i];for(const t of e){const n=s.match(t);if(n&&n[1])return n[1].trim()}return null}function iM(s){const e=[/Denominacin del comprador[:\s]+([A-Za-z0-9\s,.]+)/i,/Comprador[:\s]+([A-Za-z0-9\s,.]+)/i];for(const t of e){const n=s.match(t);if(n&&n[1])return n[1].trim()}return null}function rM(s){const e=[/Tipo de Comprobante[:\s]+(\d{3})/i,/Comprobante[:\s]+(\d{3})/i,/Factura\s+([ABC])/i];for(const t of e){const n=s.match(t);if(n&&n[1])return n[1].padStart(3,"0")}return null}function oM(s){const e=[/Punto de Venta[:\s]+(\d{4,5})/i,/P\.?\s*V\.?[:\s]+(\d{4,5})/i];for(const t of e){const n=s.match(t);if(n&&n[1])return n[1].padStart(5,"0")}return null}function aM(s){const e=[/Nmero[:\s]+(\d{8})/i,/Nro[:\s]+(\d{8})/i,/(\d{4,5})[-\s](\d{8})/];for(const t of e){const n=s.match(t);if(n){const i=n[2]||n[1];if(i)return i.padStart(8,"0")}}return null}function lM(s){const e=[/Fecha de Emisin[:\s]+(\d{2})[\/\-](\d{2})[\/\-](\d{4})/i,/Fecha[:\s]+(\d{2})[\/\-](\d{2})[\/\-](\d{4})/i,/(\d{2})[\/\-](\d{2})[\/\-](\d{4})/];for(const t of e){const n=s.match(t);if(n&&n[1]&&n[2]&&n[3]){const i=n[1],r=n[2];return`${n[3]}-${r}-${i}`}}return null}function cM(s){const e=s.match(/Neto Gravado[:\s]+\$?\s*([\d.,]+)/i),t=s.match(/No Gravado[:\s]+\$?\s*([\d.,]+)/i),n=s.match(/Exento[:\s]+\$?\s*([\d.,]+)/i),i=s.match(/IVA[:\s]+\$?\s*([\d.,]+)/i),r=s.match(/Total[:\s]+\$?\s*([\d.,]+)/i),o=l=>!l||!l[1]?0:parseFloat(l[1].replace(/\./g,"").replace(",","."));return{netTaxed:o(e),netUntaxed:o(t),netExempt:o(n),ivaAmount:o(i),otherTaxesAmount:0,totalAmount:o(r)}}function uM(s){const e=[],t=[/IVA\s+(21|10\.5|27|5|2\.5)%[:\s]+Base[:\s]+\$?\s*([\d.,]+)[:\s]+Imp[:\s]+\$?\s*([\d.,]+)/gi];for(const n of t){let i;for(;(i=n.exec(s))!==null;){const r=parseFloat(i[1]),o=parseFloat(i[2].replace(/\./g,"").replace(",",".")),l=parseFloat(i[3].replace(/\./g,"").replace(",","."));e.push({taxType:`IVA_${i[1].replace(".","_")}`,taxBase:o,taxAmount:l,rate:r})}}return e}function hM(s){let e=0;const t={supplierCuit:.25,invoiceType:.15,pointOfSale:.1,invoiceNumber:.15,issueDate:.15,totalAmount:.2};return s.supplierCuit&&V_(s.supplierCuit)&&(e+=t.supplierCuit),s.invoiceType&&(e+=t.invoiceType),s.pointOfSale&&(e+=t.pointOfSale),s.invoiceNumber&&(e+=t.invoiceNumber),s.issueDate&&(e+=t.issueDate),s.totalAmount>0&&(e+=t.totalAmount),Math.round(e*100)/100}const dM={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1,VITE_SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhhZmtuaHpnbWxqanNyZmlhYnpiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI2MzEwNDIsImV4cCI6MjA3ODIwNzA0Mn0.oozQPtaKU7AomPutZXy9PaqeUbAxU2PNEEschRDpGT4",VITE_SUPABASE_URL:"https://xafknhzgmljjsrfiabzb.supabase.co"};function cv(s,e=!0){const t=dM[s];if(!t&&e)throw new Error(`Variable de entorno faltante: ${s}`);return t||""}function fM(){const s=cv("VITE_SUPABASE_URL"),e=cv("VITE_SUPABASE_ANON_KEY"),t=cv("VITE_OPENAI_API_KEY",!1);if(!s||!e)throw new Error("Configuracin de Supabase incompleta. Verifica las variables de entorno.");return{supabase:{url:s,anonKey:e},openai:{apiKey:t||null,enabled:!!t}}}const Vb=fM();function pM(){return Vb.openai.enabled}function gM(){if(!Vb.openai.apiKey)throw new Error("OpenAI API key no est configurada");return Vb.openai.apiKey}const mM="https://api.openai.com/v1/chat/completions",yM="gpt-4o",Vg=2,vM=1e3,vc={supplierCuit:.25,invoiceType:.15,pointOfSale:.1,invoiceNumber:.15,issueDate:.15,totalAmount:.2};class eu extends Error{constructor(e,t,n=!1){super(e),this.statusCode=t,this.retryable=n,this.name="OpenAIError"}}async function wM(s){if(!pM())throw new eu("OpenAI no est configurado. Agrega VITE_OPENAI_API_KEY al archivo .env",void 0,!1);let e=null;for(let t=0;t<=Vg;t++)try{return t>0&&(console.log(`[OpenAI OCR] Intento ${t+1} de ${Vg+1}`),await xM(vM*t)),await bM(s)}catch(n){if(e=n,n instanceof eu&&!n.retryable)throw n;if(t<Vg){console.warn(`[OpenAI OCR] Error en intento ${t+1}, reintentando...`,n.message);continue}}throw new eu(`OpenAI OCR fall despus de ${Vg+1} intentos: ${e==null?void 0:e.message}`,void 0,!1)}async function bM(s){const e=gM(),{base64:t,mimeType:n}=await AM(s),i=_M(),r={model:yM,messages:[{role:"user",content:[{type:"text",text:i},{type:"image_url",image_url:{url:`data:${n};base64,${t}`}}]}],max_tokens:1200},o=await fetch(mM,{method:"POST",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify(r)});if(!o.ok){const v=await o.text();console.error("[OpenAI OCR] Error en la respuesta:",{status:o.status,statusText:o.statusText,body:v});const S=o.status===429||o.status>=500;throw new eu(`OpenAI OCR fall (${o.status}): ${v}`,o.status,S)}const l=await o.json(),c=CM(l);let u;try{u=JSON.parse(c)}catch(v){throw console.error("[OpenAI OCR] Error al parsear JSON:",v),console.error("[OpenAI OCR] Texto recibido:",c),new eu("OpenAI devolvi un formato inesperado (no JSON vlido)",void 0,!1)}const h=mS(u.supplierCuit),d=kM(u.invoiceTypeCode??u.invoiceType),f=d?sC(d):null,p=uv(u.pointOfSale),y=uv(u.invoiceNumber),_=uv(u.issueDate),A={netTaxed:no(u.netTaxed),netUntaxed:no(u.netUntaxed),netExempt:no(u.netExempt),ivaAmount:no(u.ivaAmount),otherTaxesAmount:no(u.otherTaxesAmount),totalAmount:no(u.totalAmount)},m=TM(u.taxes),b=PM({supplierCuit:h,invoiceType:f,pointOfSale:p,invoiceNumber:y,issueDate:_,totalAmount:A.totalAmount});return{supplierCuit:h,supplierName:u.supplierName??null,invoiceType:f,pointOfSale:p,invoiceNumber:y,issueDate:_,receiverCuit:mS(u.receiverCuit),receiverName:u.receiverName??null,...A,taxes:m,confidence:b,rawText:c}}function _M(){return`
Extrae los datos del comprobante argentino adjunto y responde SOLO con JSON vlido, sin texto adicional.
Estructura esperada:
{
  "supplierCuit": "string|null",
  "supplierName": "string|null",
  "receiverCuit": "string|null",
  "receiverName": "string|null",
  "invoiceTypeCode": "string|null",
  "invoiceType": "string|null",
  "pointOfSale": "string|null",
  "invoiceNumber": "string|null",
  "issueDate": "YYYY-MM-DD|null",
  "netTaxed": "number",
  "netUntaxed": "number",
  "netExempt": "number",
  "ivaAmount": "number",
  "otherTaxesAmount": "number",
  "totalAmount": "number",
  "taxes": [
    { "taxType": "string", "taxBase": "number", "taxAmount": "number", "rate": "number|null" }
  ]
}
Usa null si no encuentras un dato. Usa nmeros con punto decimal.
`}function xM(s){return new Promise(e=>setTimeout(e,s))}function AM(s){return s.type==="application/pdf"?SM(s).then(e=>({base64:e,mimeType:"image/png"})):new Promise((e,t)=>{const n=new FileReader;n.onload=()=>{const r=n.result.split(",")[1]??"";e({base64:r,mimeType:s.type||"application/octet-stream"})},n.onerror=()=>t(n.error??new Error("No se pudo leer el archivo")),n.readAsDataURL(s)})}oi.workerSrc=pT;async function SM(s){if(typeof window>"u")throw new Error("La conversin de PDF a imagen solo est disponible en el navegador");const e=await s.arrayBuffer(),n=await(await Y_({data:new Uint8Array(e)}).promise).getPage(1);return await EM(n)}async function EM(s){const e=s.getViewport({scale:2}),t=document.createElement("canvas"),n=t.getContext("2d");if(!n)throw new Error("No se pudo inicializar el canvas para renderizar el PDF");return t.width=e.width,t.height=e.height,await s.render({canvasContext:n,viewport:e}).promise,t.toDataURL("image/png").split(",")[1]??""}function CM(s){var e,t;if(s!=null&&s.choices&&Array.isArray(s.choices)&&s.choices.length>0){const n=(t=(e=s.choices[0])==null?void 0:e.message)==null?void 0:t.content;if(typeof n=="string"&&n.trim()){let i=n.trim();return i.startsWith("```json")?i=i.replace(/^```json\s*/,"").replace(/```\s*$/,""):i.startsWith("```")&&(i=i.replace(/^```\s*/,"").replace(/```\s*$/,"")),i.trim()}}throw console.error("[OpenAI OCR] Estructura de respuesta inesperada:",s),new eu("OpenAI no devolvi contenido legible en el formato esperado",void 0,!1)}function mS(s){if(!s)return null;const e=String(s).replace(/\D/g,"");return V_(e)?e:null}function kM(s){if(!s)return null;const e=String(s).trim().toUpperCase();if(/^\d{1,3}$/.test(e))return e.padStart(3,"0");const t={"FACTURA A":"001","FACTURA B":"006","FACTURA C":"011","FACTURA M":"051","NOTA DE CREDITO A":"003","NOTA DE CREDITO B":"008","NOTA DE CREDITO C":"013","NOTA DE DEBITO A":"002","NOTA DE DEBITO B":"007","NOTA DE DEBITO C":"012"},n=e.normalize("NFD").replace(/[\u0300-\u036f]/g,"");return t[n]??null}function uv(s){if(!s)return null;const e=String(s).trim();return e.length>0?e:null}function no(s){if(s==null)return 0;if(typeof s=="number"&&!Number.isNaN(s))return s;const e=String(s).replace(/\s+/g,"").replace(/\./g,"").replace(",","."),t=parseFloat(e);return Number.isNaN(t)?0:t}function TM(s){return Array.isArray(s)?s.map(e=>({taxType:typeof(e==null?void 0:e.taxType)=="string"?e.taxType:"OTRO",taxBase:no(e==null?void 0:e.taxBase),taxAmount:no(e==null?void 0:e.taxAmount),rate:typeof(e==null?void 0:e.rate)=="number"?e.rate:null})).filter(e=>e.taxAmount!==0||e.taxBase!==0):[]}function PM(s){let e=0;return s.supplierCuit&&(e+=vc.supplierCuit),s.invoiceType&&(e+=vc.invoiceType),s.pointOfSale&&(e+=vc.pointOfSale),s.invoiceNumber&&(e+=vc.invoiceNumber),s.issueDate&&(e+=vc.issueDate),s.totalAmount>0&&(e+=vc.totalAmount),Math.round(Math.min(e,1)*100)/100}async function RM(s){const e=LI({netTaxed:s.net_taxed||0,netUntaxed:s.net_untaxed||0,netExempt:s.net_exempt||0,ivaAmount:s.iva_amount||0,otherTaxesAmount:s.other_taxes_amount||0,totalAmount:s.total_amount}),t=e.valid?null:{errors:e.errors},{data:n,error:i}=await Xe.from("invoices").insert({...s,validation_errors:t}).select().single();if(i)throw i;return n}async function yS(s,e){const{data:t,error:n}=await Xe.from("invoices").update(e).eq("id",s).select().single();if(n)throw n;return t}async function bT(s){let e=Xe.from("invoices").select("*").order("created_at",{ascending:!1});s!=null&&s.status&&(e=e.eq("status",s.status)),s!=null&&s.supplierId&&(e=e.eq("supplier_id",s.supplierId)),s!=null&&s.fromDate&&(e=e.gte("issue_date",s.fromDate)),s!=null&&s.toDate&&(e=e.lte("issue_date",s.toDate));const{data:t,error:n}=await e;if(n)throw n;return t||[]}async function NM(s,e,t,n){const{data:i,error:r}=await Xe.from("invoices").select("*").eq("supplier_cuit",s).eq("invoice_type",e).eq("point_of_sale",t).eq("invoice_number",n).maybeSingle();if(r)throw r;return i}async function IM(){const{data:s,error:e}=await Xe.from("invoices").select("*").eq("status","READY_FOR_EXPORT").eq("exported",!1).order("issue_date",{ascending:!0});if(e)throw e;return s||[]}async function DM(s,e){const{error:t}=await Xe.from("invoices").update({exported:!0,export_batch_id:e,status:"EXPORTED"}).in("id",s);if(t)throw t}async function OM(s){const{data:e,error:t}=await Xe.from("invoices").select("*").eq("id",s).maybeSingle();if(t)throw t;if(!e)return null;const{data:n,error:i}=await Xe.from("invoice_taxes").select("*, tax_codes(*)").eq("invoice_id",s);if(i)throw i;const{data:r,error:o}=await Xe.from("invoice_concepts").select("*, tango_concepts(*)").eq("invoice_id",s);if(o)throw o;const{data:l,error:c}=e.supplier_id?await Xe.from("suppliers").select("*").eq("id",e.supplier_id).maybeSingle():{data:null,error:null};if(c)throw c;return{invoice:e,taxes:n||[],concepts:r||[],supplier:l}}function LM(s){return s.type.startsWith("image/")}async function MM(s){return new Promise((e,t)=>{const n=new FileReader;n.onload=async i=>{var r;try{const o=new Image;o.src=(r=i.target)==null?void 0:r.result,o.onload=async()=>{const l=document.createElement("canvas");l.width=o.width,l.height=o.height;const c=l.getContext("2d");if(!c){t(new Error("No se pudo obtener el contexto del canvas"));return}c.fillStyle="white",c.fillRect(0,0,l.width,l.height),c.drawImage(o,0,0),l.toBlob(u=>{if(u){const h=s.name.replace(/\.(jpg|jpeg|png)$/i,".pdf"),d=new File([u],h,{type:"application/pdf"});e(d)}else t(new Error("No se pudo convertir la imagen a blob"))},"image/jpeg",.95)},o.onerror=()=>{t(new Error("Error al cargar la imagen"))}}catch(o){t(o)}},n.onerror=()=>{t(new Error("Error al leer el archivo"))},n.readAsDataURL(s)})}function FM({onInvoiceCreated:s}){const{profile:e}=rg(),[t,n]=Q.useState(!1),[i,r]=Q.useState([]),o=async l=>{if(!e)return;console.log("[Upload] Procesando archivos:",l.map(u=>({name:u.name,type:u.type,size:u.size}))),n(!0);const c=l.map(u=>({filename:u.name,status:"processing",message:"Procesando..."}));r(c);for(let u=0;u<l.length;u++)try{const h=l[u];let d=h;if(LM(h)){c[u]={...c[u],message:"Convirtiendo imagen a PDF..."},r([...c]);const A=await MM(h);d=new File([A],h.name.replace(/\.[^.]+$/,".pdf"),{type:"application/pdf"})}c[u]={...c[u],message:"Extrayendo datos del comprobante..."},r([...c]);let f,p="OpenAI";try{c[u]={...c[u],message:"Analizando comprobante con OpenAI..."},r([...c]),console.log(`[Upload] Iniciando OCR con OpenAI para: ${h.name}`),f=await wM(d),console.log(`[Upload] OpenAI OCR exitoso para: ${h.name}`,{supplierCuit:f.supplierCuit,invoiceType:f.invoiceType,invoiceNumber:f.invoiceNumber,confidence:f.confidence})}catch(A){console.error("[Upload] OpenAI OCR fall, usando OCR local como respaldo",A),p="Local (Tesseract)",c[u]={...c[u],message:"OpenAI fall, usando OCR local..."},r([...c]),console.log(`[Upload] Iniciando OCR local para: ${h.name}`),f=await XL(d),console.log(`[Upload] OCR local exitoso para: ${h.name}`,{supplierCuit:f.supplierCuit,invoiceType:f.invoiceType,invoiceNumber:f.invoiceNumber,confidence:f.confidence})}if(!f.supplierCuit||!f.invoiceType||!f.invoiceNumber)throw console.error("[Upload] Datos insuficientes extrados:",{supplierCuit:f.supplierCuit,invoiceType:f.invoiceType,invoiceNumber:f.invoiceNumber,ocrMethod:p}),new Error(`No se pudo extraer informacin suficiente del comprobante (mtodo: ${p})`);if(await NM(f.supplierCuit,f.invoiceType,f.pointOfSale||"00000",f.invoiceNumber)){c[u]={...c[u],status:"duplicate",message:"Comprobante duplicado - Ya existe en el sistema"},r([...c]);continue}c[u]={...c[u],message:"Guardando en base de datos..."},r([...c]);const _=await RM({supplier_cuit:f.supplierCuit,supplier_name:f.supplierName||"Sin nombre",invoice_type:f.invoiceType,point_of_sale:f.pointOfSale||"00000",invoice_number:f.invoiceNumber,issue_date:f.issueDate||new Date().toISOString().split("T")[0],net_taxed:f.netTaxed,net_untaxed:f.netUntaxed,net_exempt:f.netExempt,iva_amount:f.ivaAmount,other_taxes_amount:f.otherTaxesAmount,total_amount:f.totalAmount,status:f.confidence>=.7?"PROCESSED":"PENDING_REVIEW",ocr_confidence:f.confidence,created_by:e.id});if(f.taxes&&f.taxes.length>0)for(const A of f.taxes){const{data:m}=await Xe.from("tax_codes").select("id").eq("code",A.taxType).maybeSingle();m&&await Xe.from("invoice_taxes").insert({invoice_id:_.id,tax_code_id:m.id,tax_base:A.taxBase,tax_amount:A.taxAmount})}c[u]={...c[u],status:"success",message:`Comprobante procesado exitosamente con ${p}`,invoiceId:_.id},r([...c]),s&&s(_.id),console.log(`[Upload] Archivo procesado completamente: ${h.name}`)}catch(h){console.error(`[Upload] Error procesando ${file.name}:`,h),c[u]={...c[u],status:"error",message:h.message||"Error al procesar el archivo"},r([...c])}n(!1)};return E.jsxs("div",{className:"space-y-6",children:[E.jsxs("div",{children:[E.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Cargar Comprobantes"}),E.jsx("p",{className:"text-gray-600",children:"Arrastra archivos PDF o imgenes para procesar automticamente"})]}),E.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:E.jsx(DI,{onFilesSelected:o,disabled:t})}),i.length>0&&E.jsxs("div",{className:"bg-white rounded-lg shadow",children:[E.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:E.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Resultados del Procesamiento"})}),E.jsx("div",{className:"divide-y divide-gray-200",children:i.map((l,c)=>E.jsxs("div",{className:"px-6 py-4 flex items-start space-x-4",children:[E.jsxs("div",{className:"flex-shrink-0 mt-1",children:[l.status==="processing"&&E.jsx(SI,{className:"h-5 w-5 text-blue-500 animate-spin"}),l.status==="success"&&E.jsx(vI,{className:"h-5 w-5 text-green-500"}),l.status==="duplicate"&&E.jsx(FA,{className:"h-5 w-5 text-yellow-500"}),l.status==="error"&&E.jsx(FA,{className:"h-5 w-5 text-red-500"})]}),E.jsxs("div",{className:"flex-1 min-w-0",children:[E.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:l.filename}),E.jsx("p",{className:`text-sm mt-1 ${l.status==="success"?"text-green-600":l.status==="duplicate"?"text-yellow-600":l.status==="error"?"text-red-600":"text-gray-600"}`,children:l.message})]})]},c))})]})]})}function jM({title:s,children:e}){return E.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-slate-100",children:E.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e})})}const BM={UPLOADED:"Cargado",PROCESSED:"Procesado",PENDING_REVIEW:"Pendiente de Revisin",READY_FOR_EXPORT:"Listo para Exportar",EXPORTED:"Exportado",ERROR:"Error"},$M={UPLOADED:"bg-gray-100 text-gray-800",PROCESSED:"bg-blue-100 text-blue-800",PENDING_REVIEW:"bg-yellow-100 text-yellow-800",READY_FOR_EXPORT:"bg-green-100 text-green-800",EXPORTED:"bg-slate-100 text-slate-800",ERROR:"bg-red-100 text-red-800"};function UM(s){return BM[s]||s}function zM(s){return $M[s]||"bg-gray-100 text-gray-800"}function _T({status:s}){return E.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${zM(s)}`,children:UM(s)})}function HM({invoiceId:s,onClose:e,onSave:t}){const{profile:n}=rg(),[i,r]=Q.useState(!0),[o,l]=Q.useState(!1),[c,u]=Q.useState(null),[h,d]=Q.useState([]),[f,p]=Q.useState([]),[y,_]=Q.useState([]),[A,m]=Q.useState([]),[b,v]=Q.useState([]),[S,C]=Q.useState(""),[k,T]=Q.useState(""),[I,O]=Q.useState(!1),[L,j]=Q.useState("basic");Q.useEffect(()=>{H()},[s]);const H=async()=>{try{r(!0);const[P,R,N,D]=await Promise.all([OM(s),Xe.from("suppliers").select("*").order("razon_social"),Xe.from("tax_codes").select("*").eq("active",!0),Xe.from("tango_concepts").select("*").eq("active",!0).order("description")]);P&&(u(P.invoice),m(P.taxes),v(P.concepts)),d(R.data||[]),p(N.data||[]),_(D.data||[])}catch(P){console.error("Error loading data:",P)}finally{r(!1)}},J=async()=>{if(!(!c||!n))try{l(!0),await yS(c.id,{supplier_id:c.supplier_id,supplier_cuit:c.supplier_cuit,supplier_name:c.supplier_name,invoice_type:c.invoice_type,point_of_sale:c.point_of_sale,invoice_number:c.invoice_number,issue_date:c.issue_date,accounting_date:c.accounting_date,currency_code:c.currency_code,exchange_rate:c.exchange_rate,purchase_condition:c.purchase_condition,net_taxed:c.net_taxed,net_untaxed:c.net_untaxed,net_exempt:c.net_exempt,iva_amount:c.iva_amount,other_taxes_amount:c.other_taxes_amount,advance_payment:c.advance_payment,discount:c.discount,freight:c.freight,interest:c.interest,total_amount:c.total_amount,is_electronic:c.is_electronic,cai_cae:c.cai_cae,cai_cae_expiration:c.cai_cae_expiration,non_computable_tax_credit:c.non_computable_tax_credit,expense_code:c.expense_code,sector_code:c.sector_code,classifier_code:c.classifier_code,afip_operation_type_code:c.afip_operation_type_code,afip_voucher_code:c.afip_voucher_code,destination_branch_number:c.destination_branch_number,observations:c.observations,notes:c.notes,updated_by:n.id}),t()}catch(P){console.error("Error saving invoice:",P)}finally{l(!1)}},Y=async()=>{if(c)try{l(!0),await yS(c.id,{status:"READY_FOR_EXPORT"}),t()}catch(P){console.error("Error marking as ready:",P)}finally{l(!1)}},te=async P=>{try{await Xe.from("invoice_concepts").delete().eq("id",P),await H()}catch(R){console.error("Error removing concept:",R)}},G=async()=>{if(!(!n||!S||!k))try{const{data:P,error:R}=await Xe.from("tango_concepts").insert({tango_concept_code:S,description:k,created_by:n.id}).select().single();if(R)throw R;_([...y,P]),C(""),T(""),O(!1)}catch(P){console.error("Error creating concept:",P)}};if(i)return E.jsx("div",{className:"flex items-center justify-center p-8",children:E.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});if(!c)return E.jsx("div",{className:"p-8 text-center text-gray-500",children:"Comprobante no encontrado"});const M=[{id:"basic",label:"Datos Bsicos"},{id:"amounts",label:"Importes"},{id:"electronic",label:"Factura Electrnica"},{id:"classification",label:"Cdigos"},{id:"concepts",label:"Conceptos"}];return E.jsxs("div",{className:"h-full flex flex-col",children:[E.jsxs("div",{className:"bg-white border-b px-6 py-4 flex items-center justify-between",children:[E.jsxs("div",{className:"flex items-center space-x-4",children:[E.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"Editar Comprobante"}),E.jsx(_T,{status:c.status})]}),E.jsxs("div",{className:"flex items-center space-x-2",children:[c.status==="PENDING_REVIEW"&&E.jsxs("button",{onClick:Y,disabled:o,className:"px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 flex items-center space-x-2 disabled:opacity-50",children:[E.jsx(wI,{className:"h-4 w-4"}),E.jsx("span",{children:"Marcar como Listo"})]}),E.jsxs("button",{onClick:J,disabled:o,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center space-x-2 disabled:opacity-50",children:[E.jsx(kI,{className:"h-4 w-4"}),E.jsx("span",{children:"Guardar"})]}),E.jsxs("button",{onClick:e,className:"px-4 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center space-x-2",children:[E.jsx(nC,{className:"h-4 w-4"}),E.jsx("span",{children:"Cerrar"})]})]})]}),E.jsx("div",{className:"border-b bg-white",children:E.jsx("div",{className:"px-6",children:E.jsx("nav",{className:"flex space-x-8",children:M.map(P=>E.jsx("button",{onClick:()=>j(P.id),className:`py-4 px-1 border-b-2 font-medium text-sm ${L===P.id?"border-blue-600 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}`,children:P.label},P.id))})})}),E.jsxs("div",{className:"flex-1 overflow-auto p-6 bg-gray-50",children:[L==="basic"&&E.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[E.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:[E.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Informacin del Proveedor"}),E.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[E.jsxs("div",{className:"md:col-span-2",children:[E.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Proveedor ",E.jsx("span",{className:"text-red-500",children:"*"})]}),E.jsxs("select",{value:c.supplier_id||"",onChange:P=>{const R=h.find(N=>N.id===P.target.value);R&&u({...c,supplier_id:R.id,supplier_cuit:R.cuit,supplier_name:R.razon_social})},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[E.jsx("option",{value:"",children:"Seleccionar proveedor"}),h.map(P=>E.jsxs("option",{value:P.id,children:[P.razon_social," - ",OI(P.cuit)]},P.id))]})]}),E.jsxs("div",{children:[E.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["CUIT ",E.jsx("span",{className:"text-red-500",children:"*"})]}),E.jsx("input",{type:"text",value:c.supplier_cuit,onChange:P=>u({...c,supplier_cuit:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),E.jsxs("div",{children:[E.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Razn Social ",E.jsx("span",{className:"text-red-500",children:"*"})]}),E.jsx("input",{type:"text",value:c.supplier_name,onChange:P=>u({...c,supplier_name:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})]}),E.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:[E.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Datos del Comprobante"}),E.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[E.jsxs("div",{children:[E.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Tipo de Comprobante ",E.jsx("span",{className:"text-red-500",children:"*"})]}),E.jsx("select",{value:c.invoice_type,onChange:P=>u({...c,invoice_type:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:jI.map(P=>E.jsx("option",{value:P.value,children:P.label},P.value))})]}),E.jsxs("div",{children:[E.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Nro. de Comprobante ",E.jsx("span",{className:"text-red-500",children:"*"})]}),E.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[E.jsx("input",{type:"text",placeholder:"Punto Venta",value:c.point_of_sale,onChange:P=>u({...c,point_of_sale:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"}),E.jsx("input",{type:"text",placeholder:"Nmero",value:c.invoice_number,onChange:P=>u({...c,invoice_number:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]}),E.jsxs("div",{children:[E.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Fecha de Emisin ",E.jsx("span",{className:"text-red-500",children:"*"})]}),E.jsx("input",{type:"date",value:c.issue_date,onChange:P=>u({...c,issue_date:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),E.jsxs("div",{children:[E.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Fecha Contable ",E.jsx("span",{className:"text-red-500",children:"*"})]}),E.jsx("input",{type:"date",value:c.accounting_date||"",onChange:P=>u({...c,accounting_date:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),E.jsxs("div",{children:[E.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Moneda CTE ",E.jsx("span",{className:"text-red-500",children:"*"})]}),E.jsxs("select",{value:c.currency_code||"ARS",onChange:P=>u({...c,currency_code:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[E.jsx("option",{value:"ARS",children:"ARS - Peso Argentino"}),E.jsx("option",{value:"USD",children:"USD - Dlar"}),E.jsx("option",{value:"EUR",children:"EUR - Euro"})]})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cotizacin"}),E.jsx("input",{type:"number",step:"0.01",value:c.exchange_rate||1,onChange:P=>u({...c,exchange_rate:parseFloat(P.target.value)||1}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),E.jsxs("div",{className:"md:col-span-2",children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Condicin de Compra"}),E.jsx("input",{type:"text",value:c.purchase_condition||"",onChange:P=>u({...c,purchase_condition:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Ej: Contado, 30 das, etc."})]})]})]})]}),L==="amounts"&&E.jsx("div",{className:"max-w-4xl mx-auto space-y-6",children:E.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:[E.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Importes Base"}),E.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[E.jsxs("div",{children:[E.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Subtotal Gravado ",E.jsx("span",{className:"text-red-500",children:"*"})]}),E.jsx("input",{type:"number",step:"0.01",value:c.net_taxed,onChange:P=>u({...c,net_taxed:parseFloat(P.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Subtotal No Gravado"}),E.jsx("input",{type:"number",step:"0.01",value:c.net_untaxed,onChange:P=>u({...c,net_untaxed:parseFloat(P.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Anticipo o Sea"}),E.jsx("input",{type:"number",step:"0.01",value:c.advance_payment||0,onChange:P=>u({...c,advance_payment:parseFloat(P.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Bonificacin"}),E.jsx("input",{type:"number",step:"0.01",value:c.discount||0,onChange:P=>u({...c,discount:parseFloat(P.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Flete"}),E.jsx("input",{type:"number",step:"0.01",value:c.freight||0,onChange:P=>u({...c,freight:parseFloat(P.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Intereses"}),E.jsx("input",{type:"number",step:"0.01",value:c.interest||0,onChange:P=>u({...c,interest:parseFloat(P.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"IVA"}),E.jsx("input",{type:"number",step:"0.01",value:c.iva_amount,onChange:P=>u({...c,iva_amount:parseFloat(P.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Otros Impuestos"}),E.jsx("input",{type:"number",step:"0.01",value:c.other_taxes_amount,onChange:P=>u({...c,other_taxes_amount:parseFloat(P.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),E.jsxs("div",{className:"md:col-span-2 pt-4 border-t",children:[E.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:["Total ",E.jsx("span",{className:"text-red-500",children:"*"})]}),E.jsx("input",{type:"number",step:"0.01",value:c.total_amount,onChange:P=>u({...c,total_amount:parseFloat(P.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 font-bold text-lg"})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Crdito Fiscal No Computable"}),E.jsx("input",{type:"number",step:"0.01",value:c.non_computable_tax_credit||0,onChange:P=>u({...c,non_computable_tax_credit:parseFloat(P.target.value)||0}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})]})}),L==="electronic"&&E.jsx("div",{className:"max-w-4xl mx-auto space-y-6",children:E.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:[E.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Factura Electrnica"}),E.jsxs("div",{className:"space-y-4",children:[E.jsx("div",{children:E.jsxs("label",{className:"flex items-center space-x-2",children:[E.jsx("input",{type:"checkbox",checked:c.is_electronic||!1,onChange:P=>u({...c,is_electronic:P.target.checked}),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),E.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Es Factura Electrnica"})]})}),c.is_electronic&&E.jsxs(E.Fragment,{children:[E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"CAI / CAE"}),E.jsx("input",{type:"text",value:c.cai_cae||"",onChange:P=>u({...c,cai_cae:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Cdigo de Autorizacin Electrnica"})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Fecha de Vencimiento del CAI / CAE"}),E.jsx("input",{type:"date",value:c.cai_cae_expiration||"",onChange:P=>u({...c,cai_cae_expiration:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]})]})]})]})}),L==="classification"&&E.jsx("div",{className:"max-w-4xl mx-auto space-y-6",children:E.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:[E.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Cdigos de Clasificacin"}),E.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cdigo de Gasto"}),E.jsx("input",{type:"text",value:c.expense_code||"",onChange:P=>u({...c,expense_code:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cdigo de Sector"}),E.jsx("input",{type:"text",value:c.sector_code||"",onChange:P=>u({...c,sector_code:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cdigo de Clasificador"}),E.jsx("input",{type:"text",value:c.classifier_code||"",onChange:P=>u({...c,classifier_code:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cdigo de Tipo de Operacin AFIP"}),E.jsx("input",{type:"text",value:c.afip_operation_type_code||"",onChange:P=>u({...c,afip_operation_type_code:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cdigo de Comprobante AFIP"}),E.jsx("input",{type:"text",value:c.afip_voucher_code||"",onChange:P=>u({...c,afip_voucher_code:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),E.jsxs("div",{children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Nro. de Sucursal Destino"}),E.jsx("input",{type:"text",value:c.destination_branch_number||"",onChange:P=>u({...c,destination_branch_number:P.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),E.jsxs("div",{className:"md:col-span-2",children:[E.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Observaciones"}),E.jsx("textarea",{value:c.observations||"",onChange:P=>u({...c,observations:P.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Observaciones adicionales..."})]})]})]})}),L==="concepts"&&E.jsxs("div",{className:"max-w-4xl mx-auto space-y-6",children:[E.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:[E.jsxs("div",{className:"flex items-center justify-between mb-4",children:[E.jsx("h3",{className:"font-semibold text-gray-900",children:"Conceptos Asignados"}),E.jsxs("button",{onClick:()=>O(!I),className:"text-sm text-blue-600 hover:text-blue-700 flex items-center space-x-1",children:[E.jsx(CI,{className:"h-4 w-4"}),E.jsx("span",{children:"Nuevo Concepto"})]})]}),I&&E.jsxs("div",{className:"mb-4 p-4 bg-gray-50 rounded-lg border border-gray-200 space-y-3",children:[E.jsx("input",{type:"text",placeholder:"Cdigo Tango",value:S,onChange:P=>C(P.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"}),E.jsx("input",{type:"text",placeholder:"Descripcin",value:k,onChange:P=>T(P.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg text-sm"}),E.jsx("button",{onClick:G,className:"w-full px-3 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm",children:"Crear Concepto"})]}),E.jsxs("div",{className:"space-y-2",children:[b.map(P=>E.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200",children:[E.jsxs("div",{className:"flex-1",children:[E.jsx("div",{className:"text-sm font-medium text-gray-900",children:P.tango_concepts.tango_concept_code}),E.jsx("div",{className:"text-xs text-gray-500",children:P.tango_concepts.description})]}),E.jsxs("div",{className:"flex items-center space-x-3",children:[E.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["$",P.amount.toLocaleString("es-AR",{minimumFractionDigits:2})]}),E.jsx("button",{onClick:()=>te(P.id),className:"text-red-600 hover:text-red-700",children:E.jsx(PI,{className:"h-4 w-4"})})]})]},P.id)),b.length===0&&E.jsx("p",{className:"text-sm text-gray-500 text-center py-8",children:"No hay conceptos asignados"})]})]}),E.jsxs("div",{className:"bg-white rounded-lg p-6 shadow-sm",children:[E.jsx("h3",{className:"font-semibold text-gray-900 mb-4",children:"Notas Internas"}),E.jsx("textarea",{value:c.notes||"",onChange:P=>u({...c,notes:P.target.value}),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",placeholder:"Notas adicionales de uso interno..."})]})]})]})]})}async function VM(s){const e=await IM();if(e.length===0)throw new Error("No hay comprobantes listos para exportar");const t=e.map(m=>m.id),n=t.map(m=>Xe.from("invoice_taxes").select("*, tax_codes(*)").eq("invoice_id",m)),i=t.map(m=>Xe.from("invoice_concepts").select("*, tango_concepts(*)").eq("invoice_id",m)),[r,o,l]=await Promise.all([Promise.all(n),Promise.all(i),Xe.from("suppliers").select("*")]),c=l.data||[],u=new Map(c.map(m=>[m.id,m])),h=[],d=[],f=[];e.forEach((m,b)=>{const v=m.supplier_id?u.get(m.supplier_id):null,S=(v==null?void 0:v.tango_supplier_code)||m.supplier_cuit;h.push({"ID Comprobante":m.internal_invoice_id,"Cdigo de proveedor / CUIT":S,"Tipo de comprobante":WM(m.invoice_type),"Nro. de comprobante":`${m.point_of_sale}-${m.invoice_number}`,"Fecha de emisin":Wg(m.issue_date),"Fecha contable":m.accounting_date?Wg(m.accounting_date):Wg(m.issue_date),"Moneda CTE":m.currency_code||"ARS",Cotizacin:Gi(m.exchange_rate||1),"Condicin de compra":m.purchase_condition||"","Subtotal gravado":Gi(m.net_taxed),"Subtotal no gravado":Gi(m.net_untaxed),"Anticipo o sea":Gi(m.advance_payment||0),Bonificacin:Gi(m.discount||0),Flete:Gi(m.freight||0),Intereses:Gi(m.interest||0),Total:Gi(m.total_amount),"Es factura electrnica":m.is_electronic?"SI":"NO","CAI / CAE":m.cai_cae||"","Fecha de vencimiento del CAI / CAE":m.cai_cae_expiration?Wg(m.cai_cae_expiration):"","Crdito fiscal no computable":Gi(m.non_computable_tax_credit||0),"Cdigo de gasto":m.expense_code||"","Cdigo de sector":m.sector_code||"","Cdigo de clasificador":m.classifier_code||"","Cdigo de tipo de operacin AFIP":m.afip_operation_type_code||"","Cdigo de comprobante AFIP":m.afip_voucher_code||"","Nro. de sucursal destino":m.destination_branch_number||"",Observaciones:m.observations||""}),(r[b].data||[]).forEach(T=>{T.tax_codes&&d.push({"ID Comprobante":m.internal_invoice_id,"Cdigo Impuesto":T.tax_codes.tango_code,Descripcin:T.tax_codes.description,"Base Imponible":T.tax_base,Importe:T.tax_amount})}),(o[b].data||[]).forEach(T=>{T.tango_concepts&&f.push({"ID Comprobante":m.internal_invoice_id,"Cdigo Concepto":T.tango_concepts.tango_concept_code,"Descripcin Concepto":T.tango_concepts.description,Importe:T.amount})})});const y=`TANGO_ComprasConceptos_${new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5)}.xlsx`,{data:_,error:A}=await Xe.from("export_batches").insert({filename:y,invoice_count:e.length,total_amount:e.reduce((m,b)=>m+b.total_amount,0),generated_by:s}).select().single();if(A)throw A;return await DM(t,_.id),{filename:y,data:{headers:h,taxes:d,concepts:f},invoiceIds:t}}function WM(s){return{FACTURA_A:"FA",FACTURA_B:"FB",FACTURA_C:"FC",FACTURA_M:"FM",NOTA_CREDITO_A:"NCA",NOTA_CREDITO_B:"NCB",NOTA_CREDITO_C:"NCC",NOTA_DEBITO_A:"NDA",NOTA_DEBITO_B:"NDB",NOTA_DEBITO_C:"NDC"}[s]||s}function Wg(s){const e=new Date(s),t=String(e.getDate()).padStart(2,"0"),n=String(e.getMonth()+1).padStart(2,"0"),i=e.getFullYear();return`${t}/${n}/${i}`}function Gi(s){return s==null?"0":s.toFixed(2)}function hv(s){if(s.length===0)return"";const e=Object.keys(s[0]),t=s.map(n=>e.map(i=>{const r=n[i];return typeof r=="string"&&(r.includes(",")||r.includes('"'))?`"${r.replace(/"/g,'""')}"`:r}).join(","));return[e.join(","),...t].join(`
`)}function GM(s,e){const t=hv(e.headers),n=hv(e.taxes),i=hv(e.concepts),r=`=== HOJA 1: ENCABEZADOS ===
${t}

=== HOJA 2: IVA Y OTROS IMPUESTOS ===
${n}

=== HOJA 3: CONCEPTOS ===
${i}`,o=new Blob([r],{type:"text/plain;charset=utf-8"}),l=window.URL.createObjectURL(o),c=document.createElement("a");c.href=l,c.download=s.replace(".xlsx",".txt"),document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(l)}function qM(){const{profile:s}=rg(),[e,t]=Q.useState("upload"),[n,i]=Q.useState(null),[r,o]=Q.useState(0),l=Q.useMemo(()=>[{id:"upload",label:"Carga automtica"},{id:"review",label:"Revisin y edicin"},{id:"export",label:"Exportar a Tango"}],[]),c=h=>{o(d=>d+1),t("review"),h&&i(h)},u=()=>{o(h=>h+1)};return E.jsx(jM,{title:"Grow Labs  Gestin de comprobantes",children:E.jsxs("div",{className:"space-y-12",children:[E.jsxs("section",{className:"rounded-3xl border border-blue-200 bg-white shadow-sm",children:[E.jsx("div",{className:"flex flex-wrap items-center gap-3 border-b border-blue-100 px-6 py-5",children:l.map(h=>{const d=h.id===e;return E.jsx("button",{type:"button",onClick:()=>t(h.id),className:`rounded-full px-4 py-2 text-sm font-semibold transition ${d?"bg-blue-600 text-white shadow-lg shadow-blue-500/30":"bg-white text-blue-700 border border-blue-200 hover:border-blue-400 hover:text-blue-900"}`,children:h.label},h.id)})}),E.jsxs("div",{className:"p-6 sm:p-8",children:[e==="upload"&&E.jsx(FM,{onInvoiceCreated:c}),e==="review"&&E.jsx(KM,{refreshKey:r,selectedInvoiceId:n,onSelectInvoice:i,onInvoiceUpdated:u}),e==="export"&&s&&E.jsx(XM,{refreshKey:r,profileId:s.id,onExportCompleted:u}),e==="export"&&!s&&E.jsx("div",{className:"rounded-3xl border border-amber-200 bg-amber-50 p-6 text-amber-700",children:"Necesitamos tu perfil para generar el archivo de exportacin. Vuelve a iniciar sesin e intntalo nuevamente."})]})]}),E.jsx("footer",{className:"bg-gradient-to-br from-gray-900 via-gray-800 to-blue-900 text-white py-12 mt-16 rounded-3xl shadow-xl",children:E.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[E.jsxs("div",{className:"grid md:grid-cols-2 gap-8 mb-8",children:[E.jsxs("div",{children:[E.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[E.jsx("img",{src:"/logo-header.png",alt:"Grow Labs Logo",className:"h-12 w-12 object-contain bg-white rounded-full p-1"}),E.jsxs("div",{children:[E.jsx("h3",{className:"text-2xl font-bold text-white",children:"Grow Labs"}),E.jsx("p",{className:"text-blue-400 text-sm font-medium",children:"Donde tus ideas crecen"})]})]}),E.jsx("p",{className:"text-gray-300 mb-4 leading-relaxed",children:"Startup tecnolgica especializada en inteligencia artificial y automatizacin de procesos. Transformamos ideas en soluciones innovadoras para gestin documental y trazabilidad financiera."}),E.jsxs("div",{className:"flex flex-wrap gap-3",children:[E.jsxs("a",{href:"https://www.instagram.com/growsanjuan/",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 bg-gradient-to-br from-pink-500 to-orange-500 hover:from-pink-600 hover:to-orange-600 text-white px-4 py-2 rounded-lg transition-all shadow-md hover:shadow-lg",children:[E.jsx(xI,{className:"w-5 h-5"}),E.jsx("span",{className:"text-sm font-medium",children:"Instagram"})]}),E.jsxs("a",{href:"https://api.whatsapp.com/send/?phone=5492643229503&text&type=phone_number&app_absent=0",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-all shadow-md hover:shadow-lg",children:[E.jsx(EI,{className:"w-5 h-5"}),E.jsx("span",{className:"text-sm font-medium",children:"WhatsApp"})]})]}),E.jsxs("div",{className:"flex flex-wrap gap-3 mt-3",children:[E.jsxs("a",{href:"https://www.growsanjuan.com",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-all shadow-md hover:shadow-lg",children:[E.jsx(_I,{className:"w-5 h-5"}),E.jsx("span",{className:"text-sm font-medium",children:"Sitio Web"})]}),E.jsxs("a",{href:"https://www.linkedin.com/in/lucas-marinero-182521308/",target:"_blank",rel:"noopener noreferrer",className:"flex items-center gap-2 bg-blue-700 hover:bg-blue-800 text-white px-4 py-2 rounded-lg transition-all shadow-md hover:shadow-lg",children:[E.jsx(AI,{className:"w-5 h-5"}),E.jsx("span",{className:"text-sm font-medium",children:"LinkedIn"})]})]})]}),E.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 border border-blue-500/30",children:[E.jsxs("h4",{className:"text-xl font-bold text-white mb-3 flex items-center gap-2",children:[E.jsx(TI,{className:"w-6 h-6 text-blue-400"}),"Cliente Exclusivo"]}),E.jsxs("div",{className:"space-y-2",children:[E.jsx("p",{className:"text-gray-300 text-sm",children:"Esta plataforma fue desarrollada a medida para automatizar la importacin de comprobantes en:"}),E.jsx("p",{className:"text-xl font-bold text-blue-400",children:"Sanatorio Argentino"}),E.jsx("p",{className:"text-gray-400 text-sm",children:"San Juan, Argentina"}),E.jsx("div",{className:"mt-4 pt-4 border-t border-gray-600",children:E.jsx("p",{className:"text-xs text-gray-400",children:"Sistema de gestin y exportacin de comprobantes con integracin a Tango Gestin y motores de IA."})})]})]})]}),E.jsx("div",{className:"border-t border-gray-700 pt-6 text-center",children:E.jsx("p",{className:"text-gray-400 text-sm",children:" 2025 Grow Labs. Todos los derechos reservados. | Powered by IA & Automatizacin financiera"})})]})})]})})}function KM({refreshKey:s,selectedInvoiceId:e,onSelectInvoice:t,onInvoiceUpdated:n}){const[i,r]=Q.useState([]),[o,l]=Q.useState(!0),[c,u]=Q.useState(null),h=Q.useCallback(async()=>{try{l(!0),u(null);const f=await bT();r(f)}catch(f){u(f instanceof Error?f.message:"No pudimos cargar los comprobantes.")}finally{l(!1)}},[]);Q.useEffect(()=>{h()},[h,s]);const d=i.map(f=>({...f,formattedDate:f.issue_date?new Date(f.issue_date).toLocaleDateString("es-AR"):"Sin fecha",formattedTotal:new Intl.NumberFormat("es-AR",{style:"currency",currency:"ARS",maximumFractionDigits:2}).format(f.total_amount??0)}));return E.jsxs("div",{className:"grid gap-6 xl:grid-cols-[minmax(0,1fr)_minmax(0,1fr)]",children:[E.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden",children:[E.jsxs("div",{className:"border-b border-slate-200 px-6 py-4",children:[E.jsx("h2",{className:"text-lg font-semibold text-slate-900",children:"Comprobantes recientes"}),E.jsx("p",{className:"text-sm text-slate-500",children:"Selecciona un comprobante para revisarlo y editar sus datos."})]}),o?E.jsx("div",{className:"p-6 text-sm text-slate-500",children:"Cargando comprobantes..."}):c?E.jsx("div",{className:"p-6 text-sm text-red-600",children:c}):d.length===0?E.jsx("div",{className:"p-6 text-sm text-slate-500",children:"Todava no hay comprobantes en el sistema."}):E.jsx("div",{className:"overflow-x-auto",children:E.jsxs("table",{className:"min-w-full divide-y divide-slate-200",children:[E.jsx("thead",{className:"bg-slate-50",children:E.jsxs("tr",{children:[E.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Fecha"}),E.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Proveedor"}),E.jsx("th",{className:"px-6 py-3 text-left text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Comprobante"}),E.jsx("th",{className:"px-6 py-3 text-right text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Total"}),E.jsx("th",{className:"px-6 py-3 text-center text-xs font-semibold uppercase tracking-wide text-slate-500",children:"Estado"})]})}),E.jsx("tbody",{className:"divide-y divide-slate-100",children:d.map(f=>{const p=f.id===e;return E.jsxs("tr",{role:"button",tabIndex:0,className:`cursor-pointer transition ${p?"bg-slate-50":"hover:bg-slate-50"}`,onClick:()=>t(f.id),onKeyDown:y=>{(y.key==="Enter"||y.key===" ")&&(y.preventDefault(),t(f.id))},children:[E.jsx("td",{className:"px-6 py-3 text-sm text-slate-700",children:f.formattedDate}),E.jsx("td",{className:"px-6 py-3 text-sm font-medium text-slate-900",children:f.supplier_name}),E.jsxs("td",{className:"px-6 py-3 text-sm text-slate-600",children:[f.invoice_type,"  ",f.point_of_sale,"-",f.invoice_number]}),E.jsx("td",{className:"px-6 py-3 text-sm text-right font-semibold text-slate-900",children:f.formattedTotal}),E.jsx("td",{className:"px-6 py-3 text-center",children:E.jsx(_T,{status:f.status})})]},f.id)})})]})})]}),E.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-slate-200",children:e?E.jsx(HM,{invoiceId:e,onClose:()=>t(null),onSave:()=>{n(),h()}}):E.jsx("div",{className:"flex h-full items-center justify-center p-12 text-center text-slate-500",children:"Selecciona un comprobante de la lista para abrir el editor."})})]})}function XM({refreshKey:s,profileId:e,onExportCompleted:t}){const[n,i]=Q.useState([]),[r,o]=Q.useState(!0),[l,c]=Q.useState(!1),[u,h]=Q.useState(null),[d,f]=Q.useState(null),p=Q.useCallback(async()=>{try{o(!0),f(null);const A=await bT({status:"READY_FOR_EXPORT"});i(A)}catch(A){f(A instanceof Error?A.message:"No pudimos cargar los comprobantes listos para exportar.")}finally{o(!1)}},[]);Q.useEffect(()=>{p()},[p,s]);const y=n.reduce((A,m)=>A+(m.total_amount??0),0),_=async()=>{try{c(!0),f(null),h(null);const A=await VM(e);GM(A.filename,A.data),h(`Exportamos ${A.invoiceIds.length} comprobantes correctamente.`),t(),await p()}catch(A){f(A instanceof Error?A.message:"No pudimos generar la exportacin. Intenta nuevamente.")}finally{c(!1)}};return E.jsxs("div",{className:"space-y-6",children:[E.jsxs("div",{className:"rounded-3xl border border-blue-500/30 bg-blue-50 p-6 text-blue-900",children:[E.jsx("h3",{className:"text-xl font-semibold",children:"Exportacin a Tango Gestin"}),E.jsx("p",{className:"mt-2 text-sm text-blue-700",children:"Genera un archivo compatible con Tango que incluye encabezados, impuestos y conceptos para cada comprobante."})]}),d&&E.jsx("div",{className:"rounded-2xl border border-red-300 bg-red-50 px-4 py-3 text-sm text-red-700",children:d}),u&&E.jsx("div",{className:"rounded-2xl border border-blue-300 bg-blue-50 px-4 py-3 text-sm text-blue-700",children:u}),E.jsxs("div",{className:"grid gap-4 sm:grid-cols-2",children:[E.jsxs("div",{className:"rounded-3xl border border-blue-200 bg-white p-6 shadow-sm",children:[E.jsx("p",{className:"text-sm font-medium text-blue-700",children:"Comprobantes listos"}),E.jsx("p",{className:"mt-2 text-4xl font-bold text-blue-900",children:r?"...":n.length})]}),E.jsxs("div",{className:"rounded-3xl border border-blue-200 bg-white p-6 shadow-sm",children:[E.jsx("p",{className:"text-sm font-medium text-blue-700",children:"Total acumulado"}),E.jsx("p",{className:"mt-2 text-3xl font-bold text-blue-900",children:r?"...":y.toLocaleString("es-AR",{style:"currency",currency:"ARS"})})]})]}),E.jsx("button",{type:"button",onClick:_,disabled:l||n.length===0,className:"inline-flex items-center justify-center rounded-xl bg-blue-600 px-6 py-3 text-sm font-semibold text-white shadow-lg shadow-blue-900/30 transition hover:bg-blue-500 disabled:cursor-not-allowed disabled:opacity-60",children:l?"Generando archivo...":"Exportar a Tango Gestin"}),E.jsxs("p",{className:"text-sm text-slate-500",children:["El archivo se descargar en formato ",E.jsx("span",{className:"font-semibold",children:"TXT"})," con las tres secciones concatenadas siguiendo el formato oficial de importacin masiva de Tango."]})]})}function YM(){return E.jsx(gI,{children:E.jsx(II,{children:E.jsx(qM,{})})})}NE(document.getElementById("root")).render(E.jsx(Q.StrictMode,{children:E.jsx(YM,{})}));
